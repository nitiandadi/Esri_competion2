/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
import{convertFromGeometry as e}from"../graphics/featureConversionUtils.js";import{OptimizedFeature as r}from"../graphics/OptimizedFeature.js";const t="ESRI__DESTINATION_ID",i="ESRI__ORIGIN_ID";class s{constructor(){this._featureLookup=new Map}static getInstance(){return s.instance||(s.instance=new s),s.instance}deleteFromStore(e){e.forEach((e=>{this._featureLookup.delete(e)}))}readFromStoreByList(e){const r=[];return e.forEach((e=>{const t=this.readFromStoreById(e);t&&r.push(t)})),r}readFromStoreById(e){const r=this._featureLookup.get(e);return r||null}writeToStore(s,o,n){const p=[];return s.forEach((s=>{if(!s||!s.id)return;s.properties||(s.properties=[]);let a,u=null;if(n&&(u=s.properties[n]?e(s.properties[n]):null),"originId"in s&&"destinationId"in s&&(s.properties[i]=s.originId,s.properties[t]=s.destinationId),s.properties[o]=s.id,s.id&&this._featureLookup.has(s.id)){const e=this._featureLookup.get(s.id);a=new r(u?JSON.parse(JSON.stringify(u)):e?.geometry?JSON.parse(JSON.stringify(e.geometry)):null,JSON.parse(JSON.stringify(Object.assign(s.properties,e?.attributes))),null,s.properties[o])}else a=new r(u?JSON.parse(JSON.stringify(u)):null,s.properties,null,s.properties[o]);this._featureLookup.set(s.id,a),p.push(a)})),p}}export{s as default};
