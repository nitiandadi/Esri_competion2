/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
import{isSome as t}from"../../../core/maybe.js";import e from"../PixelBlock.js";import{localTrigonometricOperation as n,localLogicalOperation as r,localConditionalOperation as o}from"../rasterFunctionConstants.js";import{getPixelValueRange as s}from"../rasterFormats/pixelRangeUtils.js";const a=new Map;function l(t){return a.get(t)}a.set(n.acos,[0,Math.PI]),a.set(n.asin,[-Math.PI/2,Math.PI/2]),a.set(n.atan,[-Math.PI/2,Math.PI/2]),a.set(n.cos,[-1,1]),a.set(n.sin,[-1,1]),a.set(r.booleanAnd,[0,1]),a.set(r.booleanNot,[0,1]),a.set(r.booleanOr,[0,1]),a.set(r.booleanXOr,[0,1]),a.set(r.equalTo,[0,1]),a.set(r.notEqual,[0,1]),a.set(r.greaterThan,[0,1]),a.set(r.greaterThanEqual,[0,1]),a.set(r.lessThan,[0,1]),a.set(r.lessThanEqual,[0,1]),a.set(r.isNull,[0,1]);const c=[0,2,2,2,1,2,1,1,1,1,1,2,2,1,2,2,2,2,1,2,2,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,999,999,999,999,999,999,2,1,2,999,1,1,2,1,1,1,999,999,1,1,999,1,1,2,999,999,2,2,999,999,999,999,999,999,999,999,999,999,3,999,3];function f(e,n=!1){const r=e.map((t=>t.mask)),o=r.filter((e=>t(e))),s=e[0].pixels[0].length;if(0===o.length)return new Uint8Array(s).fill(255);const a=o[0],l=new Uint8Array(a);if(1===o.length)return l;if(!n){for(let t=1;t<o.length;t++){const e=o[t];for(let t=0;t<l.length;t++)l[t]&&(l[t]=e[t]?255:0)}return l}if(o.length!==r.length)return new Uint8Array(s).fill(255);for(let t=1;t<o.length;t++){const e=o[t];for(let t=0;t<l.length;t++)0===l[t]&&(l[t]=e[t]?255:0)}return l}function u(t,n,r){const[o,s]=t,a=o.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)n&&!n[e]||(l[e]=o[e]+s[e]);return l}function h(t,n,r){const[o]=t,s=o.length,a=e.createEmptyBand("f32",s);return a.set(o),a}function i(t,n,r){const[o,s]=t,a=o.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)n&&!n[e]||(l[e]=o[e]-s[e]);return l}function g(t,n,r){const[o,s]=t,a=o.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)n&&!n[e]||(l[e]=o[e]*s[e]);return l}function p(t,n,r){const[o]=t,s=o.length,a=e.createEmptyBand(r,s);for(let e=0;e<s;e++)n&&!n[e]||(a[e]=Math.sign(o[e])*Math.floor(Math.abs(o[e])));return a}function m(t,n,r){const[o,s]=t,a=o.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)n&&!n[e]||(l[e]=o[e]/s[e]);return l}function y(t,e,n){return m(t,e,"f32")}function d(t,n,r){const[o,s]=t,a=o.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)n&&!n[e]||(l[e]=Math.floor(o[e]/s[e]));return l}function M(t,r,o,s){const a=t[0],l=a.length,c=e.createEmptyBand(o,l);if(s===n.atanh){for(let t=0;t<l;t++)if(r[t]){const e=a[t];Math.abs(e)>=1?r[t]=0:c[t]=Math.atanh(e)}return c}const f=s===n.asin?Math.asin:Math.acos;for(let e=0;e<l;e++)if(r[e]){const t=a[e];Math.abs(t)>1?r[e]=0:c[e]=f(t)}return c}function E(t,n,r,o){const[s]=t,a=s.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)n&&!n[e]||(l[e]=o(s[e]));return l}function B(t,n,r,o){const[s,a]=t,l=s.length,c=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(c[e]=o(s[e],a[e]));return c}function w(t,n,r){const[o,s]=t,a=o.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)n&&!n[e]||(l[e]=o[e]&s[e]);return l}function b(t,n,r){const[o,s]=t,a=o.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)n&&!n[e]||(l[e]=o[e]<<s[e]);return l}function x(t,n,r){const[o]=t,s=o.length,a=e.createEmptyBand(r,s);for(let e=0;e<s;e++)n&&!n[e]||(a[e]=~o[e]);return a}function A(t,n,r){const[o,s]=t,a=o.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)n&&!n[e]||(l[e]=o[e]|s[e]);return l}function k(t,n,r){const[o,s]=t,a=o.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)n&&!n[e]||(l[e]=o[e]>>s[e]);return l}function N(t,n,r){const[o,s]=t,a=o.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)n&&!n[e]||(l[e]=o[e]^s[e]);return l}function P(t,n,r){const[o,s]=t,a=o.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)n&&!n[e]||(l[e]=o[e]&&s[e]?1:0);return l}function T(t,n,r){const[o]=t,s=o.length,a=e.createEmptyBand(r,s);for(let e=0;e<s;e++)n&&!n[e]||(a[e]=o[e]?0:1);return a}function q(t,n,r){const[o,s]=t,a=o.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)n&&!n[e]||(l[e]=o[e]||s[e]?1:0);return l}function U(t,n,r){const[o,s]=t,a=o.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)n&&!n[e]||(l[e]=(o[e]?1:0)^(s[e]?1:0));return l}function I(t,n,r){const[o,s]=t,a=o.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)n&&!n[e]||(l[e]=o[e]===s[e]?1:0);return l}function j(t,n,r,o){const[s]=t,a=s.length,l=e.createEmptyBand(r,a),c=o===Math.E;for(let e=0;e<a;e++)n&&!n[e]||(l[e]=c?Math.exp(s[e]):o**s[e]);return l}function F(t,e,n){return j(t,e,n,10)}function z(t,e,n){return j(t,e,n,2)}function O(t,e,n){return j(t,e,n,Math.E)}function W(t,n,r,o){const[s]=t,a=s.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)n&&!n[e]||(s[e]<=0?n[e]=0:l[e]=o(s[e]));return l}function C(t,e,n){return W(t,e,n,Math.log10)}function R(t,e,n){return W(t,e,n,Math.log2)}function S(t,e,n){return W(t,e,n,Math.log)}function X(t,n,r){const[o,s]=t,a=o.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)n&&!n[e]||(l[e]=o[e]>s[e]?1:0);return l}function v(t,n,r){const[o,s]=t,a=o.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)n&&!n[e]||(l[e]=o[e]>=s[e]?1:0);return l}function D(t,n,r){const[o,s]=t,a=o.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)n&&!n[e]||(l[e]=o[e]<s[e]?1:0);return l}function G(t,n,r){const[o,s]=t,a=o.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)n&&!n[e]||(l[e]=o[e]<=s[e]?1:0);return l}function H(t,n,r){const[o]=t,s=o.length,a=e.createEmptyBand(r,s);if(!n)return a;for(let e=0;e<s;e++)a[e]=n[e]?0:1;return a}function J(t,n,r){const[o,s]=t,a=o.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)n&&!n[e]||(l[e]=o[e]%s[e]);return l}function K(t,n,r){const[o]=t,s=o.length,a=e.createEmptyBand(r,s);for(let e=0;e<s;e++)n&&!n[e]||(a[e]=-o[e]);return a}function L(t,n,r){const[o,s]=t,a=o.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)n&&!n[e]||(l[e]=o[e]===s[e]?0:1);return l}function Q(t,n,r){const[o,s]=t,a=o.length,l=e.createEmptyBand(r,a),c=new Uint8Array(a);for(let e=0;e<a;e++)null!=n&&!n[e]||0!==o[e]||(l[e]=s[e],c[e]=255);return{band:l,mask:c}}function V(t,n,r){const[o,s,a]=t,l=o.length,c=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(c[e]=o[e]?s[e]:a[e]);return c}function Y(t,n,r){const o=t.length;if(o<2)return t[0];const[s]=t,a=s.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)if(!n||n[e]){let n=s[e];for(let r=1;r<o;r++){const o=t[r][e];n<o&&(n=o)}l[e]=n}return l}function Z(t,n,r){const o=t.length;if(o<2)return t[0];const[s]=t,a=s.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)if(!n||n[e]){let n=s[e];for(let r=1;r<o;r++){const o=t[r][e];n>o&&(n=o)}l[e]=n}return l}function $(t,n,r){const o=t.length;if(o<2)return t[0];const[s]=t,a=s.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)if(!n||n[e]){let n=s[e],r=n;for(let s=1;s<o;s++){const o=t[s][e];r<o?r=o:n>o&&(n=o)}l[e]=r-n}return l}function _(t,n,r){const o=t.length;if(o<2)return t[0];const[s]=t,a=s.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)if(!n||n[e]){let n=0;for(let r=0;r<o;r++)n+=t[r][e];l[e]=n/o}return l}function tt(t,n,r){const o=t.length;if(o<2)return t[0];const[s]=t,a=s.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)if(!n||n[e])for(let n=0;n<o;n++){const r=t[n];l[e]+=r[e]}return l}function et(t,n,r){const o=t.length;if(o<2)return t[0];const[s]=t,a=s.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)if(!n||n[e]){const n=new Float32Array(o);let r=0;for(let a=0;a<o;a++){const o=t[a];r+=o[e],n[a]=o[e]}r/=o;let s=0;for(let t=0;t<o;t++)s+=(n[t]-r)**2;l[e]=Math.sqrt(s/o)}return l}function nt(t,n,r){const o=t.length;if(o<2)return t[0];const s=Math.floor(o/2),[a]=t,l=a.length,c=e.createEmptyBand(r,l),f=new Float32Array(o),u=o%2==1;for(let e=0;e<l;e++)if(!n||n[e]){for(let n=0;n<o;n++)f[n]=t[n][e];f.sort(),c[e]=u?f[s]:(f[s]+f[s-1])/2}return c}function rt(t,n,r){const[o,s]=t;if(null==s)return o;const a=o.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)n[e]&&(o[e]===s[e]?l[e]=o[e]:n[e]=0);return l}function ot(t,n,r){const o=t.length;if(o<=2)return rt(t,n,r);const s=t[0].length,a=e.createEmptyBand(r,s),l=new Map;for(let e=0;e<s;e++)if(!n||n[e]){let n;l.clear();for(let a=0;a<o;a++)n=t[a][e],l.set(n,l.has(n)?l.get(n)+1:1);let r=0,s=0;for(const t of l.keys())r=l.get(t),r>s&&(s=r,n=t);a[e]=n}return a}function st(t,n,r){const o=t.length;if(o<=2)return rt(t,n,r);const s=t[0].length,a=e.createEmptyBand(r,s),l=new Map;for(let e=0;e<s;e++)if(!n||n[e]){let n;l.clear();for(let a=0;a<o;a++)n=t[a][e],l.set(n,l.has(n)?l.get(n)+1:1);let r=0,s=t.length;for(const t of l.keys())r=l.get(t),r<s&&(s=r,n=t);a[e]=n}return a}function at(t,n,r){const o=t.length;if(o<2)return t[0];const[s]=t,a=s.length,l=e.createEmptyBand(r,a),c=new Set;for(let e=0;e<a;e++)if(!n||n[e]){let n;c.clear();for(let r=0;r<o;r++)n=t[r][e],c.add(n);l[e]=c.size}return l}const lt=new Map,ct=new Map,ft=new Map,ut=new Map;function ht(){lt.size||(lt.set(4,Math.sqrt),lt.set(6,Math.acos),lt.set(7,Math.asin),lt.set(8,Math.atan),lt.set(9,Math.atanh),lt.set(10,Math.abs),lt.set(21,Math.cos),lt.set(22,Math.cosh),lt.set(48,Math.floor),lt.set(49,Math.ceil),lt.set(51,Math.sin),lt.set(52,Math.sinh),lt.set(56,Math.tan),lt.set(57,Math.tanh),lt.set(59,Math.acosh),lt.set(60,Math.asinh),lt.set(65,Math.floor),ct.set(5,Math.pow),ct.set(61,Math.atan2),ft.set(1,u),ft.set(2,i),ft.set(3,g),ft.set(11,w),ft.set(12,b),ft.set(12,b),ft.set(13,x),ft.set(14,A),ft.set(15,k),ft.set(16,N),ft.set(17,P),ft.set(18,T),ft.set(19,q),ft.set(20,U),ft.set(23,m),ft.set(24,I),ft.set(25,O),ft.set(26,F),ft.set(27,z),ft.set(28,X),ft.set(29,v),ft.set(30,p),ft.set(31,H),ft.set(32,h),ft.set(33,D),ft.set(34,G),ft.set(35,S),ft.set(36,C),ft.set(37,R),ft.set(44,J),ft.set(45,K),ft.set(46,L),ft.set(64,y),ft.set(65,d),ft.set(76,V),ft.set(78,V),ut.set(38,ot),ut.set(39,Y),ut.set(40,_),ut.set(41,nt),ut.set(42,Z),ut.set(43,st),ut.set(47,$),ut.set(54,et),ut.set(55,tt),ut.set(58,at),ut.set(66,ot),ut.set(67,Y),ut.set(68,_),ut.set(69,nt),ut.set(70,Z),ut.set(71,st),ut.set(72,$),ut.set(73,et),ut.set(74,tt),ut.set(75,at))}function it(t,e,n,r){let[o,a]=s(n);const l=n.startsWith("u")||n.startsWith("s");l&&(o-=1e-5,a+=1e-5);for(let s=0;s<e.length;s++)if(e[s]){const n=t[s];isNaN(n)||n<o||n>a?e[s]=0:r[s]=l?Math.round(n):n}}function gt(t,s,l={}){ht();let c=f(t,s>=66&&s<=75);const{outputPixelType:u="f32"}=l,h=!ut.has(s)||l.processAsMultiband,i=h?t[0].pixels.length:1,g=[];for(let f=0;f<i;f++){const l=ut.has(s)&&!h?t.flatMap((t=>t.pixels)):t.map((t=>t.pixels[f]));let i,p=!0;if(s===o.setNull){const t=Q(l,c,u);i=t.band,c=t.mask,p=!1}else if(ft.has(s)){i=ft.get(s)(l,c,"f64")}else if(lt.has(s))i=s===n.asin||s===n.acos||s===n.atanh?M(l,c,"f64",s):E(l,c,"f64",lt.get(s));else if(ct.has(s))i=B(l,c,"f64",ct.get(s));else if(ut.has(s)){i=ut.get(s)(l,c,"f64")}else i=l[0],p=!1;if(p&&s!==r.isNull&&!a.has(s)){const t=e.createEmptyBand(u,i.length);c||(c=new Uint8Array(i.length).fill(255)),it(i,c,u,t),i=t}g.push(i)}const p=t[0];return new e({width:p.width,height:p.height,pixelType:u,mask:s===r.isNull?null:c,pixels:g})}export{l as getOutputDomain,gt as local,c as operandsCount};
