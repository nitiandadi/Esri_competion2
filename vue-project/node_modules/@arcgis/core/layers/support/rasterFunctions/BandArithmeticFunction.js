/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
import{_ as e}from"../../../chunks/tslib.es6.js";import{isNone as s}from"../../../core/maybe.js";import{property as t}from"../../../core/accessorSupport/decorators/property.js";import"../../../core/accessorSupport/ensureType.js";import"../../../core/arrayUtils.js";import{subclass as r}from"../../../core/accessorSupport/decorators/subclass.js";import n from"./BandArithmeticFunctionArguments.js";import{calculateBandIndex as a,getBandMatrix3 as i}from"./bandIndexUtils.js";import o from"./BaseRasterFunction.js";const c=new Set(["vari","mtvi2","rtvi-core","evi"]);let u=class extends o{constructor(){super(...arguments),this.functionName="BandArithmetic",this.functionArguments=null,this.rasterArgumentNames=["raster"]}_bindSourceRasters(){this.outputPixelType=this._getOutputPixelType("f32");const e=this.sourceRasterInfos[0],s=e.clone();s.pixelType=this.outputPixelType,s.statistics=null,s.histograms=null,s.bandCount="sultan"===this.functionArguments.method?e.bandCount:1,this.rasterInfo=s;return{success:!0,supportsGPU:!["custom","gvitm","sultan"].includes(this.functionArguments.method)}}_processPixels(e){const t=e.pixelBlocks?.[0];if(s(t))return t;const{method:r,bandIndexes:n}=this.functionArguments,i=n.split(" ").map((e=>parseFloat(e)));return a(t,{method:r,bandIndexes:i,equation:n})}_getWebGLParameters(){const e=this.functionArguments.bandIndexes.split(" ").map((e=>parseFloat(e)-1));2===e.length&&e.push(0);const s=this.isInputBandIdsSwizzled?[0,1,2]:e;let t,r;const n=new Float32Array(3),{method:a}=this.functionArguments;switch(a){case"gndvi":case"nbr":case"ndbi":case"ndvi":case"ndvi-re":case"ndsi":case"ndmi":case"mndwi":t=i([s[0],s[1],0]),r="ndxi";break;case"ndwi":t=i([s[1],s[0],0]),r="ndxi";break;case"sr":case"sr-re":case"iron-oxide":case"ferrous-minerals":case"clay-minerals":t=i([s[0],s[1],0]),r="sr";break;case"ci-g":case"ci-re":t=i([s[0],s[1],0]),r="ci";break;case"savi":t=i([s[0],s[1],0]),r="savi",n[0]=e[2]+1;break;case"tsavi":t=i([s[0],s[1],0]),r="tsavi",n[0]=e[2]+1,n[1]=e[3]+1,n[2]=e[4]+1;break;case"msavi":t=i([s[0],s[1],0]),r="msavi";break;case"gemi":t=i([s[0],s[1],0]),r="gemi";break;case"pvi":t=i([s[0],s[1],0]),r="tsavi",n[0]=e[2]+1,n[1]=e[3]+1;break;case"vari":t=i([s[0],s[1],s[2]]),r="vari";break;case"mtvi2":t=i([s[0],s[1],s[2]]),r="mtvi2";break;case"rtvi-core":t=i([s[0],s[1],s[2]]),r="rtvicore";break;case"evi":t=i([s[0],s[1],s[2]]),r="evi";break;case"wndwi":t=i([s[0],s[1],0]),r="wndwi",n[0]=e[3]?e[3]+1:.5;break;case"bai":t=i([s[1],s[0],0]),r="bai";break;default:t=i([0,1,2]),r="custom"}return{bandIndexMat3:t,indexType:r,adjustments:n}}_getInputBandIds(e){if("custom"===this.functionArguments.method)return e;const s=this.functionArguments.bandIndexes.split(" ").map((e=>parseFloat(e)-1)),t=e.length,r=s.map((e=>e>=t?t-1:e)),n=c.has(this.functionArguments.method)?3:2,a=r.slice(0,n).map((s=>e[s]));return 2===a.length&&a.push(0),a}};e([t({json:{write:!0,name:"rasterFunction"}})],u.prototype,"functionName",void 0),e([t({type:n,json:{write:!0,name:"rasterFunctionArguments"}})],u.prototype,"functionArguments",void 0),e([t()],u.prototype,"rasterArgumentNames",void 0),u=e([r("esri.layers.support.rasterFunctions.BandArithmeticFunction")],u);const m=u;export{m as default};
