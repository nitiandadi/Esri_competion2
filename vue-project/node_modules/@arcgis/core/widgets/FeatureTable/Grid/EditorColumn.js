/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
import{_ as t}from"../../../chunks/tslib.es6.js";import{isSome as e,assertIsSome as o}from"../../../core/maybe.js";import{property as i}from"../../../core/accessorSupport/decorators/property.js";import"../../../core/accessorSupport/ensureType.js";import"../../../core/arrayUtils.js";import{subclass as n}from"../../../core/accessorSupport/decorators/subclass.js";import a from"./Column.js";import{autoLink as s}from"../../support/uriUtils.js";const r="esri-editor-column__cell-input",u={input:r,inputContainer:`${r}--container`},l={showInput:"Enter",hideInput:"Escape"};let c=class extends a{constructor(t){super(t),this.activeEditInfo=null,this.cellValueValidatorFunction=({oldValue:t,value:e})=>t!==e,this.editable=!1,this.inputRenderFunction=({root:t,column:e,rowData:o})=>{if(this.activeEditInfo?.updating)return;if(!this.editable)return;const i=this.getCellValue(e,o),n=this.createInputElement({root:t,column:e,rowData:o,value:i});this._set("activeEditInfo",{column:e,input:n,root:t,rowData:o,updating:!0,oldValue:i});const a=this.createInputContainer();a.appendChild(n),this.removeCellContent(t),t.appendChild(a),n.focus(),n instanceof HTMLInputElement&&n.select(),this.grid?.notifyResize()},this.loadingMessage="",this.inputType="text",this.maxLength=null,this.parseInputValueFunction=({input:t})=>t.value,this.renderFunction=t=>{const{root:o,column:i,rowData:n}=t,{activeEditInfo:a}=this;if(a&&a.updating)return;const r=this.getCellValue(i,n),u=this.cellValueFormatFunction({column:i,rowData:n,value:r});o.onclick=()=>o.focus(),o.ondblclick=()=>this.inputRenderFunction(t),o.ontouchend=()=>this.inputRenderFunction(t);const c=this.grid?.getSlotElementByName(o.slot),p=c?.parentElement;p&&!p.onkeydown&&(p.onkeydown=e=>{e.key!==l.showInput||this.activeEditInfo||this.inputRenderFunction(t),e.key===l.hideInput&&this.activeEditInfo&&this.cancel()}),e(r)&&e(u)?o.title=u.toString():o.title&&o.removeAttribute("title");const d=s(this.messagesURIUtils,u);u?.toString()!==o.innerHTML&&d!==o.innerHTML&&(o.innerHTML=d)},this.required=!1,this.store=null,this.updateRowItemFunction=({rowData:t,column:e,value:i})=>{o(t),t.item[e.path]=i},this.updateStoreItemFunction=async({rowData:t,column:e,value:i})=>{o(t),await(this.store?.updateItem({index:t.index,name:e.path,value:i}))}}cancel(){const{activeEditInfo:t}=this;if(!t)return;const{column:e,root:o,rowData:i,oldValue:n}=t;this._set("activeEditInfo",null);const a=this.cellValueFormatFunction({column:e,rowData:i,value:n}),r=s(this.messagesURIUtils,a);o.innerHTML=r,this.grid?.notifyResize()}createInputContainer(){const t=document.createElement("div");return t.classList.add(u.inputContainer),t}createInputElement({value:t}){const e=document.createElement("input");return e.classList.add(u.input),null!=this.maxLength&&(e.maxLength=this.maxLength),e.type=this.inputType,e.value=t,e.onblur=()=>{e.onblur=null,this.submit()},e}async submit(){const{activeEditInfo:t}=this;if(!t)return;const{column:o,input:i,root:n,rowData:a,oldValue:r}=t,u=this.parseInputValueFunction({input:i,column:o,rowData:a});if(!this.cellValueValidatorFunction({value:u,oldValue:r,column:o,rowData:a}))this.cancel();else{n.innerHTML=this.loadingMessage,this.grid?.notifyResize();try{await this.updateStoreItemFunction({rowData:a,column:o,value:u}),this.updateRowItemFunction({rowData:a,column:o,value:u});const t=this.getCellValue(o,a),i=this.cellValueFormatFunction({column:o,rowData:a,value:t});e(t)&&e(i)?n.title=i.toString():n.title&&n.removeAttribute("title");const r=s(this.messagesURIUtils,i);n.innerHTML=r,this.emit("value-change",{column:o,rowData:a,value:t}),this._set("activeEditInfo",null),this.grid?.notifyResize()}catch(l){this.cancel()}}}};t([i({readOnly:!0})],c.prototype,"activeEditInfo",void 0),t([i()],c.prototype,"cellValueValidatorFunction",void 0),t([i()],c.prototype,"editable",void 0),t([i()],c.prototype,"inputRenderFunction",void 0),t([i({constructOnly:!0})],c.prototype,"loadingMessage",void 0),t([i()],c.prototype,"inputType",void 0),t([i()],c.prototype,"maxLength",void 0),t([i()],c.prototype,"parseInputValueFunction",void 0),t([i()],c.prototype,"renderFunction",void 0),t([i()],c.prototype,"required",void 0),t([i()],c.prototype,"store",void 0),t([i()],c.prototype,"updateRowItemFunction",void 0),t([i()],c.prototype,"updateStoreItemFunction",void 0),c=t([n("esri.widgets.FeatureTable.Grid.EditorColumn")],c);const p=c;export{p as default};
