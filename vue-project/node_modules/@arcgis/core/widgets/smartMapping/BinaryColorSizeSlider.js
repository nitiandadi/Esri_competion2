/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import r from"../../Color.js";import{isNone as t}from"../../core/maybe.js";import{property as s}from"../../core/accessorSupport/decorators/property.js";import{cast as i}from"../../core/accessorSupport/decorators/cast.js";import"../../core/arrayUtils.js";import{subclass as o}from"../../core/accessorSupport/decorators/subclass.js";import a from"../../renderers/visualVariables/support/SizeStop.js";import{getCIMSymbolColor as l}from"../../symbols/support/cimSymbolUtils.js";import{SmartMappingSliderBase as n}from"./SmartMappingSliderBase.js";import d from"./BinaryColorSizeSlider/BinaryColorSizeSliderViewModel.js";import{getSizesFromVariable as p,getFillFromColor as m,getDynamicPathForSizeStops as c}from"./support/utils.js";import{storeNode as u}from"../support/widgetUtils.js";import{messageBundle as h}from"../support/decorators/messageBundle.js";import{tsx as y}from"../support/jsxFactory.js";var b;const g="esri-binary-color-size-slider",v={base:g,rampElement:`${g}__ramp`,sliderContainer:`${g}__slider-container`,histogramContainer:`${g}__histogram-container`,zoomCapTop:`${g}__zoom-cap-top`,zoomCapBottom:`${g}__zoom-cap-bottom`,zoomCapLine:`${g}__zoom-cap-line`,zoomCapMask:`${g}__zoom-cap-mask`,zoomCapUnderline:`${g}__zoom-cap-underline`,primaryHandle:`${g}--primary-handle`,track:`${g}--interactive-track`,esriWidget:"esri-widget",esriWidgetPanel:"esri-widget--panel",widgetIcon:"esri-icon-edit",disabled:"esri-disabled"},f={trackBackgroundColor:new r([224,224,224]),trackAboveFillColor:new r([149,149,149]),trackBelowFillColor:new r([149,149,149])};let S=b=class extends n{constructor(e,r){super(e,r),this._minRampFillWidth=.2,this._rampNode=null,this._rampFillId=null,this.messages=null,this.style={...f},this.viewModel=new d,this._rampFillId=`${this.id}-linear-gradient`}get handlesSyncedToPrimary(){return this.viewModel.handlesSyncedToPrimary}set handlesSyncedToPrimary(e){this.viewModel.handlesSyncedToPrimary=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get persistSizeRangeEnabled(){return this.viewModel.persistSizeRangeEnabled}set persistSizeRangeEnabled(e){this.viewModel.persistSizeRangeEnabled=e}get stops(){return this.viewModel.stops}set stops(e){this.viewModel.stops=e}castStyle(e){return{...f,...e}}static fromRendererResult(e,r){const{size:{visualVariables:t},statistics:s}=e,{avg:i,stddev:o}=s,a=t[0].stops,n=e.renderer.authoringInfo.visualVariables[0],d=n.minSliderValue,p=n.maxSliderValue,m=e.renderer.classBreakInfos;let c,u,h=null;const y=e=>{if("cim"===e.type)return l(e);if(e.symbolLayers){const r=e.symbolLayers?.getItemAt(0);return r.material?.color}return e.color};if(m.length>1){const e=m[0].symbol,r=m[1].symbol;u=y(e),c=y(r)}return 1===m.length&&(h=y(m[0].symbol)),new b({max:p,min:d,stops:a,histogramConfig:{average:i,standardDeviation:o,bins:r?r.bins:[]},style:{trackAboveFillColor:c,trackBelowFillColor:u,trackFillColor:h},handlesSyncedToPrimary:!0,persistSizeRangeEnabled:!0})}updateFromRendererResult(e,r){const{size:{visualVariables:t},statistics:s}=e,{avg:i,stddev:o}=s,a=t[0].stops,n=e.renderer.authoringInfo.visualVariables[0],d=n.minSliderValue,p=n.maxSliderValue,m=e.renderer.classBreakInfos;let c,u,h=null;const y=e=>{if("cim"===e.type)return l(e);if(e.symbolLayers){const r=e.symbolLayers?.getItemAt(0);return r.material?.color}return e.color};if(m.length>1){const e=m[0].symbol,r=m[1].symbol;u=y(e),c=y(r)}1===m.length&&(h=y(m[0].symbol)),this.set({max:p,min:d,stops:a,histogramConfig:{average:i,standardDeviation:o,bins:r?r.bins:[]},style:{trackAboveFillColor:c,trackBelowFillColor:u,trackFillColor:h},handlesSyncedToPrimary:!0,persistSizeRangeEnabled:!0})}updateRenderer(e){if("univariate-color-size"!==e.authoringInfo?.type||"above-and-below"!==e.authoringInfo?.univariateTheme)return console.error("Input renderer must be a univariate renderer with an above-and-below theme."),null;const r=e.clone(),t=r.visualVariables.find((e=>"size"===e.type&&"outline"!==e.target&&e.stops)),{stops:s}=this;if(!t||!s)return console.error("No size stops available."),null;const i=r.visualVariables.indexOf(t);r.visualVariables.splice(i,1),t.stops=s,r.visualVariables.push(t);const o=s[5===s.length?2:1].value;return r.classBreakInfos[0].maxValue=o,r.classBreakInfos[1].minValue=o,r}updateFromVisualVariable(e){if(!e)return;const{maxDataValue:r,minDataValue:t,stops:s}=e;if(s)this.stops=s;else{const[s,i]=p(e);this.stops=[new a({value:t,size:i}),new a({value:r,size:s})]}}render(){const{label:e,state:r,viewModel:{primaryHandleEnabled:t},visibleElements:s}=this,i="disabled"===r,o=this.classes(v.base,v.esriWidget,v.esriWidgetPanel,{[v.disabled]:i,[v.primaryHandle]:t,[v.track]:s.interactiveTrack});return y("div",{"aria-label":e,class:o},i?null:this.renderContent(this.renderRamp(),v.sliderContainer,v.histogramContainer))}renderRamp(){const{style:{trackBackgroundColor:e},zoomOptions:r}=this;return y("div",{afterCreate:u,bind:this,class:v.rampElement,"data-node-ref":"_rampNode"},y("svg",{key:"ramp-svg",xmlns:"http://www.w3.org/2000/svg"},y("rect",{x:"0",y:"0",fill:m(e),height:"100%",width:"100%"}),this.renderPrimaryRamp(),this.renderPath()),r?this.renderZoomCaps():null)}renderPrimaryRamp(){const{_rampFillId:e,style:{trackAboveFillColor:r,trackBelowFillColor:t},viewModel:s}=this;return[y("defs",null,this.renderRampFillDefinition(e,s.getGradientStopInfo(r,t)))]}renderPath(){if(!this._rampNode)return;const{offsetHeight:e=0,offsetWidth:r=0}=this._rampNode;if(t(e)||t(r))return;const{stops:s,viewModel:{max:i,min:o},_rampFillId:a,_minRampFillWidth:l}=this,n=c({max:i,min:o,pathHeight:e,pathWidth:r,stops:s,padding:l});return y("path",{d:n,fill:`url(#${a})`})}};e([s()],S.prototype,"handlesSyncedToPrimary",null),e([s()],S.prototype,"label",null),e([s(),h("esri/widgets/smartMapping/SizeSlider/t9n/SizeSlider")],S.prototype,"messages",void 0),e([s()],S.prototype,"persistSizeRangeEnabled",null),e([s()],S.prototype,"stops",null),e([s()],S.prototype,"style",void 0),e([i("style")],S.prototype,"castStyle",null),e([s()],S.prototype,"viewModel",void 0),S=b=e([o("esri.widgets.smartMapping.BinaryColorSizeSlider")],S);const w=S;export{w as default};
