/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import{destroyMaybe as t,isNone as i,unwrap as s,isSome as l}from"../../core/maybe.js";import{generateUID as n}from"../../core/uid.js";import{property as a}from"../../core/accessorSupport/decorators/property.js";import{cast as r}from"../../core/accessorSupport/decorators/cast.js";import"../../core/arrayUtils.js";import{subclass as o}from"../../core/accessorSupport/decorators/subclass.js";import c from"../Widget.js";import"./widgetUtils.js";import{messageBundle as d}from"./decorators/messageBundle.js";import{tsx as p}from"./jsxFactory.js";import h from"./SnappingControls/SnappingControlsViewModel.js";const g={header:!0,enabledToggle:!0,selfEnabledToggle:!0,featureEnabledToggle:!0,layerList:!0},m="esri-snapping-controls",b={base:m,container:`${m}__container`,panel:`${m}__panel`,item:`${m}__item`,toggleBlock:`${m}__toggle-block`,layerListBlock:`${m}__layer-list-block`,layerList:`${m}__layer-list`,layerListFilter:`${m}__layer-list__filter`,layerListItem:`${m}__layer-list__item`,layerListItemCheckbox:`${m}__layer-list__item__checkbox`,layerListItemLabel:`${m}__layer-list__item__label`,nestedContainer:`${m}__nested-container`,disabled:"esri-disabled",esriWidget:"esri-widget",widgetIcon:"esri-icon-vertex-gps"};let u=class extends c{constructor(e,t){super((()=>{const{view:t,viewModel:i,snappingOptions:s,...l}=e;return l})(),t),this._layerListFilter=null,this.iconClass=b.widgetIcon,this.layerListOpen=!0,this.messages=null,this.visibleElements={...g},this._defaultViewModel=null,e?.viewModel?this.viewModel=e.viewModel:(this._defaultViewModel=new h({snappingOptions:e.snappingOptions,view:e.view}),this.viewModel=this._defaultViewModel)}destroy(){this._defaultViewModel=t(this._defaultViewModel)}loadDependencies(){return Promise.all([import("@esri/calcite-components/dist/components/calcite-accordion.js"),import("@esri/calcite-components/dist/components/calcite-accordion-item.js"),import("@esri/calcite-components/dist/components/calcite-block.js"),import("@esri/calcite-components/dist/components/calcite-checkbox.js"),import("@esri/calcite-components/dist/components/calcite-input.js"),import("@esri/calcite-components/dist/components/calcite-label.js"),import("@esri/calcite-components/dist/components/calcite-list.js"),import("@esri/calcite-components/dist/components/calcite-list-item.js"),import("@esri/calcite-components/dist/components/calcite-panel.js"),import("@esri/calcite-components/dist/components/calcite-switch.js")])}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set viewModel(e){e!==this._get("viewModel")&&((i(this._defaultViewModel)||this._defaultViewModel!==e)&&(this._defaultViewModel=t(this._defaultViewModel)),this._set("viewModel",e))}castVisibleElements(e){return{...g,...e}}render(){const{label:e,visibleElements:{header:t}}=this;return p("div",{"aria-label":e,class:this.classes(b.base,b.esriWidget)},p("div",{class:b.container},t?this.renderHeaderView():this.renderContent()))}renderHeaderView(){return p("calcite-panel",{heading:this.label,class:b.panel},this.renderContent())}renderContent(){return[this.renderToggles(),this.renderLayerList()]}renderToggles(){const{visibleElements:{enabledToggle:e,selfEnabledToggle:t,featureEnabledToggle:i}}=this;return e||t||i?p("calcite-block",{class:b.toggleBlock,key:"toggle-block",heading:"",open:!0},this.renderEnabledToggle(),p("div",{class:b.nestedContainer},this.renderSelfEnabledToggle(),this.renderFeatureEnabledToggle())):null}renderEnabledToggle(){if(!this.visibleElements.enabledToggle)return null;const{messages:{enableSnapping:e},viewModel:{snappingOptions:{enabled:t,enabledToggled:i}}}=this;return p("calcite-label",{layout:"inline-space-between"},e,p("calcite-switch",{checked:t,disabled:i,bind:this,onCalciteSwitchChange:this._enableSnappingSwitchChange}))}renderSelfEnabledToggle(){if(!this.visibleElements.selfEnabledToggle)return null;const{messages:{geometryGuides:e},viewModel:{snappingOptions:{enabled:t,selfEnabled:i,enabledToggled:s}}}=this;return p("calcite-label",{layout:"inline-space-between",key:"self-enabled-toggle"},e,p("calcite-switch",{checked:i,disabled:s||!t,bind:this,onCalciteSwitchChange:this._selfEnabledSwitchChange}))}renderFeatureEnabledToggle(){if(!this.visibleElements.featureEnabledToggle)return null;const{messages:{featureToFeature:e},viewModel:{snappingOptions:{enabled:t,featureEnabled:i,enabledToggled:s}}}=this;return p("calcite-label",{layout:"inline-space-between",key:"feature-enabled-toggle"},e,p("calcite-switch",{checked:i,disabled:s||!t,bind:this,onCalciteSwitchChange:this._featureEnabledSwitchChange}))}renderLayerList(){if(!this.visibleElements.layerList)return null;const{messages:e}=this,t=({target:{value:e}})=>this._layerListFilter=""===e?null:new RegExp(e,"i"),i=this.viewModel.layerListViewModel.operationalItems.length>9?p("calcite-input",{class:b.layerListFilter,clearable:!0,placeholder:e?.searchLayers,onCalciteInputInput:t}):null;return p("calcite-block",{key:"list-block",heading:e.snappingLayers,class:b.layerListBlock,collapsible:!0,open:this.layerListOpen,onCalciteBlockToggle:e=>this.layerListOpen=e.target.open},i,p("calcite-list",{class:b.layerList},this.renderLayerListItemCollection(this.viewModel.layerListViewModel.operationalItems,s(this._layerListFilter))))}renderLayerListItemCollection(e,t){return e.map((e=>{if(!t||this._itemTitleMatchesFilter(e,t))return e.children.length>0?this.renderLayerListItemGroup(e):this.renderLayerListItem(e);const i=e.children.filter((e=>this._itemTitleMatchesFilter(e,t)));return i.length>0?this.renderLayerListItemGroup(e,i):null})).toArray().filter(l)}renderLayerListItem(e){const{messages:{untitledLayer:t}}=this,i=e.title||t,s=e.enabled,l=p("calcite-checkbox",{value:e.layer.id,checked:s,bind:this,onCalciteCheckboxChange:e=>this._handleLayerListItemChange(e.target)}),n=()=>{const e=!l.properties.checked;this._handleLayerListItemChange({checked:e,value:l.properties.value})};return p("calcite-list-item",{key:`${this.id}-list-item-${e.uid}`,onCalciteListItemSelect:n},p("calcite-label",{class:b.layerListItem,slot:"content-start",tabIndex:-1,layout:"inline"},p("div",{class:b.layerListItemCheckbox},l),p("div",{class:b.layerListItemLabel},i)))}renderLayerListItemGroup(e,t){const i=e.title||this.messages.untitledLayer,s=e.title&&""!==e.title?e.title:n(),l=!!t,a=t??e.children;return p("calcite-list-item",{key:s},p("calcite-accordion",{iconPosition:"start",appearance:"transparent",afterCreate:e=>{e.append(...Array.from(e.children).map((e=>(e.remove(),e))))}},p("calcite-accordion-item",{expanded:l,heading:i,key:e.uid},p("calcite-list",null,[...this.renderLayerListItemCollection(a)]))))}_enableSnappingSwitchChange(e){this.snappingOptions.enabled=e.target.checked}_featureEnabledSwitchChange(e){this.snappingOptions.featureEnabled=e.target.checked}_itemTitleMatchesFilter(e,t){return null!=t&&t.test(e.title)}_selfEnabledSwitchChange(e){this.snappingOptions.selfEnabled=e.target.checked}async _handleLayerListItemChange(e){e.checked?this.viewModel.enableSnappingForLayer(e.value):this.viewModel.disableSnappingForLayer(e.value)}};e([a()],u.prototype,"_layerListFilter",void 0),e([a()],u.prototype,"iconClass",void 0),e([a()],u.prototype,"label",null),e([a()],u.prototype,"layerListOpen",void 0),e([a(),d("esri/widgets/support/SnappingControls/t9n/SnappingControls")],u.prototype,"messages",void 0),e([a()],u.prototype,"snappingOptions",null),e([a()],u.prototype,"view",null),e([a()],u.prototype,"viewModel",null),e([a()],u.prototype,"visibleElements",void 0),e([r("visibleElements")],u.prototype,"castVisibleElements",null),u=e([o("esri.widgets.support.SnappingControls")],u);const y=u;export{y as default};
