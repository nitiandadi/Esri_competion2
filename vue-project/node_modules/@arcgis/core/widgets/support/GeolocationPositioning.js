/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
import{_ as t}from"../../chunks/tslib.es6.js";import{getAssetUrl as e}from"../../assets.js";import o from"../../Graphic.js";import i from"../../core/Accessor.js";import s from"../../core/Error.js";import r from"../../core/Evented.js";import{property as a}from"../../core/accessorSupport/decorators/property.js";import"../../core/accessorSupport/ensureType.js";import"../../core/arrayUtils.js";import{subclass as n}from"../../core/accessorSupport/decorators/subclass.js";import c from"../../symbols/PictureMarkerSymbol.js";import{supported as p,positionToPoint as l}from"./geolocationUtils.js";import{GoToMixin as d}from"./GoTo.js";const h=2500;let g=class extends(d(r.EventedMixin(i))){constructor(){super(...arguments),this._geolocationUsable=!0,this._iconPath=e("esri/images/support/sdk_gps_location.png"),this.geolocationOptions=null,this.goToLocationEnabled=!0,this.graphic=new o({symbol:new c({url:this._iconPath,width:21,height:21})}),this.scale=null,this.useHeadingEnabled=!0,this.view=null}initialize(){p()||(this._geolocationUsable=!1)}destroy(){this._clear(),this.view=null}_clear(){this.view&&this.view.graphics.remove(this.graphic)}_getScaleWithinConstraints(t,e){if(!e)return t;if("2d"===e.type){const{effectiveMaxScale:o,effectiveMinScale:i}=e.constraints;return Math.min(i,Math.max(o,t))}return t}_getScale(t){const{scale:e}=this,o="number"==typeof e?e:h;return this._getScaleWithinConstraints(o,t)}_getHeading(t,e){const o=e?.spatialReference,i=o?.isWebMercator||o?.isGeographic,s=t.coords?.heading;if(!(!i||"number"!=typeof s||isNaN(s)||s<0||s>360))return s}_addHeading(t){const{heading:e,target:o,view:i}=t;i&&"number"==typeof e&&!isNaN(e)&&("3d"!==i.type?"2d"===i.type&&(o.rotation=360-e):o.heading=e)}_animatePoint(t,e,o,i){const{view:s}=this;if(!this.goToLocationEnabled||!s)return Promise.resolve(e);const r=this.useHeadingEnabled?this._getHeading(e,s):void 0,a={target:t,scale:o};return this._addHeading({heading:r,target:a,view:s}),this.callGoTo({target:a,options:i}).then((()=>e))}async _setPosition(t,e){try{const o=this.view,i=await l({position:t,view:o},e),{graphic:s}=this,{timestamp:r,coords:a}=t,{accuracy:n,altitude:c,altitudeAccuracy:p,heading:d,latitude:h,longitude:g,speed:u}=a,m={timestamp:r,accuracy:n,altitude:c,altitudeAccuracy:p,heading:d,latitude:h,longitude:g,speed:u};s&&(s.geometry=i,s.attributes=m);const y=this._getScale(o);return this._animatePoint(i,t,y,e)}catch(o){throw new s("positioning:invalid-point","Cannot position invalid point",{error:o})}}};t([a()],g.prototype,"_geolocationUsable",void 0),t([a()],g.prototype,"geolocationOptions",void 0),t([a()],g.prototype,"goToLocationEnabled",void 0),t([a({type:o,nonNullable:!0})],g.prototype,"graphic",void 0),t([a()],g.prototype,"scale",void 0),t([a()],g.prototype,"useHeadingEnabled",void 0),t([a()],g.prototype,"view",void 0),g=t([n("esri.widgets.support.GeolocationPositioning")],g);const u=g;export{u as default};
