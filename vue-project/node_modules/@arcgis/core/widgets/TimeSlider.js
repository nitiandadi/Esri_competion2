/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import t from"../TimeInterval.js";import{equals as i}from"../core/arrayUtils.js";import s from"../core/Collection.js";import{neverReached as n}from"../core/compilerUtils.js";import{isSome as a,isNone as o,applySome as r}from"../core/maybe.js";import{watch as l,initial as m}from"../core/reactiveUtils.js";import{truncateDate as u,offsetDate as d}from"../core/timeUtils.js";import{property as c}from"../core/accessorSupport/decorators/property.js";import"../core/accessorSupport/ensureType.js";import{subclass as p}from"../core/accessorSupport/decorators/subclass.js";import{formatDate as v,convertDateFormatToIntlOptions as h}from"../intl/date.js";import w from"./Slider.js";import f from"./Widget.js";import{accessibleHandler as y}from"./support/decorators/accessibleHandler.js";import{messageBundle as b}from"./support/decorators/messageBundle.js";import{vmEvent as g}from"./support/decorators/vmEvent.js";import{tsx as x}from"./support/jsxFactory.js";import{onResize as k}from"./support/widgetUtils.js";import{getCalciteThemeClass as j}from"../support/themeUtils.js";import{CSS as T}from"./TimeSlider/css.js";import E from"./TimeSlider/TimeSliderViewModel.js";const _=3,M=858,S=new s([{minor:new t({value:100,unit:"milliseconds"}),major:new t({value:1,unit:"seconds"}),format:{second:"numeric"}},{minor:new t({value:500,unit:"milliseconds"}),major:new t({value:5,unit:"seconds"}),format:{second:"numeric"}},{minor:new t({value:1,unit:"seconds"}),major:new t({value:20,unit:"seconds"}),format:{minute:"numeric",second:"numeric"}},{minor:new t({value:2,unit:"seconds"}),major:new t({value:30,unit:"seconds"}),format:{minute:"numeric",second:"numeric"}},{minor:new t({value:10,unit:"seconds"}),major:new t({value:1,unit:"minutes"}),format:{minute:"numeric"}},{minor:new t({value:15,unit:"seconds"}),major:new t({value:5,unit:"minutes"}),format:{hour:"numeric",minute:"numeric"}},{minor:new t({value:1,unit:"minutes"}),major:new t({value:20,unit:"minutes"}),format:{hour:"numeric",minute:"numeric"}},{minor:new t({value:5,unit:"minutes"}),major:new t({value:2,unit:"hours"}),format:{hour:"numeric",minute:"numeric"}},{minor:new t({value:15,unit:"minutes"}),major:new t({value:6,unit:"hours"}),format:{hour:"numeric",minute:"numeric"}},{minor:new t({value:1,unit:"hours"}),major:new t({value:1,unit:"days"}),format:{day:"numeric",month:"short"}},{minor:new t({value:6,unit:"hours"}),major:new t({value:1,unit:"weeks"}),format:{day:"numeric",month:"short"}},{minor:new t({value:1,unit:"days"}),major:new t({value:1,unit:"months"}),format:{month:"long"}},{minor:new t({value:2,unit:"days"}),major:new t({value:1,unit:"months"}),format:{month:"short"}},{minor:new t({value:3,unit:"days"}),major:new t({value:1,unit:"months"}),format:{month:"short"}},{minor:new t({value:4,unit:"days"}),major:new t({value:3,unit:"months"}),format:{month:"short",year:"numeric"}},{minor:new t({value:1,unit:"weeks"}),major:new t({value:1,unit:"years"}),format:{year:"numeric"}},{minor:new t({value:1,unit:"months"}),major:new t({value:1,unit:"years"}),format:{year:"numeric"}},{minor:new t({value:2,unit:"months"}),major:new t({value:2,unit:"years"}),format:{year:"numeric"}},{minor:new t({value:1,unit:"years"}),major:new t({value:1,unit:"decades"}),format:{year:"numeric"}},{minor:new t({value:2,unit:"years"}),major:new t({value:5,unit:"decades"}),format:{year:"numeric"}},{minor:new t({value:5,unit:"decades"}),major:new t({value:10,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:1,unit:"centuries"}),major:new t({value:10,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:2,unit:"centuries"}),major:new t({value:20,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:5,unit:"centuries"}),major:new t({value:50,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:10,unit:"centuries"}),major:new t({value:100,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:20,unit:"centuries"}),major:new t({value:200,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:50,unit:"centuries"}),major:new t({value:500,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:100,unit:"centuries"}),major:new t({value:1e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:200,unit:"centuries"}),major:new t({value:1e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:500,unit:"centuries"}),major:new t({value:5e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:1e3,unit:"centuries"}),major:new t({value:1e4,unit:"centuries"}),format:{era:"short",year:"numeric"}}]);let C=class extends f{constructor(e,t){super(e,t),this._ignoreNextSliderUpdate=!1,this._slider=new w({precision:0,visibleElements:{rangeLabels:!1},rangeLabelInputsEnabled:!1,thumbsConstrained:!1}),this._tickFormat=null,this.disabled=!1,this.iconClass=T.widgetIcon,this.labelFormatFunction=null,this.messages=null,this.messagesCommon=null,this.tickConfigs=null,this.timeVisible=!1,this.viewModel=new E}initialize(){this.addHandles([l((()=>this._slider.values),(e=>{if(this._ignoreNextSliderUpdate)return void(this._ignoreNextSliderUpdate=!1);const t=this.viewModel.valuesToTimeExtent(e);a(this.timeExtent)?a(t)?this.timeExtent.equals(t)||(this.timeExtent=t):this.timeExtent=null:a(t)&&(this.timeExtent=t)})),l((()=>this.effectiveStops),(()=>this._updateSliderSteps()),m)])}loadDependencies(){return Promise.all([import("@esri/calcite-components/dist/components/calcite-action.js"),import("@esri/calcite-components/dist/components/calcite-action-menu.js")])}destroy(){this._slider.destroy(),this._tickFormat=null}get actions(){return this.viewModel.actions}set actions(e){this.viewModel.actions=e}get effectiveStops(){return this.viewModel.effectiveStops}get fullTimeExtent(){return this.viewModel.fullTimeExtent}set fullTimeExtent(e){this.viewModel.fullTimeExtent=e}get interactive(){return!this.disabled&&"disabled"!==this.viewModel?.state}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){["auto","compact","wide"].includes(e)||(e="auto"),this._set("layout",e)}get loop(){return this.viewModel.loop}set loop(e){this.viewModel.loop=e}get mode(){return this.viewModel.mode}set mode(e){this.viewModel.mode=e}get playRate(){return this.viewModel.playRate}set playRate(e){this.viewModel.playRate=e}get stops(){return this.viewModel.stops}set stops(e){this.viewModel.stops=e}get timeExtent(){return this.viewModel.timeExtent}set timeExtent(e){this.viewModel.timeExtent=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}static async getPropertiesFromWebMap(e,t){return E.getPropertiesFromWebMap(e,t)}next(){return this.viewModel.next()}play(){return this.viewModel.play()}previous(){return this.viewModel.previous()}stop(){return this.viewModel.stop()}render(){const{_slider:e,actions:t,domNode:s,effectiveStops:n,fullTimeExtent:l,interactive:m,messages:u,messagesCommon:d,mode:c,tickConfigs:p,timeExtent:h,timeVisible:w,viewModel:{state:f,timeExtentValues:y}}=this;if(a(l)){const{start:t,end:i}=l;if(a(t)&&a(i)){const s=t.getTime(),n=i.getTime(),o=e.min!==s||e.max!==n;if(o&&(e.min=s,e.max=n),a(p))e.tickConfigs!==p&&(e.tickConfigs=p);else{const t=(n-s)/(e.trackElement?.offsetWidth||400),i=S.find((e=>e.minor.toMilliseconds()>_*t)),a=this._tickFormat!==i&&null!=i;if(a&&(this._tickFormat=i),o||a){const t={mode:"position",values:this._getTickPositions(i.minor),labelsVisible:!1,tickCreatedFunction:(e,t)=>{t.classList.add(T.sliderMinorTick)}},s={mode:"position",values:this._getTickPositions(i.major),labelsVisible:!0,tickCreatedFunction:(e,t)=>{t.classList.add(T.sliderMajorTick)},labelFormatFunction:e=>v(e,i.format)};e.tickConfigs=[t,s]}}}}const b=o(this.fullTimeExtent)||o(this.timeExtent)||this.timeExtent.isAllTime||this.timeExtent.isEmpty||a(this.timeExtent.start)&&(this.timeExtent.start<this.fullTimeExtent.start||this.timeExtent.start>this.fullTimeExtent.end)||a(this.timeExtent.end)&&(this.timeExtent.end>this.fullTimeExtent.end||this.timeExtent.end<this.fullTimeExtent.start);if(b)switch(this._ignoreNextSliderUpdate=!0,c){case"time-window":e.values=[e.min,e.max];break;case"instant":case"cumulative-from-end":e.values=[e.min];break;case"cumulative-from-start":e.values=[e.max]}else a(y)?i(e.values,y)||(e.values=y):e.values=null;e.disabled=!m;const g="ready"===f,E="playing"===f,C=b||!m||o(n)||0===n.length,F="auto"===this.layout?s.clientWidth<M?"compact":"wide":this.layout,D=x("div",{class:T.animation},x("button",{"aria-disabled":C?"true":"false","aria-label":E?d.control.stop:d.control.play,bind:this,class:this.classes(T.esriWidgetButton,T.animationButton,C&&T.esriButtonDisabled),disabled:C,title:E?d.control.stop:d.control.play,onclick:this._playOrStopClick,type:"button"},x("div",{class:this.classes((g||C)&&T.animationPlay,E&&T.animationPause)}))),B=a(this.labelFormatFunction)?x("div",{key:"extent",bind:this,class:T.timeExtentDate,"data-type":"extent","data-layout":F,"data-date":r(h,(e=>[e.start,e.end])),afterCreate:this._createLabel,afterUpdate:this._createLabel}):o(h)||a(h)&&h.isAllTime?[x("div",{class:this.classes(T.warning,T.warningIcon)}),x("div",{key:"warning-text",class:T.warningText},u.noTimeExtent)]:h.isEmpty?[x("div",{class:this.classes(T.warning,T.warningIcon)}),x("div",{key:"warning-text",class:T.warningText},u.emptyTimeExtent)]:[a(h.start)&&x("div",{key:"start-date-group",class:T.timeExtentGroup},x("div",{key:"start-date",class:T.timeExtentDate},this._formatDate(h.start)),w&&x("div",{key:"start-time",class:T.timeExtentTime},this._formatTime(h.start))),a(h.start)&&a(h.end)&&h.start.getTime()!==h.end.getTime()&&x("div",{key:"separator",class:T.timeExtentSeparator},"â€“"),a(h.end)&&(o(h.start)||h.start.getTime()!==h.end.getTime())&&x("div",{key:"end-date-group",class:T.timeExtentGroup},x("div",{key:"end-date",class:T.timeExtentDate},this._formatDate(h.end)),w&&x("div",{key:"end-time",class:T.timeExtentTime},this._formatTime(h.end)))],L=x("div",{class:this.classes(T.timeExtent,!m&&T.esriButtonDisabled)},[B]),U=a(this.labelFormatFunction)?x("div",{key:"min-date",bind:this,class:T.minDate,"data-date":r(l,(e=>e.start)),"data-type":"min","data-layout":F,afterCreate:this._createLabel,afterUpdate:this._createLabel}):a(l)&&a(l.start)&&[x("div",{key:"min-date",class:T.minDate},this._formatDate(l.start)),w&&x("div",{key:"min-time",class:T.minTime},this._formatTime(l.start))],W=x("div",{class:this.classes(T.min,!m&&T.esriButtonDisabled)},[U]),R=x("div",{class:T.slider},e.render()),I=a(this.labelFormatFunction)?x("div",{key:"max-date",bind:this,class:T.maxDate,"data-date":r(l,(e=>e.end)),"data-type":"max","data-layout":F,afterCreate:this._createLabel,afterUpdate:this._createLabel}):a(l)&&a(l.end)&&[x("div",{key:"max-date",class:T.maxDate},this._formatDate(l.end)),w&&x("div",{key:"max-time",class:T.maxTime},this._formatTime(l.end))],P=x("div",{class:this.classes(T.max,!m&&T.esriButtonDisabled)},[I]),A=x("div",{class:T.previous},x("button",{"aria-disabled":C?"true":"false","aria-label":d.pagination.previous,bind:this,class:this.classes(T.esriWidgetButton,T.previousButton,(E||C)&&T.esriButtonDisabled),disabled:C,title:d.pagination.previous,onclick:this._previousClick,type:"button"},x("div",{class:T.previousIcon}))),V=x("div",{class:T.next},x("button",{"aria-disabled":C?"true":"false","aria-label":d.pagination.next,bind:this,class:this.classes(T.esriWidgetButton,T.nextButton,(E||C)&&T.esriButtonDisabled),disabled:C,title:d.pagination.next,onclick:this._nextClick,type:"button"},x("div",{class:T.nextIcon}))),N=t?.length>0,O=N&&x("div",{class:T.actions,title:d.options},x("calcite-action-menu",{label:d.options,class:T.actionsButton},t.toArray().map((e=>x("calcite-action",{bind:this,icon:e.icon,id:e.id,onclick:()=>this.viewModel.triggerAction(e),text:e.title,textEnabled:!0})))));return x("div",{class:this.classes(T.timeSlider,T.esriWidget,`${T.timeSliderMode}${c}`,`${T.timeSliderLayout}${F}`,!m&&T.esriDisabled,b&&T.timeSliderOutOfBounds,N&&T.hasActions,j()),afterCreate:e=>{this.addHandles(k(e,(()=>this.scheduleRender())))},"aria-label":u.widgetLabel},"wide"===F&&x("div",{class:T.timeSliderRow},x("div",{class:T.playbackControls},[D,L,W,R,P,A,V]),O),"compact"===F&&[x("div",{key:"time-slider-row-1",class:T.timeSliderRow},[L,O]),x("div",{key:"time-slider-row-2",class:T.timeSliderRow},[R]),x("div",{key:"time-slider-row-3",class:T.timeSliderRow},[W,A,D,V,P])])}updateWebDocument(e){this.viewModel?.updateWebDocument(e)}_createLabel(e){if(o(this.labelFormatFunction))return;const t=e.getAttribute("data-type"),i=e.getAttribute("data-layout"),s=e["data-date"];this.labelFormatFunction(s,t,e,i)}_getTickPositions(e){const{fullTimeExtent:t}=this;if(o(t)||o(t.start)||o(t.end))return[];const{start:i,end:s}=t,n=[],{value:a,unit:r}=e;let l=u(i,r);for(;l.getTime()<=s.getTime();)l.getTime()>=i.getTime()&&n.push(l.getTime()),l=d(l,a,r);return n}_formatDate(e){return e?v(e,h("short-date")):null}_formatTime(e){return e?v(e,h("long-time")):null}_updateSliderSteps(){this._slider.steps=a(this.effectiveStops)&&this.effectiveStops.length>0?this.effectiveStops.map((e=>e.getTime())):null}_playOrStopClick(){switch(this.viewModel.state){case"ready":this.viewModel.play();break;case"playing":this.viewModel.stop();break;case"disabled":break;default:n(this.viewModel.state)}}_previousClick(){this.viewModel.previous()}_nextClick(){this.viewModel.next()}};e([c()],C.prototype,"actions",null),e([c()],C.prototype,"disabled",void 0),e([c()],C.prototype,"effectiveStops",null),e([c()],C.prototype,"fullTimeExtent",null),e([c()],C.prototype,"iconClass",void 0),e([c({readOnly:!0})],C.prototype,"interactive",null),e([c()],C.prototype,"label",null),e([c()],C.prototype,"labelFormatFunction",void 0),e([c({value:"auto"})],C.prototype,"layout",null),e([c()],C.prototype,"loop",null),e([c(),b("esri/widgets/TimeSlider/t9n/TimeSlider")],C.prototype,"messages",void 0),e([c(),b("esri/t9n/common")],C.prototype,"messagesCommon",void 0),e([c()],C.prototype,"mode",null),e([c()],C.prototype,"playRate",null),e([c()],C.prototype,"stops",null),e([c()],C.prototype,"tickConfigs",void 0),e([c()],C.prototype,"timeExtent",null),e([c({nonNullable:!0})],C.prototype,"timeVisible",void 0),e([c()],C.prototype,"view",null),e([c({type:E}),g("trigger-action")],C.prototype,"viewModel",void 0),e([y()],C.prototype,"_playOrStopClick",null),e([y()],C.prototype,"_previousClick",null),e([y()],C.prototype,"_nextClick",null),C=e([p("esri.widgets.TimeSlider")],C);const F=C;export{F as default};
