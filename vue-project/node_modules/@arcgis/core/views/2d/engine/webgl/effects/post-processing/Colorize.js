/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
import{disposeMaybe as e}from"../../../../../../core/maybe.js";import t from"../../VertexStream.js";import{BlendFactor as r,TextureType as s,PixelFormat as i,PixelType as a,TextureWrapMode as o,TextureSamplingMode as n}from"../../../../../webgl/enums.js";import{Texture as l}from"../../../../../webgl/Texture.js";class _{constructor(){this._layerFBOTexture=null,this._size=[0,0],this._programDesc={vsPath:"post-processing/pp",fsPath:"post-processing/filterEffect",attributes:new Map([["a_position",0]])}}dispose(){this._layerFBOTexture=e(this._layerFBOTexture)}draw(e,t,s){const{width:i,height:a}=t;this._createOrResizeResources(e,i,a);const{context:o,painter:n}=e,{materialManager:l}=n,_=this._programDesc,c=this._quad,u=s.colorMatrix;c.bind();const h=this._layerFBOTexture;o.bindFramebuffer(t),t.copyToTexture(0,0,i,a,0,0,h),o.setBlendingEnabled(!1),o.setStencilTestEnabled(!1);const p=l.getProgram(_);o.useProgram(p),o.bindTexture(h,2),p.setUniformMatrix4fv("u_coefficients",u),p.setUniform1i("u_colorTexture",2),c.draw(),o.setBlendingEnabled(!0),o.setBlendFunction(r.ONE,r.ONE_MINUS_SRC_ALPHA),o.setStencilTestEnabled(!0),c.unbind()}_createOrResizeResources(e,r,_){const{context:c}=e;this._layerFBOTexture&&this._size[0]===r&&this._size[1]===_||(this._size[0]=r,this._size[1]=_,this._layerFBOTexture?this._layerFBOTexture.resize(r,_):this._layerFBOTexture=new l(c,{target:s.TEXTURE_2D,pixelFormat:i.RGBA,internalFormat:i.RGBA,dataType:a.UNSIGNED_BYTE,wrapMode:o.CLAMP_TO_EDGE,samplingMode:n.LINEAR,flipped:!1,width:r,height:_}),this._quad||(this._quad=new t(c,[-1,-1,1,-1,-1,1,1,1])))}}export{_ as Colorize};
