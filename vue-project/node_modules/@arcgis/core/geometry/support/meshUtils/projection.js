/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
import r from"../../../core/Logger.js";import{isNone as e}from"../../../core/maybe.js";import{b as o,i as t,f as n,t as f}from"../../../chunks/mat3.js";import{c as a}from"../../../chunks/mat3f64.js";import{c as s}from"../../../chunks/mat4f64.js";import{t as c,n as m}from"../../../chunks/vec3.js";import{c as i}from"../../../chunks/vec3f64.js";import{projectBuffer as y,computeTranslationToOriginAndRotation as p}from"../../projection.js";import{getSphericalPCPF as u}from"../../spatialReferenceEllipsoidUtils.js";import{isCGCS2000 as P,isMars as T,isMoon as l}from"../spatialReferenceUtils.js";import{y2lat as A}from"../webMercatorUtils.js";import{BufferViewVec3f as F,BufferViewVec3f64 as d}from"../buffer/BufferView.js";import{t as E,a as C,n as _}from"../../../chunks/vec32.js";const g=r.getLogger("esri.geometry.support.meshUtils.normalProjection");function j(r,e,o,t,n){return B(t)?(b(U.TO_PCPF,F.fromTypedArray(r),d.fromTypedArray(e),d.fromTypedArray(o),t,F.fromTypedArray(n)),n):(g.error("Cannot convert spatial reference to PCPF"),n)}function h(r,e,o,t,n){return B(t)?(b(U.FROM_PCPF,F.fromTypedArray(r),d.fromTypedArray(e),d.fromTypedArray(o),t,F.fromTypedArray(n)),n):(g.error("Cannot convert to spatial reference from PCPF"),n)}function M(r,e,o){return y(r,e,0,o,u(e),0,r.length/3),o}function R(r,e,o){return y(r,u(o),0,e,o,0,r.length/3),e}function O(r,o,t){if(e(r))return o;const n=d.fromTypedArray(r),f=d.fromTypedArray(o);return E(f,n,t),o}function v(r,n,f){if(e(r))return n;o(x,f);const a=F.fromTypedArray(r),s=F.fromTypedArray(n);return C(s,a,x),t(x)||_(s,s),n}function V(r,n,f){if(e(r))return n;o(x,f);const a=F.fromTypedArray(r,4*Float32Array.BYTES_PER_ELEMENT),s=F.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT);if(C(s,a,x),t(x)||_(s,s),r!==n)for(let e=3;e<r.length;e+=4)n[e]=r[e];return n}function k(r,e,o,t,n){if(!B(t))return g.error("Cannot convert spatial reference to PCPF"),n;b(U.TO_PCPF,F.fromTypedArray(r,4*Float32Array.BYTES_PER_ELEMENT),d.fromTypedArray(e),d.fromTypedArray(o),t,F.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT));for(let f=3;f<r.length;f+=4)n[f]=r[f];return n}function L(r,e,o,t,n){if(!B(t))return g.error("Cannot convert to spatial reference from PCPF"),n;b(U.FROM_PCPF,F.fromTypedArray(r,16),d.fromTypedArray(e),d.fromTypedArray(o),t,F.fromTypedArray(n,16));for(let f=3;f<r.length;f+=4)n[f]=r[f];return n}function b(r,e,o,t,a,s){if(!e)return;const i=o.count,y=u(a);if(S(a))for(let m=0;m<i;m++)t.getVec(m,Y),e.getVec(m,w),p(y,Y,W,y),n(x,W),r===U.FROM_PCPF&&f(x,x),c(w,w,x),s.setVec(m,w);else for(let u=0;u<i;u++){t.getVec(u,Y),e.getVec(u,w),p(y,Y,W,y),n(x,W);const a=A(o.get(u,1));let i=Math.cos(a);r===U.TO_PCPF&&(i=1/i),x[0]*=i,x[1]*=i,x[2]*=i,x[3]*=i,x[4]*=i,x[5]*=i,r===U.FROM_PCPF&&f(x,x),c(w,w,x),m(w,w),s.setVec(u,w)}return s}function B(r){return S(r)||N(r)}function S(r){return r.isWGS84||P(r)||T(r)||l(r)}function N(r){return r.isWebMercator}var U;!function(r){r[r.TO_PCPF=0]="TO_PCPF",r[r.FROM_PCPF=1]="FROM_PCPF"}(U||(U={}));const Y=i(),w=i(),W=s(),x=a();export{R as projectFromPCPF,h as projectNormalFromPCPF,j as projectNormalToPCPF,L as projectTangentFromPCPF,k as projectTangentToPCPF,M as projectToPCPF,v as transformNormal,O as transformPosition,V as transformTangent};
