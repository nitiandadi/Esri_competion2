import{aD as J,r as p,wi as _e,wj as ot,wk as nt,cq as b,ta as we,qJ as se,g$ as N,fo as We,fs as O,hx as Le,ft as ue,r_ as rt,wl as st,g_ as Te,tG as oe,ey as at,ex as lt,wm as Ue,a3 as Ae,K as pt,c1 as ct,uK as ht,fU as Ne,fG as E,t as y,wn as dt,nv as ut,e as a,y as l,b as H,m as gt,o as ye,p as te,av as G,g as yt,hr as mt,q as qe,A as je,cg as M,kL as vt,E as ge,fB as ft,d8 as xt,fL as _t,cw as be,rG as wt,fM as Oe,fg as Ye,cv as Be,ff as Tt,fF as B,wo as Me,jd as Se,iq as Ve,rS as Je,hT as L,hW as Y,fk as Ie,wp as bt,wq as Ot,fi as Mt,f$ as ae,g0 as $e,j7 as w,hZ as Ce,s8 as St,fp as le}from"./mapviewstore-8a6f290e.js";import{b as I,U as q,a as Re,p as Pe}from"./quantityFormatUtils-6059fd77.js";import{h as Vt}from"./GraphicsLayer-0c6904d3.js";import{g as me,s as It,d as $t}from"./elevationInfoUtils-db1a4384.js";import{m as Ct,c as ne,p as re}from"./index-c3e37161.js";import{simplify as Rt,distance as Pt}from"./geometryEngine-31bba3a2.js";import{p as Gt,x as pe,X as zt}from"./InteractiveToolBase-0db68d23.js";import{t as K,m as Et,a as ce,b as Dt,g as X}from"./automaticLengthMeasurementUtils-4b743452.js";import{i as Ge}from"./automaticAreaMeasurementUtils-3a14dcec.js";import{i as ze}from"./dehydratedFeatureComparison-baf6aa6d.js";import{w as Zt,V as Ft,g as Ht,p as kt,t as Wt,a as Lt,s as Ut,c as At}from"./EditGeometryOperations-03e088f6.js";import{e as Ee}from"./SnappingContext-3f11e741.js";import{h as Nt,m as qt}from"./SnappingOperation-f7fee6c6.js";import{m as jt}from"./SnappingManager-e678da87.js";function ie(t,e,i=null){return p(i)?[t,e,i]:[t,e]}function v(t,e,i=null){return p(i)?{x:t,y:e,z:i}:{x:t,y:e}}class Ke{constructor(e){this.spatialReference=e}mapToLocalMultiple(e){return oe(e.map(i=>this.mapToLocal(i)))}get doUnnormalization(){return!1}}let Yt=class extends Ke{constructor(e,i,o=null){super(i),this._defaultZ=o,this.transform=_e(),this.transformInv=_e(),this.transform=ot(e),nt(this.transformInv,this.transform)}makeMapPoint(e,i){return ie(e,i,this._defaultZ)}mapToLocal(e){return v(this.transform[0]*e[0]+this.transform[2]*e[1]+this.transform[4],this.transform[1]*e[0]+this.transform[3]*e[1]+this.transform[5])}localToMap(e){return ie(this.transformInv[0]*e.x+this.transformInv[2]*e.y+this.transformInv[4],this.transformInv[1]*e.x+this.transformInv[3]*e.y+this.transformInv[5],this._defaultZ)}},Bt=class extends Ke{constructor(e,i){super(e.spatialReference),this.view=e,this.defaultZ=null,this.pWS=b(),this.tangentFrameUpWS=b(),this.tangentFrameRightWS=b(),this.tangentFrameForwardWS=b(),this.localFrameRightWS=b(),this.localFrameUpWS=b(),this.worldToLocalTransform=we(),this.localToWorldTransform=we(),this.scale=1,this.scale=e.resolution,this.referenceMapPoint=i,this.defaultZ=i.hasZ?i.z:null;const o=e.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,se.X,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,se.Y,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,se.Z,this.tangentFrameForwardWS);const r=b();N(r,this.tangentFrameForwardWS,We(o,this.tangentFrameForwardWS)),O(this.localFrameRightWS,o,r),Le(this.localFrameRightWS,this.localFrameRightWS),ue(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),rt(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),st(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return this.view.viewingMode==="global"}makeMapPoint(e,i){return ie(e,i,this.defaultZ)}mapToLocal(e){const i=b();this.view.renderCoordsHelper.toRenderCoords(new J({x:e[0],y:e[1],spatialReference:this.spatialReference}),i),Te(i,i,this.worldToLocalTransform);const o=this.view.renderCoordsHelper.fromRenderCoords(i,this.view.spatialReference);return p(o)?v(o.x/this.scale,o.y/this.scale):null}localToMap(e){const i=b();this.view.renderCoordsHelper.toRenderCoords(new J({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),i),Te(i,i,this.localToWorldTransform);const o=this.view.renderCoordsHelper.fromRenderCoords(i,this.view.spatialReference);return p(o)?ie(o.x,o.y,this.defaultZ):null}};function De(t,e){if(t.type==="2d")return new Yt(t.state.transform,t.spatialReference,e.length>2?e[2]:null);if(t.type==="3d"){const i=e.length>2?new J({x:e[0],y:e[1],z:e[2],spatialReference:t.spatialReference}):new J({x:e[0],y:e[1],spatialReference:t.spatialReference});return new Bt(t,i)}return null}function F(t,e){const i=new J({x:t[0],y:t[1],spatialReference:e});return t.length>2&&(i.z=t[2]),i}function Jt(t,e){return new at({points:t,spatialReference:e})}function Ze(t,e,i){const o=new lt({paths:t,spatialReference:e});return i&&Ue(o),o}function j(t,e,i,o=!0){const r=Ae(t);r.forEach(n=>{const h=n[0],c=n[n.length-1];pt(h,c)&&n.length!==1||n.push(n[0])});let s=new ct({rings:r,spatialReference:e});return s.rings.forEach(n=>{ht(n,!1,!1)||n.reverse()}),i&&Ue(s),o&&s.isSelfIntersecting&&Ne(e)&&(s=Rt(s)),s}function Fe(t,e,i){const o=e.mapToLocalMultiple(t),r=[],s={x:o[0].x,y:o[0].y},n={x:o[1].x,y:o[1].y},h=Math.round(n.x-s.x),c=Math.round(n.y-s.y),g=Math.max(Math.abs(h),Math.abs(c));if(i){const d={x:s.x+g,y:s.y+g},m={x:s.x-g,y:s.y-g};r.push(v(d.x,m.y),v(m.x,m.y),v(m.x,d.y),v(d.x,d.y))}else{const d={x:h>0?s.x+g:s.x-g,y:c>0?s.y+g:s.y-g};r.push(v(s.x,s.y),v(d.x,s.y),v(d.x,d.y),v(s.x,d.y))}return Xe(j([oe(r.map(d=>e.localToMap(d)))],e.spatialReference,e.doUnnormalization,!0),r,e)}function Kt(t,e,i){let o=e.mapToLocalMultiple(t);if(o.length===1){const c=o[0];o=[v(c.x-48,c.y+48),v(c.x+48,c.y-48),v(c.x+48,c.y-48),v(c.x-48,c.y+48)]}const r=[],s={x:o[0].x,y:o[0].y},n={x:o[1].x,y:o[1].y};if(i){const h=Math.round(n.x-s.x),c=Math.round(n.y-s.y);r.push(v(s.x-h,s.y-c),v(n.x,s.y-c),v(n.x,n.y),v(s.x-h,n.y))}else r.push(v(s.x,s.y),v(n.x,s.y),v(n.x,n.y),v(s.x,n.y));return Xe(j([oe(r.map(h=>e.localToMap(h)))],e.spatialReference,e.doUnnormalization,!0),r,e)}function Xe(t,e,i){const o=Q(e[3],e[2],i),r=Q(e[1],e[2],i),s=Q(e[0],e[1],i),n=Q(e[0],e[3],i);return{geometry:t,midpoints:p(o)&&p(r)&&p(s)&&p(n)?{top:o,right:r,bottom:s,left:n}:null}}function Q(t,e,i){U[0]=t.x,U[1]=t.y,U[2]=0,A[0]=e.x,A[1]=e.y,A[2]=0,E(U,U,A,.5),ee.x=U[0],ee.y=A[1],ee.z=A[2];const o=i.localToMap(ee);return p(o)?F(o,i.spatialReference):null}const ee=v(0,0,0),U=b(),A=b();function He(t,e,i,o){const r=e.mapToLocalMultiple(t);let s=null,n=null;if(i)s=r[0],n=r[1];else{const x=r[0],T=r[1],k=Math.round(T.x-x.x),W=Math.round(T.y-x.y),S=Math.max(Math.abs(k),Math.abs(W));s=v(k>0?x.x+S/2:x.x-S/2,W>0?x.y+S/2:x.y-S/2),n=v(Math.abs(k)>Math.abs(W)?s.x-S/2:s.x,Math.abs(k)>Math.abs(W)?s.y:s.y-S/2)}const h=e.localToMap(s),c=e.localToMap(n);if(y(h)||y(c))return null;e.doUnnormalization&&dt([[h,c]],e.spatialReference);const g=F(h,e.spatialReference),d=F(c,e.spatialReference),m=ut(e.spatialReference);let _=0;if(Ne(e.spatialReference))_=m*Pt(g,d,null);else{const x=s.x-n.x,T=s.y-n.y;_=m*Math.sqrt(x*x+T*T)*(o||1)}const z=new Ct({center:g,radius:_,radiusUnit:"meters",spatialReference:e.spatialReference});return{geometry:j(z.rings,z.spatialReference,!1),center:g,edge:d}}function Xt(t,e,i){const o=e.mapToLocalMultiple(t),r=o[0],s=o[1],n=Math.round(s.x-r.x),h=Math.round(s.y-r.y),c=v(i?r.x:r.x+n/2,i?r.y:r.y+h/2),g=i?n:n/2,d=i?h:h/2,m=60,_=[],z=2*Math.PI/m;function x($){const tt=Math.cos($),it=Math.sin($);return v(g*tt+c.x,d*it+c.y)}for(let $=0;$<m;$++)_.push(x($*z));_.push(_[0]);const{spatialReference:T,doUnnormalization:k}=e,W=j([oe(_.map($=>e.localToMap($)))],T,k,!1),S=e.localToMap(x(Math.PI/2)),ve=e.localToMap(x(0)),fe=e.localToMap(x(-Math.PI/2)),xe=e.localToMap(x(Math.PI));return{geometry:W,midpoints:p(S)&&p(ve)&&p(fe)&&p(xe)?{top:F(S,T),right:F(ve,T),bottom:F(fe,T),left:F(xe,T)}:null}}function he(t,e){switch(t){case"point":case"multipoint":return"point";case"polyline":return(p(e)&&e.type==="polyline"&&e.paths.length?e.paths[0].length:0)<2?"polylineZeroVertices":"polylineOneVertex";case"polygon":{const i=p(e)&&e.type==="polygon"&&e.rings.length?e.rings[0].length:0;return i<3?"polylineZeroVertices":i<4?"polygonOneVertex":"polygonTwoVertices"}default:return}}let D=class extends K{constructor(t){super(t),this.type="draw-point",this.helpMessage=void 0}};a([l()],D.prototype,"type",void 0),a([l()],D.prototype,"elevation",void 0),a([l()],D.prototype,"viewType",void 0),a([l()],D.prototype,"helpMessage",void 0),D=a([H("esri.views.interactive.tooltip.DrawPointTooltipInfo")],D);let C=class extends K{constructor(e){super(e),this.type="draw-polyline",this.totalLength=I,this.helpMessage=void 0}};a([l()],C.prototype,"type",void 0),a([l()],C.prototype,"elevation",void 0),a([l()],C.prototype,"totalLength",void 0),a([l()],C.prototype,"viewType",void 0),a([l()],C.prototype,"helpMessage",void 0),C=a([H("esri.views.interactive.tooltip.DrawPolylineTooltipInfo")],C);let R=class extends K{constructor(t){super(t),this.type="draw-polygon",this.area=q,this.helpMessage=void 0}};a([l()],R.prototype,"type",void 0),a([l()],R.prototype,"elevation",void 0),a([l()],R.prototype,"area",void 0),a([l()],R.prototype,"viewType",void 0),a([l()],R.prototype,"helpMessage",void 0),R=a([H("esri.views.interactive.tooltip.DrawPolygonTooltipInfo")],R);let Z=class extends K{constructor(t){super(t),this.type="draw-rectangle",this.xSize=I,this.ySize=I,this.area=q}};a([l()],Z.prototype,"type",void 0),a([l()],Z.prototype,"xSize",void 0),a([l()],Z.prototype,"ySize",void 0),a([l()],Z.prototype,"area",void 0),Z=a([H("esri.views.interactive.tooltip.DrawRectangleTooltipInfo")],Z);let P=class extends K{constructor(t){super(t),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=q}};a([l()],P.prototype,"type",void 0),a([l()],P.prototype,"radius",void 0),a([l()],P.prototype,"xSize",void 0),a([l()],P.prototype,"ySize",void 0),a([l()],P.prototype,"area",void 0),P=a([H("esri.views.interactive.tooltip.DrawCircleTooltipInfo")],P);let u=class extends gt(ye.EventedMixin(Gt)){constructor(e){super(e),this._graphic=null,this._createOperationGeometry=null,this.defaultZ=0,this.geometryType=null,this.hasZ=!0,this.labelOptions=new ne,this.mode=null,this.snappingManager=null,this.snapToScene=!1,this.tooltip=null,this.tooltipOptions=new re}initialize(){this.internalGraphicsLayer=new Vt({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer),this.drawOperation=this.makeDrawOperation(),this.handles.add([this.drawOperation.on("vertex-add",e=>this.onVertexAdd(e)),this.drawOperation.on("vertex-remove",e=>this.onVertexRemove(e)),this.drawOperation.on("vertex-update",e=>this.onVertexUpdate(e)),this.drawOperation.on("cursor-update",e=>this.onCursorUpdate(e)),this.drawOperation.on("complete",e=>this.onComplete(e)),te(()=>this.tooltipOptions.enabled,e=>{this.tooltip=e?new Dt({view:this.view,info:this._tooltipInfo}):G(this.tooltip)},ge),te(()=>this._tooltipInfo,e=>{p(this.tooltip)&&(this.tooltip.info=e)},ge)]),this.finishToolCreation()}destroy(){this.drawOperation=G(this.drawOperation),this.tooltip=G(this.tooltip),this._destroyAllVisualisations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=G(this.internalGraphicsLayer),this._set("view",null)}get _defaultElevation(){return Re(this.defaultZ,"meters")}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(e){this._set("centered",e),this._updateGraphic()}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set forceUniformSize(e){this._set("forceUniformSize",e),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(e){this._set("graphicSymbol",e),p(this._graphic)&&(this._graphic.symbol=e)}get updating(){var e;return((e=this.drawOperation)==null?void 0:e.updating)??!1}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(e){this.drawOperation.onInputEvent(e)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo()}_createGraphic(e){this._graphic=new yt({...this.graphicProperties,geometry:e,symbol:this.graphicSymbol}),this.internalGraphicsLayer.add(this._graphic),this.handles.add(this.initializeGraphic(this._graphic)),this.notifyChange("graphic"),this.handles.add(mt(()=>{p(this._graphic)&&(this.internalGraphicsLayer.remove(this._graphic),this._graphic=G(this._graphic))}),de)}_destroyAllVisualisations(){this.handles.remove(V.outline),this.handles.remove(V.regularVertices),this.handles.remove(V.activeVertex),this.handles.remove(de)}_getCreateOperationGeometry(e={operationComplete:!1}){if(this.drawOperation==null||this.drawOperation.numVertices===0)return null;const i=this.drawOperation.stagedVertex,o=this.drawOperation.committedVertices,r=o.slice();p(i)&&r.push(this.drawOperation.coordinateHelper.pointToArray(i));const s=p(i)?this.drawOperation.coordinateHelper.pointToArray(i):o.splice(-1)[0],n={regularVertices:null,activeVertex:null,full:null,outline:null,circle:null,rectangle:null},h=r.length,c=this.view.spatialReference,g=this.view.type==="3d"&&this.view.viewingMode==="global";switch(this.geometryType){case"point":n.regularVertices=o,n.activeVertex=s,n.full=this.drawOperation.coordinateHelper.arrayToPoint(r[0]);break;case"multipoint":n.regularVertices=o,n.activeVertex=s,h>0&&(n.full=Jt(r,c));break;case"polyline":n.regularVertices=o,n.activeVertex=s,h>0&&(n.full=Ze([r],c,g));break;case"polygon":n.regularVertices=o,n.activeVertex=s,h>0&&(n.full=j([r],c,g,!0));break;case"circle":if(h>0){const d=De(this.view,r[0]);if(h===1&&e.operationComplete){const m=r[0],_=d.makeMapPoint(m[0]+ke*this.view.resolution,m[1]);n.circle=He([m,_],d,!0),n.full=p(n.circle)?n.circle.geometry:null}else h===2&&(this.forceUniformSize?(n.circle=He(r,d,this.centered),n.full=p(n.circle)?n.circle.geometry:null):(n.rectangle=Xt(r,d,this.centered),n.full=n.rectangle.geometry))}break;case"rectangle":if(h>0){const d=De(this.view,r[0]);if(h===1&&e.operationComplete){const m=r[0],_=d.makeMapPoint(m[0]+ke*this.view.resolution,m[1]);n.rectangle=Fe([m,_],d,!0),n.full=n.rectangle.geometry}else h===2&&(n.rectangle=this.forceUniformSize?Fe(r,d,this.centered):Kt(r,d,this.centered),n.full=n.rectangle.geometry)}break;default:return null}switch(this.geometryType){case"point":case"multipoint":break;case"polyline":case"polygon":h>1&&(n.outline=Ze([r],c,g));break;case"circle":case"rectangle":p(n.full)&&n.full.type==="polygon"&&(n.outline=j(n.full.rings,c,g))}return n}initializeGraphic(e){return null}onComplete(e){this._updateGraphic();let i=null;if(this.drawOperation.isCompleted){const o=this._getCreateOperationGeometry({operationComplete:!0});p(o)&&(y(this._graphic)?this._createGraphic(o.full):this._graphic.geometry=o.full,i=qe(this._graphic).clone())}this._createOperationGeometry=null,this.emit("complete",{graphic:i,...e})}onCursorUpdate(e){this._updateGraphic(),this.emit("cursor-update",e)}onDeactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}onVertexAdd(e){this._updateGraphic(),this.emit("vertex-add",e)}onVertexRemove(e){this._updateGraphic(),this.emit("vertex-remove",e)}onVertexUpdate(e){this._updateGraphic(),this.emit("vertex-update",e)}_updateGraphic(){const e=this._getCreateOperationGeometry();this._createOperationGeometry=e,y(e)?this._destroyAllVisualisations():(p(e.outline)?this.handles.add(this.onOutlineChanged(e.outline),V.outline):this.handles.remove(V.outline),p(e.regularVertices)?this.handles.add(this.onRegularVerticesChanged(e.regularVertices),V.regularVertices):this.handles.remove(V.regularVertices),p(e.activeVertex)?this.handles.add(this.onActiveVertexChanged(e.activeVertex),V.activeVertex):this.handles.remove(V.activeVertex),p(e.full)?y(this._graphic)?this._createGraphic(e.full):this._graphic.geometry=e.full:this.handles.remove(de))}get _tooltipInfo(){const{drawOperation:e}=this;if(!e)return null;switch(this.geometryType){case"point":return this._drawPointTooltipInfo;case"polyline":return this._drawPolylineTooltipInfo;case"polygon":return this._drawPolygonTooltipInfo;case"rectangle":return this._drawRectangleTooltipInfo;case"circle":return this._drawCircleTooltipInfo;default:return null}}get _drawPointTooltipInfo(){const e=je(this.graphic,i=>i.geometry);return y(e)||e.type!=="point"||this.view.type==="2d"&&this.defaultZ===0?null:new D({tooltipOptions:this.tooltipOptions,elevation:this._elevationTooltipDetail,viewType:this.view.type,helpMessage:he("point",e)})}get _drawPolylineTooltipInfo(){const e=this._createOperationGeometry,i=p(e)?e.full:null;if(y(i)||i.type!=="polyline")return null;const o=Et(i,this._elevationMode);return new C({tooltipOptions:this.tooltipOptions,elevation:this._elevationTooltipDetail,totalLength:M(o,I),viewType:this.view.type,helpMessage:he("polyline",i)})}get _drawPolygonTooltipInfo(){const e=this._createOperationGeometry,i=p(e)?e.full:null;if(y(i)||i.type!=="polygon")return null;const o=Ge(i,this._elevationMode);return new R({tooltipOptions:this.tooltipOptions,elevation:this._elevationTooltipDetail,area:M(o,q),viewType:this.view.type,helpMessage:he("polygon",i)})}get _drawRectangleTooltipInfo(){return y(this.drawOperation)?null:new Z({tooltipOptions:this.tooltipOptions,xSize:M(this._xSize,I),ySize:M(this._ySize,I),area:M(this._fullGeometryArea,q)})}get _drawCircleTooltipInfo(){if(y(this.drawOperation))return null;const e=this.forceUniformSize;return new P({tooltipOptions:this.tooltipOptions,radius:e?M(this._circleRadius,I):null,xSize:e?null:M(this._xSize,I),ySize:e?null:M(this._ySize,I),area:M(this._fullGeometryArea,q)})}get _circleRadius(){const e=this._createOperationGeometry;return p(e)&&p(e.circle)&&p(e.circle.center)&&p(e.circle.edge)?ce(e.circle.center,e.circle.edge,this._elevationMode):null}get _xSize(){const e=this._createOperationGeometry;if(y(e)||y(e.rectangle))return null;const{midpoints:i}=e.rectangle;return p(i)?ce(i.left,i.right,this._elevationMode):null}get _ySize(){const e=this._createOperationGeometry;if(y(e)||y(e.rectangle))return null;const{midpoints:i}=e.rectangle;return p(i)?ce(i.top,i.bottom,this._elevationMode):null}get _fullGeometryArea(){const e=this._createOperationGeometry,i=p(e)?e.full:null;return y(i)||i.type!=="polygon"?null:Ge(i,this._elevationMode)}get _elevationTooltipDetail(){return{mode:this.drawOperation.elevationInfo.mode,...this._vertexTooltipElevation}}get _vertexTooltipElevation(){const{tooltipOptions:e,view:i,drawOperation:o}=this;if(y(o))return this._defaultElevation;const r=o.stagedVertex??o.lastVertex;if(y(r)||i.type==="2d")return this._defaultElevation;const s={mode:e.elevation.mode,offset:0},n=(me(i,r,o.elevationInfo,s)??0)*vt(r.spatialReference);return Re(n,"meters")}get _elevationMode(){return this.drawOperation.isDraped?"on-the-ground":"absolute-height"}};a([l()],u.prototype,"_createOperationGeometry",void 0),a([l()],u.prototype,"_defaultElevation",null),a([l({value:!0})],u.prototype,"centered",null),a([l({nonNullable:!0})],u.prototype,"defaultZ",void 0),a([l()],u.prototype,"drawOperation",void 0),a([l({value:!0})],u.prototype,"enabled",null),a([l({value:!0})],u.prototype,"forceUniformSize",null),a([l({constructOnly:!0})],u.prototype,"geometryType",void 0),a([l()],u.prototype,"graphic",null),a([l({constructOnly:!0})],u.prototype,"graphicProperties",void 0),a([l()],u.prototype,"graphicSymbol",null),a([l({constructOnly:!0})],u.prototype,"hasZ",void 0),a([l({constructOnly:!0,type:ne})],u.prototype,"labelOptions",void 0),a([l({constructOnly:!0})],u.prototype,"mode",void 0),a([l()],u.prototype,"snappingManager",void 0),a([l()],u.prototype,"snapToScene",void 0),a([l()],u.prototype,"tooltip",void 0),a([l({constructOnly:!0,type:re})],u.prototype,"tooltipOptions",void 0),a([l({readOnly:!0})],u.prototype,"type",void 0),a([l({readOnly:!0})],u.prototype,"updating",null),a([l({constructOnly:!0,nonNullable:!0})],u.prototype,"view",void 0),a([l()],u.prototype,"_tooltipInfo",null),a([l()],u.prototype,"_drawPointTooltipInfo",null),a([l()],u.prototype,"_drawPolylineTooltipInfo",null),a([l()],u.prototype,"_drawPolygonTooltipInfo",null),a([l()],u.prototype,"_drawRectangleTooltipInfo",null),a([l()],u.prototype,"_drawCircleTooltipInfo",null),a([l()],u.prototype,"_circleRadius",null),a([l()],u.prototype,"_xSize",null),a([l()],u.prototype,"_ySize",null),a([l()],u.prototype,"_fullGeometryArea",null),a([l()],u.prototype,"_elevationTooltipDetail",null),a([l()],u.prototype,"_vertexTooltipElevation",null),a([l()],u.prototype,"_elevationMode",null),u=a([H("esri.views.draw.DrawGraphicTool")],u);const de="create-operation-graphic",V={outline:"outline-visual",regularVertices:"regular-vertices-visual",activeVertex:"active-vertex-visual"};function Ti(t){switch(t){case"point":case"polyline":case"polygon":case"multipoint":return t;case"circle":case"rectangle":return"segment"}}const ke=48,Qe="click";class Qt{constructor({grabbableForEvent:e}){this.events=new ye,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.grabbableForEvent=e}intersectionDistance(e,i){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}}let f=class extends ye.EventedMixin(ft){constructor(t){super(t),this._createOperationCompleted=!1,this._pointerDownStates=new Set,this.isDraped=!0,this.labelOptions=new ne,this.tooltipOptions=new re,this.snapToSceneEnabled=null,this.lastVertex=null,y(t.elevationInfo)&&(this.elevationInfo=It(!!t.hasZ))}initialize(){const{geometryType:t,view:e}=this,i=e.spatialReference,o="viewingMode"in e.state?e.state.viewingMode:xt.Local,r=t==="segment"||t==="multipoint"?"polyline":t;this.coordinateHelper=Zt(this.hasZ,this.hasM,i),this._editGeometryOperations=new Ft(new Ht(r,this.coordinateHelper)),this._snappingOperation=new Nt({view:e,constrainResult:n=>{var h;return y(n)?n:(h=this._getEffectiveDrawSurface())==null?void 0:h.constrainZ(n)}}),this.handles.add(te(()=>this.stagedVertex,n=>{y(n)||this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(n)}],operation:"apply",type:"vertex-update"})},{sync:!0,equals:(n,h)=>wt(n,h,ze)})),this._activeComponent=new kt(i,o),this._editGeometryOperations.data.components.push(this._activeComponent);const s=this.segmentLabels;p(s)&&(s.context={view:e,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions},this.handles.add([te(()=>this.labelOptions.enabled,n=>{s.visible=n},ge),this.on("cursor-update",()=>{const n=this.stagedVertex;s.stagedVertex=p(n)?this.coordinateHelper.pointToVector(n):null})])),this.handles.add(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],n=>{const h=n.vertices.map(m=>({componentIndex:0,vertexIndex:m.index,coordinates:this.coordinateHelper.vectorToArray(m.pos)})),c=h.map(m=>m.coordinates);switch(n.type){case"vertex-add":this.emit(n.type,{...n,added:c,vertices:h});break;case"vertex-update":this.emit(n.type,{...n,updated:c,vertices:h});break;case"vertex-remove":this.emit(n.type,{...n,removed:c,vertices:h})}const g=this._activeComponent.getLastVertex(),d=p(g)?this.coordinateHelper.vectorToDehydratedPoint(g.pos):null;(y(d)||y(this.lastVertex)||!ze(this.lastVertex,d))&&(this.lastVertex=d)})),this._manipulator=new Qt({grabbableForEvent:n=>this.drawingMode!=="click"||n.pointerType==="touch"&&this._snappingEnabled&&this._pointerDownStates.size===1}),this.manipulators.add(this._manipulator),this._manipulator.grabbable=t!=="point",this.handles.add([this._createManipulatorDragPipeline(this._manipulator),this._manipulator.events.on("immediate-click",n=>this._onImmediateClick(n)),this._manipulator.events.on("immediate-double-click",n=>this._onImmediateDoubleClick(n))]),jt(this,()=>{const n=M(this.view.inputManager.latestPointerType,"mouse"),h=this._getSnappingContext(n);p(this.snappingManager)&&this.updatingHandles.addPromise(be(this._snappingOperation.resnap(this.snappingManager,h)))})}destroy(){G(this.segmentLabels),G(this._snappingOperation),this._editGeometryOperations=G(this._editGeometryOperations)}get _snappingEnabled(){return p(this.snappingManager)&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){const t=this._getEffectiveDrawSurface();return this.view.type==="3d"&&this.drawSurface!==t}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map(t=>this.coordinateHelper.vectorToArray(t.pos))}set drawingMode(t){this._set("drawingMode",t??Qe)}get interactive(){return this._manipulator.interactive}set interactive(t){this._manipulator.interactive=t}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get numVertices(){return p(this.stagedVertex)?this._activeComponent.vertices.length+1:this._activeComponent.vertices.length}get snappingOptions(){return p(this.snappingManager)?this.snappingManager.options:null}get stagedVertex(){return this._snappingOperation.stagedPoint}set stagedVertex(t){this._snappingOperation.stagedPoint=Ae(t)}get updating(){return this.updatingHandles.updating}get vertices(){const t=this.committedVertices;return p(this.stagedVertex)&&t.push(this.coordinateHelper.pointToArray(this.stagedVertex)),t}cancel(){this.complete({aborted:!0})}commitStagedVertex(){if(this._snappingOperation.abort(),p(this.stagedVertex)){const{stagedVertex:t}=this;this.stagedVertex=null,this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(t))}}complete(t){const e=t&&t.aborted||!1;this._snappingOperation.abort(),p(this.snappingManager)&&this.snappingManager.doneSnapping(),this.geometryType==="segment"||this.geometryType==="point"?this.commitStagedVertex():this.stagedVertex=null;const i=this.geometryType==="multipoint"&&this.numVertices===0||this.geometryType==="polyline"&&this.numVertices<2||this.geometryType==="polygon"&&this.numVertices<3;this._createOperationCompleted=!i,(this.isCompleted||e)&&this.emit("complete",{vertices:this.vertices.map((o,r)=>({componentIndex:0,vertexIndex:r,coordinates:o})),aborted:e,type:"complete"})}onInputEvent(t){switch(t.type){case"pointer-down":this._pointerDownStates.add(t.pointerId);break;case"pointer-up":this._pointerDownStates.delete(t.pointerId)}switch(t.type){case"pointer-move":return this._onPointerMove(t);case"hold":return this._onHold(t)}}redo(){this._editGeometryOperations.redo()}undo(){p(this.snappingManager)&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_closeOnClickVertexIndex(t){const e=this._activeComponent;if(this.geometryType==="polygon"&&e.vertices.length>2){if(this._vertexWithinPointerDistance(e.vertices[0].pos,t))return 0;if(this._vertexWithinPointerDistance(e.vertices[e.vertices.length-1].pos,t))return e.vertices.length-1}return null}_createManipulatorDragPipeline(t){switch(qe(this.drawingMode)){case"click":return this._createManipulatorDragPipelineClick(t);case"freehand":return this._createManipulatorDragPipelineFreehand(t);case"hybrid":return this._createManipulatorDragPipelineHybrid(t)}}_createManipulatorDragPipelineClick(t){return pe(t,(e,i,o,r)=>{const s=r==="touch"&&this._snappingEnabled;if(this.isCompleted||!s)return;const{snappingStep:n,cancelSnapping:h}=qt({predicate:()=>s,snappingManager:this.snappingManager,snappingContext:new Ee({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:r,visualizer:this.snappingVisualizer}),updatingHandles:this.updatingHandles,useZ:!this._requiresScenePoint});o=o.next(c=>(s&&p(this.snappingManager)&&this.snappingManager.doneSnapping(),c)).next(h),i.next(this._screenToMapDragEventStep()).next(c=>(c.action==="start"&&(this.stagedVertex=c.mapStart,(this.geometryType==="segment"||s&&this.numVertices===0)&&this.commitStagedVertex()),c)).next(zt(this.view,this.elevationInfo)).next(...n).next(c=>(s&&(this.stagedVertex=c.mapEnd,c.action==="end"&&this.commitStagedVertex()),c)).next(c=>(c.action==="end"&&(this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()),c))})}_createManipulatorDragPipelineFreehand(t){return pe(t,(e,i)=>{this.isCompleted||i.next(this._screenToMapDragEventStep()).next(o=>(o.action==="start"&&(y(this.stagedVertex)&&(this.stagedVertex=o.mapStart),this.geometryType==="segment"&&this.commitStagedVertex()),o)).next(o=>{switch(o.action){case"start":case"update":this.stagedVertex=o.mapEnd,this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this.complete()}return o})})}_createManipulatorDragPipelineHybrid(t){return pe(t,(e,i)=>{this.isCompleted||i.next(this._screenToMapDragEventStep()).next(o=>(o.action==="start"&&(y(this.stagedVertex)&&(this.stagedVertex=o.mapStart),this.commitStagedVertex()),o)).next(o=>{switch(o.action){case"start":case"update":this.stagedVertex=o.mapEnd,this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()}return o})})}get _drawAtFixedElevation(){return(this.geometryType==="segment"||this.geometryType==="polygon")&&this.numCommittedVertices>0}_getEffectiveDrawSurface(){if(y(this.elevationDrawSurface))return this.drawSurface;if(!this.coordinateHelper.hasZ())return this.elevationDrawSurface.defaultZ=null,this.elevationDrawSurface;let t=this.defaultZ,e=!1;return p(this.elevationInfo)&&this.elevationInfo.mode==="absolute-height"&&(e=!0),p(this.snapToSceneEnabled)&&(e=this.snapToSceneEnabled),p(this.elevationInfo)&&this.elevationInfo.mode==="on-the-ground"&&(e=!1),this._drawAtFixedElevation&&(t=this.coordinateHelper.getZ(this._activeComponent.vertices[0].pos),e=!1),e?this.drawSurface:(this.elevationDrawSurface.defaultZ=t,this.elevationDrawSurface)}_mapToScreen(t){var e;return(e=this._getEffectiveDrawSurface())==null?void 0:e.mapToScreen(t)}_onHold(t){this._snappingOperation.abort(),this.drawingMode==="click"&&t.pointerType==="touch"&&this._snappingEnabled&&(this.stagedVertex=t.mapPoint),t.stopPropagation()}_onImmediateClick(t){if(t.pointerType==="mouse"&&t.button===2||this._manipulator.dragging)return;const e=this._activeComponent,i=this._closeOnClickVertexIndex(t.screenPoint);if(p(i))return t.stopPropagation(),void this.complete();const o=this._screenToMap(t.screenPoint);if(p(o))switch(this.drawingMode){case"freehand":this.geometryType==="point"&&(p(this.stagedVertex)?this.commitStagedVertex():this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(o)),this.complete());break;case"click":case"hybrid":this._snappingOperation.abort(),p(this.stagedVertex)?this.commitStagedVertex():this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(o)),(this.geometryType==="point"||this.geometryType==="segment"&&e.vertices.length===2||this.geometryType==="segment"&&this.drawingMode==="hybrid"&&e.vertices.length===1)&&this.complete()}t.stopPropagation()}_onImmediateDoubleClick(t){this._manipulator.dragging||this.geometryType==="point"||(this.complete(),t.stopPropagation())}_onPointerMove(t){var c;const e=_t(t.x,t.y),i=this._snappingOperation;if(this._manipulator.dragging||this._pointerDownStates.has(t.pointerId)||this._manipulator.grabbing||!this._manipulator.interactive)return void i.abort();t.stopPropagation();const o=this._closeOnClickVertexIndex(e);if(p(o))return this._closeOnVertex(o),void i.abort();const r=this._screenToMap(e),s=this._requiresScenePoint?(c=this.drawSurface)==null?void 0:c.screenToMap(e):null;if(this._manipulator.cursor=p(r)?"crosshair":null,y(r))return void i.abort();const n=this.snappingManager;if(y(n))return this.stagedVertex=r,void i.abort();const h=this._getSnappingContext(t.pointerType);this.updatingHandles.addPromise(be(i.snap({point:r,scenePoint:s},n,h)))}_closeOnVertex(t){this.stagedVertex=null;const e={componentIndex:0,vertexIndex:t,coordinates:this.coordinateHelper.vectorToArray(this._activeComponent.vertices[t].pos)};this.emit("cursor-update",{updated:null,vertices:[e],operation:"apply",type:"vertex-update"})}_screenToMap(t){var e;return(e=this._getEffectiveDrawSurface())==null?void 0:e.screenToMap(t)}_screenToMapDragEventStep(){let t=null;return e=>{if(e.action==="start"&&(t=this._screenToMap(e.screenStart)),y(t))return null;const i=this._screenToMap(e.screenEnd);return p(i)?{...e,mapStart:t,mapEnd:i}:null}}_vertexWithinPointerDistance(t,e){const o=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(t));return!!p(o)&&ei(o,e,25)}_getSnappingContext(t){const e=this._drawAtFixedElevation?je(this.elevationDrawSurface,({defaultZ:i})=>i):null;return new Ee({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:t,visualizer:this.snappingVisualizer,selfSnappingZ:p(e)?{value:e,elevationInfo:this.elevationInfo}:null})}};function ei(t,e,i){const o=t.x-e.x,r=t.y-e.y;return o*o+r*r<=i}a([l()],f.prototype,"_snappingEnabled",null),a([l()],f.prototype,"defaultZ",void 0),a([l()],f.prototype,"isDraped",void 0),a([l({value:Qe})],f.prototype,"drawingMode",null),a([l({constructOnly:!0})],f.prototype,"elevationDrawSurface",void 0),a([l({constructOnly:!0})],f.prototype,"elevationInfo",void 0),a([l({constructOnly:!0,type:ne})],f.prototype,"labelOptions",void 0),a([l({constructOnly:!0,type:re})],f.prototype,"tooltipOptions",void 0),a([l({constructOnly:!0})],f.prototype,"geometryType",void 0),a([l({constructOnly:!0})],f.prototype,"hasM",void 0),a([l({constructOnly:!0})],f.prototype,"hasZ",void 0),a([l({constructOnly:!0})],f.prototype,"manipulators",void 0),a([l({constructOnly:!0})],f.prototype,"drawSurface",void 0),a([l({constructOnly:!0})],f.prototype,"segmentLabels",void 0),a([l({constructOnly:!0})],f.prototype,"snappingManager",void 0),a([l({constructOnly:!0})],f.prototype,"snappingVisualizer",void 0),a([l()],f.prototype,"snapToSceneEnabled",void 0),a([l()],f.prototype,"_snappingOperation",void 0),a([l()],f.prototype,"stagedVertex",null),a([l()],f.prototype,"lastVertex",void 0),a([l()],f.prototype,"updating",null),a([l({constructOnly:!0})],f.prototype,"view",void 0),f=a([H("esri.views.draw.DrawOperation")],f);class bi{constructor(e,i,o,r=null){this._elevationInfo=e,this.defaultZ=i,this._view=o,this._excludeGraphics=r}screenToMap(e){if(p(this.defaultZ))return this._view.sceneIntersectionHelper.intersectElevationFromScreen(Oe(e.x,e.y),this._elevationInfo,this.defaultZ,this._excludeGraphics);const i=this._view.sceneIntersectionHelper.intersectElevationFromScreen(Oe(e.x,e.y),this._elevationInfo,0,this._excludeGraphics);return p(i)&&(i.z=void 0),i}mapToScreen(e){const i=Ye(e.x,e.y,me(this._view,e,this._elevationInfo),e.spatialReference);return this._view.toScreen(i)}constrainZ(e){const{defaultZ:i}=this;return p(i)&&e.z!==i&&((e=Be(e)).z=i),e}}class Oi{constructor(e,i,o=[]){this.view=e,this.elevationInfo=i,this.exclude=o}screenToMap(e){const i=this.view.toMap(e,{exclude:this.exclude});return p(i)&&(i.z=$t(i,this.view,this.elevationInfo)),i}mapToScreen(e){let i=e;return p(this.elevationInfo)&&(i=Ye(e.x,e.y,me(this.view,e,this.elevationInfo),e.spatialReference)),this.view.toScreen(i)}constrainZ(e){return e}}class Mi{constructor(e,i=!1,o=0){this.view=e,this.hasZ=i,this.defaultZ=o,this.mapToScreen=r=>e.toScreen(r),this.screenToMap=i?r=>{const s=e.toMap(r);return s.z=o,s}:r=>e.toMap(r)}constrainZ(e){const{defaultZ:i}=this;return this.hasZ&&e.z!==i&&((e=Be(e)).z=i),e}}function Si(t,e){return et(t,e,!1)}function Vi(t,e){return et(t,e,!0)}function et(t,e,i){if(t instanceof Wt){if(t.operation instanceof Lt)return ti(t.operation,e,i),!0;if(t.operation instanceof Ut)return ii(t.operation,e,i),!0;if(t.operation instanceof At)return oi(t.operation,e,i),!0}return!1}function ti(t,e,i=!1){const o=i?-1:1,r=Tt(o*t.dx,o*t.dy,o*t.dz);B(e.origin,e.origin,r)}function ii(t,e,i=!1){const o=i?-t.angle:t.angle;Me(e.basis1,e.basis1,Se,o),Me(e.basis2,e.basis2,Se,o)}function oi(t,e,i=!1){const o=i?1/t.factor1:t.factor1,r=i?1/t.factor2:t.factor2;N(e.basis1,e.basis1,o),N(e.basis2,e.basis2,r),Ve(e.origin,e.origin,t.origin,t.axis1,o),Ve(e.origin,e.origin,t.origin,t.axis2,r)}function Ii(t,e,i,o){o||(o=Je());const r=L(Y.get(),t[1],-t[0]),s=L(Y.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),n=L(Y.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),h=Y.get();e.components.forEach(d=>d.vertices.forEach(m=>{const _=m.pos;L(h,Ie(t,_),Ie(r,_)),bt(s,s,h),Ot(n,n,h)}));const c=1e-6,g=L(Y.get(),n[0]-s[0]<c?i/2:0,n[1]-s[1]<c?i/2:0);return Mt(s,s,g),ae(n,n,g),$e(o.basis1,t,(n[0]-s[0])/2),$e(o.basis2,r,(n[1]-s[1])/2),L(o.origin,s[0]*t[0]+s[1]*r[0],s[0]*t[1]+s[1]*r[1]),ae(o.origin,o.origin,o.basis1),ae(o.origin,o.origin,o.basis2),o}function $i(t,e,i,o=0,r){r||(r=Je()),e.toRenderCoords(t.origin,i,r.origin);const s=w.get();B(s,t.origin,t.basis1),B(s,s,t.basis2),e.toRenderCoords(s,i,s);const n=w.get();B(n,t.origin,t.basis1),O(n,n,t.basis2),e.toRenderCoords(n,i,n);const h=w.get();O(h,t.origin,t.basis1),O(h,h,t.basis2),e.toRenderCoords(h,i,h);const c=w.get();O(c,t.origin,t.basis1),B(c,c,t.basis2),e.toRenderCoords(c,i,c);const g=E(w.get(),s,n,.5);O(g,g,r.origin);const d=E(w.get(),h,c,.5);O(d,r.origin,d),E(r.basis1,g,d,.5);const m=E(w.get(),c,s,.5);O(m,m,r.origin);const _=E(w.get(),n,h,.5);O(_,r.origin,_),E(r.basis2,m,_,.5);const z=ue(w.get(),r.basis1,r.basis2),x=ue(z,z,r.basis1);return Le(x,x),N(r.basis2,x,We(r.basis2,x)),N(r.basis1,r.basis1,1+o/Ce(r.basis1)),N(r.basis2,r.basis2,1+o/Ce(r.basis2)),St(r),r}function Ci(t,e,i,o){const r=w.get();O(r,O(r,t.origin,t.basis1),t.basis2);const s=w.get();le(s,r,t.basis1,2);const n=w.get();le(n,s,t.basis2,2);const h=w.get();le(h,r,t.basis2,2),r[2]=s[2]=n[2]=h[2]=e;const c=o?"on-the-ground":"absolute-height",g=Pe(X(r,s,i,c),X(h,n,i,c)),d=Pe(X(s,n,i,c),X(r,h,i,c));return y(d)||y(g)?null:[g,d]}export{Ii as A,Ti as B,$i as G,u as H,Ci as M,Si as S,Vi as Y,Mi as a,Oi as c,f as k,bi as o};
