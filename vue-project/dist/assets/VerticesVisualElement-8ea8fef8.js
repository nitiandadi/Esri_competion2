import{b3 as a,ib as b,hC as c,rD as R,qy as $,qT as v,iL as x,rE as E,hE as M,hF as y,t as F,j6 as T,dy as B,jJ as S,cq as q,k3 as I}from"./mapviewstore-8a6f290e.js";import{W as A}from"./SnappingVisualizer3D-65e3df3f.js";import{n as D}from"./LineVisualElement-edc641a4.js";import{v as P}from"./manipulatorUtils-6039567a.js";const t={main:new a([255,127,0]),selected:new a([255,255,255]),staged:new a([12,207,255]),outline:new a([0,0,0,.5]),selectedOutline:new a([255,255,255])},g=.3;function w(i,e){const r=i.clone();return r.a*=e,r}function V(i,e){const r=i.clone(),s=R(r);s.s*=e;const n=$(s);return r.r=n.r,r.g=n.g,r.b=n.b,r}function l(i,e){if(e)for(const r in e)i[r]=e[r]}class U{constructor(e){this.color=t.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=c.Opaque,l(this,e)}}let C=class{constructor(e){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=t.main,this.outlineColor=t.outline,this.renderOccluded=c.Opaque,this.hoverOutlineColor=t.selectedOutline,l(this,e)}apply(e,r){const s=this[e];r.setParameters({color:h(s),transparent:e!=="color"||s.a<1,renderOccluded:this.renderOccluded})}};class L{constructor(e){this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.color=w(t.main,.5),this.hoverColor=t.main,this.renderOccluded=c.Transparent,this.minSquaredEdgeLength=900,l(this,e)}apply(e,r){const s=this[e];r.setParameters({color:h(s),transparent:s.a<1,renderOccluded:this.renderOccluded})}}class j{constructor(e){this.vertex=new C({color:t.main,outlineColor:t.outline}),this.edge=new C({color:V(w(t.main,2/3),.5),outlineColor:w(t.outline,.5),size:8,collisionPadding:8}),this.selected=new C({color:t.selected,outlineColor:t.outline}),this.edgeOffset=new L,l(this,e)}}class z{constructor(e){this.color=t.selected,this.width=1.5,this.stipplePattern=v(5),this.stippleOffColor=t.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=t.selected,this.renderOccluded=c.OccludeAndTransparent,l(this,e)}apply(e){e.color=h(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=h(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=h(this.innerColor),e.renderOccluded=this.renderOccluded}}class k{constructor(e){this.color=t.selected,this.size=4,this.outlineSize=1,this.outlineColor=t.outline,this.shape="square",l(this,e)}apply(e){e.color=h(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=h(this.outlineColor),e.primitive=this.shape}}let O=class{constructor(e){this.innerColor=t.selected,this.innerWidth=1,this.glowColor=t.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=g,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=t.main,l(this,e)}apply(e,r=1){const s={glowColor:a.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:a.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*r,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=s:e.laserlineStyle=s}};class H{constructor(e){this.outline=new z({color:t.outline,renderOccluded:c.OccludeAndTransparentStencil,stippleOffColor:t.selected,stipplePattern:v(5),width:1.5,innerWidth:0}),this.staged=new z({color:t.selected,renderOccluded:c.OccludeAndTransparentStencil,innerColor:t.staged,stippleOffColor:t.outline,stipplePattern:v(5),width:1.5}),this.shadowStyle=new O({globalAlpha:g,glowColor:t.main,glowFalloff:8,glowWidth:8,innerColor:t.selected,innerWidth:1}),l(this,e)}}class N{constructor(e){this.outline=new k({color:t.selected,outlineColor:t.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new O({globalAlpha:g,glowColor:t.main,glowFalloff:1.5,glowWidth:6,innerColor:t.selected,innerWidth:1,radius:2}),l(this,e)}}class Y extends z{constructor(e){super(),this.extensionType=A.GROUND_RAY,l(this,e)}}class J{constructor(e){this.lineGraphics=new H,this.pointGraphics=new N,this.heightPlane=new O({globalAlpha:g,glowColor:t.main,glowFalloff:8,glowWidth:8,innerColor:t.selected,innerWidth:1}),this.heightBox=new O({globalAlpha:g,glowColor:t.main,glowFalloff:8,glowWidth:8,innerColor:t.selected,innerWidth:0,heightFillColor:t.main}),this.zVerticalLine=new Y({color:w(t.main,5*g/3),falloff:2,innerColor:w(t.selected,0),renderOccluded:c.OccludeAndTransparent,stipplePattern:null,width:5,extensionType:A.GROUND_RAY}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,l(this,e)}}class K{constructor(e){this.visualElements=new J,this.reshapeManipulators=new j,this.zManipulator=new U,l(this,e)}colorToVec4(e){return h(e)}}function h(i){return b(a.toUnitRGBA(i))}const f=new K;function Q(i,e,r,s,n){const o=x(3*i.length),m=x(o.length);i.forEach((u,_)=>{o[3*_+0]=u[0],o[3*_+1]=u[1],o[3*_+2]=u.length>2?u[2]:0});const p=E(o,e,0,m,0,o,0,o.length/3,r,s,n),d=p!=null;return{numVertices:i.length,position:o,mapPositions:m,projectionSuccess:d,sampledElevation:p}}class le extends D{constructor(e){super(e),this.view=null,this._renderOccluded=c.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=f.colorToVec4(f.reshapeManipulators.vertex.color),this._size=f.reshapeManipulators.vertex.size,this._outlineColor=f.colorToVec4(f.reshapeManipulators.vertex.outlineColor),this._outlineSize=f.reshapeManipulators.vertex.outlineSize,this._elevationInfo=null,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){M(e,this._color)||(y(this._color,e),this._updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){M(e,this._outlineColor)||(y(this._outlineColor,e),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,transparent:this._color[3]<1,screenSizeScale:this.size,renderOccluded:this._renderOccluded}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){const e=this.vertices;if(F(e)||e.length===0)return[];const r=.5,s=.5,n=Q(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,T.fromElevationInfo(this.elevationInfo)),o=[],m=n.numVertices,p=n.position;for(let d=0;d<m;++d){const u=B(X,p[3*d+0],p[3*d+1],p[3*d+2]),_=W(this._vertexMaterial,r,u),G=W(this._vertexOutlineMaterial,s,u);o.push({vertexGeometry:_,vertexOutlineGeometry:G})}return o}createGeometries(e){const r=this._createRenderGeometries();for(const{vertexGeometry:s,vertexOutlineGeometry:n}of r)e.addGeometry(s),e.addGeometry(n)}createExternalResources(){this._vertexMaterial=new P({...this._vertexMaterialParameters,writeDepth:!0,cullFace:S.Back,screenSizeEnabled:!0}),this._vertexOutlineMaterial=new P({...this._vertexOutlineMaterialParameters,transparent:!0,writeDepth:!0,cullFace:S.Front,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachExternalMaterial(e){e(this._vertexMaterial),e(this._vertexOutlineMaterial)}}const X=q();function W(i,e,r){return I(i,e,16,16,{offset:r})}export{le as _,t as r,f as y};
