import{hp as Qt,rG as ts,e as V,y as H,d as It,aD as ss,rq as At,rz as Ct,b as is,bP as es,bJ as rs,ib as Y,ff as I,i9 as k,im as nt,iB as ns,jE as os,ho as Rt,iA as vt,iR as Nt,iw as as,iE as ds,iF as cs,iG as ls,iU as us,iH as gs,qS as hs,ds as tt,d2 as ps,iJ as fs,iV as bs,kf as $s,iP as _s,kh as ms,ki as Os,c_ as Ts,c$ as Es,jT as ws,q as Is,hC as _,hF as Pt,r as z,nO as As,jj as ut,hA as Cs,j7 as d,fE as N,i0 as Gt,hZ as P,dy as ot,fF as f,g$ as h,rX as Ot,k0 as Z,jf as Dt,jw as X,rY as qt,fs as O,j$ as zt,hJ as B,jt as C,cq as at,hx as S,rZ as Rs,jc as st,jJ as it,hH as vs,jz as St,iD as Lt,gI as pt,o4 as yt,r_ as Mt,r$ as Vt,s0 as Ut,s1 as Ns,s2 as Bt,fo as F,ft as R,rV as Ps,s3 as Ss,s4 as bt,s5 as Ls,s6 as ys,fh as Ms,oM as Vs,t as U,qR as Us,d7 as Xt,k5 as ks,rS as Yt,s7 as $t,qJ as kt,rU as xs,s8 as Ws,s as js}from"./mapviewstore-8a6f290e.js";import{g as q}from"./persistable-583a46db.js";import{n as Hs,g as Fs,b as Gs}from"./LineVisualElement-edc641a4.js";import{V as Ds,i as Zt,e as w,x as qs,U as zs}from"./manipulatorUtils-6039567a.js";import{l as Bs}from"./index-93a23f67.js";let T=class extends Qt(es){constructor(s){super(s),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(s){return this.heading===s.heading&&this.tilt===s.tilt&&ts(this.position,s.position)&&this.width===s.width&&this.height===s.height}};V([H({readOnly:!0,json:{read:!1,write:!0}})],T.prototype,"type",void 0),V([H({type:ss}),q()],T.prototype,"position",void 0),V([H({type:Number,nonNullable:!0,range:{min:0,max:360}}),q(),It(t=>At.normalize(Ct(t),0,!0))],T.prototype,"heading",void 0),V([H({type:Number,nonNullable:!0,range:{min:0,max:360}}),q(),It(t=>At.normalize(Ct(t),0,!0))],T.prototype,"tilt",void 0),V([H({type:Number,nonNullable:!0}),q()],T.prototype,"width",void 0),V([H({type:Number,nonNullable:!0}),q()],T.prototype,"height",void 0),T=V([is("esri.analysis.SlicePlane")],T);const Xs=T,xi=rs("mac")?"Meta":"Control",Wi="Shift",Ys=2,Zs=1.15,Js=1.15,ji=2500,Hi=.02,Ks=Math.cos(nt(45)),xt=Math.cos(nt(5)),Fi=.95,Gi=.3,Qs=.7,J=I(1,.5,0),Di=2,ti=1,si=Y([...J,Qs]),ii=[0,0,0,.04],ei=Y([...J,.5]),ri=k(1,1,1,1),ni=k(1,.8,.6,1),oi=k(1,.93,.86,1),ai=Y([...J,1]),di=Y([...J,1]),ci=3,Jt=11,_t=22.5,rt=40,Wt=48,li=2.25,ui=Y([...J,1]),gi=4,jt=1,hi=.3,pi=6,fi=4,Ht=1600,bi=.4;function $i(t){const s=new ns;s.extensions.add("GL_OES_standard_derivatives");const{vertex:i,fragment:r,attributes:n,varyings:o}=s;return os(i,t),n.add(Rt.POSITION,"vec3"),n.add(Rt.UV0,"vec2"),o.add("vUV","vec2"),i.code.add(vt`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),r.uniforms.add([new Nt("backgroundColor",e=>e.backgroundColor),new Nt("gridColor",e=>e.gridColor),new as("gridWidth",e=>e.gridWidth)]),r.code.add(vt`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
gl_FragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),s}const _i=Object.freeze(Object.defineProperty({__proto__:null,build:$i},Symbol.toStringTag,{value:"Module"}));let mi=class extends bs{constructor(){super(...arguments),this.backgroundColor=k(1,0,0,.5),this.gridColor=k(0,1,0,.5),this.gridWidth=4}};class gt extends cs{initializeProgram(s){return new ls(s.rctx,gt.shader.get().build(this.configuration),us)}initializePipeline(){return gs({blending:hs(tt.ONE,tt.ONE,tt.ONE_MINUS_SRC_ALPHA,tt.ONE_MINUS_SRC_ALPHA),depthTest:{func:ps.LESS},colorWrite:fs})}}gt.shader=new ds(_i,()=>Bs(()=>import("./SlicePlaneMaterial.glsl-1c554c34.js"),["assets/SlicePlaneMaterial.glsl-1c554c34.js","assets/mapviewstore-8a6f290e.js","assets/index-93a23f67.js","assets/index-2d69a2d2.css","assets/persistable-583a46db.js","assets/resourceExtension-dfbbe1e7.js","assets/LineVisualElement-edc641a4.js","assets/VisualElement-cf195c8c.js","assets/manipulatorUtils-6039567a.js","assets/ImageMaterial-86134e3a.js"]));class Oi extends $s{constructor(s){super(s,new Ei),this._configuration=new _s}createBufferWriter(){return new ms(Os)}requiresSlot(s,i){return i===Ts.Color&&s===Es.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL}createGLMaterial(s){return new Ti(s)}getConfiguration(){return this._configuration}}class Ti extends ws{constructor(s){super(s),this.ensureTechnique(gt,null)}beginSlot(){return Is(this.technique)}}class Ei extends mi{constructor(){super(...arguments),this.renderOccluded=_.Occlude}}class wi extends Hs{constructor(s){super(s),this._material=null,this._renderOccluded=_.OccludeAndTransparent,this._gridWidth=1,this._gridColor=k(1,0,0,1),this._backgroundColor=k(1,0,0,1),this.applyProps(s)}get renderOccluded(){return this._renderOccluded}set renderOccluded(s){s!==this._renderOccluded&&(this._renderOccluded=s,this._updateMaterial())}get gridWidth(){return this._gridWidth}set gridWidth(s){this._gridWidth!==s&&(this._gridWidth=s,this._updateMaterial())}get gridColor(){return this._gridColor}set gridColor(s){Pt(this._gridColor,s),this._updateMaterial()}get backgroundColor(){return this._backgroundColor}set backgroundColor(s){Pt(this._backgroundColor,s),this._updateMaterial()}createExternalResources(){this._material=new Oi(this._materialParameters)}destroyExternalResources(){this._material=null}forEachExternalMaterial(s){z(this._material)&&s(this._material)}createGeometries(s){if(z(this._material)){const i=As(this._material);s.addGeometry(i)}}get _materialParameters(){return{backgroundColor:this._backgroundColor,gridWidth:this._gridWidth,gridColor:this._gridColor,renderOccluded:this._renderOccluded}}_updateMaterial(){z(this._material)&&this._material.setParameters(this._materialParameters)}}function zi(t,s,i,r,n,o,e,a){return Ii(s,e.worldUpAtPosition(t,d.get()),n,o,a.basis1,a.basis2),h(a.basis1,a.basis1,i),h(a.basis2,a.basis2,r),N(a.origin,t),Bt(a.basis2,a.basis1,a.origin,a.plane),a}function Ii(t,s,i,r,n,o){const e=F(t,s),a=d.get(),c=d.get();switch(r===v.HORIZONTAL_OR_VERTICAL?Math.abs(e)>Ks?v.HORIZONTAL:v.VERTICAL:r){case v.VERTICAL:{const l=Math.abs(e)<=xt?t:i.viewUp;R(a,l,s),N(c,s);break}case v.HORIZONTAL:R(a,i.viewUp,s),R(c,s,a);break;case v.TILTED:{const l=Math.abs(e)<=xt?s:i.viewUp;R(a,l,t),R(c,t,a);break}}const g=R(d.get(),a,c);F(g,i.viewForward)>0&&h(c,c,-1),S(n,a),S(o,c)}function Ai(t,s,i){const r=s.worldUpAtPosition(t.origin,d.get()),n=t.basis1,o=wt(t,r),e=Math.round(o/G)*G;return $t(t,e-o,n,i)}function Bi(t,s,i,r,n,o){const e=N(d.get(),n.origin);f(e,e,h(d.get(),n.basis1,t.direction[0]<0?1:-1)),f(e,e,h(d.get(),n.basis2,t.direction[1]<0?1:-1));const a=P(n.basis1),c=P(n.basis2),g=O(d.get(),i,e),l=O(d.get(),s,e);let u=0,p=0;if(Et(t)){const K=mt(n),y=mt(o);u=a-.5*t.direction[0]*F(n.basis1,l)/a,p=c-.5*t.direction[1]*F(n.basis2,l)/c;const W=y/K;u*=W,p*=W}const m=u+.5*t.direction[0]*F(n.basis1,g)/a,$=p+.5*t.direction[1]*F(n.basis2,g)/c,x=h(d.get(),n.basis1,m/a),L=h(d.get(),n.basis2,$/c);(m<=0||Ft(o.origin,x,r)<=Ht)&&N(x,o.basis1),($<=0||Ft(o.origin,L,r)<=Ht)&&N(L,o.basis2);const b=N(d.get(),e);return f(b,b,h(d.get(),x,t.direction[0]<0?-1:1)),f(b,b,h(d.get(),L,t.direction[1]<0?-1:1)),Ps(b,x,L,o)}function Xi(t,s){return bi*Math.min(s.width,s.height)*s.computeRenderPixelSizeAt(t)}function Yi(t,s,i,r){const n=R(d.get(),s,i);return R(n,n,s),Gt(t,n,r)}function Zi(t,s){return Ds(t.basis1,t.basis2,t.origin,s)}function Ji(t,s,i,r){const n=s.worldUpAtPosition(t.origin,d.get()),o=d.get();switch(i){case dt.HEADING:N(o,n);break;case dt.TILT:N(o,t.basis1)}return Gt(t.origin,o,r)}function Ki(t,s,i,r){const n=Tt(i,A.NEGATIVE_X),o=Z.get();Ss(o,s,n.edge*Math.PI/2);const e=S(d.get(),n.basis);let a=h(d.get(),e,n.direction*r.computeScreenPixelSizeAt(n.position)*rt);f(a,a,n.position);const c=r.projectToRenderScreen(a,bt(d.get())),g=Ci(r,c);Ls(r,c,et),S(et.direction,et.direction);const l=d.get();!g&&ys(i,et,l)&&(a=l),o[12]=0,o[13]=0,o[14]=0,t.modelTransform=o,t.renderLocation=Ms(a),g?t.state|=ct:t.state&=~ct}function Ci(t,s){const[i,r,n,o]=t.viewport,e=Math.min(n,o)/16;let a=!0;return s[0]<i+e?(s[0]=i+e,a=!1):s[0]>i+n-e&&(s[0]=i+n-e,a=!1),s[1]<r+e?(s[1]=r+e,a=!1):s[1]>r+o-e&&(s[1]=r+o-e,a=!1),a}function Qi(t,s,i,r){const n=P(r.basis1),o=P(r.basis2),e=Kt(r),a=mt(r),c=ot(d.get(),0,0,0);f(c,h(d.get(),r.basis1,s.direction[0]),h(d.get(),r.basis2,s.direction[1])),f(c,r.origin,c);let g=0,l=1;if(Et(s))s.direction[0]===1&&s.direction[1]===-1?g=G:s.direction[0]===1&&s.direction[1]===1?g=Math.PI:s.direction[0]===-1&&s.direction[1]===1&&(g=3*Math.PI/2),l=a;else{const p=s.direction[0]!==0?1:2;g=p===1?G:0,l=(p===1?o:n)-e}const u=Ot(Z.get(),g);Dt(u,u,ot(d.get(),l,l,l)),X(u,i,u),u[12]=0,u[13]=0,u[14]=0,t.modelTransform=u,t.renderLocation=c}function te(t,s,i,r){const n=r.worldUpAtPosition(i.origin,d.get()),o=Tt(i,A.POSITIVE_X),e=Ot(Z.get(),o.edge*Math.PI/2);qt(e,e,-wt(i,n)),X(e,s,e),e[12]=0,e[13]=0,e[14]=0,t.modelTransform=e,t.renderLocation=o.position}function se(t,s,i){const r=Tt(i,A.POSITIVE_Y),n=Ot(Z.get(),r.edge*Math.PI/2);qt(n,n,G),X(n,s,n),n[12]=0,n[13]=0,n[14]=0,t.modelTransform=n,t.renderLocation=r.position}var A;function Tt(t,s){switch(s){case A.POSITIVE_X:return{basis:t.basis1,direction:1,position:f(d.get(),t.origin,t.basis1),edge:s};case A.POSITIVE_Y:return{basis:t.basis2,direction:1,position:f(d.get(),t.origin,t.basis2),edge:s};case A.NEGATIVE_X:return{basis:t.basis1,direction:-1,position:O(d.get(),t.origin,t.basis1),edge:s};case A.NEGATIVE_Y:return{basis:t.basis2,direction:-1,position:O(d.get(),t.origin,t.basis2),edge:s}}}function Ft(t,s,i){const r=i.projectToRenderScreen(f(d.get(),t,s),bt(d.get())),n=i.projectToRenderScreen(O(d.get(),t,s),bt(d.get()));return Vs(O(r,r,n))}function Kt(t){const s=P(t.basis1),i=P(t.basis2);return hi*Math.min(s,i)}function mt(t){return Kt(t)}function Et(t){return t.direction[0]!==0&&t.direction[1]!==0}function ie(t,s=lt.CENTER_ON_ARROW){const i=s===lt.CENTER_ON_CALLOUT?rt:0,r=[I(i,0,-Wt/2),I(i,0,Wt/2)],n=Ni(r,!0),o=(u,p)=>Ri(r,u,p),e=o(0,!1),a=o(li,!0),c=new zt({color:ai,renderOccluded:_.OccludeAndTransparent}),g=B(c,[[i,0,0],[i-rt,0,0]]),l=B(c,[[i,0,0],[i-rt,0,0]]);return new Zt({view:t,renderObjects:[...e.normal.map(u=>new w(u,C.Unfocused|E)),...a.normal.map(u=>new w(u,C.Unfocused|E)),new w(g,C.Unfocused|E|ct),...e.focused.map(u=>new w(u,C.Focused|E)),...a.focused.map(u=>new w(u,C.Focused|E)),new w(l,C.Focused|E|ct)],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[n]},collisionPriority:1,radius:Jt,state:E})}function ee(t,s){const i=zs(t,{customStateMask:E,texture:s});return i.state=E,i}function re(t){const s=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0],[-1,-1,0]];return new Fs({view:t,attached:!1,color:si,width:ti,writeDepthEnabled:!1,renderOccluded:_.OccludeAndTransparent,geometry:[s]})}function ne(t){return new wi({view:t,attached:!1,backgroundColor:[...ii],gridColor:ei,gridWidth:4,renderOccluded:_.OccludeAndTransparent})}function oe(t,s){const i=Et(s),r=i?[I(1,0,0),I(0,0,0),I(0,1,0)]:[I(1,0,0),I(-1,0,0)],n=ui,o=m=>new vs({color:n,width:m,renderOccluded:_.OccludeAndTransparent}),e=()=>new zt({color:n,renderOccluded:_.OccludeAndTransparent}),a=i?gi:jt,c=a*Ys,g=jt,l=m=>m>1?o(m):e(),u=[new w(B(l(a),r),C.Unfocused|ft),new w(B(l(c),r),C.Focused|ft),new w(B(l(g),r),Si)],p=new Zt({view:t,renderObjects:u,collisionType:{type:"line",paths:[r]},radius:i?pi:fi,...qs});return p.state=ft,p}function Ri(t,s,i){const r=new st({color:ri,cullFace:it.Back,renderOccluded:_.Opaque}),n=new st({color:ni,cullFace:it.Back,renderOccluded:_.Opaque}),o=new st({color:oi,cullFace:it.Back,renderOccluded:_.Opaque}),e=new st({color:di,transparent:!0,writeDepth:!1,cullFace:it.Front,renderOccluded:_.Transparent}),a=c=>{t=t.slice(0);const g=O(d.get(),t[0],t[1]);S(g,g);const l=O(d.get(),t[t.length-1],t[t.length-2]);if(S(l,l),s>0){const D=h(at(),l,-s);t[t.length-1]=f(D,D,t[t.length-1]);const j=h(at(),g,-s);t[0]=f(j,j,t[0])}const u=c?Js:1,p=_t*u,m=Jt*u,$=St(Z.get());if(s>0){const D=p/4,j=ot(d.get(),0,D,0),Q=1+s/D;Lt($,$,j),Dt($,$,ot(d.get(),Q,Q,Q)),Lt($,$,h(j,j,-1/Q))}const x=St(pt()),L=I(0,1,0),b=yt(pt(),Mt(Vt.get(),L,l));b[12]=t[t.length-1][0],b[13]=t[t.length-1][1],b[14]=t[t.length-1][2],X(b,b,$);const K=vi(ci*(c?Zs:1)+s,t,i?e:o);K.transformation=x;const y=[K],W=Ut(i?e:r,p,m,24,!1,!1,!0);W.transformation=b,y.push(W);const ht=Ut(i?e:n,p,m,24,!1,!0,!1);ht.transformation=b,y.push(ht);const M=yt(pt(),Mt(Vt.get(),L,g));return M[12]=t[0][0],M[13]=t[0][1],M[14]=t[0][2],X(M,M,$),y.push(W.instantiate({transformation:M})),y.push(ht.instantiate({transformation:M})),y};return{normal:a(!1),focused:a(!0)}}function vi(t,s,i){const r=[];for(let o=0;o<12;o++){const e=o/12*2*Math.PI;r.push([Math.cos(e)*t,Math.sin(e)*t])}return Ns(i,r,s,[],[],!1)}function Ni(t,s){const i=O(at(),t[t.length-1],t[t.length-2]);if(S(i,i),h(i,i,_t),f(i,i,t[t.length-1]),s){const r=O(at(),t[0],t[1]);return S(r,r),h(r,r,_t),f(r,r,t[0]),[r,...t,i]}return[...t,i]}function ae(t,s,i,r=new Xs){if(U(t))return null;const{renderCoordsHelper:n}=s,o=n.fromRenderCoords(t.origin,s.spatialReference);if(U(o))return null;const e=Us(o,i);if(U(e))return null;r.position=e;const a=2*P(t.basis1),c=2*P(t.basis2),g=Xt.renderUnitScaleFactor(s.spatialReference,i);r.width=a*g,r.height=c*g;const l=n.worldUpAtPosition(t.origin,d.get());return r.tilt=ks(wt(t,l)),r.heading=n.headingAtPosition(t.origin,t.basis1)-90,r}function wt(t,s){return Rs(s,t.basis2,t.basis1)+G}function Pi(t,s,i,r,n,o,e=Yt()){return o.toRenderCoords(t,e.origin)?(o.worldBasisAtPosition(e.origin,kt.X,e.basis1),o.worldBasisAtPosition(e.origin,kt.Y,e.basis2),Bt(e.basis2,e.basis1,e.origin,e.plane),$t(e,-nt(s),xs(e),e),$t(e,nt(i),e.basis1,e),h(e.basis1,e.basis1,r/2),h(e.basis2,e.basis2,n/2),Ws(e),e):(js.getLogger("esri.views.3d.analysis.Slice.sliceToolUtils").error(`Failed to project slice plane position, projection from ${t.spatialReference.wkid} is not supported`),null)}function de(t,s){if(U(t)||U(t.position))return null;const i=Gs(t.position,s.spatialReference,s.elevationProvider);if(U(i))return null;const r=Xt.renderUnitScaleFactor(t.position.spatialReference,s.spatialReference),n=t.width*r,o=t.height*r;return{position:i,heading:t.heading,tilt:t.tilt,renderWidth:n,renderHeight:o}}function ce(t,s,i,r=Yt()){if(U(t))return null;const n=Pi(t.position,t.heading,t.tilt,t.renderWidth,t.renderHeight,s.renderCoordsHelper,r);return!i.tiltEnabled&&z(n)&&Ai(n,s.renderCoordsHelper,n),n}(function(t){t[t.POSITIVE_X=0]="POSITIVE_X",t[t.POSITIVE_Y=1]="POSITIVE_Y",t[t.NEGATIVE_X=2]="NEGATIVE_X",t[t.NEGATIVE_Y=3]="NEGATIVE_Y"})(A||(A={}));const E=ut.Custom1;var dt,v;(function(t){t[t.HEADING=1]="HEADING",t[t.TILT=2]="TILT"})(dt||(dt={})),function(t){t[t.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",t[t.HORIZONTAL=1]="HORIZONTAL",t[t.VERTICAL=2]="VERTICAL",t[t.TILTED=3]="TILTED"}(v||(v={}));const ct=ut.Custom2,et=Cs(),G=Math.PI/2,ft=ut.Custom1,Si=ut.Custom2;var lt;function le(t){const s=t.type==="building-scene-3d"?t:null;return z(s)}(function(t){t[t.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",t[t.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"})(lt||(lt={}));export{Zi as B,ei as C,E,zi as G,dt as I,Qi as J,te as K,Gi as M,lt as N,ce as O,le as P,se as Q,v as R,de as T,Yi as W,Bi as Y,Xi as Z,ft as _,ee as a,Di as b,re as c,xi as d,ji as e,si as f,ae as g,Xs as h,Hi as i,ct as j,Si as k,ne as l,Wi as m,Fi as n,mt as o,Ji as q,Et as r,ie as s,$i as t,oe as u,ti as v,ii as x,Ki as z};
