import{s as F,b8 as z,e as v,bQ as I,y as g,b as B,bP as N}from"./mapviewstore-8a6f290e.js";const $=F.getLogger("esri.rest.support.generateRendererUtils");function M(t,i){return Number(t.toFixed(i))}function Q(t){const i=C(t),n=[],s=i.uniqueValues.length;for(let f=0;f<s;f++){const c=i.uniqueValues[f],u=i.valueFrequency[f],l=c.toString();n.push({value:c,count:u,label:l})}return{uniqueValues:n}}function U(t){const{normalizationTotal:i}=t;return{classBreaks:j(t),normalizationTotal:i}}function j(t){const i=t.definition,{classificationMethod:n,normalizationType:s,definedInterval:f}=i,c=i.breakCount??1,u=[];let l=t.values;if(l.length===0)return[];l=l.sort((o,h)=>o-h);const d=l[0],p=l[l.length-1];if(n==="equal-interval")if(l.length>=c){const o=(p-d)/c;let h=d;for(let a=1;a<c;a++){const e=M(d+a*o,6);u.push({minValue:h,maxValue:e,label:b(h,e,s)}),h=e}u.push({minValue:h,maxValue:p,label:b(h,p,s)})}else l.forEach(o=>{u.push({minValue:o,maxValue:o,label:b(o,o,s)})});else if(n==="natural-breaks"){const o=C(l),h=t.valueFrequency||o.valueFrequency,a=D(o.uniqueValues,h,c);let e=d;for(let r=1;r<c;r++)if(o.uniqueValues.length>r){const m=M(o.uniqueValues[a[r]],6);u.push({minValue:e,maxValue:m,label:b(e,m,s)}),e=m}u.push({minValue:e,maxValue:p,label:b(e,p,s)})}else if(n==="quantile")if(l.length>=c&&d!==p){let o=d,h=Math.ceil(l.length/c),a=0;for(let e=1;e<c;e++){let r=h+a-1;r>l.length&&(r=l.length-1),r<0&&(r=0),u.push({minValue:o,maxValue:l[r],label:b(o,l[r],s)}),o=l[r],a+=h,h=Math.ceil((l.length-a)/(c-e))}u.push({minValue:o,maxValue:p,label:b(o,p,s)})}else{let o=-1;for(let h=0;h<l.length;h++){const a=l[h];a!==o&&(o=a,u.push({minValue:o,maxValue:a,label:b(o,a,s)}),o=a)}}else if(n==="standard-deviation"){const o=L(l),h=_(l,o);if(h===0)u.push({minValue:l[0],maxValue:l[0],label:b(l[0],l[0],s)});else{const a=E(d,p,c,o,h)*h;let e=0,r=d;for(let y=c;y>=1;y--){const q=M(o-(y-.5)*a,6);u.push({minValue:r,maxValue:q,label:b(r,q,s)}),r=q,e++}let m=M(o+.5*a,6);u.push({minValue:r,maxValue:m,label:b(r,m,s)}),r=m,e++;for(let y=1;y<=c;y++)m=e===2*c?p:M(o+(y+.5)*a,6),u.push({minValue:r,maxValue:m,label:b(r,m,s)}),r=m,e++}}else if(n==="defined-interval"){if(!f)return u;const o=l[0],h=l[l.length-1],a=Math.ceil((h-o)/f);let e=o;for(let r=1;r<a;r++){const m=M(o+r*f,6);u.push({minValue:e,maxValue:m,label:b(e,m,s)}),e=m}u.push({minValue:e,maxValue:h,label:b(e,h,s)})}return u}function b(t,i,n){let s=null;return s=t===i?n&&n==="percent-of-total"?t+"%":t.toString():n&&n==="percent-of-total"?t+"% - "+i+"%":t+" - "+i,s}function C(t){const i=[],n=[];let s=Number.MIN_VALUE,f=1,c=-1;for(let u=0;u<t.length;u++){const l=t[u];l===s?(f++,n[c]=f):l!==null&&(i.push(l),s=l,f=1,n.push(f),c++)}return{uniqueValues:i,valueFrequency:n}}function D(t,i,n){const s=t.length,f=[];n>s&&(n=s);for(let u=0;u<n;u++)f.push(Math.round(u*s/n-1));f.push(s-1);let c=k(f,t,i,n);return T(c.mean,c.sdcm,f,t,i,n)&&(c=k(f,t,i,n)),f}function k(t,i,n,s){let f=[],c=[],u=[],l=0;const d=[],p=[];for(let e=0;e<s;e++){const r=x(e,t,i,n);d.push(r.sbMean),p.push(r.sbSdcm),l+=p[e]}let o,h=l,a=!0;for(;a||l<h;){a=!1,f=[];for(let e=0;e<s;e++)f.push(t[e]);for(let e=0;e<s;e++)for(let r=t[e]+1;r<=t[e+1];r++)if(o=i[r],e>0&&r!==t[e+1]&&Math.abs(o-d[e])>Math.abs(o-d[e-1]))t[e]=r;else if(e<s-1&&t[e]!==r-1&&Math.abs(o-d[e])>Math.abs(o-d[e+1])){t[e+1]=r-1;break}h=l,l=0,c=[],u=[];for(let e=0;e<s;e++){c.push(d[e]),u.push(p[e]);const r=x(e,t,i,n);d[e]=r.sbMean,p[e]=r.sbSdcm,l+=p[e]}}if(l>h){for(let e=0;e<s;e++)t[e]=f[e],d[e]=c[e],p[e]=u[e];l=h}return{mean:d,sdcm:p}}function T(t,i,n,s,f,c){let u=0,l=0,d=0,p=0,o=!0;for(let h=0;h<2&&o;h++){h===0&&(o=!1);for(let a=0;a<c-1;a++)for(;n[a+1]+1!==n[a+2];){n[a+1]=n[a+1]+1;const e=x(a,n,s,f);d=e.sbMean,u=e.sbSdcm;const r=x(a+1,n,s,f);if(p=r.sbMean,l=r.sbSdcm,!(u+l<i[a]+i[a+1])){n[a+1]=n[a+1]-1;break}i[a]=u,i[a+1]=l,t[a]=d,t[a+1]=p,o=!0}for(let a=c-1;a>0;a--)for(;n[a]!==n[a-1]+1;){n[a]=n[a]-1;const e=x(a-1,n,s,f);d=e.sbMean,u=e.sbSdcm;const r=x(a,n,s,f);if(p=r.sbMean,l=r.sbSdcm,!(u+l<i[a-1]+i[a])){n[a]=n[a]+1;break}i[a-1]=u,i[a]=l,t[a-1]=d,t[a]=p,o=!0}}return o}function E(t,i,n,s,f){let c=Math.max(s-t,i-s)/f/n;return c=c>=1?1:c>=.5?.5:.25,c}function L(t){let i=0;for(let n=0;n<t.length;n++)i+=t[n];return i/=t.length,i}function _(t,i){let n=0;for(let s=0;s<t.length;s++){const f=t[s];n+=(f-i)*(f-i)}return n/=t.length,Math.sqrt(n)}function x(t,i,n,s){let f=0,c=0;for(let d=i[t]+1;d<=i[t+1];d++){const p=s[d];f+=n[d]*p,c+=p}c<=0&&$.warn("Exception in Natural Breaks calculation");const u=f/c;let l=0;for(let d=i[t]+1;d<=i[t+1];d++)l+=s[d]*(n[d]-u)**2;return{sbMean:u,sbSdcm:l}}const w=new z({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"}),S=new z({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});let V=class extends N{constructor(t){super(t),this.type="class-breaks-definition",this.breakCount=null,this.classificationField=null,this.classificationMethod=null,this.normalizationField=null,this.normalizationType=null}set standardDeviationInterval(t){this.classificationMethod==="standard-deviation"&&this._set("standardDeviationInterval",t)}set definedInterval(t){this.classificationMethod==="defined-interval"&&this._set("definedInterval",t)}};v([I({classBreaksDef:"class-breaks-definition"})],V.prototype,"type",void 0),v([g({json:{write:!0}})],V.prototype,"breakCount",void 0),v([g({json:{write:!0}})],V.prototype,"classificationField",void 0),v([g({type:String,json:{read:w.read,write:w.write}})],V.prototype,"classificationMethod",void 0),v([g({json:{write:!0}})],V.prototype,"normalizationField",void 0),v([g({json:{read:S.read,write:S.write}})],V.prototype,"normalizationType",void 0),v([g({value:null,json:{write:!0}})],V.prototype,"standardDeviationInterval",null),v([g({value:null,json:{write:!0}})],V.prototype,"definedInterval",null),V=v([B("esri.rest.support.ClassBreaksDefinition")],V);const A=V;export{U as a,A as d,Q as n};
