import{h9 as I,bd as S,bR as g,c as b,r as v,ha as f}from"./mapviewstore-8a6f290e.js";import{getSiblingOfSameTypeI as y}from"./resourceUtils-ae877d62.js";import"./index-93a23f67.js";async function F(r,s,o){if(!s||!s.resources)return;const t=s.portalItem===r.portalItem?new Set(r.paths):new Set;r.paths.length=0,r.portalItem=s.portalItem;const a=new Set(s.resources.toKeep.map(e=>e.resource.path)),n=new Set,c=[];a.forEach(e=>{t.delete(e),r.paths.push(e)});for(const e of s.resources.toUpdate)if(t.delete(e.resource.path),a.has(e.resource.path)||n.has(e.resource.path)){const{resource:p,content:l,finish:d,error:w}=e,u=y(p,I());r.paths.push(u.path),c.push(i({resource:u,content:l,compress:e.compress,finish:d,error:w},o))}else r.paths.push(e.resource.path),c.push(R(e,o)),n.add(e.resource.path);for(const e of s.resources.toAdd)c.push(i(e,o)),r.paths.push(e.resource.path);if(t.forEach(e=>{if(s.portalItem){const p=s.portalItem.resourceFromPath(e);c.push(p.portalItem.removeResource(p).catch(()=>{}))}}),c.length===0)return;const m=await S(c);g(o);const h=m.filter(e=>"error"in e).map(e=>e.error);if(h.length>0)throw new b("save:resources","Failed to save one or more resources",{errors:h})}async function i(r,s){var a,n;const o={...v(s)?s:{},compress:r.compress},t=await f(r.resource.portalItem.addResource(r.resource,r.content,o));if(t.ok!==!0)throw(a=r.error)==null||a.call(r,t.error),t.error;(n=r.finish)==null||n.call(r,r.resource)}async function R(r,s){var t,a;const o=await f(r.resource.update(r.content,s));if(o.ok!==!0)throw(t=r.error)==null||t.call(r,o.error),o.error;(a=r.finish)==null||a.call(r,r.resource)}export{F as saveResources};
