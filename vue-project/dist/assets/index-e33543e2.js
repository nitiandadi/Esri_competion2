import{k as Qe,l as ue,r as z,d as rt,t as un,o as lt,m as De,n as Wt,a as de,c as Be,f as N,F as Hi,i as dn,j as cn,_ as pn,q as Le,u as M,E as zi,s as je,g as U,w as B,v as Pt,x as Pe,y as mn,z as ht,A as hn,B as Je,C as fn,D as gn,G as vn,H as Qt,I as ti,J as yn,K as _n,L as bn,T as xn,M as En,N as ft,O as gt,P as vt,Q as yt,R as _t,p as bt}from"./index-93a23f67.js";import{P as wn,H as Kt,x as Fn,u as ve,j as qi,g as Jt,e as d,y as m,b as ee,v as pe,s as He,c as nt,d as In,f as qe,W as Yt,h as fe,n as x,t as T,r as f,i as Rt,k as Wi,l as Ye,m as ut,o as Qi,p as re,q as le,w as Tn,z as Vn,T as oe,A as Te,U as Cn,B as Ot,C as Ki,D as Nt,E as $n,F as ii,G as F,I as Ji,J as xt,L as Et,K as kn,M as Sn,N as An,O as Yi,S as ni,Q as wt,R as jt,V as si,X as Mn,Y as Ln,Z as Ut,_ as ai,$ as Dn,a0 as Ae,a1 as Ft,a2 as Pn,a3 as Rn,a4 as On,a5 as Nn,a6 as jn,a7 as Un,a8 as Gn,a9 as Bn,aa as Xe,ab as Hn,ac as zn,ad as qn,ae as Wn,af as Qn,ag as Kn,ah as It,ai as oi,aj as ri,ak as li,al as Jn,am as Yn,an as Xn,ao as Zn,ap as ui,aq as es,ar as Xi,as as Zi,at as ts,au as is,av as ns,aw as ss,ax as as,ay as en,az as di,aA as os,aB as rs,aC as Ze,a as ls}from"./mapviewstore-8a6f290e.js";import{u as Tt}from"./useEcharts-e87bb20d.js";import"./chartdata-dcab81db.js";import{A as et,c as us}from"./AQI-c8d7650b.js";import{a as Gt}from"./axios-760d4776.js";import{c as ci,u as ds,q as cs,a as ps}from"./onLayerstore-db26c7ed.js";import{u as Ke}from"./useTime-a8fa1ef7.js";import{w as tn}from"./Legend-df6b405d.js";import{h as ms}from"./GraphicsLayer-0c6904d3.js";import{u as hs}from"./mapViewstore-4da67348.js";import{c as pi}from"./Subtype-37ecaea9.js";import{c as Vt}from"./ArcadeDate-1f995969.js";import{t as fs}from"./ImmutableArray-ee1d0ce7.js";import"./EffectView-eb6dd52d.js";import"./ExportImageParameters-3ed81a65.js";import"./floorFilterUtils-080a7cd2.js";import"./sublayerUtils-694cd24b.js";import"./pixelRangeUtils-03719dd8.js";import"./rendererConversion-e2be3445.js";import"./executionError-fb3f283a.js";let mi;function gs(t,e,i){mi=new wn({field:e,colorStops:[{ratio:0,color:"rgba(0, 255, 0, 0)"},{ratio:.3,color:"rgba(0, 255, 0, 0.5)"},{ratio:.4,color:"rgba(255, 255, 0, 1)"},{ratio:.6,color:"rgba(255, 255, 0, 1)"},{ratio:.7,color:"rgba(255, 140, 0, 1)"}],radius:15,maxDensity:.319,minDensity:0});const n=new Kt({source:t.graphics,fields:[{name:"OBJECTID",alias:"ObjectID",type:"oid"},{name:"name",alias:"Name",type:"string"},{name:"city",alias:"City",type:"string"},{name:"aqi",alias:"AQI",type:"double"},{name:"date",alias:"Date",type:"date"}],objectIdField:"OBJECTID",geometryType:"point",renderer:mi,id:t.id,popupTemplate:{title:"{name}",content:"AQI: {aqi} mg/m³, 日期: {date}"},timeInfo:{startField:"date",fullTimeExtent:{start:i,end:i}}});return n.visible=!1,n}function vs(){const e=[{id:0},{id:1},{id:2},{id:3},{id:4}].map(n=>i(n));function i(n){const s="https://services7.arcgis.com/R5nxHh77a68zEsEp/arcgis/rest/services/%E5%9F%8E%E5%B8%82%E6%99%AF%E7%82%B9AQI%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97/FeatureServer/"+n.id;return new Kt({url:s,outFields:["*"],title:"AQI",id:"AQI"+n.id})}return e}async function Ct(t,e){const{where:i,attributeUpdates:n}=e,s=new Fn({where:i,outFields:["*"],returnGeometry:!0}),a=await t.queryFeatures(s);if(a.features.length===0)throw console.log(t.id+i),new Error("No features found for query");const o=[];a.features.forEach(r=>{const u=r.clone();for(const c in n)u.attributes[c]=n[c];o.push(u)});const l=await t.applyEdits({updateFeatures:o});if(!l.updateFeatureResults||l.updateFeatureResults.length===0)throw new Error("Update failed");return t}const ys=Qe("heatmap",()=>{let t=null,e=[],i=null;async function n(l,r,u,c){const p=ve().getView();i=l,e=vs();const h=Ke(),g=h.year,_=h.month,y=h.day,b=new Date(g.value,_.value-1,y.value);let E=new Date(b.getTime());const w=[];for(let V=-4;V<=0;V++)E=new Date(g.value,_.value-1,y.value+V),w.push(E);c.value&&await qi(()=>p.ready).then(async()=>{u.value=!0,r.value=0;let V=0;try{const v=[];for(const S of ci)for(const D of S.coordinates){const H={location:D};try{await Gt.post("http://47.108.76.144:9000/quality/airLast5d",H).then(async X=>{V++,r.value=Math.floor(V/(ci.length*3+et.length*5)*100),console.log(r.value),v.push({city:S.name,AQIs:X.data.aqi})})}catch(X){console.log(X)}}const O=[];for(let S=0;S<5;S++){const D=new ms({id:`AQI${S}`});O.push(D)}for(const S of et){const D=e[0].createQuery();D.where=`name='${S.name}'`;const H=await e[0].queryFeatures(D);if(H.features.length>0){const X=H.features[0].attributes.city,q=v.filter(K=>K.city===X).map(K=>K.AQIs),J=q[Math.floor(Math.random()*q.length)];console.log(X,J);for(let K=0;K<e.length;K++){const ye=new Jt({geometry:H.features[0].geometry,attributes:{name:H.features[0].attributes.name,city:H.features[0].attributes.city,aqi:J[K],date:w[K].getTime()}});O[K].add(ye),V++,r.value=Math.floor(V/(X.length*3+et.length*5)*100),V===X.length*3+et.length*5&&setTimeout(()=>{u.value=!1},600),console.log(r.value)}}}for(const[S,D]of O.entries()){const H=await gs(D,"AQI",w[S]);p.map.add(H)}c.value=!1}catch(v){console.error(v)}})}function s(){const l=ve().getView();t&&(t.visible=!1),l.ui.remove(t);for(let r=0;r<5;r++)l.map.findLayerById(`AQI${r}`).visible=!1;l.map.allLayers.getItemAt(1).visible=!0}function a(){const l=ve().getView();i?(t=new tn({container:i,view:l,layerInfos:[{layer:l.map.allLayers.find(r=>r.id==="AQI2"),title:"AQI热力图图例"}],style:"card"}),i=null):t&&(t.visible=!(t!=null&&t.visible)),l.goTo({center:[97,36],zoom:6});for(let r=0;r<5;r++)l.map.findLayerById(`AQI${r}`).visible=!l.map.findLayerById(`AQI${r}`).visible;l.map.allLayers.getItemAt(1).visible=!l.map.allLayers.getItemAt(1).visible}function o(){const l=ve().getView();for(let r=2;r<l.map.allLayers.length;r++)if(l.map.allLayers.getItemAt(r).loaded===!1)return!1;return!0}return{createTimeHeatmap:n,cancelTimeHeatmap:s,toggleHeatmap:a,isHeatmapLoaded:o}});let te=class extends pe{constructor(e){super(e),this.precision=4,this.thumbsConstrained=!0}set effectiveMax(e){this.setEffectiveMax(e)}set effectiveMin(e){this.setEffectiveMin(e)}set labelFormatFunction(e){this._set("labelFormatFunction",e)}set inputFormatFunction(e){this._set("inputFormatFunction",e)}set inputParseFunction(e){this._set("inputParseFunction",e)}get labels(){const{max:e,min:i,values:n}=this,s=n&&n.length?n.map((a,o)=>this.getLabelForValue(a,"value",o)):[];return{max:this.getLabelForValue(e,"max"),min:this.getLabelForValue(i,"min"),values:s}}set max(e){this.setMax(e)}set min(e){this.setMin(e)}get state(){const{max:e,min:i}=this;return e!=null&&i!=null&&e>i?"ready":"disabled"}set values(e){const{max:i,min:n}=this,s=this.values;s&&e&&s.length===e.length&&s.every((a,o)=>a===e[o])||(this._set("values",null),e&&e.length&&(n!=null&&e.some(a=>a<n)&&(this.min=Math.min(...e)),i!=null&&e.some(a=>a>i)&&(this.max=Math.max(...e))),this._set("values",e))}toPrecision(e){return parseFloat(e.toFixed(this.precision))}defaultLabelFormatFunction(e){const{max:i,min:n,precision:s}=this,a=i!=null&&n!=null&&i-n>10?2:s;return parseFloat(e.toFixed(a)).toString()}defaultInputFormatFunction(e){return e.toString()}defaultInputParseFunction(e){return parseFloat(e)}getBounds(){const{effectiveMax:e,effectiveMin:i,max:n,min:s}=this;return{min:i!=null&&s!=null?Math.max(s,i):s,max:e!=null&&n!=null?Math.min(n,e):n}}getBoundsForValueAtIndex(e){const{thumbsConstrained:i,values:n}=this,{min:s,max:a}=this.getBounds();if(i&&n){const o=e-1,l=e+1;return{min:n[o]!=null?n[o]:s,max:n[l]!=null?n[l]:a}}return{min:s,max:a}}getLabelForValue(e,i,n){return e==null?null:this.labelFormatFunction?this.labelFormatFunction(e,i,n):this.defaultLabelFormatFunction(e)}setMax(e){const{max:i,values:n}=this;if(e==null)return void this._set("max",null);if(isNaN(e))return void this._logError("slider:invalid-value","Supplied value for property 'max' is NaN.");const s=this.toPrecision(e);if(i!==s&&(this._set("max",s),n&&n.length))for(let a=0;a<n.length;a++)s<n[a]&&this.setValue(a,s)}setMin(e){const{min:i,values:n}=this;if(e==null)return void this._set("min",null);if(isNaN(e))return void this._logError("slider:invalid-value","Supplied value for property 'min' is NaN.");const s=this.toPrecision(e);if(i!==s&&(this._set("min",s),n&&n.length))for(let a=0;a<n.length;a++)s>n[a]&&this.setValue(a,s)}setEffectiveMax(e){if(e==null)return void this._set("effectiveMax",null);if(isNaN(e))return void this._logError("slider:invalid-value","Supplied value for property 'effectiveMax' is NaN.");const i=this.toPrecision(e);this.effectiveMax!==i&&this._set("effectiveMax",this._applyBoundsToValue(i))}setEffectiveMin(e){if(e==null)return void this._set("effectiveMin",null);if(isNaN(e))return void this._logError("slider:invalid-value","Supplied value for property 'effectiveMin' is NaN.");const i=this.toPrecision(e);this.effectiveMin!==i&&this._set("effectiveMin",this._applyBoundsToValue(i))}setValue(e,i){if(isNaN(i))return void this._logError("slider:invalid-value","Supplied value for member of property 'values' is NaN.");const{values:n}=this;if(n==null)return void this._logError("slider:invalid-value","Supplied value for member of property 'values' is null.");const s=n[e],a=this.toPrecision(i);if(s===a)return;const o=[...n];o[e]=a,this._set("values",o),this.notifyChange("labels")}_applyBoundsToValue(e){const{max:i,min:n}=this;return n!=null&&e<n?n:i!=null&&e>i?i:e}_logError(e,i,n){He.getLogger(this.declaredClass).error(new nt(e,i,n))}};d([m()],te.prototype,"effectiveMax",null),d([m()],te.prototype,"effectiveMin",null),d([m()],te.prototype,"labelFormatFunction",null),d([m()],te.prototype,"inputFormatFunction",null),d([m()],te.prototype,"inputParseFunction",null),d([m({readOnly:!0})],te.prototype,"labels",null),d([m()],te.prototype,"max",null),d([m()],te.prototype,"min",null),d([m()],te.prototype,"precision",void 0),d([m({readOnly:!0})],te.prototype,"state",null),d([m()],te.prototype,"thumbsConstrained",void 0),d([m()],te.prototype,"values",null),te=d([ee("esri.widgets.Slider.SliderViewModel")],te);const _s=te,L="esri-slider",C={base:L,reversed:`${L}--reversed`,horizontalLayout:`${L}--horizontal`,verticalLayout:`${L}--vertical`,contentElement:`${L}__content`,extraContentElement:`${L}__extra-content`,trackElement:`${L}__track`,ticksContainerElement:`${L}__ticks`,tickElement:`${L}__tick`,tickLabelElement:`${L}__tick-label`,maxElement:`${L}__max`,minElement:`${L}__min`,maxElementInteractive:`${L}__max--interactive`,minElementInteractive:`${L}__min--interactive`,rangeElementActive:`${L}__range--active`,rangeInput:`${L}__range-input`,anchorElement:`${L}__anchor`,movingAnchorElement:`${L}__anchor--moving`,lastMovedAnchorElement:`${L}__anchor--moved`,anchorElementActive:`${L}__anchor--active`,anchorElementIndexPrefix:`${L}__anchor-`,segmentElement:`${L}__segment`,segmentElementIndexPrefix:`${L}__segment-`,segmentElementInteractive:`${L}__segment--interactive`,segmentElementActive:`${L}__segment--active`,effectiveSegmentElement:`${L}__effective-segment`,effectiveMaxSegmentElement:`${L}__effective-max-segment`,effectiveMinSegmentElement:`${L}__effective-min-segment`,thumbElement:`${L}__thumb`,labelElement:`${L}__label`,labelElementInteractive:`${L}__label--interactive`,labelInput:`${L}__label-input`,esriWidget:"esri-widget",widgetIcon:"esri-icon-edit",disabled:"esri-disabled",hidden:"esri-hidden"},ne={showInput:"Enter",hideInput1:"Enter",hideInput2:"Escape",hideInput3:"Tab",moveAnchorUp:"ArrowUp",moveAnchorDown:"ArrowDown",moveAnchorLeft:"ArrowLeft",moveAnchorRight:"ArrowRight",moveAnchorToMax:"End",moveAnchorToMin:"Home"},bs="esri.widgets.Slider",hi={labels:!1,rangeLabels:!1};let k=class extends Yt{constructor(e,i){super(e,i),this._activeLabelInputIndex=null,this._anchorElements=[],this._dragged=!1,this._dragStartInfo=null,this._focusedAnchorIndex=null,this._isMinInputActive=!1,this._isMaxInputActive=!1,this._lastMovedHandleIndex=null,this._positionPrecision=5,this._segmentDragStartInfo=null,this._trackHeight=null,this._trackWidth=null,this._zIndices=null,this._zIndexOffset=3,this.disabled=!1,this.draggableSegmentsEnabled=!0,this.effectiveSegmentElements=new fe,this.extraNodes=[],this.inputCreatedFunction=null,this.labelElements=new fe,this.labelInputsEnabled=!1,this.maxLabelElement=null,this.messages=null,this.minLabelElement=null,this.rangeLabelInputsEnabled=!1,this.segmentElements=new fe,this.snapOnClickEnabled=!0,this.steps=null,this.syncedSegmentsEnabled=!1,this.thumbCreatedFunction=null,this.thumbElements=new fe,this.tickElements=new fe,this.trackElement=null,this.viewModel=new _s,this.visibleElements={...hi},this._onAnchorPointerDown=this._onAnchorPointerDown.bind(this),this._onAnchorPointerMove=this._onAnchorPointerMove.bind(this),this._onAnchorPointerUp=this._onAnchorPointerUp.bind(this),this._onLabelPointerDown=this._onLabelPointerDown.bind(this),this._onLabelPointerUp=this._onLabelPointerUp.bind(this),this._onSegmentPointerDown=this._onSegmentPointerDown.bind(this),this._onSegmentPointerMove=this._onSegmentPointerMove.bind(this),this._onSegmentPointerUp=this._onSegmentPointerUp.bind(this),this._onTrackPointerDown=this._onTrackPointerDown.bind(this),this._onTrackPointerMove=this._onTrackPointerMove.bind(this),this._onTrackPointerUp=this._onTrackPointerUp.bind(this)}destroy(){document.removeEventListener("pointerup",this._onLabelPointerUp),document.removeEventListener("pointermove",this._onLabelPointerMove),document.removeEventListener("pointerup",this._onAnchorPointerUp),document.removeEventListener("pointermove",this._onAnchorPointerMove),this.labelElements.removeAll(),this.labelElements.destroy(),this.segmentElements.removeAll(),this.segmentElements.destroy(),this.effectiveSegmentElements.removeAll(),this.effectiveSegmentElements.destroy(),this.thumbElements.removeAll(),this.thumbElements.destroy(),this.tickElements.removeAll(),this.tickElements.destroy()}get effectiveMax(){return this.viewModel.effectiveMax}set effectiveMax(e){this.viewModel.effectiveMax=e}get effectiveMin(){return this.viewModel.effectiveMin}set effectiveMin(e){this.viewModel.effectiveMin=e}get inputFormatFunction(){return this.viewModel.inputFormatFunction}set inputFormatFunction(e){this.viewModel.inputFormatFunction=e}get inputParseFunction(){return this.viewModel.inputParseFunction}set inputParseFunction(e){this.viewModel.inputParseFunction=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get labelFormatFunction(){return this.viewModel.labelFormatFunction}set labelFormatFunction(e){this.viewModel.labelFormatFunction=e}get labels(){return this.viewModel.labels}set layout(e){["vertical","vertical-reversed","horizontal","horizontal-reversed"].includes(e)||(e="horizontal"),this._set("layout",e)}get max(){return this.viewModel.max}set max(e){this.viewModel.max=e}get min(){return this.viewModel.min}set min(e){this.viewModel.min=e}get precision(){return this.viewModel.precision}set precision(e){this.viewModel.precision=e}get state(){const{_activeLabelInputIndex:e,_isMaxInputActive:i,_isMinInputActive:n,_dragStartInfo:s,_segmentDragStartInfo:a,disabled:o,viewModel:l}=this,r=f(s)||f(a);return o?"disabled":e===null&&!i&&!n?r?"dragging":l.state:"editing"}get thumbsConstrained(){return this.viewModel.thumbsConstrained}set thumbsConstrained(e){this.viewModel.thumbsConstrained=e}set tickConfigs(e){this._set("tickConfigs",e),this.scheduleRender()}get values(){return this.viewModel.values}set values(e){this.viewModel.values=e}castVisibleElements(e){return{...hi,...e}}render(){const{label:e}=this,i=this.classes(C.base,C.esriWidget,this._isHorizontalLayout()?C.horizontalLayout:C.verticalLayout,this._isReversedLayout()?C.reversed:null,this._isDisabled()?C.disabled:null);return this._storeTrackDimensions(),x("div",{"aria-label":e,class:i,"touch-action":"none",bind:this,afterCreate:this._afterContainerCreate},this.renderContent())}toNextStep(e){this._toStep(e,1)}toPreviousStep(e){this._toStep(e,-1)}renderContent(){const{max:e,min:i}=this;if(!(T(i)||T(e)||i>=e))return[this.renderMin(),this.renderSliderContainer(),this.renderMax()]}renderSliderContainer(){return x("div",{key:"slider-container",bind:this,class:C.contentElement},this.renderTrackElement(),this.renderTicksContainer(),this.renderExtraContentElements())}renderTrackElement(){return x("div",{afterCreate:this._afterTrackCreate,afterRemoved:this._afterTrackRemoved,bind:this,class:C.trackElement,"touch-action":"none"},this.renderEffectiveSegmentElements(),this.renderSegmentElements(),this.renderAnchorElements())}renderEffectiveSegmentElements(){if(!this.trackElement||!this.values||!this.values.length)return;const e=f(this.effectiveMax),i=f(this.effectiveMin);if(!e&&!i)return;const{max:n,min:s,viewModel:a}=this,o=a.getBounds(),l=[];return i&&l.push(this.renderEffectiveSegmentElement(s,o.min,!0)),e&&l.push(this.renderEffectiveSegmentElement(o.max,n,!1)),l}renderSegmentElements(){if(!this.trackElement||!this.values||!this.values.length)return;const e=this.values.length,i=[];for(let n=0;n<=e;n++)i.push(this.renderSegmentElement(n));return i}renderSegmentElement(e){const{_trackHeight:i,_trackWidth:n,draggableSegmentsEnabled:s,id:a,state:o,values:l}=this,r=this._isHorizontalLayout(),u=r?n:i,c=this.viewModel.getBounds(),p=this._positionFromValue(c.max),h=this._positionFromValue(c.min),g=e===l.length?null:e,_=e===0?null:e-1,y=f(g),b=f(_);let E,w;const V=[...l].sort((H,X)=>H-X);this._isReversedLayout()?(E=b?this._positionFromValue(V[_]):h,w=y?this._positionFromValue(V[g]):p):(E=y?this._positionFromValue(V[g]):p,w=b?this._positionFromValue(V[_]):h);const v=this._applyPrecisionToPosition(100*w/u),O=(E-w)/u,S=r?`transform: translate(${v}%, 0px) scale(${O}, 1);`:`transform: translate(0px, ${v}%) scale(1, ${O});`,D=this.classes(C.segmentElement,C.segmentElementIndexPrefix+e,s&&y&&b&&o!=="disabled"?C.segmentElementInteractive:null);return x("div",{afterCreate:this._afterSegmentCreate,afterRemoved:this._afterSegmentRemoved,bind:this,class:D,"data-max-thumb-index":g,"data-min-thumb-index":_,"data-segment-index":e,key:`${a}-segment-${e}`,style:S,"touch-action":"none"})}renderEffectiveSegmentElement(e,i,n){const{_trackHeight:s,_trackWidth:a,layout:o}=this,l=this._positionFromValue(e),r=this._positionFromValue(i),u=this._isHorizontalLayout(),c=u?a:s,p=this._applyPrecisionToPosition(100*l/c);let h=null;if(o==="horizontal"){const y=n?c-r:r,b=l===c?0:p;h=`clip-path: inset(0% ${r===c?0:this._applyPrecisionToPosition(y/c*100)}% 0% ${b}%);`}else{const y=(r-l)/c;h=u?`transform: translate(${p}%, 0px) scale(${y}, 1);`:`transform: translate(0px, ${p}%) scale(1, ${y});`}const g=n?C.effectiveMinSegmentElement:C.effectiveMaxSegmentElement,_=this.classes(C.segmentElement,C.effectiveSegmentElement,g);return x("div",{afterCreate:this._afterEffectiveSegmentCreate,afterRemoved:this._afterEffectiveSegmentRemoved,bind:this,class:_,style:h,"touch-action":"none"})}renderAnchorElements(){const{trackElement:e,values:i}=this;if(i&&i.length)return this._zIndices=i.map((n,s)=>{const a=this._positionFromValue(n),o=this._positionToPercent(a),l=(this._isHorizontalLayout()?o>50:o<50)?-1:1;return this._zIndexOffset+(i.length+l*s)}),e&&i&&i.length?i.map((n,s)=>this.renderAnchorElement(n,s)):null}renderAnchorElement(e,i){const n=this._positionFromValue(e),s=this._valueFromPosition(n);if(T(s)||isNaN(s))return;const{_dragStartInfo:a,_lastMovedHandleIndex:o,id:l,layout:r,values:u,visibleElements:{labels:c}}=this,p=a&&a.index===i,h=o===i,g=this.classes(C.anchorElement,C.anchorElementIndexPrefix+i,p?C.movingAnchorElement:null,h?C.lastMovedAnchorElement:null),_=this.labels.values[i],y=this._getStyleForAnchor(e,i,p||h),{min:b,max:E}=this.viewModel.getBoundsForValueAtIndex(i),{disabled:w,messages:V}=this,v=u.length===2?Rt(i===0?V.rangeMinimum:V.rangeMaximum,{value:e}):_,O=u.length===1?null:i===0?`${l}-handle-${i+1}`:i===u.length-1?`${l}-handle-${i-1}`:`${l}-handle-${i-1} ${l}-handle-${i+1}`;return x("div",{afterCreate:this._afterAnchorCreate,afterUpdate:this._afterAnchorUpdate,afterRemoved:this._afterAnchorRemoved,"aria-controls":O,"aria-label":V.sliderValue,"aria-labelledby":c?`${l}-label-${i}`:null,"aria-orientation":r,"aria-valuemax":E.toString(),"aria-valuemin":b.toString(),"aria-valuenow":e.toString(),"aria-valuetext":v,bind:this,class:g,"data-thumb-index":i,"data-value":e,id:`${l}-handle-${i}`,key:`${l}-handle-${i}`,onkeydown:this._onAnchorKeyDown,"touch-action":"none",role:"slider",style:y,tabIndex:w?-1:0},x("span",{afterCreate:this._afterThumbCreate,afterRemoved:this._afterThumbRemoved,bind:this,class:C.thumbElement,"data-thumb-index":i,"touch-action":"none"}),this.renderThumbLabel(i))}renderThumbLabel(e){const{id:i,labels:n,labelInputsEnabled:s,state:a}=this,o=this.visibleElements.labels,l=n.values[e],r=this.classes(C.labelElement,o?null:C.hidden,s&&a!=="disabled"?C.labelElementInteractive:null);return x("span",{afterCreate:this._afterLabelCreate,afterRemoved:this._afterLabelRemoved,"aria-hidden":(!o).toString(),bind:this,class:r,"data-thumb-index":e,key:`${i}-label-${e}`,id:`${i}-label-${e}`,role:s?"button":null,"touch-action":"none"},this._activeLabelInputIndex===e?this.renderValueInput(e):l)}renderValueInput(e){const{disabled:i,values:n}=this,s=n[e];return x("input",{key:`value-input-${e}`,afterCreate:this._afterInputCreate,"aria-label":this.messages.sliderValue,bind:this,class:C.labelInput,"data-input-type":"thumb","data-input-index":e,required:!0,tabIndex:i?-1:0,type:"text",value:this._formatInputValue(s,"value",e),onblur:this._onLabelInputBlur,onkeydown:this._onInputKeyDown})}renderMax(){const{_isMaxInputActive:e,labels:i,rangeLabelInputsEnabled:n,state:s}=this,a=this.visibleElements.rangeLabels,o=this.classes(C.maxElement,{[C.hidden]:!a,[C.maxElementInteractive]:n&&s!=="disabled",[C.rangeElementActive]:e});return x("div",{"aria-hidden":(!a).toString(),afterCreate:this._afterMaxLabelCreate,bind:this,class:o,onclick:this._onMaxLabelClick,onkeydown:this._onMaxLabelKeyDown,role:n?"button":null,tabIndex:!this.disabled&&n?0:-1},e?this.renderMaxInput():i.max)}renderMin(){const{_isMinInputActive:e,labels:i,rangeLabelInputsEnabled:n,state:s}=this,a=this.visibleElements.rangeLabels,o=this.classes(C.minElement,{[C.hidden]:!a,[C.minElementInteractive]:n&&s!=="disabled",[C.rangeElementActive]:e});return x("div",{"aria-hidden":(!a).toString(),afterCreate:this._afterMinLabelCreate,bind:this,class:o,onclick:this._onMinLabelClick,onkeydown:this._onMinLabelKeyDown,role:n?"button":null,tabIndex:!this.disabled&&n?0:-1},e?this.renderMinInput():i.min)}renderMaxInput(){return x("input",{afterCreate:this._afterInputCreate,"aria-label":this.messages.maximumValue,bind:this,class:C.rangeInput,"data-input-type":"max",required:!0,tabIndex:this.disabled?-1:0,type:"text",value:this._formatInputValue(this.max,"max"),onblur:this._onMaxInputBlur,onkeydown:this._onInputKeyDown})}renderMinInput(){return x("input",{afterCreate:this._afterInputCreate,"aria-label":this.messages.minimumValue,bind:this,class:C.rangeInput,"data-input-type":"min",required:!0,tabIndex:this.disabled?-1:0,type:"text",value:this._formatInputValue(this.min,"min"),onblur:this._onMinInputBlur,onkeydown:this._onInputKeyDown})}renderExtraContentElements(){return x("div",{bind:this,class:C.extraContentElement},this.extraNodes)}renderTicksContainer(){if(this.tickConfigs&&this.trackElement&&(this._trackHeight!==0||this._trackWidth!==0))return this.tickConfigs.map((e,i)=>x("div",{key:"ticks-container",class:this.classes(C.ticksContainerElement)},this.renderTicks(e,i)))}renderTicks(e,i){const{mode:n,values:s}=e;if(this.tickElements.getItemAt(i)||this.tickElements.add(new fe,i),n==="position"){const l=Array.isArray(s)?s:[s];return this._calculateTickPositions(l).map((r,u)=>this.renderTickGroup(e,u,i,r))}if(n==="percent"&&Array.isArray(s)){const{max:l,min:r}=this,u=l-r,c=s.map(p=>this._applyPrecisionToPosition(p/100*u+r));return this._calculateTickPositions(c).map((p,h)=>this.renderTickGroup(e,h,i,p))}const a=Array.isArray(s)&&s.length?s[0]:isNaN(s)?null:s,o=this._getTickCounts(a,e);return this._calculateEquidistantTickPositions(o).map((l,r)=>this.renderTickGroup(e,r,i,l))}renderTickGroup(e,i,n,s){const a=e.mode==="position"?Array.isArray(e.values)?e.values[i]:e.values:this._valueFromPosition(s);if(!T(a)&&!isNaN(a))return x("div",{afterCreate:this._afterTickGroupCreate,afterRemoved:this._afterTickGroupRemoved,bind:this,"data-config":e,"data-position":s,"data-tick-config-index":n,"data-tick-group-index":i,"data-value":a,onclick:this._onTickGroupClick,key:`tick-group-${i}`},this.renderTickLine(e,i,n,a),e.labelsVisible?this.renderTickLabel(e,i,n,a):null)}renderTickLine(e,i,n,s){return x("div",{afterCreate:this._afterTickLineCreate,"aria-valuenow":s.toString(),bind:this,class:C.tickElement,"data-config":e,"data-tick-config-index":n,"data-tick-group-index":i,"data-value":s,key:`tick-label-${i}`,style:this._getPositionStyleForElement(s)})}renderTickLabel(e,i,n,s){const a=e.labelFormatFunction?e.labelFormatFunction(s,"tick",i):this.viewModel.getLabelForValue(s,"tick",i);return x("div",{afterCreate:this._afterTickLabelCreate,"aria-label":a,"aria-valuenow":s.toString(),"aria-valuetext":a,bind:this,class:C.tickLabelElement,"data-config":e,"data-tick-config-index":n,"data-tick-group-index":i,"data-value":s,key:`tick-label-${i}`,style:`transform: translate(-50%); ${this._getPositionStyleForElement(s)}`},a)}_afterContainerCreate(e){this.addHandles(Wi(e,()=>this.scheduleRender()))}_afterTrackCreate(e){this._set("trackElement",e),e.addEventListener("pointerdown",this._onTrackPointerDown),this.scheduleRender()}_afterTrackRemoved(e){e.removeEventListener("pointerdown",this._onTrackPointerDown),document.removeEventListener("pointermove",this._onTrackPointerMove),document.removeEventListener("pointerup",this._onTrackPointerUp)}_afterSegmentCreate(e){this.segmentElements.add(e),e.addEventListener("pointerdown",this._onSegmentPointerDown)}_afterSegmentRemoved(e){this.segmentElements.remove(e),e.removeEventListener("pointerdown",this._onSegmentPointerDown)}_afterEffectiveSegmentCreate(e){this.effectiveSegmentElements.add(e)}_afterEffectiveSegmentRemoved(e){this.effectiveSegmentElements.remove(e)}_afterAnchorCreate(e){if(this._anchorElements.push(e),e.addEventListener("pointerdown",this._onAnchorPointerDown),this.thumbCreatedFunction){const i=e["data-thumb-index"],n=e["data-value"],s=this.thumbElements.getItemAt(i)||null,a=this.labelElements.getItemAt(i)||null;this.thumbCreatedFunction(i,n,s,a)}}_afterAnchorUpdate(e){f(this._focusedAnchorIndex)&&e["data-thumb-index"]===this._focusedAnchorIndex&&(e.focus(),this._focusedAnchorIndex=null)}_afterAnchorRemoved(e){const i=this._anchorElements.indexOf(e,0);i>-1&&this._anchorElements.splice(i,1),e.removeEventListener("pointerdown",this._onAnchorPointerDown)}_afterThumbCreate(e){this.thumbElements.add(e)}_afterThumbRemoved(e){this.thumbElements.remove(e)}_afterLabelCreate(e){this.labelElements.add(e),e.addEventListener("pointerdown",this._onLabelPointerDown),e.addEventListener("pointerup",this._onLabelPointerUp)}_afterLabelRemoved(e){this.labelElements.remove(e),e.removeEventListener("pointerdown",this._onLabelPointerDown),e.removeEventListener("pointerup",this._onLabelPointerUp)}_afterInputCreate(e){if(e.focus(),e.select(),this.inputCreatedFunction){const i=e.getAttribute("data-input-type"),n=i==="thumb"?e["data-input-index"]:null;this.inputCreatedFunction(e,i,n)}}_afterTickLineCreate(e){const i=e["data-tick-config-index"],n=e["data-tick-group-index"],s=this.tickElements.getItemAt(i);s.getItemAt(n)?s.getItemAt(n).tickElement=e:s.add({groupElement:null,tickElement:e,labelElement:null},n)}_afterTickLabelCreate(e){const i=e["data-tick-config-index"],n=e["data-tick-group-index"],s=this.tickElements.getItemAt(i);s.getItemAt(n)?s.getItemAt(n).labelElement=e:s.add({groupElement:null,labelElement:e,tickElement:null},n)}_afterTickGroupRemoved(e){const i=e["data-tick-config-index"],n=this.tickElements.items[i],s=n==null?void 0:n.find(a=>a.groupElement===e);s&&n.remove(s)}_afterTickGroupCreate(e){var n,s;const i=e["data-config"];if(i&&i.tickCreatedFunction){const a=e["data-tick-config-index"],o=e["data-tick-group-index"],l=e["data-value"],r=(s=(n=this.tickElements)==null?void 0:n.getItemAt(a))==null?void 0:s.getItemAt(o);if(r){r.groupElement=e;const u=r.tickElement||null,c=r.labelElement||null;i.tickCreatedFunction(l,u,c)}}}_afterMaxLabelCreate(e){this._set("maxLabelElement",e)}_afterMinLabelCreate(e){this._set("minLabelElement",e)}_onAnchorKeyDown(e){if(this._isDisabled()||this.state==="editing")return;const{target:i}=e,n=Ye(e),{_anchorElements:s,values:a}=this,o=i["data-thumb-index"],l=s[o],r=a[o],u=[ne.moveAnchorUp,ne.moveAnchorDown,ne.moveAnchorLeft,ne.moveAnchorRight];if(n===ne.showInput&&this.labelInputsEnabled)this._activeLabelInputIndex=o,this.notifyChange("state");else if(u.includes(n)){e.preventDefault();const{steps:c}=this,p=n===ne.moveAnchorUp||n===ne.moveAnchorRight?1:-1;if(f(c))this._toStep(o,this._isReversedLayout()?-1*p:p);else{const{precision:g}=this,_=this._getPositionOfElement(l),y=this._valueFromPosition(_),b=this._isHorizontalLayout()?p:-1*p;let E;E=g===0?this._positionFromValue(y+b):g===1?this._positionFromValue(y+.1*b):_+b,this._toPosition(o,E)}const h=this.values[o];r!==h&&this._emitThumbChangeEvent({index:o,oldValue:r,value:h})}else if(n===ne.moveAnchorToMax||n===ne.moveAnchorToMin){e.preventDefault();const{min:c,max:p}=this._getAnchorBoundsInPixels(o),h=this._isPositionInverted()?n===ne.moveAnchorToMax?c:p:n===ne.moveAnchorToMin?c:p;this._toPosition(o,h);const g=this.values[o];r!==g&&this._emitThumbChangeEvent({index:o,oldValue:r,value:g})}}_onAnchorPointerDown(e){if(this._isDisabled())return;const{target:i,clientX:n,clientY:s}=e,a=i["data-thumb-index"];a!==void 0&&(e.preventDefault(),this._anchorElements[a]&&this._anchorElements[a].focus(),this._storeTrackDimensions(),this._dragStartInfo={clientX:n,clientY:s,index:a,position:this._getPositionOfElement(this._anchorElements[a])},this.notifyChange("state"),document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove))}_onAnchorPointerMove(e){if(this.state==="editing"||!this._dragStartInfo)return;e.preventDefault();const{values:i,_anchorElements:n,_dragged:s,_dragStartInfo:a,_dragStartInfo:{index:o,position:l}}=this,{clientX:r,clientY:u}=e,c=s?"drag":"start",p=n[o],h=this._getPositionOfElement(p),g=this._applyPrecisionToPosition(this._isHorizontalLayout()?l+r-a.clientX:l+u-a.clientY);if(h===g)return;const _=i[o];this._dragged=!0,this._toPosition(o,g);const y=this.values[o];s?_!==y&&this._emitThumbDragEvent({index:o,state:c,value:y}):this._emitThumbDragEvent({index:o,state:c,value:_})}_onAnchorPointerUp(e){if(document.removeEventListener("pointerup",this._onAnchorPointerUp),document.removeEventListener("pointermove",this._onAnchorPointerMove),!this._dragStartInfo)return;e.preventDefault();const{index:i}=this._dragStartInfo,n=this._dragged,s=this.values[i];this._dragged=!1,this._dragStartInfo=null,this._lastMovedHandleIndex=i,this.notifyChange("state"),n?this._emitThumbDragEvent({index:i,state:"stop",value:s}):(this.scheduleRender(),this.state!=="editing"&&this._emitThumbClickEvent({index:i,value:s}))}_onTrackPointerDown(e){const{_dragStartInfo:i,snapOnClickEnabled:n,state:s,values:a}=this;if(this._isDisabled()||s==="editing"||i||(document.addEventListener("pointermove",this._onTrackPointerMove),document.addEventListener("pointerup",this._onTrackPointerUp),!n||!a.length))return;const{steps:o}=this,{clientX:l,clientY:r}=e,u=this._getCursorPositionFromEvent(e),c=this._valueFromPosition(u),p=this._getIndexOfNearestValue(c),h=a[p],g=a.some((E,w)=>E===h&&w!==p)&&c>h?this.values.lastIndexOf(h):p;if(T(g))return;const _=a[g],y=f(o)?this._calculateNearestStepPosition(u):u;this._toPosition(g,y),this._dragged=!0,this._dragStartInfo={clientX:l,clientY:r,index:g,position:y},this._focusedAnchorIndex=g,this.notifyChange("state"),this._emitThumbDragEvent({index:g,state:"start",value:_});const b=this.values[g];_!==b&&this._emitThumbDragEvent({index:g,state:"drag",value:b}),document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove)}_onTrackPointerMove(e){e.preventDefault(),this._dragged=!0}_onTrackPointerUp(e){if(e.preventDefault(),document.removeEventListener("pointermove",this._onTrackPointerMove),document.removeEventListener("pointerup",this._onTrackPointerUp),this.snapOnClickEnabled||(this._dragged=!1),!this._dragged){const i=this._getCursorPositionFromEvent(e),n=this._valueFromPosition(i);this._emitTrackClickEvent({value:n})}}_onSegmentPointerDown(e){var r,u;e.preventDefault();const i=e.target,n=i["data-segment-index"],s=i["data-min-thumb-index"],a=i["data-max-thumb-index"];if(this._isDisabled()||T(s)||T(a))return;e.stopPropagation(),this._storeTrackDimensions(),document.addEventListener("pointerup",this._onSegmentPointerUp);const o=this._getAnchorDetails(s),l=this._getAnchorDetails(a);this.syncedSegmentsEnabled?(this.segmentElements.forEach(c=>c.classList.add(C.segmentElementActive)),this._anchorElements.forEach(c=>c.classList.add(C.anchorElementActive))):(this.segmentElements.getItemAt(n).classList.add(C.segmentElementActive),(r=this._anchorElements[o.index])==null||r.classList.add(C.anchorElementActive),(u=this._anchorElements[l.index])==null||u.classList.add(C.anchorElementActive)),this._segmentDragStartInfo={cursorPosition:this._getCursorPositionFromEvent(e),index:n,details:this._normalizeSegmentDetails({min:o,max:l})},this.draggableSegmentsEnabled&&(document.addEventListener("pointermove",this._onSegmentPointerMove),this.notifyChange("state"),this._emitSegmentDragEvent({index:n,state:"start",thumbIndices:[s,a]}))}_onSegmentPointerMove(e){if(!this._segmentDragStartInfo)return;e.preventDefault();const{_trackHeight:i,_trackWidth:n,_segmentDragStartInfo:{index:s,cursorPosition:a,details:{min:o,max:l}}}=this,{index:r,position:u,value:c}=o,{index:p,position:h,value:g}=l;this._dragged=!0;const _=this._getCursorPositionFromEvent(e);if(_===a)return;const y=this._positionToPercent(a),b=this._positionToPercent(_)-y,E=this._positionToPercent(u)+b,w=this._positionToPercent(h)+b,{min:V}=this._getAnchorBoundsAsPercents(r),{max:v}=this._getAnchorBoundsAsPercents(p);let O=!1,S=!1;if(E<V?O=!0:w>v&&(S=!0),O){const{min:P,max:_e}=this.viewModel.getBoundsForValueAtIndex(r),be=this._isPositionInverted()?_e:P,W=be,xe=g+(be-c),Ve=xe-this.values[p];return void(this.syncedSegmentsEnabled?this._updateAnchorValuesByDifference(Ve):this._updateAnchorValues([r,p],[W,xe]))}if(S){const{min:P,max:_e}=this.viewModel.getBoundsForValueAtIndex(p),be=this._isPositionInverted()?P:_e,W=be,xe=c+(be-g),Ve=xe-this.values[r];return void(this.syncedSegmentsEnabled?this._updateAnchorValuesByDifference(Ve):this._updateAnchorValues([r,p],[xe,W]))}const D=this._isHorizontalLayout()?n:i,H=w/100*D,X=E/100*D,q=this.values,J=[q[r],q[p]],K=this._getValueForAnchorAtPosition(r,X),ye=this._getValueForAnchorAtPosition(p,H);this.syncedSegmentsEnabled?this._updateAnchorValuesByDifference(K-J[0]):this._updateAnchorValues([r,p],[K,ye]),[this.values[r],this.values[p]].every((P,_e)=>P===J[_e])||this._emitSegmentDragEvent({index:s,state:"drag",thumbIndices:[r,p]})}_onSegmentPointerUp(e){if(e.preventDefault(),document.removeEventListener("pointerup",this._onSegmentPointerUp),document.removeEventListener("pointermove",this._onSegmentPointerMove),!this._segmentDragStartInfo)return;const{_dragged:i,max:n,min:s,values:a}=this,{index:o,details:{min:{index:l},max:{index:r}}}=this._segmentDragStartInfo;if(this.segmentElements.forEach(u=>u.classList.remove(C.segmentElementActive)),this._anchorElements.forEach(u=>u.classList.remove(C.anchorElementActive)),this.draggableSegmentsEnabled){const u=n-s,c=a[l],p=a[r];this._lastMovedHandleIndex=c===p?c>u/2?l:r:null,this._dragged=!1,this._segmentDragStartInfo=null,this.notifyChange("state"),this._emitSegmentDragEvent({index:o,state:"stop",thumbIndices:[l,r]})}if(!i){const u=this._getCursorPositionFromEvent(e),c=this._valueFromPosition(u);this._emitSegmentClickEvent({index:o,value:c,thumbIndices:[l,r]})}}_onTickGroupClick(e){const i=e.target;if(i["data-config"]){const n=i["data-tick-config-index"],s=i["data-tick-group-index"],a=i["data-value"];this._emitTickClickEvent({configIndex:n,groupIndex:s,value:a})}}_storeTrackDimensions(){if(this.trackElement){const e=this._getDimensions(this.trackElement);this._trackHeight=e.height,this._trackWidth=e.width}}_onLabelPointerDown(){this._isDisabled()||(this._dragged=!1,document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove))}_onLabelPointerMove(){this._isDisabled()||(this._dragged=!0)}_onLabelPointerUp(e){if(this._isDisabled())return;const i=e.target["data-thumb-index"];this.labelInputsEnabled&&!this._dragged&&f(i)&&(this._activeLabelInputIndex=i),this._dragged=!1,this.notifyChange("state"),document.removeEventListener("pointerup",this._onLabelPointerUp),document.removeEventListener("pointermove",this._onLabelPointerMove)}_onLabelInputBlur(e){const{_activeLabelInputIndex:i,values:n,viewModel:s}=this,a=e.target.value;if(this._activeLabelInputIndex=null,this.notifyChange("state"),!a)return;const o=this._parseInputValue(a,"value",i),l=n[i],{min:r,max:u}=this.viewModel.getBoundsForValueAtIndex(i);if(o<r||o>u)return;s.setValue(i,o);const c=this.values[i];l!==c&&this._emitThumbChangeEvent({index:i,oldValue:l,value:c})}_onInputKeyDown(e){if(this._isDisabled())return;const{target:i}=e,n=Ye(e),{hideInput1:s,hideInput2:a,hideInput3:o}=ne,{_activeLabelInputIndex:l,_anchorElements:r}=this,u=i;if(n===s||n===a||n===o){e.stopPropagation();const c=l;u.blur(),f(c)?r[c].focus():u.parentElement.focus()}}_onMaxLabelClick(){this._isDisabled()||(this._emitRangeLabelClickEvent({type:"max-click",value:this.max}),this.rangeLabelInputsEnabled&&(this._isMaxInputActive=!0,this.notifyChange("state")))}_onMaxLabelKeyDown(e){this._isDisabled()||Ye(e)!==ne.showInput||(this._isMaxInputActive=!0,this.notifyChange("state"))}_onMaxInputBlur(e){const i=e.target.value;if(this._isMaxInputActive=!1,this.notifyChange("state"),!i)return;const n=this.max,s=this._parseInputValue(i,"max");s<=this.min||(this.viewModel.set("max",s),this.max!==n&&this._emitMaxChangeEvent({oldValue:n,value:this.max}))}_onMinLabelClick(){this._isDisabled()||(this._emitRangeLabelClickEvent({type:"min-click",value:this.min}),this.rangeLabelInputsEnabled&&(this._isMinInputActive=!0,this.notifyChange("state")))}_onMinLabelKeyDown(e){this._isDisabled()||Ye(e)!==ne.showInput||(this._isMinInputActive=!0,this.notifyChange("state"))}_onMinInputBlur(e){const i=e.target.value;if(this._isMinInputActive=!1,this.notifyChange("state"),!i)return;const n=this.min,s=this._parseInputValue(i,"min");s>=this.max||(this.viewModel.set("min",s),this.min!==n&&this._emitMinChangeEvent({oldValue:n,value:this.min}))}_isDisabled(){return this.disabled||this.state==="disabled"}_positionFromValue(e){const{max:i,min:n}=this,s=i-n;if(s===0)return 0;const{_trackHeight:a,_trackWidth:o}=this,l=this._isHorizontalLayout();let r=parseFloat(l?(o*(e-n)/s).toFixed(2):(a*(i-e)/s).toFixed(2));return this._isReversedLayout()&&(r=l?o-r:a-r),r}_valueFromPosition(e){const{_trackHeight:i,_trackWidth:n,max:s,min:a,precision:o}=this,l=s-a;let r=this._isHorizontalLayout()?e*l/n+a:l*(1e3-e/i*1e3)/1e3+a;return this._isReversedLayout()&&(r=s+a-r),parseFloat(r.toFixed(o))}_positionToPercent(e){const{_trackHeight:i,_trackWidth:n}=this,s=100*e/(this._isHorizontalLayout()?n:i);return this._applyPrecisionToPosition(s)}_applyPrecisionToPosition(e){return parseFloat(e.toFixed(this._positionPrecision))}_isPositionInverted(){const{layout:e}=this;return e==="horizontal-reversed"||e==="vertical"}_isHorizontalLayout(){return this.layout.includes("horizontal")}_isReversedLayout(){return this.layout.includes("reversed")}_normalizeSegmentDetails(e){if(this._isPositionInverted()){const{min:i,max:n}=e;return{min:n,max:i}}return e}_parseInputValue(e,i,n){return this.inputParseFunction?this.inputParseFunction(e,i,n):this.viewModel.defaultInputParseFunction(e)}_formatInputValue(e,i,n){return this.inputFormatFunction?this.inputFormatFunction(e,i,n):this.viewModel.defaultInputFormatFunction(e)}_getAnchorDetails(e){const i=[...this.values].sort((s,a)=>s-a)[e],n=this.values.indexOf(i);return{index:n,position:this._getPositionOfElement(this._anchorElements[n]),value:i}}_updateAnchorStyle(e,i){const n=this._anchorElements[e];n&&(this._isHorizontalLayout()?n.style.left=`${i}`:n.style.top=`${i}`)}_getStyleForAnchor(e,i,n){const s=this._getPositionStyleForElement(e);if(this.values.length===1)return`${s}`;const a=this._zIndices[i];return`${s}; z-index: ${n?this._zIndexOffset+a:a}`}_getPositionStyleForElement(e){const i=this._positionFromValue(e),n=this._positionToPercent(i);return`${this._isHorizontalLayout()?"left":"top"}: ${n+"%"}`}_getPositionOfElement(e){const i=this._getDimensions(e.offsetParent),n=this._getDimensions(e);return this._isHorizontalLayout()?this._applyPrecisionToPosition(n.left-i.left):this._applyPrecisionToPosition(n.top-i.top)}_updateAnchorValues(e,i){e.forEach((n,s)=>this._toValue(n,i[s]))}_updateAnchorValuesByDifference(e){const{min:i,max:n,values:s}=this;s.forEach((a,o)=>this._toValue(o,Math.max(Math.min(a+e,n),i)))}_toValue(e,i){f(this.steps)&&(i=this._getStepValues()[this._getIndexOfNearestStepValue(i)]),this._updateAnchorStyle(e,this._getPositionStyleForElement(i)),this.viewModel.setValue(e,i)}_toPosition(e,i){const n=f(this.steps)?this._getStepValueForAnchorAtPosition(e,i):this._getValueForAnchorAtPosition(e,i);this._updateAnchorStyle(e,this._getPositionStyleForElement(n)),this.viewModel.setValue(e,n)}_getValueForAnchorAtPosition(e,i){const{min:n,max:s}=this._getAnchorBoundsInPixels(e),{min:a,max:o}=this.viewModel.getBoundsForValueAtIndex(e);let l,r,u=null;return this._isPositionInverted()?(l=a,r=o):(l=o,r=a),u=i>s?l:i<n?r:this._valueFromPosition(i),u>o?u=o:u<a&&(u=a),u}_getStepValueForAnchorAtPosition(e,i){const n=this._getStepValues(),s=this._calculateNearestStepPosition(i),a=this._getValueForAnchorAtPosition(e,s);return n[this._getIndexOfNearestStepValue(a)]}_getAnchorBoundsAsPercents(e){const{min:i,max:n}=this._getAnchorBoundsInPixels(e);return{min:this._positionToPercent(i),max:this._positionToPercent(n)}}_getAnchorBoundsInPixels(e){const{_anchorElements:i,_trackHeight:n,_trackWidth:s,effectiveMax:a,effectiveMin:o,thumbsConstrained:l}=this,r=i[e-1],u=i[e+1],c=this._isHorizontalLayout()?s:n;let p,h;return this._isPositionInverted()?(p=f(o)?this._positionFromValue(o):c,h=f(a)?this._positionFromValue(a):0):(p=f(a)?this._positionFromValue(a):c,h=f(o)?this._positionFromValue(o):0),l?this._isPositionInverted()?{max:r?this._getPositionOfElement(r):p,min:u?this._getPositionOfElement(u):h}:{max:u?this._getPositionOfElement(u):p,min:r?this._getPositionOfElement(r):h}:{max:p,min:h}}_getIndexOfNearestValue(e){return this.values.indexOf(this.values.reduce((i,n)=>Math.abs(n-e)<Math.abs(i-e)?n:i))}_getCursorPositionFromEvent(e){const i=this._getDimensions(this.trackElement);return this._isHorizontalLayout()?e.clientX-i.left:e.clientY-i.top}_getStepValues(){const{steps:e}=this;if(Array.isArray(e))return e;const{max:i,min:n}=this,s=Math.ceil((i-n)/e),a=[];for(let o=0;o<=s;o++){const l=n+e*o;a.push(l>i?i:l)}return a}_toStep(e,i){const{values:n,viewModel:s}=this,a=n[e],o=this._getStepValues(),l=o.indexOf(a);let r=null;if(l>-1){let u=o[l+i];isNaN(u)&&(u=o[l]);const c=this._positionFromValue(u);r=this._getStepValueForAnchorAtPosition(e,c)}else r=o[this._getIndexOfNearestStepValue(a)+i];s.setValue(e,r)}_getIndexOfNearestStepValue(e){const{steps:i}=this;if(T(i))return null;const n=this._getStepValues(),s=n.reduce((a,o)=>Math.abs(o-e)<Math.abs(a-e)?o:a);return n.indexOf(s)}_calculateNearestStepPosition(e){const i=this._valueFromPosition(e),n=this._getIndexOfNearestStepValue(i),s=this._getStepValues();return this._positionFromValue(s[n])}_getTickCounts(e,i){const{mode:n}=i;return n==="count"||n==="position"?e||0:n==="percent"&&100/e||0}_calculateTickPositions(e){return e.map(i=>this._positionFromValue(i))}_calculateEquidistantTickPositions(e){const{_trackWidth:i,_trackHeight:n}=this,s=this._isHorizontalLayout()?i:n,a=s/(e-1),o=[];if(e===1)return[s/2];for(let l=0;l<e;l++){const r=l*a;r<=s&&o.push(r)}return o}_getDimensions(e){try{return e.getBoundingClientRect()}catch(i){if(typeof i=="object"&&i!==null)return new DOMRect(0,0,0,0);throw i}}_emitTrackClickEvent(e){this.emit("track-click",{...e,type:"track-click"})}_emitTickClickEvent(e){this.emit("tick-click",{...e,type:"tick-click"})}_emitMaxChangeEvent(e){this.emit("max-change",{...e,type:"max-change"})}_emitMinChangeEvent(e){this.emit("min-change",{...e,type:"min-change"})}_emitThumbChangeEvent(e){this.emit("thumb-change",{...e,type:"thumb-change"})}_emitThumbClickEvent(e){this.emit("thumb-click",{...e,type:"thumb-click"})}_emitThumbDragEvent(e){this.emit("thumb-drag",{...e,type:"thumb-drag"})}_emitSegmentClickEvent(e){this.emit("segment-click",{...e,type:"segment-click"})}_emitSegmentDragEvent(e){this.emit("segment-drag",{...e,type:"segment-drag"})}_emitRangeLabelClickEvent(e){this.emit(e.type,{...e})}};d([m()],k.prototype,"disabled",void 0),d([m()],k.prototype,"draggableSegmentsEnabled",void 0),d([m()],k.prototype,"effectiveMax",null),d([m()],k.prototype,"effectiveMin",null),d([m({readOnly:!0})],k.prototype,"effectiveSegmentElements",void 0),d([m()],k.prototype,"extraNodes",void 0),d([m()],k.prototype,"inputCreatedFunction",void 0),d([m()],k.prototype,"inputFormatFunction",null),d([m()],k.prototype,"inputParseFunction",null),d([m()],k.prototype,"label",null),d([m({readOnly:!0})],k.prototype,"labelElements",void 0),d([m()],k.prototype,"labelInputsEnabled",void 0),d([m()],k.prototype,"labelFormatFunction",null),d([m({readOnly:!0})],k.prototype,"labels",null),d([m({value:"horizontal"})],k.prototype,"layout",null),d([m()],k.prototype,"max",null),d([m({readOnly:!0})],k.prototype,"maxLabelElement",void 0),d([m(),qe("esri/widgets/Slider/t9n/Slider")],k.prototype,"messages",void 0),d([m()],k.prototype,"min",null),d([m({readOnly:!0})],k.prototype,"minLabelElement",void 0),d([m()],k.prototype,"precision",null),d([m()],k.prototype,"rangeLabelInputsEnabled",void 0),d([m({readOnly:!0})],k.prototype,"segmentElements",void 0),d([m()],k.prototype,"snapOnClickEnabled",void 0),d([m({readOnly:!0})],k.prototype,"state",null),d([m()],k.prototype,"steps",void 0),d([m()],k.prototype,"syncedSegmentsEnabled",void 0),d([m()],k.prototype,"thumbsConstrained",null),d([m()],k.prototype,"thumbCreatedFunction",void 0),d([m({readOnly:!0})],k.prototype,"thumbElements",void 0),d([m()],k.prototype,"tickConfigs",null),d([m({readOnly:!0})],k.prototype,"tickElements",void 0),d([m({readOnly:!0})],k.prototype,"trackElement",void 0),d([m()],k.prototype,"values",null),d([m()],k.prototype,"viewModel",void 0),d([m()],k.prototype,"visibleElements",void 0),d([In("visibleElements")],k.prototype,"castVisibleElements",null),k=d([ee(bs)],k);const xs=k,R="esri-time-slider",I={widgetIcon:"esri-icon-time-clock",esriWidget:"esri-widget",esriWidgetButton:"esri-widget--button",esriButtonDisabled:"esri-button--disabled",esriDisabled:"esri-disabled",timeSlider:`${R}`,timeSliderOutOfBounds:`${R}--out-of-bounds`,timeSliderMode:`${R}__mode--`,timeSliderLayout:`${R}__layout--`,timeSliderRow:`${R}__row`,animation:`${R}__animation`,animationButton:`${R}__animation-button`,animationPlay:"esri-icon-play",animationPause:"esri-icon-pause",timeExtent:`${R}__time-extent`,timeExtentGroup:`${R}__time-extent-group`,timeExtentDate:`${R}__time-extent-date`,timeExtentTime:`${R}__time-extent-time`,timeExtentSeparator:`${R}__time-extent-separator`,playbackControls:`${R}__playback-controls`,min:`${R}__min`,minDate:`${R}__min-date`,minTime:`${R}__min-time`,slider:`${R}__slider`,sliderMajorTick:"majorTick",sliderMinorTick:"minorTick",max:`${R}__max`,maxDate:`${R}__max-date`,maxTime:`${R}__max-time`,previous:`${R}__previous`,previousButton:`${R}__previous-button`,previousIcon:"esri-icon-reverse",next:`${R}__next`,nextButton:`${R}__next-button`,nextIcon:"esri-icon-forward",warning:`${R}__warning`,warningIcon:"esri-icon-notice-triangle",warningText:`${R}__warning-text`,hasActions:`${R}--has-actions`,actions:`${R}__actions`,actionsButton:`${R}__actions-button`},fi=1e4;function Bt(t){return f(t)&&t.count!==void 0}function st(t){return f(t)&&t.interval!==void 0}function gi(t){return f(t)&&t.dates!==void 0}function vi(t){return t.declaredClass==="esri.WebMap"}let Q=class extends ut(Qi.EventedAccessor){constructor(e){super(e),this._animationController=null,this._isViewTimeExtentInitialized=!1,this._timerId=null,this.actions=new fe,this.fullTimeExtent=null,this.loop=!1,this.mode="time-window",this.stops={count:10},this.timeExtent=null,this.view=null}initialize(){this.handles.add([re(()=>this.effectiveStops,()=>{T(this.timeExtent)&&(this.timeExtent=this._getDefaultTimeExtent())},Nt),re(()=>this.view,(e,i)=>{this._unregisterWidget(i),this._registerWidget(e)},$n),re(()=>this.timeExtent,e=>{if(T(this.view))return;const i=this.view.timeExtent;(T(e)||e.isAllTime)&&(T(i)||i.isAllTime)||f(e)&&f(i)&&e.equals(i)||(this.view.timeExtent=le(e))},Nt),re(()=>Te(this.view,e=>e.timeExtent),e=>{this._isViewTimeExtentInitialized?(T(e)||e.isAllTime)&&(T(this.timeExtent)||this.timeExtent.isAllTime)||f(e)&&f(this.timeExtent)&&e.equals(this.timeExtent)||(this.timeExtent=e):this._isViewTimeExtentInitialized=!0})])}destroy(){f(this._timerId)&&(clearInterval(this._timerId),this._timerId=null),this._unregisterWidget(this.view),this.view=null,f(this._animationController)&&(this._animationController.abort(),this._animationController=null)}get effectiveStops(){const{fullTimeExtent:e,stops:i}=this;if(gi(i)){const{dates:n}=i;if(n==null||n.length===0)return null;const s=n.sort((l,r)=>l.getTime()-r.getTime());if(T(e))return s;const{start:a,end:o}=e;return T(a)||T(o)?s:s.filter(l=>!(l.getTime()<a.getTime()||l.getTime()>o.getTime()))}if(Bt(i)){const n=i.timeExtent??le(e);return this._divideTimeExtentByCount(n,i.count)}if(st(i)){const n=i.timeExtent??le(e);return this._divideTimeExtentByInterval(n,i.interval)}return[]}set playRate(e){e<=0||e>36e5||(this.state==="playing"&&this._startAnimation(),this._set("playRate",e))}get state(){return T(this.fullTimeExtent)?"disabled":f(this._animationController)?"playing":"ready"}get timeExtentValues(){const{mode:e,timeExtent:i}=this;if(T(i)||i.isAllTime||i.isEmpty)return null;const{start:n,end:s}=i;switch(e){case"cumulative-from-end":case"instant":return f(n)?[n.getTime()]:null;case"cumulative-from-start":return f(s)?[s.getTime()]:null;case"time-window":return f(n)&&f(s)?[n.getTime(),s.getTime()]:null}}static async getPropertiesFromWebMap(e,i){var p;if(T(e)||!vi(e))return null;await e.load({signal:i});const n=(p=e==null?void 0:e.widgets)==null?void 0:p.timeSlider;if(!n)return null;const{getFullTimeExtentFromWebDocument:s,getModeFromTimeSlider:a,getStopsFromTimeSlider:o,getTimeExtentFromTimeSlider:l}=await ue(()=>import("./utils-3cfdc542.js"),["assets/utils-3cfdc542.js","assets/mapviewstore-8a6f290e.js","assets/index-93a23f67.js","assets/index-2d69a2d2.css"]),r=await s(e,i),u=n.loop,c=a(n);return{fullTimeExtent:r,loop:u,mode:c,playRate:n.stopDelay??2e3,stops:o(n),timeExtent:l(n,c)}}next(){this._step({forward:!0,allowRestart:!1})}play(){this._startAnimation()}previous(){this._step({forward:!1,allowRestart:!1})}stop(){this._stopAnimation()}triggerAction(e){this.emit("trigger-action",{action:e})}updateWebDocument(e){if(vi(e)){const i=new Tn({currentTimeExtent:this.timeExtent,fullTimeExtent:this.fullTimeExtent,loop:this.loop,numStops:Bt(this.stops)?this.stops.count:null,numThumbs:this.mode==="time-window"?2:1,stopDelay:this.playRate,stopInterval:st(this.stops)?this.stops.interval:null,stops:gi(this.stops)?this.stops.dates:null});e.widgets?e.widgets.timeSlider=i:e.widgets=new Vn({timeSlider:i})}}valuesToTimeExtent(e){if(T(e))return null;const i=e.sort((a,o)=>a-o).map(a=>new Date(a)),n=i.length>0?i[0]:null,s=i.length>1?i[1]:null;switch(this.mode){case"time-window":return new oe({start:n,end:s});case"instant":return new oe({start:n,end:n});case"cumulative-from-start":return new oe({start:null,end:n});case"cumulative-from-end":return new oe({start:n,end:null});default:return oe.allTime}}async _animate(){try{const e=this.view,i=Te(this._animationController,n=>n.signal);await Promise.all([Cn(this.playRate,null,i),f(e)&&qi(()=>e.updating===!1,i)])}catch(e){return Ot(e)||He.getLogger(this.declaredClass).error(e),void(this._animationController=null)}this._step({forward:!0,allowRestart:!1}),T(this._animationController)||this._animate()}_divideTimeExtentByCount(e,i=10){if(!e||!i)return[];const{start:n,end:s}=e;if(T(n)||T(s))return[];if(i>fi)return this._divideTimeExtentByCount(e);const a=[],o=n.getTime(),l=s.getTime()-o;for(let r=0;r<=i;r++)a.push(new Date(o+r/i*l));return a}_divideTimeExtentByInterval(e,i,n=fi){if(!e||!i)return[];const{start:s,end:a}=e;if(T(s)||T(a))return[];const o=a.getTime()-s.getTime(),l=i.toMilliseconds();if(l<=0||o/l>n)return this._divideTimeExtentByCount(e);const r=[],{value:u,unit:c}=i;let p=s;for(;p.getTime()<=a.getTime();)r.push(new Date(p.getTime())),p=Ki(p,u,c);return r}_getDefaultTimeExtent(){const{effectiveStops:e,mode:i}=this;if(T(e)||!i)return null;switch(i){case"time-window":return e.length>1?new oe({start:e[0],end:e[1]}):null;case"cumulative-from-start":return e.length>0?new oe({start:null,end:e[0]}):null;case"cumulative-from-end":return e.length>0?new oe({start:e[0],end:null}):null;case"instant":return e.length>0?new oe({start:e[0],end:e[0]}):null;default:return null}}_registerWidget(e){f(e)&&(e.persistableViewModels.includes(this)||e.persistableViewModels.add(this))}_startAnimation(){this._stopAnimation(),this._animationController=new AbortController,this._step({forward:!0,allowRestart:!0}),this._animate()}_step(e){const{forward:i,allowRestart:n}=e,{effectiveStops:s}=this;if(T(this.timeExtentValues)||T(s))return;const a=s.map(p=>p.getTime()),o=this.timeExtentValues.map(p=>{const h=a.indexOf(p);if(h!==-1)return h;const g=a.reduce((_,y)=>Math.abs(y-p)<Math.abs(_-p)?y:_);return a.indexOf(g)}),l=o.map(p=>p+(i?1:-1)),r=l.some(p=>p<0||p>a.length-1),{loop:u,state:c}=this;if(r)if(u||n){const p=Math.min(...o),h=Math.max(...o),g=(i?o.map(_=>_-p):o.map(_=>_+(a.length-1-h))).map(_=>a[_]);this.timeExtent=this.valuesToTimeExtent(g)}else c==="playing"&&this.stop();else{const p=l.map(h=>a[h]);this.timeExtent=this.valuesToTimeExtent(p)}}_stopAnimation(){f(this._animationController)&&(this._animationController.abort(),this._animationController=null)}_unregisterWidget(e){f(e)&&e.persistableViewModels.remove(this)}};d([m()],Q.prototype,"_animationController",void 0),d([m({type:fe})],Q.prototype,"actions",void 0),d([m({readOnly:!0})],Q.prototype,"effectiveStops",null),d([m({type:oe})],Q.prototype,"fullTimeExtent",void 0),d([m({nonNullable:!0})],Q.prototype,"loop",void 0),d([m({nonNullable:!0})],Q.prototype,"mode",void 0),d([m({nonNullable:!0,value:1e3})],Q.prototype,"playRate",null),d([m({readOnly:!0})],Q.prototype,"state",null),d([m({cast:t=>T(t)?null:(st(t)&&(t.interval=ii(F,t.interval)),(st(t)||Bt(t))&&(t.timeExtent=ii(oe,t.timeExtent)),t)})],Q.prototype,"stops",void 0),d([m({type:oe})],Q.prototype,"timeExtent",void 0),d([m({readOnly:!0})],Q.prototype,"timeExtentValues",null),d([m()],Q.prototype,"view",void 0),d([m()],Q.prototype,"next",null),d([m()],Q.prototype,"play",null),d([m()],Q.prototype,"previous",null),d([m()],Q.prototype,"stop",null),d([m()],Q.prototype,"updateWebDocument",null),Q=d([ee("esri.widgets.TimeSlider.TimeSliderViewModel")],Q);const Ht=Q,Es=3,ws=858,Fs=new fe([{minor:new F({value:100,unit:"milliseconds"}),major:new F({value:1,unit:"seconds"}),format:{second:"numeric"}},{minor:new F({value:500,unit:"milliseconds"}),major:new F({value:5,unit:"seconds"}),format:{second:"numeric"}},{minor:new F({value:1,unit:"seconds"}),major:new F({value:20,unit:"seconds"}),format:{minute:"numeric",second:"numeric"}},{minor:new F({value:2,unit:"seconds"}),major:new F({value:30,unit:"seconds"}),format:{minute:"numeric",second:"numeric"}},{minor:new F({value:10,unit:"seconds"}),major:new F({value:1,unit:"minutes"}),format:{minute:"numeric"}},{minor:new F({value:15,unit:"seconds"}),major:new F({value:5,unit:"minutes"}),format:{hour:"numeric",minute:"numeric"}},{minor:new F({value:1,unit:"minutes"}),major:new F({value:20,unit:"minutes"}),format:{hour:"numeric",minute:"numeric"}},{minor:new F({value:5,unit:"minutes"}),major:new F({value:2,unit:"hours"}),format:{hour:"numeric",minute:"numeric"}},{minor:new F({value:15,unit:"minutes"}),major:new F({value:6,unit:"hours"}),format:{hour:"numeric",minute:"numeric"}},{minor:new F({value:1,unit:"hours"}),major:new F({value:1,unit:"days"}),format:{day:"numeric",month:"short"}},{minor:new F({value:6,unit:"hours"}),major:new F({value:1,unit:"weeks"}),format:{day:"numeric",month:"short"}},{minor:new F({value:1,unit:"days"}),major:new F({value:1,unit:"months"}),format:{month:"long"}},{minor:new F({value:2,unit:"days"}),major:new F({value:1,unit:"months"}),format:{month:"short"}},{minor:new F({value:3,unit:"days"}),major:new F({value:1,unit:"months"}),format:{month:"short"}},{minor:new F({value:4,unit:"days"}),major:new F({value:3,unit:"months"}),format:{month:"short",year:"numeric"}},{minor:new F({value:1,unit:"weeks"}),major:new F({value:1,unit:"years"}),format:{year:"numeric"}},{minor:new F({value:1,unit:"months"}),major:new F({value:1,unit:"years"}),format:{year:"numeric"}},{minor:new F({value:2,unit:"months"}),major:new F({value:2,unit:"years"}),format:{year:"numeric"}},{minor:new F({value:1,unit:"years"}),major:new F({value:1,unit:"decades"}),format:{year:"numeric"}},{minor:new F({value:2,unit:"years"}),major:new F({value:5,unit:"decades"}),format:{year:"numeric"}},{minor:new F({value:5,unit:"decades"}),major:new F({value:10,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new F({value:1,unit:"centuries"}),major:new F({value:10,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new F({value:2,unit:"centuries"}),major:new F({value:20,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new F({value:5,unit:"centuries"}),major:new F({value:50,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new F({value:10,unit:"centuries"}),major:new F({value:100,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new F({value:20,unit:"centuries"}),major:new F({value:200,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new F({value:50,unit:"centuries"}),major:new F({value:500,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new F({value:100,unit:"centuries"}),major:new F({value:1e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new F({value:200,unit:"centuries"}),major:new F({value:1e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new F({value:500,unit:"centuries"}),major:new F({value:5e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new F({value:1e3,unit:"centuries"}),major:new F({value:1e4,unit:"centuries"}),format:{era:"short",year:"numeric"}}]);let G=class extends Yt{constructor(e,i){super(e,i),this._ignoreNextSliderUpdate=!1,this._slider=new xs({precision:0,visibleElements:{rangeLabels:!1},rangeLabelInputsEnabled:!1,thumbsConstrained:!1}),this._tickFormat=null,this.disabled=!1,this.iconClass=I.widgetIcon,this.labelFormatFunction=null,this.messages=null,this.messagesCommon=null,this.tickConfigs=null,this.timeVisible=!1,this.viewModel=new Ht}initialize(){this.addHandles([re(()=>this._slider.values,e=>{if(this._ignoreNextSliderUpdate)return void(this._ignoreNextSliderUpdate=!1);const i=this.viewModel.valuesToTimeExtent(e);f(this.timeExtent)?f(i)?this.timeExtent.equals(i)||(this.timeExtent=i):this.timeExtent=null:f(i)&&(this.timeExtent=i)}),re(()=>this.effectiveStops,()=>this._updateSliderSteps(),Nt)])}loadDependencies(){return Promise.all([ue(()=>import("./calcite-action-d683ce1d.js"),["assets/calcite-action-d683ce1d.js","assets/action-ad3f0c6e.js","assets/mapviewstore-8a6f290e.js","assets/index-93a23f67.js","assets/index-2d69a2d2.css","assets/guid-9426053f.js","assets/interactive-573cbe88.js","assets/loadable-25ad9e4e.js","assets/t9n-2a1e9a0c.js","assets/key-4e6b67a3.js","assets/observers-4f67f1fb.js","assets/icon-b51674d0.js","assets/loader-b5129b3f.js"]),ue(()=>import("./calcite-action-menu-07a308bd.js"),["assets/calcite-action-menu-07a308bd.js","assets/action-menu-44008ae9.js","assets/mapviewstore-8a6f290e.js","assets/index-93a23f67.js","assets/index-2d69a2d2.css","assets/guid-9426053f.js","assets/key-4e6b67a3.js","assets/loadable-25ad9e4e.js","assets/action-ad3f0c6e.js","assets/interactive-573cbe88.js","assets/t9n-2a1e9a0c.js","assets/observers-4f67f1fb.js","assets/icon-b51674d0.js","assets/loader-b5129b3f.js","assets/popover-ddaba2ad.js","assets/openCloseComponent-ada6c573.js","assets/debounce-31e0cfcc.js","assets/Heading-6f2abfee.js"])])}destroy(){this._slider.destroy(),this._tickFormat=null}get actions(){return this.viewModel.actions}set actions(e){this.viewModel.actions=e}get effectiveStops(){return this.viewModel.effectiveStops}get fullTimeExtent(){return this.viewModel.fullTimeExtent}set fullTimeExtent(e){this.viewModel.fullTimeExtent=e}get interactive(){var e;return!this.disabled&&((e=this.viewModel)==null?void 0:e.state)!=="disabled"}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){["auto","compact","wide"].includes(e)||(e="auto"),this._set("layout",e)}get loop(){return this.viewModel.loop}set loop(e){this.viewModel.loop=e}get mode(){return this.viewModel.mode}set mode(e){this.viewModel.mode=e}get playRate(){return this.viewModel.playRate}set playRate(e){this.viewModel.playRate=e}get stops(){return this.viewModel.stops}set stops(e){this.viewModel.stops=e}get timeExtent(){return this.viewModel.timeExtent}set timeExtent(e){this.viewModel.timeExtent=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}static async getPropertiesFromWebMap(e,i){return Ht.getPropertiesFromWebMap(e,i)}next(){return this.viewModel.next()}play(){return this.viewModel.play()}previous(){return this.viewModel.previous()}stop(){return this.viewModel.stop()}render(){var be;const{_slider:e,actions:i,domNode:n,effectiveStops:s,fullTimeExtent:a,interactive:o,messages:l,messagesCommon:r,mode:u,tickConfigs:c,timeExtent:p,timeVisible:h,viewModel:{state:g,timeExtentValues:_}}=this;if(f(a)){const{start:W,end:xe}=a;if(f(W)&&f(xe)){const Ve=W.getTime(),dt=xe.getTime(),Zt=e.min!==Ve||e.max!==dt;if(Zt&&(e.min=Ve,e.max=dt),f(c))e.tickConfigs!==c&&(e.tickConfigs=c);else{const rn=(dt-Ve)/(((be=e.trackElement)==null?void 0:be.offsetWidth)||400),Se=Fs.find(ct=>ct.minor.toMilliseconds()>Es*rn),ei=this._tickFormat!==Se&&Se!=null;if(ei&&(this._tickFormat=Se),Zt||ei){const ct={mode:"position",values:this._getTickPositions(Se.minor),labelsVisible:!1,tickCreatedFunction:(pt,mt)=>{mt.classList.add(I.sliderMinorTick)}},ln={mode:"position",values:this._getTickPositions(Se.major),labelsVisible:!0,tickCreatedFunction:(pt,mt)=>{mt.classList.add(I.sliderMajorTick)},labelFormatFunction:pt=>Et(pt,Se.format)};e.tickConfigs=[ct,ln]}}}}const y=T(this.fullTimeExtent)||T(this.timeExtent)||this.timeExtent.isAllTime||this.timeExtent.isEmpty||f(this.timeExtent.start)&&(this.timeExtent.start<this.fullTimeExtent.start||this.timeExtent.start>this.fullTimeExtent.end)||f(this.timeExtent.end)&&(this.timeExtent.end>this.fullTimeExtent.end||this.timeExtent.end<this.fullTimeExtent.start);if(y)switch(this._ignoreNextSliderUpdate=!0,u){case"time-window":e.values=[e.min,e.max];break;case"instant":case"cumulative-from-end":e.values=[e.min];break;case"cumulative-from-start":e.values=[e.max]}else f(_)?kn(e.values,_)||(e.values=_):e.values=null;e.disabled=!o;const b=g==="ready",E=g==="playing",w=y||!o||T(s)||s.length===0,V=this.layout==="auto"?n.clientWidth<ws?"compact":"wide":this.layout,v=x("div",{class:I.animation},x("button",{"aria-disabled":w?"true":"false","aria-label":E?r.control.stop:r.control.play,bind:this,class:this.classes(I.esriWidgetButton,I.animationButton,w&&I.esriButtonDisabled),disabled:w,title:E?r.control.stop:r.control.play,onclick:this._playOrStopClick,type:"button"},x("div",{class:this.classes((b||w)&&I.animationPlay,E&&I.animationPause)}))),O=f(this.labelFormatFunction)?x("div",{key:"extent",bind:this,class:I.timeExtentDate,"data-type":"extent","data-layout":V,"data-date":Te(p,W=>[W.start,W.end]),afterCreate:this._createLabel,afterUpdate:this._createLabel}):T(p)||f(p)&&p.isAllTime?[x("div",{class:this.classes(I.warning,I.warningIcon)}),x("div",{key:"warning-text",class:I.warningText},l.noTimeExtent)]:p.isEmpty?[x("div",{class:this.classes(I.warning,I.warningIcon)}),x("div",{key:"warning-text",class:I.warningText},l.emptyTimeExtent)]:[f(p.start)&&x("div",{key:"start-date-group",class:I.timeExtentGroup},x("div",{key:"start-date",class:I.timeExtentDate},this._formatDate(p.start)),h&&x("div",{key:"start-time",class:I.timeExtentTime},this._formatTime(p.start))),f(p.start)&&f(p.end)&&p.start.getTime()!==p.end.getTime()&&x("div",{key:"separator",class:I.timeExtentSeparator},"–"),f(p.end)&&(T(p.start)||p.start.getTime()!==p.end.getTime())&&x("div",{key:"end-date-group",class:I.timeExtentGroup},x("div",{key:"end-date",class:I.timeExtentDate},this._formatDate(p.end)),h&&x("div",{key:"end-time",class:I.timeExtentTime},this._formatTime(p.end)))],S=x("div",{class:this.classes(I.timeExtent,!o&&I.esriButtonDisabled)},[O]),D=f(this.labelFormatFunction)?x("div",{key:"min-date",bind:this,class:I.minDate,"data-date":Te(a,W=>W.start),"data-type":"min","data-layout":V,afterCreate:this._createLabel,afterUpdate:this._createLabel}):f(a)&&f(a.start)&&[x("div",{key:"min-date",class:I.minDate},this._formatDate(a.start)),h&&x("div",{key:"min-time",class:I.minTime},this._formatTime(a.start))],H=x("div",{class:this.classes(I.min,!o&&I.esriButtonDisabled)},[D]),X=x("div",{class:I.slider},e.render()),q=f(this.labelFormatFunction)?x("div",{key:"max-date",bind:this,class:I.maxDate,"data-date":Te(a,W=>W.end),"data-type":"max","data-layout":V,afterCreate:this._createLabel,afterUpdate:this._createLabel}):f(a)&&f(a.end)&&[x("div",{key:"max-date",class:I.maxDate},this._formatDate(a.end)),h&&x("div",{key:"max-time",class:I.maxTime},this._formatTime(a.end))],J=x("div",{class:this.classes(I.max,!o&&I.esriButtonDisabled)},[q]),K=x("div",{class:I.previous},x("button",{"aria-disabled":w?"true":"false","aria-label":r.pagination.previous,bind:this,class:this.classes(I.esriWidgetButton,I.previousButton,(E||w)&&I.esriButtonDisabled),disabled:w,title:r.pagination.previous,onclick:this._previousClick,type:"button"},x("div",{class:I.previousIcon}))),ye=x("div",{class:I.next},x("button",{"aria-disabled":w?"true":"false","aria-label":r.pagination.next,bind:this,class:this.classes(I.esriWidgetButton,I.nextButton,(E||w)&&I.esriButtonDisabled),disabled:w,title:r.pagination.next,onclick:this._nextClick,type:"button"},x("div",{class:I.nextIcon}))),P=(i==null?void 0:i.length)>0,_e=P&&x("div",{class:I.actions,title:r.options},x("calcite-action-menu",{label:r.options,class:I.actionsButton},i.toArray().map(W=>x("calcite-action",{bind:this,icon:W.icon,id:W.id,onclick:()=>this.viewModel.triggerAction(W),text:W.title,textEnabled:!0}))));return x("div",{class:this.classes(I.timeSlider,I.esriWidget,`${I.timeSliderMode}${u}`,`${I.timeSliderLayout}${V}`,!o&&I.esriDisabled,y&&I.timeSliderOutOfBounds,P&&I.hasActions,Sn()),afterCreate:W=>{this.addHandles(Wi(W,()=>this.scheduleRender()))},"aria-label":l.widgetLabel},V==="wide"&&x("div",{class:I.timeSliderRow},x("div",{class:I.playbackControls},[v,S,H,X,J,K,ye]),_e),V==="compact"&&[x("div",{key:"time-slider-row-1",class:I.timeSliderRow},[S,_e]),x("div",{key:"time-slider-row-2",class:I.timeSliderRow},[X]),x("div",{key:"time-slider-row-3",class:I.timeSliderRow},[H,K,v,ye,J])])}updateWebDocument(e){var i;(i=this.viewModel)==null||i.updateWebDocument(e)}_createLabel(e){if(T(this.labelFormatFunction))return;const i=e.getAttribute("data-type"),n=e.getAttribute("data-layout"),s=e["data-date"];this.labelFormatFunction(s,i,e,n)}_getTickPositions(e){const{fullTimeExtent:i}=this;if(T(i)||T(i.start)||T(i.end))return[];const{start:n,end:s}=i,a=[],{value:o,unit:l}=e;let r=An(n,l);for(;r.getTime()<=s.getTime();)r.getTime()>=n.getTime()&&a.push(r.getTime()),r=Ki(r,o,l);return a}_formatDate(e){return e?Et(e,ni("short-date")):null}_formatTime(e){return e?Et(e,ni("long-time")):null}_updateSliderSteps(){this._slider.steps=f(this.effectiveStops)&&this.effectiveStops.length>0?this.effectiveStops.map(e=>e.getTime()):null}_playOrStopClick(){switch(this.viewModel.state){case"ready":this.viewModel.play();break;case"playing":this.viewModel.stop();break;case"disabled":break;default:Yi(this.viewModel.state)}}_previousClick(){this.viewModel.previous()}_nextClick(){this.viewModel.next()}};d([m()],G.prototype,"actions",null),d([m()],G.prototype,"disabled",void 0),d([m()],G.prototype,"effectiveStops",null),d([m()],G.prototype,"fullTimeExtent",null),d([m()],G.prototype,"iconClass",void 0),d([m({readOnly:!0})],G.prototype,"interactive",null),d([m()],G.prototype,"label",null),d([m()],G.prototype,"labelFormatFunction",void 0),d([m({value:"auto"})],G.prototype,"layout",null),d([m()],G.prototype,"loop",null),d([m(),qe("esri/widgets/TimeSlider/t9n/TimeSlider")],G.prototype,"messages",void 0),d([m(),qe("esri/t9n/common")],G.prototype,"messagesCommon",void 0),d([m()],G.prototype,"mode",null),d([m()],G.prototype,"playRate",null),d([m()],G.prototype,"stops",null),d([m()],G.prototype,"tickConfigs",void 0),d([m()],G.prototype,"timeExtent",null),d([m({nonNullable:!0})],G.prototype,"timeVisible",void 0),d([m()],G.prototype,"view",null),d([m({type:Ht}),Ji("trigger-action")],G.prototype,"viewModel",void 0),d([xt()],G.prototype,"_playOrStopClick",null),d([xt()],G.prototype,"_previousClick",null),d([xt()],G.prototype,"_nextClick",null),G=d([ee("esri.widgets.TimeSlider")],G);const Is=G;function Ts(t,e,i,n,s){const a=new Is({container:n,view:s,fullTimeExtent:{start:t,end:e},timeExtent:{start:i,end:i},timeVisible:!0,loop:!0,stops:{interval:{unit:"days",value:1}},mode:"instant",layout:"compact"});return a.visible=!1,a}const nn=Qe("timerslider",()=>{const t=ve().getView();let e=z(null);function i(n){const s=Ke(),a=s.year,o=s.month,l=s.day,r=new Date(a.value,o.value-1,l.value-4),u=new Date(a.value,o.value-1,l.value),c=new Date(a.value,o.value-1,l.value);n&&(e.value=Ts(r,u,c,n.value,t))}return{createTimeslider:i,timeSlider:e}}),it=Ke();function Vs(){let t=[],e=new Date(it.year.value,it.month.value-1,it.day.value).getTime(),i=24*60*60*1e3;for(let n=0;n<5;n++){let s=new Date(e+(n-3)*i),a=s.getMonth()+1,o=s.getDate(),l=a+"-"+o;t.push(l)}return t}const Cs={color:["#ed3f35","#00f2f1","#f7b851"],title:{text:it.nowTime.value,textStyle:{color:"#fff"}},tooltip:{trigger:"axis",axisPointer:{lineStyle:{color:"#ccc",width:1,type:"solid"}},backgroundColor:"#115687",borderColor:"#ccc",borderWidth:1,padding:[5,10],textStyle:{color:"#fff",fontSize:12},extraCssText:"box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);max-width: 200px; max-height: 90px;",formatter:function(t){let e='<div style="font-size: 16px; font-weight: bold;height: 30px; ">'+t[0].name+"</div>";return t.forEach(function(i){let n="";i.seriesIndex===0||i.seriesIndex===1?n="°C":n="%",e+='<span style="display: inline-block; width: 10px; height: 10px; margin-right: 5px;font-size: 14px; border-radius: 50%; background-color: '+i.color+';"></span>'+i.seriesName+"："+i.value+n+"<br>"}),e}},legend:{textStyle:{color:"#4c9bfd"},right:"3%"},grid:{top:"20%",left:"3%",right:"4%",bottom:"3%",show:!0,borderColor:"#012f4a",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:Vs(),axisTick:{show:!1},axisLabel:{color:"#4c9bfd"},axisLine:{show:!1}},yAxis:{type:"value",axisLabel:{color:"#4c9bfd"},splitLine:{lineStyle:{color:"#012f4a"}}},series:[{name:"最高温度",type:"line",smooth:!0,data:[]},{name:"最低温度",type:"line",smooth:!0,data:[]},{name:"湿度",type:"line",smooth:!0,data:[]}]},$t=Ke();function $s(){let t=[],e=new Date($t.year.value,$t.month.value-1,$t.day.value).getTime(),i=24*60*60*1e3;for(let n=0;n<5;n++){let s=new Date(e+(n-4)*i),a=s.getMonth()+1,o=s.getDate(),l=a+"-"+o;t.push(l)}return t}const ks={grid:{top:"12%",left:"15%",bottom:"10%"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},backgroundColor:"#115687",borderColor:"#ccc",borderWidth:1,padding:[5,10],textStyle:{color:"#fff",fontSize:12},extraCssText:"box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);max-width: 200px; max-height: 110px;",formatter:function(t){let e='<div style="font-size: 16px; font-weight: bold;height: 30px; ">'+t[0].name+"</div>";return t.forEach(function(i){e+='<span style="display: inline-block; width: 10px; height: 10px; margin-right: 5px;font-size: 14px; border-radius: 50%; background-color: '+i.color+';"></span>'+i.seriesName+"："+i.value+"<br>"}),e}},xAxis:{type:"category",data:$s(),axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:"#4c9bfd"}},legend:{data:["pH值","溶解氧","高锰酸盐指数","总氮"],textStyle:{color:"#4c9bfd"}},yAxis:{type:"value",axisLabel:{color:"#4c9bfd"}},toolbox:{show:!0,orient:"vertical",left:"right",top:"center",showTitle:!1,feature:{magicType:{show:!0,type:["line","bar"]}},iconStyle:{color:"#4c9bfd",borderColor:"#4c9bfd"}},series:[{name:"pH值",type:"bar",data:[],itemStyle:{borderRadius:20}},{name:"溶解氧",type:"bar",data:[],itemStyle:{borderRadius:20}},{name:"高锰酸盐指数",type:"bar",data:[],itemStyle:{borderRadius:20}},{name:"总氮",type:"bar",data:[],itemStyle:{borderRadius:20}}]},kt=Ke();function Ss(){let t=[],e=new Date(kt.year.value,kt.month.value-1,kt.day.value).getTime(),i=24*60*60*1e3;for(let n=0;n<5;n++){let s=new Date(e+(n-4)*i),a=s.getMonth()+1,o=s.getDate(),l=a+"-"+o;t.push(l)}return t}const We={baseOption:{toolbox:{show:!0,orient:"vertical",left:"10",top:"-10",feature:{},itemSize:25},animation:!0,timeline:{data:[],axisType:"category",orient:"vertical",left:"15%",top:"center",width:"15%",height:"200px",autoPlay:!0,playInterval:1500,label:{fontSize:12,color:"#4c9bfd"},tooltip:{show:!1}},tooltip:{trigger:"axis"},radar:{indicator:[{name:"PM10",max:100,color:"#4c9bfd"},{name:"PM2.5",max:50,color:"#4c9bfd"},{name:"CO",max:1,color:"#4c9bfd"},{name:"SO₂",max:50,color:"#4c9bfd"},{name:"NO₂",max:50,color:"#4c9bfd"}],center:["70%","50%"]},series:{name:"污染指数",type:"radar",data:[]}},options:[]},Oe=Ss(),yi={[Oe[0]]:[],[Oe[1]]:[],[Oe[2]]:[],[Oe[3]]:[],[Oe[4]]:[]};var Ni;const _i=(Ni=We.baseOption)==null?void 0:Ni.radar;var ji,Ui,Gi,Bi;for(let t in yi){let e=yi[t];console.log(t);let i={series:{data:[{value:e,name:t,itemStyle:{color:"#17e3f5"}}]},tooltip:{trigger:"item",backgroundColor:"#115687",borderColor:"#ccc",borderWidth:1,padding:[5,10],textStyle:{color:"#fff",fontSize:12},extraCssText:"box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);max-width: 200px; max-height: 130px;",formatter:function(n){let s='<div style="font-size: 18px; font-weight: bold;height: 30px; ">'+n.name+"</div>";if(_i.indicator)for(let a=0;a<n.value.length;a++)s+='<span style="display: inline-block; width: 10px; height: 10px; margin-right: 5px;font-size: 18px; border-radius: 50%; background-color: '+n.color+';"></span>'+_i.indicator[a].name+"："+n.value[a]+"<br>";return s}}};(ji=We.options)==null||ji.push(i),(Bi=(Gi=(Ui=We.baseOption)==null?void 0:Ui.timeline)==null?void 0:Gi.data)==null||Bi.push(t)}const Re=t=>(dn("data-v-768222c0"),t=t(),cn(),t),As={class:"envirment-panel line"},Ms=Re(()=>N("div",{class:"envirment-panel-title"},[N("span",null,"湿度温度监测")],-1)),Ls=Re(()=>N("div",{class:"envirment-panel-footer"},null,-1)),Ds={class:"envirment-panel bar"},Ps=Re(()=>N("div",{class:"envirment-panel-title"},[N("span",null,"空气污染指数")],-1)),Rs=Re(()=>N("div",{class:"envirment-panel-footer"},null,-1)),Os={class:"envirment-panel pie"},Ns=Re(()=>N("div",{class:"envirment-panel-title"},[N("span",null,"景点水质监测")],-1)),js=Re(()=>N("div",{class:"envirment-panel-footer"},null,-1)),Us=rt({__name:"environment",setup(t){const e=ys(),i=nn(),n=ds(),s=z(null),a=z(null),o=z(null),l=z(null),r=z(null),u=un(i.timeSlider);return lt(()=>{var b;const c=De("percentage"),p=De("isActive"),h=De("flag2");c.value=0,p.value=!1,n.createOnlayer();let g=null,_=null,y=null;o.value&&(g=wt(o.value),Tt(g,Cs),n.setChartLine(g)),l.value&&(_=wt(l.value),((b=We.baseOption)==null?void 0:b.toolbox).feature={myTool1:{show:!0,title:"AQI热力图",icon:"image://https://img.icons8.com/color/48/000000/fire-element.png",onclick:function(){e.createTimeHeatmap(a.value,c,p,h),h.value===!1&&(e.isHeatmapLoaded()?(e.toggleHeatmap(),u.visible=!u.visible,u.playRate=3e3):alert("请先创建热力图"))}}},Tt(_,We),n.setChartRadar(_)),r.value&&(y=wt(r.value),Tt(y,ks),n.setChartBar(y))}),Wt(()=>{n.destroyOnlayer(),u.visible=!1,e.cancelTimeHeatmap()}),(c,p)=>(de(),Be(Hi,null,[N("div",{class:"envirment",ref_key:"envirmentRef",ref:s},[N("div",As,[Ms,N("div",{class:"envirment-panel-chart",ref_key:"chartLineRef",ref:o},null,512),Ls]),N("div",Ds,[Ps,N("div",{class:"envirment-panel-chart",ref_key:"chartRadarRef",ref:l},null,512),Rs]),N("div",Os,[Ns,N("div",{class:"envirment-panel-chart",ref_key:"chartBarRef",ref:r},null,512),js])],512),N("div",{class:"lengend",ref_key:"lengendRef",ref:a},null,512)],64))}});const Gs=pn(Us,[["__scopeId","data-v-768222c0"]]),Bs=`@charset "UTF-8";.classification-card{display:flex;flex-direction:column;position:fixed;right:0%;top:10%;width:30%;height:auto;border-radius:6px;background-image:linear-gradient(-90deg,#182940 0%,#115687 100%);pointer-events:auto;border:0px solid var(--el-card-border-color)}.classification-card__header{display:flex;justify-content:space-between;align-items:center;color:#fff;font-size:1.6rem;font-weight:700;font-style:italic}.classification-params{height:40%}.classification-slider-demo{display:flex;align-items:center}.classification-slider-tooltip,.classification-tooltip-popper,.classification-legend{height:auto}.el-table{--el-table-border-color: var(--el-border-color-lighter);--el-table-border: 1px solid var(--el-table-border-color);--el-table-text-color: #fff;--el-table-header-text-color: #fff;--el-table-row-hover-bg-color: #115687;--el-table-current-row-bg-color: var(--el-color-primary-light-9);--el-table-header-bg-color: #115687;--el-table-fixed-box-shadow: var(--el-box-shadow-light);--el-table-bg-color: #fff;--el-table-tr-bg-color: #ffffff00;--el-table-expanded-cell-bg-color: var(--el-fill-color-blank);--el-table-fixed-left-column: inset 10px 0 10px -10px rgba(0, 0, 0, .15);--el-table-fixed-right-column: inset -10px 0 10px -10px rgba(0, 0, 0, .15)}.el-table__body-wrapper tr td.el-table-fixed-column--right,.el-table__body-wrapper tr td.el-table-fixed-column--left{background-color:#115687}.el-input__wrapper{background-color:#fff0}.el-input__inner{color:#fff}.el-button.is-link{color:#28c3e2}.el-progress__text{height:auto;color:#fff}
`,Hs=Qe("Autoupdata",()=>{const t=hs().getView(),e={AQI:"aqi",ph值:"ph",溶解氧:"dissolvedoxygen",高锰酸盐指数:"permanganateindex",总氮:"totalnitrogen",湿度:"humidity"};let i={aqi:[20,40],ph:[7,9],dissolvedoxygen:[6,8],permanganateindex:[2,5],totalnitrogen:[0,1],mintemp:18,humidity:[45,55],maxtemp:23};const n=[i],s=["环境优美","环境良好","环境一般","环境较差","环境脏乱"];function a(u){const c=[[0,255,0,.5],[0,180,0,.8],[0,80,210,.8],[255,255,0,.8],[255,0,0,.8]],p=["#17f5a7","#1F7A44","#1A6EA5","#A59825","#7F1A1C"],h=[];for(let y=0;y<5;y++){const b=new si({style:"path",path:"M18.3,8.7c0,0-1.7-2.2-8.3-4.4S1.7,8.7,1.7,8.7S6,14.3,10,18c4-3.7,8.3-9.3,8.3-9.3",color:c[y],outline:{color:p[y],width:2},size:7});h.push(b)}const g=new Ln({field:"class",uniqueValueInfos:[{value:"环境优美",symbol:h[0]},{value:"环境良好",symbol:h[1]},{value:"环境一般",symbol:h[2]},{value:"环境较差",symbol:h[3]},{value:"环境恶劣",symbol:h[4]}]});u.renderer=g;const _=new jt({title:"{name}",content:[{type:"fields",fieldInfos:[{fieldName:"aqi",label:"AQI"},{fieldName:"ph",label:"ph值"},{fieldName:"dissolvedoxygen",label:"溶解氧"},{fieldName:"permanganate",label:"高锰酸盐指数"},{fieldName:"totalnitrogen",label:"总氮"},{fieldName:"humidity",label:"湿度"},{fieldName:"maxtemp",label:"最高气温"},{fieldName:"class",label:"景点评价"}]}]});u.popupTemplate=_}async function o(u,c,p,h){const g=t.map.findLayerById("points"),_=g.createQuery();_.where="1=1",h.value===0&&(await g.queryFeatures(_).then(({features:y})=>{c.value=!0,u.value=0;let b=0;setTimeout(()=>{c.value=!1},2e4),y.forEach(async E=>{const V=E.geometry,v={location:`${V.longitude},${V.latitude}`},O=E.attributes.city,S=cs[O];let D="",H="";if(S){const q=Object.keys(S),J=Math.floor(Math.random()*q.length);H=q[J],D=S[H].行政区划}const X={areaCode:D,name:H,date:""};await Gt.post("http://47.108.76.144:9000/quality/water",X).then(q=>{let J={},K=`name='${E.attributes.name}'`;for(let P in q.data)if(P==="ph"||P==="dissolvedoxygen"||P==="permanganateindex"||P==="totalnitrogen"){if(q.data[P]===null){b++,u.value=Math.floor(b/(y.length*8)*100),b===y.length*8&&setTimeout(()=>{c.value=!1},600);return}console.log(q.data[P]),J[P.toLowerCase()]=q.data[P].toString(),b++,u.value=Math.floor(b/(y.length*8)*100),b===y.length*8&&setTimeout(()=>{c.value=!1},600)}Ct(g,{where:K,attributeUpdates:J})}),await Gt.post("http://47.108.76.144:9000/quality/now",v).then(q=>{let J={},K=`name='${E.attributes.name}'`;for(let P in q.data)(P==="tempMax"||P==="aqi"||P==="humidity"||P==="date")&&(J[P.toLocaleLowerCase()]=q.data[P].toString(),P==="tempMax"&&(J.maxtemp=q.data[P].toString()),P==="date"&&(J.pointstime=q.data[P]),b++,u.value=Math.floor(b/(y.length*8)*100),b===y.length*8&&setTimeout(()=>{c.value=!1},600));Ct(g,{where:K,attributeUpdates:J})})})}),h.value++),new tn({container:p,view:t,layerInfos:[{layer:g,title:"景点图例"}]})}async function l(u,c){if(i=n[n.length-1],u.name)if(u.name==="气温")i.mintemp=u.Value[0],i.maxtemp=u.Value[1];else{const _=e[u.name];i[_]=u.Value}n.push(i);const p=e[c],h=t.map.findLayerById("points"),g=h.createQuery();g.where="1=1",await h.queryFeatures(g).then(({features:_})=>{_.forEach(y=>{let b=0;for(const v in y.attributes)v==="maxtemp"?(y.attributes[v]>i[v]||y.attributes[v]<i.mintemp)&&b++:v==="aqi"||v==="humidity"?(y.attributes[v]<i[v][0]||y.attributes[v]>i[v][1])&&b++:v===p&&(y.attributes[v]<i[v][0]||y.attributes[v]>i[v][1])&&b++;console.log(y.attributes.name,b);const E=`name='${y.attributes.name}'`,w={class:s[b]};Ct(h,{where:E,attributeUpdates:w})}),a(h)})}function r(){const u=t.map.findLayerById("points"),c=new jt({title:"{名称}",content:[{type:"fields",fieldInfos:[{fieldName:"名称",label:"名称"},{fieldName:"类型名称",label:"类型名称"},{fieldName:"longitude",label:"经度"},{fieldName:"latitude",label:"纬度"},{fieldName:"高程",label:"高程"}]}]});u.popupTemplate=c;const p=new si({style:"path",path:"M18.3,8.7c0,0-1.7-2.2-8.3-4.4S1.7,8.7,1.7,8.7S6,14.3,10,18c4-3.7,8.3-9.3,8.3-9.3",color:"#17e3f5",outline:{color:"#115687",width:2},size:7}),h=new Mn({label:"景点",symbol:p});u.renderer=h}return{Uplayerdata:o,classifyAnalysis:l,cancelrender:r}}),zs={class:"box-card__header"},qs=N("span",null,"模糊分类参数设置",-1),Ws={class:"classification-params"},Qs={key:0},Ks={key:1},Js=N("div",{style:{height:"20px"}},null,-1),Ys=rt({__name:"classification",setup(t){const{Uplayerdata:e,classifyAnalysis:i,cancelrender:n}=Hs(),s=De("watchV2"),a=De("count"),o=z(null),l=z(0),r=z(!1),u=[{color:"#f56c6c",percentage:20},{color:"#e6a23c",percentage:40},{color:"#5cb87a",percentage:60},{color:"#1989fa",percentage:80},{color:"#115687 ",percentage:100}],c=[{name:"气温",sliderValue:[18,23],sliderSettings:{min:18,max:25},isSelect:!1,selectValue:""},{name:"湿度",sliderValue:[45,55],sliderSettings:{min:40,max:60},isSelect:!1,selectValue:""},{name:"AQI",sliderValue:[20,40],sliderSettings:{min:0,max:50},isSelect:!1,selectValue:""},{name:"ph值",sliderValue:[7,9],sliderSettings:{min:6,max:9},isSelect:!0,selectValue:"1"}],p=(v,O)=>{switch(O){case"气温":return v.toFixed(2)+" °C";case"湿度":return v.toFixed(2)+"%";case"AQI":return v.toFixed(2);case"ph值":return v.toFixed(2);case"溶解氧":return v.toFixed(2)+"mg/L";case"高锰酸盐指数":return v.toFixed(2)+"mg/L";case"总氮":return v.toFixed(2)+"mg/L";default:return""}};function h(v){switch(v){case"1":return{min:6,max:9,sliderValue:[7,9],name:"ph值"};case"2":return{min:5,max:9,sliderValue:[6,8],name:"溶解氧"};case"3":return{min:0,max:5,sliderValue:[2,5],name:"高锰酸盐指数"};default:return{min:0,max:1,sliderValue:[0,1],name:"总氮"}}}let g="ph值";const _=v=>{if(console.log(v),v.isSelect){const{min:O,max:S,sliderValue:D,name:H}=h(v.selectValue);v.name=H,v.sliderSettings.min=O,v.sliderSettings.max=S,v.sliderValue=D,g=v.name}s.value=!1};function y(v){switch(v.name){case"气温":return`当前${v.name}的取值为${v.sliderValue[0]}~${v.sliderValue[1]}°C、
        取值范围为${v.sliderSettings.min}~${v.sliderSettings.max}°C`;case"湿度":return`当前${v.name}的取值为${v.sliderValue[0]}~${v.sliderValue[1]}%、
        取值范围为${v.sliderSettings.min}~${v.sliderSettings.max}%`;case"AQI":return`当前${v.name}的取值为${v.sliderValue[0]}~${v.sliderValue[1]}、
        取值范围为${v.sliderSettings.min}~${v.sliderSettings.max}`;case"水质":return`当前${v.name}的默认值为ph值，当前${v.name}的取值为${v.sliderValue[0]}~${v.sliderValue[1]}、
        取值范围为${v.sliderSettings.min}~${v.sliderSettings.max}`;case"ph值":return`当前${v.name}的取值为${v.sliderValue[0]}~${v.sliderValue[1]}、
        取值范围为${v.sliderSettings.min}~${v.sliderSettings.max}`;case"溶解氧":return`当前${v.name}的取值为${v.sliderValue[0]}~${v.sliderValue[1]}mg/L、
        取值范围为${v.sliderSettings.min}~${v.sliderSettings.max}mg/L`;case"高锰酸盐指数":return`当前${v.name}的取值为${v.sliderValue[0]}~${v.sliderValue[1]}mg/L、
        取值范围为${v.sliderSettings.min}~${v.sliderSettings.max}mg/L`;case"总氮":return`当前${v.name}的取值为${v.sliderValue[0]}~${v.sliderValue[1]}mg/L、
        取值范围为${v.sliderSettings.min}~${v.sliderSettings.max}mg/L`;default:return""}}const b={name:"",Value:[0,0]};function E(v,O){b.name=v.name,b.Value=O,console.log(b),s.value=!1}lt(()=>{e(l,r,o.value,a)}),Wt(()=>{n(),s.value=!0});function w(){i(b,g),s.value=!1}const V=document.createElement("style");return V.setAttribute("lang","scss"),V.innerHTML=Bs,document.head.appendChild(V),(v,O)=>(de(),Be(Hi,null,[r.value?(de(),Le(M(zi),{key:0,type:"dashboard","stroke-width":20,percentage:l.value,color:u,style:{position:"absolute",left:"30%",top:"20%","pointer-events":"auto",height:"auto"}},null,8,["percentage"])):je("",!0),U(M(Qt),{class:"classification-card",ref:"classificationRef"},{header:B(()=>[N("div",zs,[qs,U(M(Pt),{class:"button",text:"",style:{color:"#28c3e2","font-size":"18px","font-weight":"bold","font-style":"italic"},onClick:w},{default:B(()=>[Pe("执行分析 ")]),_:1})])]),default:B(()=>[N("div",Ws,[U(M(mn),{data:c,border:!0,style:{width:"100%","background-image":"linear-gradient(-90deg, #182940 0%, #115687 100%)"}},{default:B(()=>[U(M(ht),{prop:"name",label:"参数",width:"120"},{default:B(({row:S})=>[S.isSelect?(de(),Be("div",Qs,[U(M(hn),{modelValue:S.selectValue,"onUpdate:modelValue":D=>S.selectValue=D,placeholder:"请选择",onChange:D=>_(S)},{default:B(()=>[U(M(Je),{label:"ph值",value:"1"}),U(M(Je),{label:"溶解氧",value:"2"}),U(M(Je),{label:"高锰酸盐指数",value:"3"}),U(M(Je),{label:"总氮",value:"4"})]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])):(de(),Be("span",Ks,fn(S.name),1))]),_:1}),U(M(ht),{prop:"sliderSettings",label:"设置范围",width:"330"},{default:B(({row:S})=>[U(M(gn),{modelValue:S.sliderValue,"onUpdate:modelValue":D=>S.sliderValue=D,range:"",min:S.sliderSettings.min,max:S.sliderSettings.max,"tooltip-class":"classification-slider-tooltip","format-tooltip":D=>p(D,S.name),onChange:D=>E(S,D)},null,8,["modelValue","onUpdate:modelValue","min","max","format-tooltip","onChange"])]),_:1}),U(M(ht),{fixed:"right",label:"提示",width:"100"},{default:B(({row:S})=>[U(M(vn),{class:"item",effect:"dark",content:y(S),"popper-class":"classification-tooltip-popper"},{default:B(()=>[U(M(Pt),{link:"",type:"primary",size:"small"},{default:B(()=>[Pe("Detail")]),_:1})]),_:2},1032,["content"])]),_:1})]),_:1})]),Js,N("div",{class:"classification-legend",ref_key:"IlengendRef",ref:o},null,512)]),_:1},512)],64))}}),ge="esri-feature-form",tt=`${ge}__date`,ce=`${ge}__group`,ae=`${ge}__input`,A={base:ge,form:`${ge}__form`,formHeader:`${ge}__form-header`,label:`${ge}__label`,inputFieldWrapper:`${ae}-wrapper`,inputFieldLoader:`${ae}-loader`,inputField:`${ae}`,inputDate:`${ae}--date`,inputTime:`${ae}--time`,inputRadioGroup:`${ae}--radio-group`,inputRadio:`${ae}--radio`,inputRadioLabel:`${ae}--radio-label`,inputDisabled:`${ae}--disabled`,inputSwitch:`${ae}--switch`,inputInvalid:`${ae}--invalid`,inputIconInvalid:`${ae}-icon--invalid`,errorMessage:`${ge}__field-error-message`,description:`${ge}__description-text`,dateInputPart:`${tt}-input-part`,loneDateInputPart:`${tt}-input-part--lone`,dateInputContainer:`${tt}-input-container`,dateFormatHint:`${tt}-format-hint`,group:ce,groupLabel:`${ce}-label`,groupHeader:`${ce}-header`,groupHeading:`${ce}-header`,groupTitle:`${ce}-title`,groupDescription:`${ce}-description`,groupToggleIcon:`${ce}-toggle-icon`,groupCollapsed:`${ce}--collapsed`,groupSequential:`${ce}--sequential`,groupActive:`${ce}--active`,collapseIcon:"esri-icon-up",errorIcon:"esri-icon-notice-triangle",expandIcon:"esri-icon-down",widget:"esri-widget",panel:"esri-widget--panel",input:"esri-input",select:"esri-select"},Ie=t=>!!t.inputFields,me=(t,e)=>{var i;return f(t)&&((i=t.input)==null?void 0:i.type)===e},bi={typeFieldName:null,types:[]};function xi(t,e,i){const n=Object.keys(e).filter(o=>Ut(t,o)),s=n.map(o=>e[o]),a=n.map(o=>i.get(o)).filter(f);return Zs(t,Xs(s,a))}function Xs(t,e){const i=e.map((n,s)=>{let a=t[s];if(n.domain&&n.domain.type==="coded-value"){const o=n.domain.codedValues.find(l=>l.code===a);o!=null&&o.name&&(a=o.name)}return[n.name,a]});return Object.fromEntries(i)}function Zs(t,e){return ai(ai(t,i=>`{${i.toLowerCase()}}`),Object.fromEntries(Object.entries(e).map(([i,n])=>[i.toLowerCase(),n])))}const zt=t=>{var e,i;return t?t.type==="subtype-sublayer"?{typeFieldName:(e=t.parent)==null?void 0:e.subtypeField,types:(i=t.parent)==null?void 0:i.subtypes}:"types"in t&&t.types?{typeFieldName:t.typeIdField,types:t.types.map(({id:n,name:s,domains:a})=>({code:n,name:s,domains:a}))}:bi:bi};let Ce=class extends pe{constructor(e){super(e),this.maxValue=null,this.minValue=null,this.codedValue=null}};d([m()],Ce.prototype,"objectType",void 0),d([m()],Ce.prototype,"maxValue",void 0),d([m()],Ce.prototype,"minValue",void 0),d([m()],Ce.prototype,"codedValue",void 0),Ce=d([ee("esri.layers.support.ContingentValue")],Ce);const Y=Ce;let $e=class extends pe{constructor(e){super(e),this.isRetired=!1}};d([m()],$e.prototype,"id",void 0),d([m()],$e.prototype,"isRetired",void 0),d([m()],$e.prototype,"subtype",void 0),d([m()],$e.prototype,"values",void 0),$e=d([ee("esri.layers.support.Contingency")],$e);const Ei=$e;let Ue=class extends pe{constructor(e){super(e)}};d([m()],Ue.prototype,"fieldGroup",void 0),d([m()],Ue.prototype,"type",void 0),Ue=d([ee("esri.layers.support.ContingencyConstraintViolation")],Ue);const wi=Ue;let Ge=class extends pe{constructor(t){super(t)}};d([m()],Ge.prototype,"contingentValuesAllGroups",void 0),d([m()],Ge.prototype,"contingentValuesByFieldGroup",void 0),Ge=d([ee("esri.layers.support.ContingentValuesResult")],Ge);const ea=Ge;let ke=class extends pe{constructor(t){super(t),this.fields=null,this.isEditingRestrictive=!1}};d([m()],ke.prototype,"name",void 0),d([m()],ke.prototype,"fields",void 0),d([m()],ke.prototype,"isEditingRestrictive",void 0),d([m()],ke.prototype,"contingencies",void 0),ke=d([ee("esri.layers.support.FieldGroup")],ke);const qt=ke;var Ee;let we=Ee=class extends Dn(Pn){constructor(t){super(t),this.request=Ae,this.fieldGroups=null,this.fieldGroupDefinitions=null}initialize(){}get subtypeFieldName(){const{layer:t}=this;return t.type==="subtype-group"?t.subtypeField:t.typeIdField}static async createLoadedLayerContingentValuesCache(t){await t.load();const e=t.sourceJSON;if(t.layerId===void 0)return null;const i=e.hasContingentValuesDefinition;if(i)return new Ee({layer:t}).load();if(i===void 0){const n=Ft(t.url);if(T(n))return null;const s=n.url.path;if((await Ee._staticFetchEnterpriseFeatureRoot(s)).supportsQueryDataElements){const a=t.layerId.toString(),o=await Ee._staticFetchEnterpriseFieldGroup(s,a);if(o){const l=o.map(r=>({name:r.name,isEditingRestrictive:r.isEditingRestrictive,fields:r.fieldNames.names}));return new Ee({layer:t,fieldGroupDefinitions:l}).load()}}}return null}async load(t){const e=this.layer.load(t).then(()=>this._initializeContingentValues(this.fieldGroupDefinitions,t));return this.addResolvingPromise(e),this}validateContingencyConstraints(t,e){const i=Object.keys(t),n=[],s=[];for(const a of this.fieldGroups){const o=a.isEditingRestrictive?"error":"warning";if(e&&!a.fields.some(c=>e.includes(c)))continue;if(!a.fields.every(c=>i.includes(c))){s.push(new wi({fieldGroup:a,type:o}));continue}let l=!1;const r=t[this.subtypeFieldName],u=a.contingencies.filter(c=>!(!c.isRetired&&c.subtype)||c.subtype.code===r);for(const c of u){let p=!0;for(const h in c.values){const g=c.values[h];if(g.objectType!=="any"){if(g.objectType==="null"){if(t[h]!=null){p=!1;break}}else if(g.objectType==="code"){if(t[h]!==g.codedValue.code){p=!1;break}}else if(g.objectType==="range"){const _=t[h];if(_<g.minValue||_>g.maxValue){p=!1;break}}}}if(p){l=!0;break}}l||n.push(new wi({fieldGroup:a,type:o}))}return{invalid:n,incomplete:s}}getContingentValues(t,e,i=!1){const n=t[this.subtypeFieldName],s=n!=null,a={};let o=[];const l=this.fieldGroups.filter(r=>r.fields.includes(e));o.push(new Y({objectType:"any"}));for(const r of l){let u=[];const c=r.contingencies.filter(g=>!(g.isRetired||g.subtype&&s&&g.subtype.code!==n));let p=!1;const h={};for(const g of c){let _,y=!0;for(const b in g.values){const E=g.values[b];if(e!==b){if(t[b]!==void 0&&E.objectType!=="any"){if(E.objectType==="null")t[b]!==null&&(y=!1);else if(E.objectType==="code")t[b]!==E.codedValue.code&&(y=!1);else if(E.objectType==="range"){const w=t[b];(w<E.minValue||w>E.maxValue)&&(y=!1)}}}else _=E,p=p||E.objectType==="range"}if(_&&y){if(_.objectType==="any"){u.length=0,u.push(_);break}const b=this._generateKey(_);h[b]||u.push(_),h[b]=!0}}p&&(u=this._joinRange(u)),a[r.name]=u,o=i?this._filterIntersection(o,u):[]}return l.length===1&&i&&(o=[]),new ea({contingentValuesAllGroups:o,contingentValuesByFieldGroup:a})}_generateKey(t){switch(t.objectType){case"any":return"@any@";case"null":return"@null@";case"code":return t.codedValue.name+t.codedValue.code.toString();case"range":return t.minValue.toString()+"-"+t.maxValue.toString()}}_joinRange(t){let e,i;t.sort((s,a)=>s.objectType==="null"?-1:a.objectType==="null"?1:s.minValue-a.minValue);const n=[];for(const s of t)s.objectType!=="null"?e!=null&&i!=null?i<s.minValue?(n.push(new Y({objectType:"range",minValue:e,maxValue:i})),e=s.minValue,i=s.maxValue):i<s.maxValue&&(i=s.maxValue):(e=s.minValue,i=s.maxValue):n.push(s);return n.push(new Y({objectType:"range",minValue:e,maxValue:i})),n}_filterIntersection(t,e){var s,a;if(t.length===0||e.length===0)return[];if(t[0].objectType==="any")return e;if(e[0].objectType==="any")return t;const i=t[0].objectType==="range"||((s=t[1])==null?void 0:s.objectType)==="range",n=e[0].objectType==="range"||((a=e[1])==null?void 0:a.objectType)==="range";return i||n?this._intersectRanges(t,e):this._intersectValues(t,e)}_intersectRanges(t,e){const i=[];let n,s=0;for(const a of t)for(;s<e.length;s++){const o=e[s];if(a.objectType==="null"&&o.objectType==="null")i.push(new Y({objectType:"null"}));else{if(a.objectType==="null")break;if(o.objectType==="null")continue}if(a.maxValue<o.minValue)break;if(a.maxValue===o.minValue){i.push(new Y({objectType:"range",minValue:a.maxValue,maxValue:o.minValue}));break}if(!(a.minValue>o.maxValue))if(a.minValue!==o.maxValue){if(n=a.minValue>o.minValue?a.minValue:o.minValue,a.maxValue<o.maxValue){i.push(new Y({objectType:"range",minValue:n,maxValue:a.maxValue}));break}i.push(new Y({objectType:"range",minValue:n,maxValue:o.maxValue}))}else i.push(new Y({objectType:"range",minValue:a.minValue,maxValue:o.maxValue}))}return i}_intersectValues(t,e){const i=[];for(const n of t)e.some(s=>{if(n.objectType===s.objectType)switch(n.objectType){case"any":case"null":return!0;case"code":return n.codedValue.code===s.codedValue.code&&n.codedValue.name===s.codedValue.name}return!1})&&i.push(n);return i}static async _staticFetchEnterpriseFeatureRoot(t,e){return Ae(t,{responseType:"json",query:{f:"json"},...e}).then(i=>i.data)}static async _staticFetchEnterpriseFieldGroup(t,e,i){return Ae(`${t}/queryDataElements`,{responseType:"json",query:{layers:JSON.stringify([e]),f:"json"},...i}).then(n=>{var s;return(s=n.data.layerDataElements)==null?void 0:s[0].dataElement.fieldGroups})}async _initializeContingentValues(t,e){const i=t||await this._fetchFieldGroupDefs(e);if(i.length===0)return void(this.fieldGroups=[]);const n=await this._fetchContingentValues(i,e);this.fieldGroups=n}async _fetchFieldGroupDefs(t){if(this.layer.layerId===void 0)return[];const e=this.layer.sourceJSON,i=this.layer.layerId.toString(),n=le(Ft(this.layer.url)).url.path;return e.hasContingentValuesDefinition?(await this._fetchAGOLFieldGroup(n,i,t)).map(s=>({name:s.name,isEditingRestrictive:s.restrictive,fields:s.fields.map(a=>this.layer.fieldsIndex.normalizeFieldName(a))})):e.hasContingentValuesDefinition!==void 0?[]:this._fetchEnterpriseFeatureRoot(n,t).then(async s=>s.supportsQueryDataElements?(await this._fetchEnterpriseFieldGroup(n,i,t)).map(a=>({name:a.name,isEditingRestrictive:a.isEditingRestrictive,fields:a.fieldNames.names.map(o=>this.layer.fieldsIndex.normalizeFieldName(o))})):[])}async _fetchAGOLFieldGroup(t,e,i){return Ae(`${t}/${e}/fieldgroups`,{responseType:"json",query:{f:"json"},...i}).then(n=>n.data.fieldGroups)}async _fetchEnterpriseFieldGroup(t,e,i){return Ee._staticFetchEnterpriseFieldGroup(t,e,i)}async _fetchEnterpriseFeatureRoot(t,e){return Ee._staticFetchEnterpriseFeatureRoot(t,e)}async _fetchContingentValues(t,e){if(this.layer.layerId===void 0)return[];const i=this.layer.sourceJSON,n=this.layer.layerId.toString(),s=le(Ft(this.layer.url)).url.path;if(i.hasContingentValuesDefinition){const o=await this._fetchAGOLContingentValues(s,n,e);return this._constructFieldGroupsAGOL(t,o)}const a=await this._fetchEnterpriseContingentValues(s,n,e);return this._constructFieldGroupsEnterprise(t,a)}_constructFieldGroupsAGOL(t,e){return t.map(i=>{const n=e.contingentValuesDefinition.fieldGroups.find(s=>s.name===i.name);if(n){let s=[];return s=e.contingentValuesDefinition.hasSubType?this._parseAGOLFieldGroupSubtype(i,e,n.subTypes):this._parseAGOLFieldGroup(i,e,n.contingentValues),new qt({name:i.name,isEditingRestrictive:i.isEditingRestrictive,fields:i.fields,contingencies:s})}return null}).filter(f)}_parseAGOLFieldGroupSubtype(t,e,i){let n=[];return i==null||i.forEach(s=>{const a=this._getSubtypeAGOL(s.name);n=n.concat(this._parseAGOLFieldGroup(t,e,s.contingentValues,a))}),n}_parseAGOLFieldGroup(t,e,i,n=null){const s=[];for(const a of i??[]){const o=this._parseAGOLContingency(a,t,e,n);s.push(o)}return s}_parseAGOLContingency(t,e,i,n){var l;const s=t.id,a=!!t.retired&&t.retired===1,o={};for(let r=0,u=0;r<e.fields.length;r++){const c=e.fields[r],p=i.typeCodes[t.types[r]];if(p==="Code"){let h=t.values[u];u++;const g=this._getDomain(n,c);if(((l=this.layer.getField(c))==null?void 0:l.type)==="string"){const b=i.stringDicts.find(E=>E.domain===g.name);b&&(h=b.entries[h])}const _=g.codedValues.find(b=>b.code===h),y=new Y({codedValue:_,objectType:"code"});o[c]=y}else if(p==="Range"){const h=t.values[u];u++;const g=h.range[0],_=h.range[1],y=new Y({minValue:g,maxValue:_,objectType:"range"});o[c]=y}else if(p==="Any"){const h=new Y({objectType:"any"});o[c]=h}else{const h=new Y({objectType:"null"});o[c]=h}}return new Ei({id:s,isRetired:a,subtype:n,values:o})}_constructFieldGroupsEnterprise(t,e){const i=e.fieldGroups;return t.map(n=>{const s=i.find(a=>a.name===n.name);if(s){const a=s.contingencies.map(o=>{const l=o.id,r=o.isRetired||!1,u=this._getSubtypeEnterprise(o.subtypeCode),c={};for(let p=0;p<n.fields.length;p++){const h=n.fields[p];let g=o.values[p];if(typeof g=="number"||typeof g=="string"){const _=this._getDomain(u,h),y=this.layer.getField(h);(y==null?void 0:y.type)==="string"?g=e.stringDictionary[g]:(y==null?void 0:y.type)==="date"&&(g=new Date(`${g}+00:00`).getTime());const b=_.codedValues.find(w=>w.code===g),E=new Y({codedValue:b,objectType:"code"});c[h]=E}else if(typeof g=="object"){const _=g.minValue,y=g.maxValue,b=new Y({minValue:_,maxValue:y,objectType:"range"});c[h]=b}else if(g){const _=new Y({objectType:"any"});c[h]=_}else{const _=new Y({objectType:"null"});c[h]=_}}return new Ei({id:l,isRetired:r,subtype:u,values:c})});return new qt({name:n.name,isEditingRestrictive:n.isEditingRestrictive,fields:n.fields,contingencies:a})}return null}).filter(f)}async _fetchEnterpriseContingentValues(t,e,i){return Ae(`${t}/queryContingentValues`,{responseType:"json",query:{layers:JSON.stringify([e]),f:"json"},...i}).then(n=>{var s;return(s=n.data.contingentValueSets)==null?void 0:s[0]})}async _fetchAGOLContingentValues(t,e,i){return Ae(`${t}/${e}/contingentValues`,{responseType:"json",query:{f:"json"},...i}).then(n=>n.data)}_getSubtypeEnterprise(t){const e=this.layer.sourceJSON;let i;if(e.subtypes){const n=e.subtypes.find(s=>s.code===t);i=pi.fromJSON(n)}return i||null}_getSubtypeAGOL(t){const e=this.layer.sourceJSON;let i;if(e.subtypes){const n=e.subtypes.find(s=>s.name===t);i=pi.fromJSON(n)}return i||null}_getDomain(t,e){var n;const i=t?(n=t.domains)==null?void 0:n[e]:this.layer.getFieldDomain(e);return(i==null?void 0:i.type)==="inherited"?this.layer.getFieldDomain(e):i}};d([m({constructOnly:!0})],we.prototype,"layer",void 0),d([m({constructOnly:!0})],we.prototype,"request",void 0),d([m({type:[qt]})],we.prototype,"fieldGroups",void 0),d([m({constructOnly:!0})],we.prototype,"fieldGroupDefinitions",void 0),d([m()],we.prototype,"subtypeFieldName",null),we=Ee=d([ee("esri.layers.support.LayerContingentValuesCache")],we);const ta=we;let ze=null;function ia(t,e,i,n={}){const s=e.elementType,a="value",o=s.type==="array"?[{name:a,type:s.type,elementType:s.elementType}]:s.type==="dictionary"?[{name:a,type:s.type,properties:s.properties}]:[{name:a,type:s.type}];return new fs(t.map(l=>{const r={};return Xt(r,o,{[a]:l},i,n),r[a]}))}function na(t,e,i={}){const n=t instanceof jn?new Kt({source:t.features,geometryType:t.geometryType,fields:t.fields,spatialReference:t.spatialReference}):t;return e.constructFeatureSet(n,i.spatialReference,null,!0,i.lruCache,i.interceptor)}function sa(t,e,i={}){const{spatialReference:n,interceptor:s,lruCache:a}=i;return typeof t=="string"?e.createFeatureSetCollectionFromService(t,n,a,s):e.createFeatureSetCollectionFromMap(t,n,a,s)}function aa(t,e,i,n={}){const s={};return Xt(s,e.properties,t,i,n),new ze.Dictionary(s)}function Xt(t,e,i,n,s={}){var o,l;const a={};for(const r of Object.keys(i))a[r.toLowerCase()]=i[r];for(const r of e){const u=r.name.toLowerCase();if(s.variablesPreProcessed)t[u]=a[u];else switch(r.type){case"array":{const c=a[u];t[u]=ia(c,r,n,s);break}case"feature":{const c=a[u];t[u]=c==null?null:ze.Feature.createFromGraphic(c,s==null?void 0:s.timeReference);break}case"featureSet":{const c=a[u];t[u]=n?na(c,n,s):null;break}case"featureSetCollection":{const c=a[u];t[u]=n?sa(c,n,s):null;break}case"dictionary":{const c=a[u];t[u]=aa(c,r,n,s);break}case"date":{const c=a[u];t[u]=c?c instanceof Vt?c:(o=s==null?void 0:s.timeReference)!=null&&o.timeZone?Vt.dateJSAndZoneToArcadeDate(c,(l=s==null?void 0:s.timeReference)==null?void 0:l.timeZone):Vt.dateJSToArcadeDate(c):null;break}case"geometry":case"boolean":case"text":case"number":t[u]=a[u]}}}function sn(t,e){for(const i of t)e.push(i),i.type==="dictionary"&&sn(i.properties,e);return e}function Fi(t,e,i,n,s){const{spatialReference:a,interceptor:o,lruCache:l,console:r,abortSignal:u,timeReference:c,services:p={portal:Nn.getDefault()}}=i,h={vars:{},spatialReference:a,interceptor:o,timeReference:c,lrucache:l,useAsync:s,services:p,console:r,abortSignal:u};return e&&Xt(h.vars,t.variables,e,n,i),h}function at(t,e){switch(e.getArcadeType(t)){case"number":case"text":case"boolean":case"point":case"polygon":case"polyline":case"multipoint":case"extent":return t;case"date":return t.toJSDate();case"feature":{const i=(t.type,t),n="geometry"in i?i.geometry():null,s="readAttributes"in i?i.readAttributes():i.attributes;return new Jt({geometry:n,attributes:s})}case"dictionary":{const i=t,n=i.attributes,s={};for(const a of Object.keys(n))s[a]=at(i.field(a),e);return s}case"array":return("toArray"in t?t.toArray():t).map(i=>at(i,e))}return t}const Ii={variables:[{name:"$feature",type:"feature"},{name:"$layer",type:"featureSet"},{name:"$datastore",type:"featureSetCollection"},{name:"$map",type:"featureSetCollection"}]},Ti={variables:[{name:"$feature",type:"feature"},{name:"$aggregatedFeatures",type:"featureSet"}]},Vi=new Map([["form-constraint",{variables:[{name:"$feature",type:"feature"}]}],["feature-z",{variables:[{name:"$feature",type:"feature"}]}],["field-calculation",{variables:[{name:"$feature",type:"feature"},{name:"$datastore",type:"featureSetCollection"}]}],["form-calculation",{variables:[{name:"$feature",type:"feature"},{name:"$originalFeature",type:"feature"},{name:"$layer",type:"featureSet"},{name:"$featureSet",type:"featureSet"},{name:"$datastore",type:"featureSetCollection"},{name:"$map",type:"featureSetCollection"},{name:"$editContext",type:"dictionary",properties:[{name:"editType",type:"text"}]}]}],["labeling",{variables:[{name:"$feature",type:"feature"}]}],["popup",Ii],["popup-element",Ii],["feature-reduction-popup",Ti],["feature-reduction-popup-element",Ti],["visualization",{variables:[{name:"$feature",type:"feature"},{name:"$view",type:"dictionary",properties:[{name:"scale",type:"number"}]}]}]]);function oa(t){const e=Vi.get(t);if(!e){const i=Array.from(Vi.keys()).map(n=>`'${n}'`).join(", ");throw new nt("createArcadeProfile:invalid-profile-name",`Invalid profile name '${t}'. You must specify one of the following values: ${i}`)}return Rn(e)}async function ra(t,e,i={}){ze||(ze=await On());const{arcade:n,arcadeUtils:s}=ze,{loadScriptDependencies:a,referencesMember:o,scriptIsAsync:l}=n,r=sn(e.variables,[]),u=r.filter(V=>V.type==="featureSet"||V.type==="featureSetCollection").map(V=>V.name.toLowerCase()),c=n.parseScript(t,u);if(!c)throw new nt("arcade:invalid-script","Unable to create SyntaxTree");const p=s.extractFieldNames(c),h=n.scriptTouchesGeometry(c),g=r.map(V=>V.name.toLowerCase()).filter(V=>o(c,V)),_=l(c,u);await a(c,_,u);const y={vars:{},spatialReference:null,useAsync:_};for(const V of g)y.vars[V]="any";const{lruCache:b}=i,E=n.compileScript(c,y),w=n.featureSetUtils();return{execute:(V,v={})=>{if(_)throw new nt("arcade:invalid-execution-mode","Cannot execute the script in synchronous mode");const O=E(Fi(e,V,{lruCache:b,...v},w,_));return v.rawOutput?O:at(O,s)},executeAsync:async(V,v={})=>{const O=await E(Fi(e,V,{lruCache:b,...v},w,_));return v.rawOutput?O:at(O,s)},isAsync:_,variablesUsed:g,fieldsUsed:p,geometryUsed:h,syntaxTree:c}}var an;const la=Symbol("FormExpressionArcadeExecutor");let ie=class extends pe{constructor(e){super(e),this[an]=!0,this._lastEvaluatedValue=null,this._abortController=new AbortController,this._stale=!1,this._updatingTracking=new Gn,this._executeAsyncDebounced=Bn(async(i,n,s)=>{const a=await this.executor.executeAsync(i,{...n,abortSignal:s});return s.aborted?this._lastEvaluatedValue:(this._lastEvaluatedValue=a,this._stale=!1,a)})}get isAsync(){return this.executor.isAsync}get fieldsUsed(){return this.executor.fieldsUsed}get syntaxTree(){return this.executor.syntaxTree}get updating(){return this._updatingTracking.updating}get stale(){return this._stale}get geometryUsed(){return this.executor.geometryUsed}get variablesUsed(){return this.executor.variablesUsed}get lastEvaluatedValue(){return this._lastEvaluatedValue}abort(){this._abortController.abort()}execute(e,i){this._abortController=new AbortController;const n=this.executor.execute(e,{...i,abortSignal:this._abortController.signal});return this._lastEvaluatedValue=n,n}async executeAsync(e,i){return this._abortController=new AbortController,this._updatingTracking.addPromise(this._executeAsyncDebounced(e,i??{},this._abortController.signal))}markStale(){this._stale=!0}reset(){this.abort(),this._lastEvaluatedValue=null,this._stale=!1}};an=la,d([m()],ie.prototype,"_lastEvaluatedValue",void 0),d([m()],ie.prototype,"_stale",void 0),d([m()],ie.prototype,"_updatingTracking",void 0),d([m({constructOnly:!0})],ie.prototype,"executor",void 0),d([m()],ie.prototype,"isAsync",null),d([m()],ie.prototype,"fieldsUsed",null),d([m()],ie.prototype,"syntaxTree",null),d([m()],ie.prototype,"updating",null),d([m()],ie.prototype,"stale",null),d([m()],ie.prototype,"geometryUsed",null),d([m()],ie.prototype,"variablesUsed",null),d([m()],ie.prototype,"lastEvaluatedValue",null),ie=d([ee("esri.widgets.FeatureForm.FormExpressionArcadeExecutor")],ie);const ua=async(t,e)=>{const i=oa("form-calculation"),n=await ra(t,i,{});return e!=null&&e.fieldsIndex&&(n.fieldsUsed=Un(e.fieldsIndex,n.fieldsUsed)),new ie({executor:n})},St="#JSAPI_FORM_EXPRESSIONS_MANAGER_GEOMETRY",da="esri.widgets.FeatureForm.FormExpressionsManager";let Fe=class extends pe{constructor(t){super(t),this._fieldReferencesLookup=new Map,this._fieldsAffectedLookup=new Map,this._latestFieldValues={...t.feature.attributes}}initialize(){this._dependencyGraph=this._buildDependencyGraph()}get _baseContext(){const{editType:t,layer:e,map:i,originalFeature:n,spatialReference:s}=this.arcadeContextInfo,a=(e==null?void 0:e.type)==="feature"?e:(e==null?void 0:e.type)==="scene"&&f(e.associatedLayer)?e.associatedLayer:void 0;return[{$originalfeature:n,$editcontext:{editType:t},$layer:a,$featureset:a,$datastore:e==null?void 0:e.url,$map:i},{spatialReference:s}]}set feature(t){this._latestFieldValues={...t==null?void 0:t.attributes},this._set("feature",t)}evaluateAll(){return this._evaluate(this.executors)}evaluateExpressions(t){return this._evaluate(t)}evaluateInvalidated(t){const{_fieldReferencesLookup:e,_latestFieldValues:i,feature:n}=this,s=new Set;for(const a of t)if(i[a]=n.getAttribute(a),e.has(a))for(const o of e.get(a))s.add(o);return this._evaluate([...s])}async evaluateInvalidatedByGeometry(){if(this._fieldReferencesLookup.has(St))return this._evaluate([...this._fieldReferencesLookup.get(St)])}resetExecutors(){for(const t of this.executors)t.reset()}_buildDependencyGraph(){const{_fieldReferencesLookup:t,_fieldsAffectedLookup:e,executors:i}=this,n=new Map(this.inputFields.map(a=>[a.name,a])),s=new Map(i.map(a=>[a,new Array]));for(const a of i){for(const o of a.fieldsUsed){Xe(t,o,()=>new Set).add(a);const l=n.get(o),{valueExpressionExecutor:r,editableExpressionExecutor:u}=l;f(r)&&r!==a&&(s.get(r).push(a),Xe(e,r,()=>new Set).add(l)),f(u)&&u!==a&&(s.get(u).push(a),Xe(e,u,()=>new Set).add(l))}a.geometryUsed&&Xe(t,St,()=>new Set).add(a)}return s}async _evaluate(t){const e=new Map,{_dependencyGraph:i,_fieldsAffectedLookup:n,_latestFieldValues:s}=this;for(const o of t)on(o,e,i);for(const[o,{resolver:l,dependencyPromises:r}]of e)Promise.all(r).then(async()=>{const[u,c]=this._makeContext(s);return o.executeAsync(u,c)}).then(()=>{if(n.has(o))for(const u of n.get(o))this._latestFieldValues[u.name]=u.value;l.resolve()},u=>{!u||Ot(u)||Ci(u)||o.markStale(),l.reject(u)});const a=(await Promise.allSettled(Array.from(e.values(),({resolver:o})=>o.promise))).filter(o=>o.status==="rejected"&&!(Ot(o.reason)||Ci(o.reason)));if(a.length>0)throw new AggregateError(a,"One or more expression executions failed")}_makeContext(t){const[e,i]=this._baseContext,n=this.feature.clone();return n.attributes=t,[{...e,$feature:n},i]}};d([m()],Fe.prototype,"_baseContext",null),d([m()],Fe.prototype,"feature",null),d([m()],Fe.prototype,"executors",void 0),d([m()],Fe.prototype,"inputFields",void 0),d([m()],Fe.prototype,"arcadeContextInfo",void 0),Fe=d([ee(da)],Fe);const on=(t,e,i)=>{if(e.has(t))return;const n=Hn();e.set(t,{resolver:n,dependencyPromises:[]}),t.abort();const s=i.get(t);for(const a of s)on(a,e,i),e.get(a).dependencyPromises.push(n.promise)},Ci=t=>t&&typeof t=="object"&&"message"in t&&t.message==="Cancelled";var he,ot;(function(t){t.Text="text",t.Number="number",t.Date="date",t.Unsupported="unsupported"})(he||(he={})),function(t){t.TOO_SHORT="length-validation-error::too-short"}(ot||(ot={}));const $i={type:"number"},ki={type:"number",intlOptions:{notation:"scientific"}},Si={type:"date",intlOptions:{day:"2-digit",month:"2-digit",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}},ca="__internal-type-based-coded-value-domain__";function Ai(t){return t>=1e7||t<=-1e7}let $=class extends ut(pe){constructor(t){super(t),this._storedValue=null,this.arcadeEditType="NA",this.editableExpressionExecutor=null,this.id=zn().toString(),this.requiredExpressionExecutor=null,this.valueExpressionExecutor=null,this.visibilityExpressionExecutor=null,this.feature=null,this.field=null,this.fieldElement=null,this.layer=null,this.error=null,this.group=null,this.messages=null}get _configAllowsEdits(){var n,s,a;const{fieldElement:t,layer:e,name:i}=this;return f(t)?t.editableExpression?this.evaluatedEditableExpression:t.editable!==!1:e.userHasUpdateItemPrivileges?!0:((a="popupTemplate"in e?(s=(n=e==null?void 0:e.popupTemplate)==null?void 0:n.fieldInfos)==null?void 0:s.find(({fieldName:o})=>o===i):null)==null?void 0:a.isEditable)??!0}get _layerFieldAllowsEdits(){const{field:t,layer:e}=this;if(!e||!t)return!1;const i=qn(e),n=i==null?void 0:i.operations.supportsEditing,s=t.editable,a=pa(i,this.arcadeEditType);return!!(n&&s&&a)}get isUsingValueExpression(){return this._shouldUseValueExpression()}get evaluatedEditableExpression(){const{editableExpressionExecutor:t}=this;return f(t)?!!t.lastEvaluatedValue:null}get evaluatedRequiredExpression(){const{requiredExpressionExecutor:t}=this;return f(t)?!!t.lastEvaluatedValue:null}get evaluatedVisibilityExpression(){const{visibilityExpressionExecutor:t}=this;return f(t)?!!t.lastEvaluatedValue:null}get evaluatedValueExpression(){const{valueExpressionExecutor:t}=this;return f(t)?t.lastEvaluatedValue:null}set initialFeature(t){this._set("initialFeature",t),this.notifyChange("valid")}get description(){var t;return(t=le(this.fieldElement))==null?void 0:t.description}get domain(){const{layer:t}=this,{typeFieldName:e,types:i}=zt(t);if(e===this.name&&T(this.field.domain))return new Wn({name:ca,codedValues:i.map(({code:o,name:l})=>new Qn({code:o,name:l}))});const{feature:n}=this,s=t.getFieldDomain(this.name,{feature:n}),a=Kn(this.fieldElement,"domain");return f(a)&&this._isDomainCompatible(a)?a:s}get editable(){return!!this._layerFieldAllowsEdits&&(this.evaluatedEditableExpression??this._configAllowsEdits)}get inputType(){var t,e;return(e=(t=le(this.fieldElement))==null?void 0:t.input)==null?void 0:e.type}get errorMessage(){return this._toErrorMessage()}get hint(){var t;return(t=le(this.fieldElement))==null?void 0:t.hint}get includeTime(){var i;const{fieldElement:t}=this,e=f(t)&&((i=t.input)==null?void 0:i.type)==="datetime-picker"?t.input.includeTime:void 0;return e===void 0||e}get label(){return f(this.fieldElement)&&this.fieldElement.label||this.field.alias||this.field.name}get maxLength(){if(this.type===he.Date)return-1;const{field:e,fieldElement:i}=this,n=e==null?void 0:e.length,s=Mi(i)?i.input.maxLength:NaN;return!isNaN(s)&&s>=-1&&(n===-1||s<=n)?s:n}get minLength(){if(this.type===he.Date)return-1;const{field:e,fieldElement:i}=this,n=e==null?void 0:e.length,s=Mi(i)?i.input.minLength:NaN;return!isNaN(s)&&s>=-1&&(n===-1||s<=n)?s:-1}get name(){var t;return(t=this.field)==null?void 0:t.name}get required(){const{editable:t,evaluatedRequiredExpression:e,field:i,visible:n}=this;return!!t&&((i==null?void 0:i.nullable)===!1||!(!n||!f(e))&&e)}set required(t){this._overrideIfSome("required",t)}get submittable(){const{field:t,required:e,valid:i,value:n}=this;return(!e||!T(n))&&(!!i||this.initialFeature.getAttribute(t.name)===n)}get type(){const{field:t}=this;return It(t)?he.Number:oi(t)?he.Text:ri(t)?he.Date:he.Unsupported}get updating(){const{editableExpressionExecutor:t,valueExpressionExecutor:e}=this;return f(e)&&e.updating||f(t)&&t.updating}get valid(){const t=this.editable?this._validate():null;return this._set("error",t),t===null}get value(){if(this._shouldUseValueExpression()){const t=this.evaluatedValueExpression;if(this.type===he.Date){if(t instanceof Date)return t.getTime();if(typeof t!="number")return parseInt(t,10)}return f(t)&&typeof t=="object"?t.toString():t}return this.get("_storedValue")}set value(t){this.notifyChange("evaluatedVisibilityExpression"),this.set("_storedValue",t)}get visible(){return!this._isEditorField()&&(f(this.evaluatedVisibilityExpression)?this.evaluatedVisibilityExpression:!!f(this.fieldElement)||this._isVisibleByDefault())}_isDomainCompatible(t){const{field:e}=this;if((t==null?void 0:t.type)==="coded-value"){const i=typeof t.codedValues[0].code;if(i==="string"&&oi(e)||i==="number"&&It(e))return!0}return!!((t==null?void 0:t.type)==="range"&&It(e)||ri(e))}_validate(){const{domain:t,field:e,initialFeature:i,minLength:n,required:s,type:a,valid:o,value:l}=this,r=s&&l===null,u=o!==void 0;return!r&&i.getAttribute(e.name)===l&&u?null:r?li.INVALID_TYPE:a==="text"&&n>-1&&typeof l=="string"&&l.length<n?ot.TOO_SHORT:t?l!==null||s?Jn(t,l):null:Yn(e,l)}_isVisibleByDefault(){var e,i;const t=(e=this.field)==null?void 0:e.type;return((i=this.field)==null?void 0:i.visible)&&t!=="oid"&&t!=="global-id"&&!this._isGeometryField()}_isEditorField(){return Xn(this.layer).includes(this.name)}_isGeometryField(){return Zn(this.layer).includes(this.name)}_shouldUseValueExpression(){return this._layerFieldAllowsEdits&&!this._configAllowsEdits&&f(this.valueExpressionExecutor)}_toErrorMessage(){const{domain:t,field:e,messages:i,minLength:n,value:s,required:a,type:o}=this,l=this.error;if(a&&s===null)return i.validationErrors.cannotBeNull;if(l===ui.VALUE_OUT_OF_RANGE||l===es.OUT_OF_RANGE){const r=Xi(t)||Zi(e);return Rt(i.validationErrors.outsideRange,r,{format:{max:o==="date"?Si:Ai(r.max)?ki:$i,min:o==="date"?Si:Ai(r.min)?ki:$i}})}return l===ui.INVALID_CODED_VALUE?i.validationErrors.invalidCodedValue:l===li.INVALID_TYPE?i.validationErrors.invalidType:l===ot.TOO_SHORT?Rt(i.validationErrors.tooShort,{min:n}):null}};d([m()],$.prototype,"_storedValue",void 0),d([m()],$.prototype,"_configAllowsEdits",null),d([m()],$.prototype,"_layerFieldAllowsEdits",null),d([m()],$.prototype,"arcadeEditType",void 0),d([m()],$.prototype,"editableExpressionExecutor",void 0),d([m()],$.prototype,"requiredExpressionExecutor",void 0),d([m()],$.prototype,"valueExpressionExecutor",void 0),d([m()],$.prototype,"isUsingValueExpression",null),d([m()],$.prototype,"visibilityExpressionExecutor",void 0),d([m()],$.prototype,"evaluatedEditableExpression",null),d([m()],$.prototype,"evaluatedRequiredExpression",null),d([m()],$.prototype,"evaluatedVisibilityExpression",null),d([m()],$.prototype,"evaluatedValueExpression",null),d([m()],$.prototype,"feature",void 0),d([m()],$.prototype,"field",void 0),d([m({constructOnly:!0})],$.prototype,"fieldElement",void 0),d([m()],$.prototype,"initialFeature",null),d([m()],$.prototype,"layer",void 0),d([m({readOnly:!0})],$.prototype,"description",null),d([m()],$.prototype,"domain",null),d([m()],$.prototype,"editable",null),d([m({readOnly:!0})],$.prototype,"inputType",null),d([m({readOnly:!0})],$.prototype,"error",void 0),d([m({dependsOn:["error","messages","value"]})],$.prototype,"errorMessage",null),d([m()],$.prototype,"group",void 0),d([m({readOnly:!0})],$.prototype,"hint",null),d([m()],$.prototype,"includeTime",null),d([m()],$.prototype,"label",null),d([m()],$.prototype,"maxLength",null),d([m()],$.prototype,"minLength",null),d([m()],$.prototype,"messages",void 0),d([m({readOnly:!0})],$.prototype,"name",null),d([m()],$.prototype,"required",null),d([m()],$.prototype,"submittable",null),d([m()],$.prototype,"type",null),d([m()],$.prototype,"updating",null),d([m()],$.prototype,"valid",null),d([m({value:null})],$.prototype,"value",null),d([m()],$.prototype,"visible",null),$=d([ee("esri.widgets.FeatureForm.InputField")],$);const pa=(t,e)=>{if(!t)return!0;const{operations:i}=t;switch(e){case"INSERT":return i.supportsAdd;case"UPDATE":case"DELETE":return i.supportsUpdate;default:return!0}},Mi=t=>f(t)&&(me(t,"text-box")||me(t,"text-area")),Li=$;let se=class extends ut(pe){constructor(t){super(t),this._expressionTrackingHandles=new Map,this.visibilityExpressionExecutor=null,this.feature=null,this.groupElement=null}initialize(){this.addHandles([re(()=>[this.visible,this.inputFields],([t])=>{const{inputFields:e}=this,i=!!t&&void 0;for(const n of e)n.required=i},{initial:!0,equals:(t,e)=>e[0]===t[0]&&e[1]===t[1]})])}destroy(){for(const t of this._expressionTrackingHandles.values())t.remove()}get visibilityExpression(){var t;return(t=le(this.groupElement))==null?void 0:t.visibilityExpression}set visibilityExpression(t){Te(this.groupElement,e=>{e.visibilityExpression=t})}get evaluatedVisibilityExpression(){const{visibilityExpressionExecutor:t}=this;return f(t)?!!t.lastEvaluatedValue:null}get description(){var t;return(t=le(this.groupElement))==null?void 0:t.description}set description(t){Te(this.groupElement,e=>{e.description=t})}get inputFields(){return this._get("inputFields")}set inputFields(t){this.handles.removeAll(),t&&this.handles.add(t.map(e=>re(()=>e.visible,()=>this._dirtyEvaluatedVisibilityExpression()))),this._set("inputFields",t)}get label(){var t;return(t=le(this.groupElement))==null?void 0:t.label}set label(t){Te(this.groupElement,e=>{e.label=t})}get state(){return f(this.groupElement)&&this.groupElement.initialState||"expanded"}set state(t){this._overrideIfSome("state",t)}get visible(){return this.evaluatedVisibilityExpression!==!1&&this.inputFields&&this.inputFields.some(t=>t.visible)}_dirtyEvaluatedVisibilityExpression(){const{groupElement:t}=this;f(t)&&t.visibilityExpression&&this.notifyChange("evaluatedVisibilityExpression")}};d([m()],se.prototype,"visibilityExpression",null),d([m()],se.prototype,"visibilityExpressionExecutor",void 0),d([m()],se.prototype,"evaluatedVisibilityExpression",null),d([m()],se.prototype,"description",null),d([m()],se.prototype,"feature",void 0),d([m()],se.prototype,"groupElement",void 0),d([m()],se.prototype,"initialFeature",void 0),d([m()],se.prototype,"inputFields",null),d([m()],se.prototype,"label",null),d([m()],se.prototype,"state",null),d([m()],se.prototype,"visible",null),se=d([ee("esri.widgets.FeatureForm.InputFieldGroup")],se);const ma=se,At=new Jt({attributes:{}}),ha=["editableExpression","requiredExpression","valueExpression","visibilityExpression"],fa=["visibilityExpression"],ga="#JSAPI_CONTINGENT_VALUE_EMPTY_HASH",Me="#JSAPI_CONTINGENT_VALUE_ANY_HASH",va="#JSAPI_CONTINGENT_VALUE_NULL_HASH";let j=class extends ut(ts(Qi.EventedAccessor)){constructor(t){super(t),this._expressionExecutorLookup=new Map,this._expressionLookup=new Map,this._expressionsManager=null,this._contingentValuesCache=null,this._featureClone=At.clone(),this._initialFeature=At.clone(),this.arcadeEditType="NA",this.contingencyConstraintViolations=new Map,this.inputFields=[],this.messages=null,this.strict=!1,this._isSupportedElement=this._isSupportedElement.bind(this)}initialize(){const t=async()=>{const s=await as("esri/widgets/FeatureForm/t9n/FeatureForm");this.messages=s;for(const a of this.allInputFields)a.messages=s};t();const e=re(()=>{var s;return[this.layer,(s=this.layer)==null?void 0:s.loaded,this.formTemplate]},([s,a])=>{f(s)&&(a?this._updateInputFields():s.load().catch(()=>He.getLogger(this.declaredClass).error("Failed to load layer",s.loadError)))},{equals:([s,a,o],[l,r,u])=>s===l&&a===r&&o===u,initial:!0}),i=re(()=>this._arcadeContextInfo,s=>{f(this._expressionsManager)&&(this._expressionsManager.arcadeContextInfo=s)}),n=re(()=>this.layer,s=>{const a=(s==null?void 0:s.type)==="subtype-sublayer"?s.parent:(s==null?void 0:s.type)==="feature"?s:null;a&&this.addResolvingPromise(ta.createLoadedLayerContingentValuesCache(a).then(o=>{this._contingentValuesCache=o,this.notifyChange("fieldsWithContingentValues")}))},{initial:!0});this.handles.add([is(t),e,i,n])}destroy(){this.feature=null,this.layer=null,this._contingentValuesCache=ns(this._contingentValuesCache)}get _arcadeContextInfo(){const{_initialFeature:t,arcadeEditType:e,layer:i,spatialReference:n,view:s}=this;return{layer:ss(i)?i:null,originalFeature:t,editType:e,spatialReference:n,map:s==null?void 0:s.map}}get updating(){return this.updatingHandles.updating}get allInputFields(){return Di(this.inputFields)}get _layerFieldsByName(){return new Map(this.layer.fields.map(t=>[t.name,t]))}get feature(){return this._get("feature")}set feature(t){this._featureClone=t?t.clone():At.clone(),this._initialFeature=this._featureClone.clone(),this._resetInputFieldValues(this._featureClone),this.contingencyConstraintViolations.clear(),f(this._expressionsManager)&&(this._expressionsManager.resetExecutors(),this._expressionsManager.feature=this._featureClone,this.updatingHandles.addPromise(this._expressionsManager.evaluateAll().finally(()=>this._afterExpressionsEvaluated()))),this._set("feature",t)}get fieldsWithContingentValues(){if(T(this._contingentValuesCache))return new Set;const t=this._contingentValuesCache.fieldGroups.flatMap(e=>e.fields);return new Set(t)}get formTemplate(){return this.layer&&"formTemplate"in this.layer?this.layer.formTemplate:null}set formTemplate(t){t===void 0?this._clearOverride("formTemplate"):this._override("formTemplate",t)}get formDescription(){const{formTemplate:t,layer:e}=this;return!T(t)&&t.description&&e?xi(t.description,this.getValues(),e.fieldsIndex):null}get formTitle(){const{formTemplate:t,layer:e}=this;return!T(t)&&t.title&&e?xi(t.title,this.getValues(),e.fieldsIndex):null}get joinedContingentValues(){return this._joinContingentValues()}get layer(){var t;return(t=this.feature)!=null&&t.sourceLayer&&"applyEdits"in this.feature.sourceLayer?this.feature.sourceLayer:null}set layer(t){this._override("layer",t)}get spatialReference(){var t;return((t=this.layer)==null?void 0:t.spatialReference)??null}set spatialReference(t){this._override("spatialReference",t)}get state(){return this.messages&&this.get("layer.loaded")?"ready":"disabled"}get submittable(){return!!this.valid||this.allInputFields.filter(t=>!t.valid).every(({submittable:t})=>t)}get valid(){const t=this.allInputFields;return t.length>0&&t.every(({valid:e})=>e)}findField(t){return this.allInputFields.find(e=>e.name===t)}getValue(t){const{_featureClone:e,layer:i}=this,n=!!(i!=null&&i.getField(t));return e.getAttribute(t)??(n?null:void 0)}setValue(t,e){const{_featureClone:i,strict:n}=this,s=this.findField(t);e=e===""?null:e,s&&i.getAttribute(t)!==e&&(s.value=e,n&&!s.valid||(this._afterValueChange(s),f(this._expressionsManager)&&this.updatingHandles.addPromise(this._expressionsManager.evaluateInvalidated([s.name]).finally(()=>this._afterExpressionsEvaluated()))))}getValues(){return{...this._featureClone.attributes}}submit(){const t=this.allInputFields,e=new Set(t.filter(s=>s.valid).map(({name:s})=>s)),i=t.filter(s=>!s.valid).map(({name:s})=>s),n=this.getValues();if(this.validateContingencyConstraints(n,{includeIncompleteViolations:!0}).length>0)for(const[s,a]of this.contingencyConstraintViolations.entries())a.type==="error"&&(e.delete(s),i.push(s));this.emit("submit",{valid:[...e],invalid:i,values:n})}validateContingencyConstraints(t,e){const{_contingentValuesCache:i}=this,n=new Map;if(this.contingencyConstraintViolations=n,T(i))return[];const{invalid:s,incomplete:a}=i.validateContingencyConstraints(t),o=[...s,...e!=null&&e.includeIncompleteViolations?a:[]];for(const l of o)for(const r of l.fieldGroup.fields)n.set(r,l);return o}notifyFeatureGeometryChanged(){const{_expressionsManager:t,feature:e,_featureClone:i}=this;i.geometry=e.geometry,f(t)&&this.updatingHandles.addPromise(t.evaluateInvalidatedByGeometry().finally(()=>this._afterExpressionsEvaluated()))}_emitChangeEvent({name:t,valid:e,value:i}){this.emit("value-change",{layer:this.layer,feature:this.feature,fieldName:t,value:i,valid:e})}_updateInputFields(){const{_featureClone:t,_initialFeature:e,arcadeEditType:i,formTemplate:n,inputFields:s,messages:a,layer:o}=this,l={arcadeEditType:i,feature:t,initialFeature:e,layer:o,messages:a},r=s.slice(),u=f(n)&&n.elements.length>0?this._updateInputFieldsFromElements(r,n.elements,l):this._updateInputFieldsFromLayerFields(r,o==null?void 0:o.fields,l);this.inputFields=u}_updateInputFieldsFromElements(t,e,i){const n=new Map;for(const o of t)if(Ie(o)){Lt(n,o.groupElement,o);for(const l of o.inputFields)Lt(n,l.fieldElement,l)}else Lt(n,o.fieldElement,o);const s=new Map,a=this._updateInputFieldsRecursive({existingInputFieldsByElement:n,updatedElements:e.filter(this._isSupportedElement),sharedInitializationProperties:i,group:null,newExpressionExecutorPromises:s});this.updatingHandles.addPromise(Promise.all(Array.from(s.values())).then(()=>{const o=Array.from(this._expressionExecutorLookup.values()),l=Di(a);return this._createExpressionsManager(o,l),le(this._expressionsManager).evaluateAll().finally(()=>this._afterExpressionsEvaluated())}));for(const[o,l]of n.entries())n.delete(o),l.destroy();return a}_updateInputFieldsRecursive(t){const{existingInputFieldsByElement:e,updatedElements:i,sharedInitializationProperties:n,group:s,newExpressionExecutorPromises:a}=t,o=[];for(const l of i){const r=e.has(l),u=r?e.get(l):Mt(l)?this._makeInputFieldGroupFromGroupElement(l,n):this._makeInputFieldFromFieldElement(l,n,s);if(o.push(u),r)if(e.delete(l),Ie(u)){const{feature:c}=n;u.set({feature:c})}else u.set(n);else this._assignExpressionExecutors(u,l,a);if(Mt(l)){const c=l.elements.filter(p=>this._isSupportedElement(p));u.inputFields=this._updateInputFieldsRecursive({existingInputFieldsByElement:e,updatedElements:c,sharedInitializationProperties:n,group:u,newExpressionExecutorPromises:a})}}return o}_updateInputFieldsFromLayerFields(t,e,i){if(!Array.isArray(e))return He.getLogger(this.declaredClass).warn(this.declaredClass,"No attribute fields found."),[];const n=new Map;for(const c of t)if(Ie(c)){for(const p of c.inputFields)p.destroy();c.inputFields.length=0,c.destroy()}else f(c.fieldElement)?c.destroy():n.set(c.field,c);const s=[],{arcadeEditType:a,feature:o,initialFeature:l,layer:r,messages:u}=i;for(const c of e){const p=n.get(c)??new Li({arcadeEditType:a,field:c,feature:o,initialFeature:l,layer:r,messages:u,value:o.getAttribute(c.name)??null});s.push(p),n.delete(c)}for(const[c,p]of n.entries())n.delete(c),p.destroy();return s}_resetInputFieldValues(t){for(const e of this.allInputFields)e.value=t.getAttribute(e.name)}_makeInputFieldFromFieldElement(t,e,i=null){const{arcadeEditType:n,feature:s,initialFeature:a,layer:o,messages:l}=e;return new Li({arcadeEditType:n,fieldElement:t,field:this._layerFieldsByName.get(t.fieldName),value:s.getAttribute(t.fieldName)??null,feature:s,initialFeature:a,layer:o,group:i,messages:l})}_makeInputFieldGroupFromGroupElement(t,e){const{feature:i,initialFeature:n}=e;return new ma({groupElement:t,inputFields:[],feature:i,initialFeature:n})}_assignExpressionExecutors(t,e,i){const n=Mt(e)?fa:ha,s=[];for(const a of n){const o=e[a],{_expressionExecutorLookup:l}=this;if(f(o)&&o!==""){const r=`${a}Executor`,u=this._expressionLookup.get(o)??this._addToExpressionLookup(o);if(l.has(u))t[r]=l.get(u);else if(i.has(u)){const c=i.get(u).then(p=>(t[r]=p,p));i.set(u,c)}else{const c=ua(u,this.layer).then(p=>(t[r]=p,l.set(u,p),p));i.set(u,c)}}}return s}_createExpressionsManager(t,e){const{_arcadeContextInfo:i,_featureClone:n}=this;this._expressionsManager=new Fe({executors:t,feature:n,arcadeContextInfo:i,inputFields:e})}_afterValueChange(t){var u;const{name:e,value:i}=t,{_featureClone:n,formTemplate:s,layer:a}=this;if(!a)return;const o=n.getAttribute(e);n.setAttribute(e,i);const{typeFieldName:l,types:r}=zt(a);if(e===l&&i!==o){if(a.type==="subtype-sublayer"){const p=(u=a.parent)==null?void 0:u.findSublayerForFeature(n);n.sourceLayer=this.feature.sourceLayer=p}const c=new Set;for(const p of r)if(p.domains&&typeof p.domains=="object")for(const h of Object.keys(p.domains))c.add(h);for(const p of c){const h=this.findField(p);h&&h.notifyChange("domain")}}if(f(s)){const{description:c,title:p}=s;p&&Ut(p,e)&&this.notifyChange("formTitle"),c&&Ut(c,e)&&this.notifyChange("formDescription")}this._emitChangeEvent(t)}_afterExpressionsEvaluated(){const{_featureClone:t}=this;for(const e of this.allInputFields)e.value!==t.getAttribute(e.name)&&this._afterValueChange(e)}_addToExpressionLookup(t){var s;const{_expressionLookup:e,formTemplate:i}=this,n=((s=f(i)&&f(i.expressionInfos)?Object.values(i.expressionInfos).find(a=>a.name===t):null)==null?void 0:s.expression)??t;return e.set(t,n),t!==n&&e.set(n,n),n}_isSupportedElement(t){return t.type==="field"||t.type==="group"||(He.getLogger(this.declaredClass).warn("form-info::unsupported-element-type","Only element types 'field' and 'group' are supported",`Element ${t.label} has unsupported type '${t.type}'`),!1)}_joinContingentValues(){const t=this._contingentValuesCache;if(T(t))return[];const{typeFieldName:e}=zt(this.layer),i=e?this.getValue(e):null,n=[];for(const o of t.fieldGroups){const{contingencies:l,fields:r,name:u}=o,c=[];for(const p of l)p.isRetired||f(p.subtype)&&p.subtype.code!==i||c.push({values:p.values});c.length>0&&n.push({name:u,fields:r,contingencies:c})}const[s,a]=this._generateJoinPlan(n);return[...s.flatMap(o=>this._joinFieldGroupContingencies(o)),...a.flatMap(o=>o.contingencies)]}_generateJoinPlan(t){const e=new Map,i=[],n=new Set;for(const r of t)for(const u of r.fields)if(e.has(u)){const c=e.get(u),p=r,h=[c.name,p.name].sort().join("|");if(n.has(h))continue;i.push([c,p]),n.add(h),e.set(u,p)}else e.set(u,r);const s=new Set(i.flat()),a=new Set(t);for(const r of s)a.delete(r);const o=new Map,l=new Map;for(const r of new Set(i.flat())){const u=Symbol(r.name);o.set(u,new Set([r])),l.set(r,u)}for(const[r,u]of i){const c=l.get(r),p=l.get(u);if(c===p)continue;const h=o.get(c),g=o.get(p);for(const _ of g)h.add(_),l.set(_,c);o.delete(p)}return[[...o.values()].map(r=>[...r]),[...a]]}_joinFieldGroupContingencies(t){const e=t.slice(),i=e.shift();let n=e.shift(),s=this._generateJoinKey(i.fields,n.fields),a=new Set([...i.fields,...n.fields]),o=new Map;for(const r of i.contingencies){const[u]=this._hashContingency(r,s.codedValueFields,!0);o.has(u)?o.get(u).push(r):o.set(u,[r])}for(;e.length>0;){const r=new Map,u=e.shift(),c=this._generateJoinKey(a,u.fields);for(const p of n.contingencies){const[h,g]=this._hashContingency(p,s.codedValueFields),_=g?this._findMatchingContingenciesWithAnyHashMask(o,h):o.get(h);if(o.has(Me)&&_.push(...this._findMatchingContingenciesContainingAny(p,o.get(Me),s.codedValueFields)),!T(_))for(const y of _){const b=s.rangeFields.length>0?this._joinContingenciesWithRangeDomains(y,p,s.rangeFields):this._joinContingencies(y,p);if(T(b))break;const[E]=this._hashContingency(b,c.codedValueFields,!0);r.has(E)?r.get(E).push(b):r.set(E,[b])}}o=r,n=u,s=c,a=new Set([...a,...n.fields])}const l=[];for(const r of n.contingencies){const[u,c]=this._hashContingency(r,s.codedValueFields),p=c?this._findMatchingContingenciesWithAnyHashMask(o,u):o.get(u);if(o.has(Me)&&p.push(...this._findMatchingContingenciesContainingAny(r,o.get(Me),s.codedValueFields)),!T(p))for(const h of p){const g=s.rangeFields.length>0?this._joinContingenciesWithRangeDomains(h,r,s.rangeFields):this._joinContingencies(h,r);f(g)&&l.push(g)}}return l}_joinContingencies(t,e){const i={values:{...t.values,...e.values}};for(const[n,s]of Object.entries(i.values))s.objectType==="any"&&f(t.values[n])&&(i.values[n]=t.values[n]);return i}_joinContingenciesWithRangeDomains(t,e,i){const n=this._joinContingencies(t,e);for(const s of i){const a=t.values[s],o=e.values[s],{leftIsNull:l,rightIsNull:r,bothAreNull:u,leftIsAny:c,rightIsAny:p,bothAreAny:h,leftIsRange:g,rightIsRange:_}=this._compareObjectTypes(a.objectType,o.objectType);if(u||h)continue;if(l&&p||r&&c){n.values[s]=new Y({objectType:"null"});continue}if(l&&_||r&&g)return null;c?(a.minValue=-1/0,a.maxValue=1/0):p&&(o.minValue=-1/0,o.maxValue=1/0);const y=Math.max(a.minValue,o.minValue),b=Math.min(a.maxValue,o.maxValue);if(y>b)return null;n.values[s]=new Y({objectType:"range",minValue:y,maxValue:b})}return n}_findMatchingContingenciesContainingAny(t,e,i){return e.filter(n=>i.every(s=>{var l,r;const a=n.values[s],o=t.values[s];return a.objectType==="any"||o.objectType==="any"||((l=a.codedValue)==null?void 0:l.code)===((r=o.codedValue)==null?void 0:r.code)}))}_findMatchingContingenciesWithAnyHashMask(t,e){const i=RegExp(`${e}$`),n=[];for(const[s,a]of t){if(s===Me)break;i.test(s)&&n.push(...a)}return n}_generateJoinKey(t,e){const i=Array.isArray(t)?new Set(t):t,n=Array.isArray(e)?new Set(e):e,s=i.size<n.size?i:n,a=s===i?n:i,o=new Set,l=new Set;for(const r of s)if(a.has(r)){const u=this.layer.getFieldDomain(r,{feature:this.feature});if(T(u))continue;switch(u.type){case"coded-value":o.add(r);break;case"range":l.add(r)}}return{codedValueFields:[...o],rangeFields:[...l]}}_hashContingency(t,e,i=!1){var a;if(e.length<1)return[ga,!1];const n=[];let s=!1;for(const o of e){const l=t.values[o];if(l.objectType==="any"){if(i)return[Me,!0];s=!0,n.push(`${o}:.*`)}else l.objectType==="null"?n.push(`${o}:${va}`):n.push(`${o}:${(a=l.codedValue)==null?void 0:a.code}`)}return[n.sort().join("&"),s]}_compareObjectTypes(t,e){return{leftIsNull:t==="null",rightIsNull:e==="null",bothAreNull:t==="null"&&e==="null",leftIsAny:t==="any",rightIsAny:e==="any",bothAreAny:t==="any"&&e==="any",leftIsRange:t==="range",rightIsRange:e==="range"}}};d([m()],j.prototype,"_featureClone",void 0),d([m()],j.prototype,"_arcadeContextInfo",null),d([m()],j.prototype,"updating",null),d([m({readOnly:!0})],j.prototype,"allInputFields",null),d([m()],j.prototype,"_layerFieldsByName",null),d([m()],j.prototype,"arcadeEditType",void 0),d([m()],j.prototype,"contingencyConstraintViolations",void 0),d([m()],j.prototype,"feature",null),d([m()],j.prototype,"fieldsWithContingentValues",null),d([m({type:en})],j.prototype,"formTemplate",null),d([m()],j.prototype,"formDescription",null),d([m()],j.prototype,"formTitle",null),d([m()],j.prototype,"inputFields",void 0),d([m()],j.prototype,"joinedContingentValues",null),d([m()],j.prototype,"layer",null),d([m()],j.prototype,"messages",void 0),d([m()],j.prototype,"spatialReference",null),d([m()],j.prototype,"state",null),d([m()],j.prototype,"strict",void 0),d([m()],j.prototype,"submittable",null),d([m()],j.prototype,"valid",null),d([m()],j.prototype,"view",void 0),d([m()],j.prototype,"getValues",null),d([m()],j.prototype,"submit",null),j=d([ee("esri.widgets.FeatureForm.FeatureFormViewModel")],j);const Mt=t=>t.type==="group",Di=t=>t.reduce((e,i)=>Ie(i)?[...e,...i.inputFields]:[...e,i],[]),Lt=(t,e,i)=>{f(e)&&t.set(e,i)},ya=j,Pi="TT",Ne="data-field-name",Ri="latn",Dt=t=>"valueAsDate"in t;let Z=class extends Yt{constructor(t,e){super(t,e),this._dateInputFieldMap=new Map,this._activeInputName="",this._activeNumberFieldEdit=null,this._fieldFocusNeeded=!1,this._fieldToInitialIncompatibleDomainValue=new Map,this._switchFieldsWithInitialIncompatibleValue=new Set,this._userUpdatedInputFieldNames=new Set,this.disabled=!1,this.groupDisplay="all",this.headingLevel=2,this.messages=null,this.messagesTemplates=null,this.viewModel=new ya,this._handleInputInput=i=>{this._commitInputValue(i.currentTarget)},this._handleFormKeyDown=this._handleFormKeyDown.bind(this),this._handleInputBlur=this._handleInputBlur.bind(this),this._handleInputFocus=this._handleInputFocus.bind(this),this._handleNumberInputMouseDown=this._handleNumberInputMouseDown.bind(this),this._handleInputKeyDown=this._handleInputKeyDown.bind(this),this._handleOptionChange=this._handleOptionChange.bind(this),this._handleGroupClick=this._handleGroupClick.bind(this),this._handleSubmit=this._handleSubmit.bind(this),this._afterInputCreateOrUpdate=this._afterInputCreateOrUpdate.bind(this),this._afterDateInputCreateOrUpdate=this._afterDateInputCreateOrUpdate.bind(this)}initialize(){this.addHandles([re(()=>this.feature,()=>{const t=this._getFocusableInput("forward");this._activeInputName=(t==null?void 0:t.name)||"",this._userUpdatedInputFieldNames.clear(),this._fieldToInitialIncompatibleDomainValue.clear(),this._switchFieldsWithInitialIncompatibleValue.clear(),this._dateInputFieldMap.clear(),this._fieldFocusNeeded=!0}),this.on("submit",t=>{if(t.invalid.length>0){const[e]=t.invalid;t.invalid.forEach(i=>this._userUpdatedInputFieldNames.add(i)),this._activeInputName=e,this._fieldFocusNeeded=!0,this.scheduleRender()}})])}loadDependencies(){return Promise.all([ue(()=>import("./calcite-combobox-8caec24c.js"),["assets/calcite-combobox-8caec24c.js","assets/mapviewstore-8a6f290e.js","assets/index-93a23f67.js","assets/index-2d69a2d2.css","assets/filter2-f9cbea7a.js","assets/debounce-31e0cfcc.js","assets/openCloseComponent-ada6c573.js","assets/label2-08d7e4b0.js","assets/guid-9426053f.js","assets/interactive-573cbe88.js","assets/loadable-25ad9e4e.js","assets/t9n-2a1e9a0c.js","assets/key-4e6b67a3.js","assets/observers-4f67f1fb.js","assets/utils2-f58e4863.js","assets/conditionalSlot-b60889bf.js","assets/icon-b51674d0.js"]),ue(()=>import("./calcite-combobox-item-0cea29e7.js"),["assets/calcite-combobox-item-0cea29e7.js","assets/mapviewstore-8a6f290e.js","assets/index-93a23f67.js","assets/index-2d69a2d2.css","assets/conditionalSlot-b60889bf.js","assets/observers-4f67f1fb.js","assets/guid-9426053f.js","assets/interactive-573cbe88.js","assets/utils2-f58e4863.js","assets/icon-b51674d0.js"]),ue(()=>import("./calcite-combobox-item-group-e6917e4e.js"),["assets/calcite-combobox-item-group-e6917e4e.js","assets/mapviewstore-8a6f290e.js","assets/index-93a23f67.js","assets/index-2d69a2d2.css","assets/guid-9426053f.js","assets/utils2-f58e4863.js"]),ue(()=>import("./calcite-input-message-b95d2783.js"),["assets/calcite-input-message-b95d2783.js","assets/mapviewstore-8a6f290e.js","assets/index-93a23f67.js","assets/index-2d69a2d2.css","assets/icon-b51674d0.js","assets/observers-4f67f1fb.js"]),ue(()=>import("./calcite-progress-df79cc30.js"),["assets/calcite-progress-df79cc30.js","assets/progress-3653ca0b.js","assets/mapviewstore-8a6f290e.js","assets/index-93a23f67.js","assets/index-2d69a2d2.css"]),ue(()=>import("./calcite-switch-809be9bb.js"),["assets/calcite-switch-809be9bb.js","assets/mapviewstore-8a6f290e.js","assets/index-93a23f67.js","assets/index-2d69a2d2.css","assets/label2-08d7e4b0.js","assets/interactive-573cbe88.js","assets/key-4e6b67a3.js","assets/loadable-25ad9e4e.js"]),ue(()=>import("./calcite-input-date-picker-c6f3c1fc.js"),["assets/calcite-input-date-picker-c6f3c1fc.js","assets/mapviewstore-8a6f290e.js","assets/index-93a23f67.js","assets/index-2d69a2d2.css","assets/t9n-2a1e9a0c.js","assets/key-4e6b67a3.js","assets/observers-4f67f1fb.js","assets/openCloseComponent-ada6c573.js","assets/debounce-31e0cfcc.js","assets/label2-08d7e4b0.js","assets/interactive-573cbe88.js","assets/loadable-25ad9e4e.js","assets/Heading-6f2abfee.js","assets/icon-b51674d0.js","assets/input-a9797900.js","assets/progress-3653ca0b.js"]),ue(()=>import("./calcite-input-time-picker-eadb04c5.js"),["assets/calcite-input-time-picker-eadb04c5.js","assets/mapviewstore-8a6f290e.js","assets/index-93a23f67.js","assets/index-2d69a2d2.css","assets/label2-08d7e4b0.js","assets/guid-9426053f.js","assets/interactive-573cbe88.js","assets/key-4e6b67a3.js","assets/loadable-25ad9e4e.js","assets/t9n-2a1e9a0c.js","assets/observers-4f67f1fb.js","assets/icon-b51674d0.js","assets/action-ad3f0c6e.js","assets/loader-b5129b3f.js","assets/input-a9797900.js","assets/progress-3653ca0b.js","assets/popover-ddaba2ad.js","assets/openCloseComponent-ada6c573.js","assets/debounce-31e0cfcc.js","assets/Heading-6f2abfee.js"])])}get feature(){return this.viewModel.feature}set feature(t){this.viewModel.feature=t}get formTemplate(){return this.viewModel.formTemplate}set formTemplate(t){this.viewModel.formTemplate=t}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get layer(){return this.viewModel.layer}set layer(t){this.viewModel.layer=t}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(t){this.viewModel.spatialReference=t}get strict(){return this.viewModel.strict}set strict(t){this.viewModel.strict=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}getValues(){return this.viewModel.getValues()}submit(){return this.viewModel.submit()}render(){const{state:t}=this.viewModel;return x("div",{class:this.classes(A.base,A.widget,A.panel)},t==="ready"?this.renderForm():null)}renderForm(){const t=this.viewModel,e=f(t.formTitle)&&x(di,{key:"title",level:this.headingLevel},t.formTitle),i=f(t.formDescription)&&x("p",{class:A.description,key:"description"},t.formDescription),n=e||i?x("div",{class:A.formHeader},e,i):null;return x("form",{class:A.form,novalidate:!0,onsubmit:this._handleSubmit,onkeydown:this._handleFormKeyDown},n,this.renderFields())}renderFields(){const{viewModel:{inputFields:t}}=this;return t.filter(e=>e.visible).map((e,i)=>Ie(e)?this.renderGroup(e,i):this.renderLabeledField(e))}renderGroup(t,e){const{formTemplate:i,disabled:n}=this,{description:s,inputFields:a,label:o,state:l}=t,r=a.filter(w=>w.visible),u=this.viewModel.findField(this._activeInputName),c=!(!u||u.group!==t),p=`${this.id}_group_${e}`,h=`${this.id}_group-label_${e}`,g=`${this.id}_group-description_${e}`,_=s?x("p",{class:this.classes(A.groupDescription,A.description),id:g},s):null,y=this.groupDisplay==="sequential",b=y?c:l==="expanded",E=b?A.collapseIcon:A.expandIcon;return x("fieldset",{"aria-expanded":b.toString(),"aria-labelledby":h,"aria-describedby":s?g:"",class:this.classes(A.group,y?A.groupSequential:null,b?null:A.groupCollapsed,c?A.groupActive:null,n?A.inputDisabled:null),disabled:n,"data-group":t,id:p,key:e,onclick:this._handleGroupClick},x("button",{role:y?"presentation":void 0,class:A.groupHeader,type:"button",tabIndex:y?-1:0},x("div",{class:A.groupTitle},x(di,{class:A.groupLabel,id:h,level:f(i)&&i.title?os(this.headingLevel):this.headingLevel},o),_),y?null:x("span",{class:this.classes(E,A.groupToggleIcon)})),r.map(w=>this.renderLabeledField(w)))}_getFocusableInput(t,e){const i=this.viewModel.allInputFields,n=t==="forward"?i:i.slice().reverse();let s;if(e)if(Ie(e))s=n.indexOf(e.inputFields[0]);else{let a;if(this._isInputFieldInGroup(e)&&e.group.state==="collapsed"){const{inputFields:o}=e.group;a=t==="forward"?o[o.length-1]:o[0]}else a=e;s=n.indexOf(a)+1}else s=0;for(let a=s;a<n.length;a++){const o=n[a];if(o.visible)return o}return null}renderLabeledField(t){const{feature:e,label:i,layer:n,type:s}=t;return x("label",{key:`${n.id}-${e.uid}-${t.name}`,class:A.label},[i,s!=="unsupported"?this.renderInputField(t):this.renderUnsupportedField(t),this.renderAuxiliaryText(t)])}renderInputField(t){const{domain:e,name:i,type:n,updating:s,value:a}=t,o=this.getCommonInputProps(t);if((e==null?void 0:e.type)==="coded-value"){if(me(t.fieldElement,"switch")){const{fieldElement:r}=t;if(!(this._switchFieldsWithInitialIncompatibleValue.has(i)||a==null||r.input.onValue!==a&&r.input.offValue!==a))return this.renderSwitchInputField(t,o);this._switchFieldsWithInitialIncompatibleValue.add(i)}return t.inputType==="radio-buttons"?this.renderRadioButtonsInputField(t,e.codedValues.map(({code:r,name:u})=>({value:r,name:u})),o):this.renderSelectInputField(t,this._getFieldValueOptions(i,e),o)}if(t.inputType==="datetime-picker"||n==="date")return this.renderDateInputField(t,o);const l=n==="number"?x("input",{type:"number",...o,value:f(this._activeNumberFieldEdit)&&this._activeNumberFieldEdit.fieldName===t.name?this._activeNumberFieldEdit.value:`${o.value}`}):t.inputType==="text-area"?x("textarea",{...o}):x("input",{type:"text",...o});return s?x("div",{class:A.inputFieldWrapper},l,x("div",{class:A.inputFieldLoader},x("calcite-progress",{type:"indeterminate"}))):l}renderDateInputField(t,e){const{includeTime:i,label:n,name:s,valid:a,value:o}=t,{readOnly:l,required:r}=e,{date:u,time:c}=this._formatValueForDateInputs(o),p=f(e.max)?this._formatValueForDateInputs(e.max):void 0,h=f(e.min)?this._formatValueForDateInputs(e.min):void 0,g=(p==null?void 0:p.date)??void 0,_=(h==null?void 0:h.date)??void 0,y={afterCreate:this._afterDateInputCreate,afterUpdate:this._afterDateInputCreateOrUpdate,"aria-invalid":!a,label:n,numberingSystem:Ri,overlayPositioning:"fixed",readOnly:l,required:r,tabIndex:0,[Ne]:s};return x("div",{key:`${e.key}-date-time-container`,class:A.dateInputContainer},x("calcite-input-date-picker",{bind:this,...y,class:this.classes(e.class,A.inputDate),"data-date-part":"date",key:`${e.key}-date-input`,valueAsDate:u??void 0,maxAsDate:g,minAsDate:_,onCalciteInputDatePickerChange:b=>this._commitDateChanges(b.target),onblur:b=>this._commitDateChanges(b.target,!0)}),i?x("calcite-input-time-picker",{bind:this,...y,class:this.classes(e.class,A.inputTime),"data-date-part":"time",key:`${e.key}-time-input`,value:c??void 0,step:1,onCalciteInputTimePickerChange:b=>this._commitDateChanges(b.target),onfocus:b=>{b.target.calciteTimePickerEl&&(b.target.calciteTimePickerEl.showSecond=!0)},onblur:b=>this._commitDateChanges(b.target,!0)}):null)}renderUnsupportedField(t){const e=this.getCommonInputProps(t);return x("input",{afterCreate:e.afterCreate,afterUpdate:e.afterUpdate,class:this.classes(A.input,A.inputField,A.inputDisabled),onfocus:e.onfocus,readOnly:!0,tabIndex:e.tabIndex,type:"text",value:e.value,[Ne]:e[Ne]})}renderSelectInputField(t,e,i){const{value:n}=t,{messages:s,messagesTemplates:a}=this,o=e.map(p=>p.map(h=>x("calcite-combobox-item",{value:`${h.value}`,textLabel:h.name,key:`#${h.value}`,selected:n===h.value}))),[l,r]=o;this._registerIncompatibleValue(n,e.flat(),t,p=>{r.unshift(x("calcite-combobox-item",{value:`${p}`,textLabel:`${p}`,key:"incompatible-option",readOnly:!0}))});const u=r.length>0?[x("calcite-combobox-item-group",{key:"recommended",label:s.recommended},l),x("calcite-combobox-item-group",{key:"other",label:a.other},r)]:l,c=T(t.fieldElement)||me(t.fieldElement,"combo-box")&&t.fieldElement.input.showNoValueOption;if(!t.required&&c){const p="",h=me(t.fieldElement,"combo-box")&&t.fieldElement.input.noValueOptionLabel||this.messages.empty;u.unshift(x("calcite-combobox-item",{value:p,textLabel:this.messages.empty,key:"empty-option"},h))}return x("calcite-combobox",{...i,selectionMode:"single",disabled:i.readOnly,allowCustomValues:!1,onCalciteComboboxChange:p=>this._handleOptionChange(p.target)},u)}_registerIncompatibleValue(t,e,i,n){const s=this._fieldToInitialIncompatibleDomainValue,a=s.has(i.name);(a||t!=null&&t!==""&&!e.some(o=>o.value===t))&&(a||s.set(i.name,t),n==null||n(t))}renderRadioButtonsInputField(t,e,i){const{value:n}=t,s=e.map(o=>this.renderRadioButton({key:o.name,label:o.name,name:t.name,value:o.value,selected:o.value===n,props:i}));this._registerIncompatibleValue(n,e,t);const a=T(t.fieldElement)||me(t.fieldElement,"radio-buttons")&&t.fieldElement.input.showNoValueOption;if(!t.required&&a){const o="",l=me(t.fieldElement,"radio-buttons")&&t.fieldElement.input.noValueOptionLabel||this.messages.empty,r=n===o||n===null;s.unshift(this.renderRadioButton({key:"empty-option",label:l,name:t.name,value:o,selected:r,props:i}))}return x("div",{key:`${i.key}-radio`,class:A.inputRadioGroup},s)}renderSwitchInputField(t,e){const{value:i}=t,n=!!me(t.fieldElement,"switch")&&i===t.fieldElement.input.onValue;return x("calcite-switch",{...e,class:A.inputSwitch,onCalciteSwitchChange:s=>this._commitInputValue(s.target),checked:n,disabled:e.readOnly})}renderRadioButton({key:t,name:e,value:i,selected:n,label:s,props:a}){return x("label",{key:t,class:A.inputRadioLabel},x("input",{...a,class:A.inputRadio,name:e,type:"radio",value:i,checked:n,disabled:a.readOnly,onchange:o=>this._commitInputValue(o.target)}),s)}renderAuxiliaryText(t){const e=this._userUpdatedInputFieldNames.has(t.name)&&!t.valid?t.errorMessage:f(this.viewModel.contingencyConstraintViolations.get(t.name))?this.messages.validationErrors.valuesIncompatible:f(t.valueExpressionExecutor)&&t.valueExpressionExecutor.stale?this.messages.valueExpressionError:null;return f(e)?x("calcite-input-message",{status:"invalid",icon:!0},e):t.description?x("div",{key:"description",class:A.description},t.description):null}getCommonInputProps(t){const{disabled:e,groupDisplay:i}=this,{editable:n,group:s,hint:a,label:o,maxLength:l,minLength:r,name:u,required:c,type:p,valid:h,value:g}=t,_=this._userUpdatedInputFieldNames.has(u),y=!n||e,b=i==="all"&&f(s)&&s.state==="collapsed";return{afterCreate:this._afterInputCreateOrUpdate,afterUpdate:this._afterInputCreateOrUpdate,"aria-invalid":h?"false":"true",class:this.classes(A.input,A.inputField,y?A.inputDisabled:null,_&&!h?A.inputInvalid:null),key:u,label:o,minlength:r>-1?`${r}`:"",maxlength:l>-1?`${l}`:"",...this._getNumberFieldConstraints(t),readOnly:y,value:g==null?"":`${g}`,[Ne]:u,onfocus:this._handleInputFocus,oninput:this._handleInputInput,onblur:this._handleInputBlur,onkeydown:this._handleInputKeyDown,onmousedown:p==="number"?this._handleNumberInputMouseDown:null,placeholder:p==="number"||p==="text"?a:"",required:c,tabIndex:b?-1:0}}_isInputFieldInGroup(t){return!Ie(t)&&f(t.group)}_handleNumberInputMouseDown({target:t}){t.focus(),this.scheduleRender()}_getFieldValueOptions(t,e){const i=e.codedValues.map(({code:s,name:a})=>({value:s,name:a})),n=this.viewModel.fieldsWithContingentValues.has(t)?this._getContingentValueOptions(t):[];if(n.length>0){const s=new Set(n.map(a=>a.value));return[n,i.filter(a=>!s.has(a.value))]}return[i,[]]}_getContingentValueOptions(t){const e={};for(const s of this.viewModel.allInputFields){const{name:a,value:o}=s;!T(o)&&a!==t&&this.viewModel.fieldsWithContingentValues.has(a)&&(e[a]=o)}const i=this.viewModel.joinedContingentValues.slice(),n=new Map;for(const s of i){const a=s.values[t];if(T(a)||a.objectType!=="code"&&a.objectType!=="null")continue;const{code:o,name:l}=a.codedValue&&a.objectType!=="null"?a.codedValue:{code:"",name:this.messages.empty};n.has(o)||Object.entries(e).every(([r,u])=>!s.values.hasOwnProperty(r)||this._valueIsValidContingentValue(u,s.values[r]))&&n.set(o,{name:l,value:o})}return[...n.values()]}_getInputFieldFromInput(t){return this.viewModel.findField(t.getAttribute(Ne))}_getNumberFieldConstraints(t){const e=Xi(t.domain)||Zi(t.field);return e&&e.max!==Number.MAX_VALUE&&e.min!==Number.MIN_VALUE?e:{min:null,max:null}}async _afterDateInputCreate(t){!Dt(t)&&f(t.value)&&"setValue"in t&&t.setValue({value:t.value,origin:"external"}),this._afterDateInputCreateOrUpdate(t)}_afterDateInputCreateOrUpdate(t){const{name:e}=this._getInputFieldFromInput(t),i=this._dateInputFieldMap.get(e),n=Dt(t);f(i)?n?i.date=t:i.time=t:this._dateInputFieldMap.set(e,{[n?"date":"time"]:t}),this._afterInputCreateOrUpdate(t)}_afterInputCreateOrUpdate(t){const{viewModel:e}=this,i=this._getInputFieldFromInput(t),n=e.findField(this._activeInputName),s=this._fieldToInitialIncompatibleDomainValue.get(i.name)===i.value;this._fieldFocusNeeded&&n===i&&(i.inputType!=="radio-buttons"||s||t.checked)&&(this._fieldFocusNeeded=!1,this._isInputFieldInGroup(i)&&(i.group.state="expanded"),t.focus())}_handleInputFocus(t){const e=t.target,i=this._getInputFieldFromInput(e);this._activeInputName=i.name,this._isNumberInputField(i)&&(this._activeNumberFieldEdit={fieldName:i.name,input:e,value:e.value})}_isNumberInputField({domain:t,inputType:e="text-box",type:i}){return i==="number"&&e==="text-box"&&(!t||t.type!=="coded-value")}_handleInputBlur(t){const e=t.target,i=this._getInputFieldFromInput(e);i.type==="number"&&f(this._activeNumberFieldEdit)&&(this._activeNumberFieldEdit.input.value=`${i.value}`,this._activeNumberFieldEdit=null),this._commitInputValue(e),this.scheduleRender()}_commitDateChanges(t,e=!1){const{name:i}=this._getInputFieldFromInput(t);if(!this._dateInputFieldMap.has(i))return;const n=this._dateInputFieldMap.get(i);if(!n||!n.date)return;const s=this._getFieldValueFromDateInput(t),a=this._getFieldValueFromDateInputs(n.date,n.time);this.viewModel.getValue(i)!==a&&(s!==null&&a!==null?this._updateFieldValue(i,a):e&&this._updateFieldValue(i,null))}_commitInputValue(t){const e=this._getInputFieldFromInput(t);f(this._activeNumberFieldEdit)&&this._isNumberInputField(e)&&(this._activeNumberFieldEdit.value=t.value),this._updateFieldValue(e.name,this._parseValue(t))}_handleInputKeyDown(t){const{key:e,altKey:i,ctrlKey:n,metaKey:s}=t,a=this._getInputFieldFromInput(t.target);if(e==="Enter")this._isInputFieldInGroup(a)&&a.group.state==="collapsed"&&(a.group.state="expanded");else{const{type:o}=a.field,l=o==="single"||o==="double";if((o==="integer"||o==="small-integer"||l)&&!i&&!n&&!s&&e.length===1){const r=Number(e),u=["-","+"],c=["e","."],p=l?[...u,...c]:u;isNaN(r)&&!p.includes(e)&&t.preventDefault()}}}_updateFieldValue(t,e){if(this.viewModel.setValue(t,e),this._userUpdatedInputFieldNames.add(t),this.viewModel.fieldsWithContingentValues.has(t)){const i=Object.fromEntries(Object.entries(this.getValues()).filter(([n,s])=>f(s)));this.viewModel.validateContingencyConstraints(i)}}_parseValue(t){const e=this._getInputFieldFromInput(t),i=t.value;if(me(e.fieldElement,"switch")&&t.tagName!=="CALCITE-COMBOBOX")return t.checked?e.fieldElement.input.onValue:e.fieldElement.input.offValue;if(e.inputType==="radio-buttons"&&t.type==="radio"&&!t.checked)return e.value;const{type:n}=e;return n==="number"?i?parseFloat(i):null:i}_handleOptionChange(t){this._commitInputValue(t),this.scheduleRender()}_handleGroupClick(t){var a;const e=t.currentTarget["data-group"],i=e.state==="expanded",n=this.groupDisplay==="sequential",s=`.${A.groupHeader}`;if(!(i&&!t.target.closest(s))){if(this._activeInputName=((a=this._getFocusableInput("forward",e))==null?void 0:a.name)||"",n){const o=t.target.closest(s);if(i&&!o)return;this.viewModel.inputFields.forEach(l=>{Ie(l)&&l!==e&&(l.state="collapsed")})}e.state=i?"collapsed":"expanded",this._fieldFocusNeeded=n,this.scheduleRender()}}_handleSubmit(t){t.preventDefault()}_handleFormKeyDown(t){t.key==="Enter"&&this.viewModel.submit()}_getDefaultLocaleOptions(){return{locale:rs(),numberingSystem:Ri}}_getFieldValueFromDateInputs(t,e){const i=this._getDateTimeFromInput(t),n=this._getDateTimeFromInput(e);if(!i&&!n)return null;const s=this._getInputFieldFromInput(t),a=this._getNumberFieldConstraints(s),o=Date.now(),l=f(a.max)&&a.max<o?a.max:o,r=Ze.fromMillis(l,this._getDefaultLocaleOptions()),u=i||r,{year:c,month:p,day:h}=u,{hour:g,minute:_,second:y}=n||r,b=u.set({year:c,month:p,day:h,hour:g,minute:_,second:y});return b.isValid?b.toMillis():null}_getDateTimeFromInput(t){if(!t)return null;let e=null;if(Dt(t)){const i=t.valueAsDate;if(!i||Array.isArray(i))return null;e=Ze.fromJSDate(i)}else{if(!t.value)return null;e=Ze.fromFormat(t.value,Pi,this._getDefaultLocaleOptions())}return e??null}_getFieldValueFromDateInput(t){return this._dateTimeToFieldValue(this._getDateTimeFromInput(t))}_dateTimeToFieldValue(t){return t!=null&&t.isValid?t.toMillis():null}_dateTimeFromFieldValue(t){return t===null?null:Ze.fromMillis(t,this._getDefaultLocaleOptions())}_formatValueForDateInputs(t){if(t==null||isNaN(t))return{date:null,time:null};const e=this._dateTimeFromFieldValue(t);return e?{date:e.toJSDate(),time:e.toFormat(Pi,this._getDefaultLocaleOptions())}:{date:null,time:null}}_valueIsValidContingentValue(t,e){var i;switch(e.objectType){case"any":return!0;case"null":return t==null;case"code":return t===((i=e.codedValue)==null?void 0:i.code);case"range":return f(t)&&f(e.minValue)&&f(e.maxValue)&&t>=e.minValue&&t<=e.maxValue;default:return Yi(e.objectType),!1}}};d([m()],Z.prototype,"disabled",void 0),d([m()],Z.prototype,"feature",null),d([m()],Z.prototype,"formTemplate",null),d([m()],Z.prototype,"groupDisplay",void 0),d([m()],Z.prototype,"headingLevel",void 0),d([m()],Z.prototype,"label",null),d([m()],Z.prototype,"layer",null),d([m(),qe("esri/widgets/FeatureForm/t9n/FeatureForm")],Z.prototype,"messages",void 0),d([m(),qe("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],Z.prototype,"messagesTemplates",void 0),d([m()],Z.prototype,"spatialReference",null),d([m()],Z.prototype,"strict",null),d([m()],Z.prototype,"view",null),d([m(),Ji(["value-change","submit"])],Z.prototype,"viewModel",void 0),Z=d([ee("esri.widgets.FeatureForm")],Z);const _a=Z,ba=Qe("correctFeature",()=>{let t;const e=ve().getView(),i=new en({elements:[{type:"group",label:"基本信息",description:"展示景点基本信息",elements:[{type:"field",fieldName:"name",label:"景点名称",editableExpression:"return false"},{type:"field",fieldName:"pointstime",label:"日期",editableExpression:"return false"},{type:"field",fieldName:"typeName",label:"类型名称",editableExpression:"return false"}]},{type:"group",label:"修正分类",description:"执行修正景点分类的操作",elements:[{type:"field",fieldName:"class",label:"景点分类",editableExpression:"return true",input:{type:"combo-box",showNoValueOption:!1},domain:{type:"coded-value",name:"class",codedValues:[{name:"环境优美",code:"环境优美"},{name:"环境良好",code:"环境良好"},{name:"环境一般",code:"环境一般"},{name:"环境较差",code:"环境较差"},{name:"环境恶劣",code:"环境恶劣"}]}}]}]});let n;async function s(r,u,c){await u.queryFeatures({objectIds:[r],outFields:["*"],returnGeometry:!0}).then(p=>{p.features.length>0&&(t=p.features[0],c.feature=t)})}function a(r,u){u.applyEdits(r).catch(c=>{console.log("==============================================="),console.error("[ applyEdits ] FAILURE: ",c.code,c.name,c.message),console.log("error = ",c)})}function o(r){const u=e.map.layers.find(c=>c.id==="points");u.formTemplate=i,n=new _a({view:e,container:r.value,groupDisplay:"sequential",layer:u}),e.on("click",c=>{e.hitTest(c).then(p=>{if(p.results.length===0)return;const h=p.results[0];h.graphic&&h.graphic.layer===u&&s(h.graphic.attributes.ObjectId,u,n)})}),n.on("submit",()=>{if(t){const c=n.getValues();Object.keys(c).forEach(h=>{t.attributes[h]=c[h]}),a({updateFeatures:[t]},u)}})}function l(){n.submit()}return{createFeaturefrom:o,submitForm:l}}),xa=`@charset "UTF-8";.correction-card{display:flex;flex-direction:column;position:fixed;left:0%;bottom:10%;width:30%;height:auto;border-radius:6px;background-image:linear-gradient(-90deg,#182940 0%,#115687 100%);pointer-events:auto;border:0px solid var(--el-card-border-color)}.correction-card__header{display:flex;justify-content:space-between;align-items:center;color:#fff;font-size:1.6rem;font-weight:700;font-style:italic}.esri-feature-form{color:#92c3e4;background-image:linear-gradient(-90deg,#182940 0%,#115687 100%)}.esri-feature-form__description-text{color:#49c5f2a6}
`,Ea={class:"box-card__header"},wa=N("span",null,"景点修正",-1),Fa=rt({__name:"correction",setup(t){const{createFeaturefrom:e,submitForm:i}=ba(),n=z(null);function s(){i()}lt(()=>{e(n)});const a=document.createElement("style");return a.setAttribute("lang","scss"),a.innerHTML=xa,document.head.appendChild(a),(o,l)=>(de(),Le(M(Qt),{class:"correction-card"},{header:B(()=>[N("div",Ea,[wa,U(M(Pt),{class:"button",text:"",style:{color:"#28c3e2","font-size":"18px","font-weight":"bold","font-style":"italic"},onClick:s},{default:B(()=>[Pe("提交表单 ")]),_:1})])]),default:B(()=>[N("div",{class:"correction-featureFrom",ref_key:"correctionRef",ref:n},null,512)]),_:1}))}}),Oi=Qe("pointslayer",()=>{let t=null;function e(){let s=ve().getView();t=us(),s.map.add(t);const a=new jt({title:"{name}",content:[{type:"fields",fieldInfos:[{fieldName:"longitude",label:"经度"},{fieldName:"latitude",label:"纬度"},{fieldName:"city",label:"城市"},{fieldName:"typeName",label:"景点类型"}]}]});t.popupTemplate=a,s.popup.dockEnabled=!1,s.popup.collapsed=!0,s.popup.dockOptions={buttonEnabled:!1,breakpoint:!1,position:"bottom-right"}}function i(s){ve().getView().watch("updating",o=>{o||(s.value=!1)})}function n(){ve().getView().map.removeAll()}return{addpointslayer:e,removepointslayer:n,ispointslayerLoaded:i}}),Ia=N("div",{class:"box-card__header"},[N("span",null,"景点管理")],-1),to=rt({__name:"index",setup(t){const e=z(!0),i=`
        <path class="path" d="
          M 30 15
          L 28 17
          M 25.61 25.61
          A 15 15, 0, 0, 1, 15 30
          A 15 15, 0, 1, 1, 27.99 7.5
          L 15 15
        " style="stroke-width: 4px; fill: rgba(0, 0, 0, 0)"/>
      `,n=z(null),s=z(null),a=z(!0),o=z(!1),l=z(!1),r=z(!1),u=z(!1),c=z(!0);ls(s);const p=z(0),h=z(!1),g=De("flag");let _=[o,l,r];function y(E){if(E===0)for(let w=1;w<_.length;w++)_[w].value=!1;else _[0].value=!1}const b=()=>{u.value=!0};return lt(()=>{setTimeout(()=>{const E=Oi(),w=nn(),V=ps();b(),E.addpointslayer(),E.ispointslayerLoaded(a),w.createTimeslider(n),V.getdata(p,h,g),g.value===!1&&(e.value=!1)},100),ti(l,E=>{E||(r.value=!1)}),ti(p,E=>{E===100&&(e.value=!1)})}),Wt(()=>{Oi().removepointslayer()}),bt("watchV2",c),bt("percentage",p),bt("isActive",h),(E,w)=>{const V=yn("loading");return de(),Be("div",{ref_key:"screenRef",ref:s,class:"screen"},[h.value?(de(),Le(M(zi),{key:0,type:"circle","stroke-width":15,percentage:p.value,style:{position:"absolute",left:"18%",top:"17%","pointer-events":"auto",height:"auto"}},null,8,["percentage"])):je("",!0),U(xn,{name:"right-slide-in"},{default:B(()=>[U(M(Qt),{class:"box-card",style:_n({left:u.value?"0%":"-380px"}),"body-style":{height:"80%"}},{header:B(()=>[Ia]),default:B(()=>[U(M(En),{justify:"space-between"},{default:B(()=>[U(M(ft),{style:{height:"33.33%"}},{default:B(()=>[U(M(gt),null,{default:B(()=>[Pe("景点环境监测")]),_:1}),bn(U(M(vt),{modelValue:o.value,"onUpdate:modelValue":w[0]||(w[0]=v=>o.value=v),class:"box-card__switch",size:"large",style:{"margin-left":"8%"},"inline-prompt":"","active-icon":M(yt),"inactive-icon":M(_t),disabled:a.value,onChange:w[1]||(w[1]=v=>y(0)),"element-loading-text":"Loading...","element-loading-spinner":i,"element-loading-svg-view-box":"-10, -10, 50, 50","element-loading-background":"rgba(122, 122, 122, 0.8)"},null,8,["modelValue","active-icon","inactive-icon","disabled"]),[[V,e.value]])]),_:1}),U(M(ft),{style:{height:"33.33%"}},{default:B(()=>[U(M(gt),null,{default:B(()=>[Pe("景点模糊分类")]),_:1}),U(M(vt),{modelValue:l.value,"onUpdate:modelValue":w[2]||(w[2]=v=>l.value=v),class:"box-card__switch",size:"large",style:{"margin-left":"8%"},"inline-prompt":"","active-icon":M(yt),"inactive-icon":M(_t),disabled:a.value,onChange:w[3]||(w[3]=v=>y(1))},null,8,["modelValue","active-icon","inactive-icon","disabled"])]),_:1}),U(M(ft),{style:{height:"33.33%"}},{default:B(()=>[U(M(gt),null,{default:B(()=>[Pe("修正旅游景点")]),_:1}),U(M(vt),{modelValue:r.value,"onUpdate:modelValue":w[4]||(w[4]=v=>r.value=v),class:"box-card__switch",size:"large",style:{"margin-left":"8%"},"inline-prompt":"","active-icon":M(yt),"inactive-icon":M(_t),disabled:c.value,onChange:w[5]||(w[5]=v=>y(2))},null,8,["modelValue","active-icon","inactive-icon","disabled"])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1}),N("div",{class:"timeSlider",ref_key:"timeSliderRef",ref:n},null,512),o.value?(de(),Le(Gs,{key:1})):je("",!0),l.value?(de(),Le(Ys,{key:2})):je("",!0),r.value?(de(),Le(Fa,{key:3})):je("",!0)],512)}}});export{to as default};
