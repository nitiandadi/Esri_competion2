import{as as b,r as h,he as P,e as a,y as l,a as O,qI as R,t as _,c4 as E,hG as G,fq as C,ht as $,hD as x,dS as M,hI as j,gA as F,il as I,gs as H,d9 as f,jr as g,hB as S,fT as V,bY as c,dI as y,qQ as D,qR as q,o as v}from"./MapView-d4248bee.js";import{t as W}from"./VisualElement-62e5dd07.js";const T=p=>{let e=class extends b(p){constructor(){super(...arguments),this.parent=null,this._userInteractive=!1,this._interactiveViewModelCount=0}get interactive(){return this._interactiveViewModelCount>0||this._userInteractive}set interactive(t){this._userInteractive=t}get updating(){return!1}get visible(){return!h(this.parent)||this.parent.visible&&!this.parent.suspended}set visible(t){this._overrideIfSome("visible",t)}forceInteractiveForViewModel(){return this._interactiveViewModelCount++,P(()=>this._interactiveViewModelCount--)}};return a([l({readOnly:!0})],e.prototype,"type",void 0),a([l({constructOnly:!0})],e.prototype,"analysis",void 0),a([l({constructOnly:!0})],e.prototype,"parent",void 0),a([l({constructOnly:!0})],e.prototype,"view",void 0),a([l({type:Boolean})],e.prototype,"interactive",null),a([l()],e.prototype,"_userInteractive",void 0),a([l({readOnly:!0})],e.prototype,"updating",null),a([l()],e.prototype,"visible",null),a([l()],e.prototype,"_interactiveViewModelCount",void 0),e=a([O("esri.views.3d.analysis.AnalysisView3D")],e),e};function z(p,e,t,r=!1){const s=R(p,e);return _(s)?null:(s.hasZ&&!r||!h(t)||(s.z=E(G(t,s),0)),s)}function Y(p,e,t){t.warnOnce(`Failed to project analysis geometry (id: '${p.id}'), projection from spatial reference (wkid: '${e.wkid}') to view spatial reference is not supported. Projection may be possible after calling projection.load().`)}class A extends W{constructor(e){super(e.view),this._resources=null,this._transform=C()}get object(){return h(this._resources)?this._resources.object:null}get transform(){return this._transform}set transform(e){$(this._transform,e),h(this._resources)&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if(_(this._resources))return;const e=this._resources.object,t=this.view._stage;t.removeMany(e.geometries),e.removeAllGeometries(),this.createGeometries(e),e.visible=this.visible,t.addMany(e.geometries)}createResources(){this.destroyResources();const e=this.view._stage;if(!e)return;const t=new x({pickable:!1,updatePolicy:M.SYNC});e.add(t);const r=new j({castShadow:!1});r.transformation=this._transform,this.createExternalResources(),this.createGeometries(r),e.addMany(r.geometries),this.forEachExternalMaterial(s=>e.add(s)),e.add(r),t.add(r),r.visible=this.visible,this._resources={layer:t,object:r}}destroyResources(){const e=this.view._stage;!_(this._resources)&&e&&(e.remove(this._resources.object),e.remove(this._resources.layer),this.forEachExternalMaterial(t=>{e.remove(t),t.dispose()}),e.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(e){_(this._resources)||(this._resources.object.visible=e)}}class N extends A{constructor(e,t){super(e),this._hasExternalMaterial=!1,this._hasExternalMaterial=h(t),this._material=h(t)?t:new F({width:1,color:I(1,0,1,1),stippleOffColor:null,stipplePattern:null,stipplePreferContinuous:!0,isClosed:!1,falloff:0,innerColor:null,innerWidth:1,hasPolygonOffset:!1,renderOccluded:H.OccludeAndTransparent,writeDepth:!0}),this.applyProps(e)}setGeometryFromRenderSpacePoint(e,t=1e3){this.geometry=[[[e[0]-t,e[1]+0,e[2]+0],[e[0]+t,e[1]+0,e[2]+0]],[[e[0]-0,e[1]-t,e[2]+0],[e[0]+0,e[1]+t,e[2]+0]],[[e[0]-0,e[1]+0,e[2]-t],[e[0]+0,e[1]+0,e[2]+t]]]}setGeometryFromExtent(e){const t=this.view.spatialReference,r=c(),s=c(),o=100,i=[];f(r,e[0],e[1],o),this.view.renderCoordsHelper.toRenderCoords(r,t,s),i.push([s[0],s[1],s[2]]),f(r,e[2],e[1],o),this.view.renderCoordsHelper.toRenderCoords(r,t,s),i.push([s[0],s[1],s[2]]),f(r,e[2],e[3],o),this.view.renderCoordsHelper.toRenderCoords(r,t,s),i.push([s[0],s[1],s[2]]),f(r,e[0],e[3],o),this.view.renderCoordsHelper.toRenderCoords(r,t,s),i.push([s[0],s[1],s[2]]),f(r,e[0],e[1],o),this.view.renderCoordsHelper.toRenderCoords(r,t,s),i.push([s[0],s[1],s[2]]),f(r,e[0],e[1],o),this.view.renderCoordsHelper.toRenderCoords(r,t,s),i.push([s[0],s[1],s[2]]),this.geometry=[i]}setGeometryFromFrustum(e){const t=[];e.lines.forEach(r=>{t.push([r.origin[0],r.origin[1],r.origin[2]]),t.push([r.endpoint[0],r.endpoint[1],r.endpoint[2]])}),this.geometry=[t]}setGeometryFromBoundedPlane(e){const t=[],r=e.origin,s=e.basis1,o=e.basis2,i=.5,n=c(),d=c(),m=c(),u=c();n[0]=r[0]-s[0]*i-o[0]*i,n[1]=r[1]-s[1]*i-o[1]*i,n[2]=r[2]-s[2]*i-o[2]*i,d[0]=r[0]-s[0]*i+o[0]*i,d[1]=r[1]-s[1]*i+o[1]*i,d[2]=r[2]-s[2]*i+o[2]*i,m[0]=r[0]+s[0]*i+o[0]*i,m[1]=r[1]+s[1]*i+o[1]*i,m[2]=r[2]+s[2]*i+o[2]*i,u[0]=r[0]+s[0]*i-o[0]*i,u[1]=r[1]+s[1]*i-o[1]*i,u[2]=r[2]+s[2]*i-o[2]*i,t.push([n[0],n[1],n[2]]),t.push([d[0],d[1],d[2]]),t.push([m[0],m[1],m[2]]),t.push([u[0],u[1],u[2]]),t.push([n[0],n[1],n[2]]),this.geometry=[t]}setGeometryFromSegment(e){const t=e.endRenderSpace;this.transform=g(w,t);const{points:r}=e.createRenderGeometry(t,this.view.renderCoordsHelper);this.geometry=[r]}setGeometryFromSegments(e,t=S){this.transform=g(w,t),this.geometry=e.map(r=>r.createRenderGeometry(t,this.view.renderCoordsHelper).points)}getTransformedGeometry(){return _(this._geometry)?null:this._geometry.map(e=>e.map(t=>V(c(),t,this.transform)))}get renderOccluded(){return this._material.parameters.renderOccluded}set renderOccluded(e){this._material.setParameters({renderOccluded:e})}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get width(){return this._material.parameters.width}set width(e){this._material.setParameters({width:e})}get color(){return this._material.parameters.color}set color(e){this._material.setParameters({color:y(e)})}get innerWidth(){return this._material.parameters.innerWidth}set innerWidth(e){this._material.setParameters({innerWidth:e})}get innerColor(){return this._material.parameters.innerColor}set innerColor(e){this._material.setParameters({innerColor:h(e)?y(e):null})}get stipplePattern(){return this._material.parameters.stipplePattern}set stipplePattern(e){h(this._material)&&this._material.setParameters({stipplePattern:e})}get stippleOffColor(){return this._material.parameters.stippleOffColor}set stippleOffColor(e){this._material.setParameters({stippleOffColor:h(e)?y(e):null})}get stipplePreferContinuous(){return this._material.parameters.stipplePreferContinuous}set stipplePreferContinuous(e){this._material.setParameters({stipplePreferContinuous:e})}get writeDepthEnabled(){return this._material.parameters.writeDepth}set writeDepthEnabled(e){this._material.setParameters({writeDepth:e})}get falloff(){return this._material.parameters.falloff}set falloff(e){this._material.setParameters({falloff:e})}get polygonOffset(){return this._material.parameters.hasPolygonOffset}set polygonOffset(e){this._material.setParameters({hasPolygonOffset:e})}createExternalResources(){}destroyExternalResources(){}createGeometries(e){for(const t of D(this.geometry)){const r=q(v(this._material),t);e.addGeometry(r)}}forEachExternalMaterial(e){this._hasExternalMaterial||e(v(this._material))}}const w=C();export{Y as a,T as b,z as c,N as g,A as n};
