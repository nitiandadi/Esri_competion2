import{j as Ke,k as ue,b as B,d as rt,t as on,o as lt,l as zt,a as de,c as Be,f as N,p as rn,i as ln,_ as un,m as dn,n as De,u as M,E as Ni,q as je,g as O,w as G,s as Lt,v as Pe,x as cn,y as ht,z as pn,A as Ye,B as mn,C as hn,D as fn,F as qt,G as gn,H as Yt,I as vn,J as yn,K as _n,T as bn,L as xn,M as ft,N as gt,O as vt,P as yt,Q as _t,R as En}from"./index-9ba3f23e.js";import{P as wn,H as ji,x as Fn,j as Ui,e as d,y as m,a as J,v as me,s as He,b as nt,c as In,d as We,W as Wt,f as ve,n as b,t as V,r as f,g as Dt,h as Gi,i as Xe,k as ut,l as Bi,m as ae,o as oe,p as Tn,q as Vn,T as se,w as Te,U as Cn,z as Pt,A as Hi,B as Rt,C as $n,D as Xt,E as w,F as zi,G as bt,L as xt,I as kn,J as Sn,K as An,M as qi,S as Zt,N as Et,O as Ot,Q as ei,R as Mn,V as Ln,X as Nt,Y as ti,Z as Dn,_ as Ae,$ as wt,a0 as Pn,a1 as Rn,a2 as On,a3 as Nn,a4 as Wi,a5 as jn,a6 as Un,a7 as Gn,a8 as Bn,a9 as Ze,aa as Hn,ab as zn,ac as qn,ad as Wn,ae as Qn,af as Kn,ag as Ft,ah as ii,ai as ni,aj as si,ak as Jn,al as Yn,am as Xn,an as Zn,ao as ai,ap as es,aq as Qi,ar as Ki,as as ts,at as is,au as ns,av as ss,aw as as,ax as Ji,ay as oi,az as os,aA as rs,aB as et,u as ls}from"./MapView-d4248bee.js";import{u as Je,a as It}from"./useTime-ca88e827.js";import"./liquidFillView-0a9aeed9.js";import{u as ce}from"./visitorLayer-9a30f3f8.js";import{w as Yi,u as us,q as ds,c as cs}from"./onLayerstore-2aa4cd13.js";import{a as jt}from"./axios-760d4776.js";import{c as ri}from"./Subtype-e6096c1f.js";import{c as Tt}from"./ArcadeDate-df6f30d4.js";import{t as ps}from"./ImmutableArray-ee1d0ce7.js";import"./EffectView-a19236b0.js";import"./ExportImageParameters-90912122.js";import"./floorFilterUtils-080a7cd2.js";import"./sublayerUtils-1691c184.js";import"./pixelRangeUtils-03719dd8.js";import"./rendererConversion-90e15c15.js";import"./executionError-fb3f283a.js";let li;function ms(t,e){return li=new wn({field:e,colorStops:[{ratio:0,color:"rgba(0, 255, 0, 0)"},{ratio:.3,color:"rgba(0, 255, 0, 0.5)"},{ratio:.4,color:"rgba(255, 255, 0, 1)"},{ratio:.6,color:"rgba(255, 255, 0, 1)"},{ratio:.7,color:"rgba(255, 140, 0, 1)"}],radius:15,maxDensity:.319,minDensity:0}),t.renderer=li,t.visible=!1,t}function hs(){const e=[{id:0},{id:1},{id:2},{id:3},{id:4},{id:5},{id:6}].map(n=>i(n));function i(n){const s="https://services7.arcgis.com/R5nxHh77a68zEsEp/arcgis/rest/services/AQI%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97/FeatureServer/"+n.id;return new ji({url:s,outFields:["*"],title:"AQI",id:"AQI"+n.id,popupTemplate:{title:"{名称}",content:"AQI: {AQI} mg/m³, 日期: {time}"}})}return e}const Me=[{name:"谢家阶层型剖面",AQI:[89,38,135,143,145,51,118]},{name:"盘道",AQI:[120,87,94,26,58,51,126]},{name:"羌塘组湖积地层",AQI:[68,126,51,140,20,56,70]},{name:"青海湖",AQI:[133,95,113,47,139,29,103]},{name:"年保玉则",AQI:[24,55,106,66,80,100,20]},{name:"鄂陵湖湿地",AQI:[73,81,31,112,121,59,127]},{name:"扎陵湖湿地",AQI:[123,109,97,54,58,146,123]}];async function ze(t,e){const{where:i,attributeUpdates:n}=e,s=new Fn({where:i,outFields:["*"],returnGeometry:!0}),a=await t.queryFeatures(s);if(a.features.length===0)throw console.log(t.id+i),new Error("No features found for query");const o=[];a.features.forEach(r=>{const l=r.clone();for(const c in n)l.attributes[c]=n[c];o.push(l)});const u=await t.applyEdits({updateFeatures:o});if(!u.updateFeatureResults||u.updateFeatureResults.length===0)throw new Error("Update failed");return t}const Xi=Ke("heatmap",()=>{let t=null,e=[],i=null;async function n(r,l,c){const p=ce().getView();i=r,e=hs();const h=Je(),v=h.year,_=h.month,y=h.day,x=new Date(v.value,_.value-1,y.value);let F=new Date(x.getTime());const E=[];for(let g=-4;g<=0;g++)F=new Date(v.value,_.value-1,y.value+g),E.push(F);await Ui(()=>p.ready).then(()=>{c.value=!0,l.value=0;let g=0;e.forEach(async(T,k)=>{if(!(k===0||k===6)){for(const j of Me){const Q=T.createQuery();Q.where=`名称='${j.name}'`,await T.queryFeatures(Q).then(async ie=>{const P=ie.features[0].geometry,re={location:`${P.longitude},${P.latitude}`};await jt.post("http://81.70.22.42:9000/quality/airLast5d",re).then(async Z=>{const _e=`名称='${j.name}'`,le={AQI:Z.data.aqi[k-1]};ze(T,{where:_e,attributeUpdates:le}),g++,l.value=Math.floor(g/(Me.length*10)*100),g===Me.length*10&&setTimeout(()=>{c.value=!1},600),console.log(l.value)})})}for(const j of Me){const Q=`名称='${j.name}'`,ie={time:E[k-1].getTime()};ze(T,{where:Q,attributeUpdates:ie}),g++,l.value=Math.floor(g/(Me.length*10)*100),g===Me.length*10&&setTimeout(()=>{c.value=!1},600),console.log(l.value)}ms(T,"AQI")}})})}function s(){const r=ce().getView();for(let l=0;l<7;l++)r.map.add(e[l],l+2)}function a(){const r=ce().getView();t&&(t.visible=!1),r.ui.remove(t);for(let l=0;l<7;l++)e[l].visible=!1,r.map.remove(r.map.findLayerById(`AQI${l}`));r.map.allLayers.getItemAt(1).visible=!0}function o(){const r=ce().getView();i?(t=new Yi({container:i,view:r,layerInfos:[{layer:r.map.allLayers.find(l=>l.id==="AQI2"),title:"AQI热力图图例"}],style:"card"}),i=null):t&&(t.visible=!(t!=null&&t.visible)),r.goTo({center:[97,36],zoom:6});for(let l=2;l<r.map.allLayers.length;l++)r.map.allLayers.getItemAt(l).visible=!r.map.allLayers.getItemAt(l).visible;r.map.allLayers.getItemAt(1).visible=!r.map.allLayers.getItemAt(1).visible}function u(){const r=ce().getView();for(let l=2;l<r.map.allLayers.length;l++)if(r.map.allLayers.getItemAt(l).loaded===!1)return!1;return!0}return{createTimeHeatmap:n,cancelTimeHeatmap:a,toggleHeatmap:o,isHeatmapLoaded:u,addTimeHeatmap:s}});let Y=class extends me{constructor(e){super(e),this.precision=4,this.thumbsConstrained=!0}set effectiveMax(e){this.setEffectiveMax(e)}set effectiveMin(e){this.setEffectiveMin(e)}set labelFormatFunction(e){this._set("labelFormatFunction",e)}set inputFormatFunction(e){this._set("inputFormatFunction",e)}set inputParseFunction(e){this._set("inputParseFunction",e)}get labels(){const{max:e,min:i,values:n}=this,s=n&&n.length?n.map((a,o)=>this.getLabelForValue(a,"value",o)):[];return{max:this.getLabelForValue(e,"max"),min:this.getLabelForValue(i,"min"),values:s}}set max(e){this.setMax(e)}set min(e){this.setMin(e)}get state(){const{max:e,min:i}=this;return e!=null&&i!=null&&e>i?"ready":"disabled"}set values(e){const{max:i,min:n}=this,s=this.values;s&&e&&s.length===e.length&&s.every((a,o)=>a===e[o])||(this._set("values",null),e&&e.length&&(n!=null&&e.some(a=>a<n)&&(this.min=Math.min(...e)),i!=null&&e.some(a=>a>i)&&(this.max=Math.max(...e))),this._set("values",e))}toPrecision(e){return parseFloat(e.toFixed(this.precision))}defaultLabelFormatFunction(e){const{max:i,min:n,precision:s}=this,a=i!=null&&n!=null&&i-n>10?2:s;return parseFloat(e.toFixed(a)).toString()}defaultInputFormatFunction(e){return e.toString()}defaultInputParseFunction(e){return parseFloat(e)}getBounds(){const{effectiveMax:e,effectiveMin:i,max:n,min:s}=this;return{min:i!=null&&s!=null?Math.max(s,i):s,max:e!=null&&n!=null?Math.min(n,e):n}}getBoundsForValueAtIndex(e){const{thumbsConstrained:i,values:n}=this,{min:s,max:a}=this.getBounds();if(i&&n){const o=e-1,u=e+1;return{min:n[o]!=null?n[o]:s,max:n[u]!=null?n[u]:a}}return{min:s,max:a}}getLabelForValue(e,i,n){return e==null?null:this.labelFormatFunction?this.labelFormatFunction(e,i,n):this.defaultLabelFormatFunction(e)}setMax(e){const{max:i,values:n}=this;if(e==null)return void this._set("max",null);if(isNaN(e))return void this._logError("slider:invalid-value","Supplied value for property 'max' is NaN.");const s=this.toPrecision(e);if(i!==s&&(this._set("max",s),n&&n.length))for(let a=0;a<n.length;a++)s<n[a]&&this.setValue(a,s)}setMin(e){const{min:i,values:n}=this;if(e==null)return void this._set("min",null);if(isNaN(e))return void this._logError("slider:invalid-value","Supplied value for property 'min' is NaN.");const s=this.toPrecision(e);if(i!==s&&(this._set("min",s),n&&n.length))for(let a=0;a<n.length;a++)s>n[a]&&this.setValue(a,s)}setEffectiveMax(e){if(e==null)return void this._set("effectiveMax",null);if(isNaN(e))return void this._logError("slider:invalid-value","Supplied value for property 'effectiveMax' is NaN.");const i=this.toPrecision(e);this.effectiveMax!==i&&this._set("effectiveMax",this._applyBoundsToValue(i))}setEffectiveMin(e){if(e==null)return void this._set("effectiveMin",null);if(isNaN(e))return void this._logError("slider:invalid-value","Supplied value for property 'effectiveMin' is NaN.");const i=this.toPrecision(e);this.effectiveMin!==i&&this._set("effectiveMin",this._applyBoundsToValue(i))}setValue(e,i){if(isNaN(i))return void this._logError("slider:invalid-value","Supplied value for member of property 'values' is NaN.");const{values:n}=this;if(n==null)return void this._logError("slider:invalid-value","Supplied value for member of property 'values' is null.");const s=n[e],a=this.toPrecision(i);if(s===a)return;const o=[...n];o[e]=a,this._set("values",o),this.notifyChange("labels")}_applyBoundsToValue(e){const{max:i,min:n}=this;return n!=null&&e<n?n:i!=null&&e>i?i:e}_logError(e,i,n){He.getLogger(this.declaredClass).error(new nt(e,i,n))}};d([m()],Y.prototype,"effectiveMax",null),d([m()],Y.prototype,"effectiveMin",null),d([m()],Y.prototype,"labelFormatFunction",null),d([m()],Y.prototype,"inputFormatFunction",null),d([m()],Y.prototype,"inputParseFunction",null),d([m({readOnly:!0})],Y.prototype,"labels",null),d([m()],Y.prototype,"max",null),d([m()],Y.prototype,"min",null),d([m()],Y.prototype,"precision",void 0),d([m({readOnly:!0})],Y.prototype,"state",null),d([m()],Y.prototype,"thumbsConstrained",void 0),d([m()],Y.prototype,"values",null),Y=d([J("esri.widgets.Slider.SliderViewModel")],Y);const fs=Y,L="esri-slider",C={base:L,reversed:`${L}--reversed`,horizontalLayout:`${L}--horizontal`,verticalLayout:`${L}--vertical`,contentElement:`${L}__content`,extraContentElement:`${L}__extra-content`,trackElement:`${L}__track`,ticksContainerElement:`${L}__ticks`,tickElement:`${L}__tick`,tickLabelElement:`${L}__tick-label`,maxElement:`${L}__max`,minElement:`${L}__min`,maxElementInteractive:`${L}__max--interactive`,minElementInteractive:`${L}__min--interactive`,rangeElementActive:`${L}__range--active`,rangeInput:`${L}__range-input`,anchorElement:`${L}__anchor`,movingAnchorElement:`${L}__anchor--moving`,lastMovedAnchorElement:`${L}__anchor--moved`,anchorElementActive:`${L}__anchor--active`,anchorElementIndexPrefix:`${L}__anchor-`,segmentElement:`${L}__segment`,segmentElementIndexPrefix:`${L}__segment-`,segmentElementInteractive:`${L}__segment--interactive`,segmentElementActive:`${L}__segment--active`,effectiveSegmentElement:`${L}__effective-segment`,effectiveMaxSegmentElement:`${L}__effective-max-segment`,effectiveMinSegmentElement:`${L}__effective-min-segment`,thumbElement:`${L}__thumb`,labelElement:`${L}__label`,labelElementInteractive:`${L}__label--interactive`,labelInput:`${L}__label-input`,esriWidget:"esri-widget",widgetIcon:"esri-icon-edit",disabled:"esri-disabled",hidden:"esri-hidden"},ee={showInput:"Enter",hideInput1:"Enter",hideInput2:"Escape",hideInput3:"Tab",moveAnchorUp:"ArrowUp",moveAnchorDown:"ArrowDown",moveAnchorLeft:"ArrowLeft",moveAnchorRight:"ArrowRight",moveAnchorToMax:"End",moveAnchorToMin:"Home"},gs="esri.widgets.Slider",ui={labels:!1,rangeLabels:!1};let S=class extends Wt{constructor(e,i){super(e,i),this._activeLabelInputIndex=null,this._anchorElements=[],this._dragged=!1,this._dragStartInfo=null,this._focusedAnchorIndex=null,this._isMinInputActive=!1,this._isMaxInputActive=!1,this._lastMovedHandleIndex=null,this._positionPrecision=5,this._segmentDragStartInfo=null,this._trackHeight=null,this._trackWidth=null,this._zIndices=null,this._zIndexOffset=3,this.disabled=!1,this.draggableSegmentsEnabled=!0,this.effectiveSegmentElements=new ve,this.extraNodes=[],this.inputCreatedFunction=null,this.labelElements=new ve,this.labelInputsEnabled=!1,this.maxLabelElement=null,this.messages=null,this.minLabelElement=null,this.rangeLabelInputsEnabled=!1,this.segmentElements=new ve,this.snapOnClickEnabled=!0,this.steps=null,this.syncedSegmentsEnabled=!1,this.thumbCreatedFunction=null,this.thumbElements=new ve,this.tickElements=new ve,this.trackElement=null,this.viewModel=new fs,this.visibleElements={...ui},this._onAnchorPointerDown=this._onAnchorPointerDown.bind(this),this._onAnchorPointerMove=this._onAnchorPointerMove.bind(this),this._onAnchorPointerUp=this._onAnchorPointerUp.bind(this),this._onLabelPointerDown=this._onLabelPointerDown.bind(this),this._onLabelPointerUp=this._onLabelPointerUp.bind(this),this._onSegmentPointerDown=this._onSegmentPointerDown.bind(this),this._onSegmentPointerMove=this._onSegmentPointerMove.bind(this),this._onSegmentPointerUp=this._onSegmentPointerUp.bind(this),this._onTrackPointerDown=this._onTrackPointerDown.bind(this),this._onTrackPointerMove=this._onTrackPointerMove.bind(this),this._onTrackPointerUp=this._onTrackPointerUp.bind(this)}destroy(){document.removeEventListener("pointerup",this._onLabelPointerUp),document.removeEventListener("pointermove",this._onLabelPointerMove),document.removeEventListener("pointerup",this._onAnchorPointerUp),document.removeEventListener("pointermove",this._onAnchorPointerMove),this.labelElements.removeAll(),this.labelElements.destroy(),this.segmentElements.removeAll(),this.segmentElements.destroy(),this.effectiveSegmentElements.removeAll(),this.effectiveSegmentElements.destroy(),this.thumbElements.removeAll(),this.thumbElements.destroy(),this.tickElements.removeAll(),this.tickElements.destroy()}get effectiveMax(){return this.viewModel.effectiveMax}set effectiveMax(e){this.viewModel.effectiveMax=e}get effectiveMin(){return this.viewModel.effectiveMin}set effectiveMin(e){this.viewModel.effectiveMin=e}get inputFormatFunction(){return this.viewModel.inputFormatFunction}set inputFormatFunction(e){this.viewModel.inputFormatFunction=e}get inputParseFunction(){return this.viewModel.inputParseFunction}set inputParseFunction(e){this.viewModel.inputParseFunction=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get labelFormatFunction(){return this.viewModel.labelFormatFunction}set labelFormatFunction(e){this.viewModel.labelFormatFunction=e}get labels(){return this.viewModel.labels}set layout(e){["vertical","vertical-reversed","horizontal","horizontal-reversed"].includes(e)||(e="horizontal"),this._set("layout",e)}get max(){return this.viewModel.max}set max(e){this.viewModel.max=e}get min(){return this.viewModel.min}set min(e){this.viewModel.min=e}get precision(){return this.viewModel.precision}set precision(e){this.viewModel.precision=e}get state(){const{_activeLabelInputIndex:e,_isMaxInputActive:i,_isMinInputActive:n,_dragStartInfo:s,_segmentDragStartInfo:a,disabled:o,viewModel:u}=this,r=f(s)||f(a);return o?"disabled":e===null&&!i&&!n?r?"dragging":u.state:"editing"}get thumbsConstrained(){return this.viewModel.thumbsConstrained}set thumbsConstrained(e){this.viewModel.thumbsConstrained=e}set tickConfigs(e){this._set("tickConfigs",e),this.scheduleRender()}get values(){return this.viewModel.values}set values(e){this.viewModel.values=e}castVisibleElements(e){return{...ui,...e}}render(){const{label:e}=this,i=this.classes(C.base,C.esriWidget,this._isHorizontalLayout()?C.horizontalLayout:C.verticalLayout,this._isReversedLayout()?C.reversed:null,this._isDisabled()?C.disabled:null);return this._storeTrackDimensions(),b("div",{"aria-label":e,class:i,"touch-action":"none",bind:this,afterCreate:this._afterContainerCreate},this.renderContent())}toNextStep(e){this._toStep(e,1)}toPreviousStep(e){this._toStep(e,-1)}renderContent(){const{max:e,min:i}=this;if(!(V(i)||V(e)||i>=e))return[this.renderMin(),this.renderSliderContainer(),this.renderMax()]}renderSliderContainer(){return b("div",{key:"slider-container",bind:this,class:C.contentElement},this.renderTrackElement(),this.renderTicksContainer(),this.renderExtraContentElements())}renderTrackElement(){return b("div",{afterCreate:this._afterTrackCreate,afterRemoved:this._afterTrackRemoved,bind:this,class:C.trackElement,"touch-action":"none"},this.renderEffectiveSegmentElements(),this.renderSegmentElements(),this.renderAnchorElements())}renderEffectiveSegmentElements(){if(!this.trackElement||!this.values||!this.values.length)return;const e=f(this.effectiveMax),i=f(this.effectiveMin);if(!e&&!i)return;const{max:n,min:s,viewModel:a}=this,o=a.getBounds(),u=[];return i&&u.push(this.renderEffectiveSegmentElement(s,o.min,!0)),e&&u.push(this.renderEffectiveSegmentElement(o.max,n,!1)),u}renderSegmentElements(){if(!this.trackElement||!this.values||!this.values.length)return;const e=this.values.length,i=[];for(let n=0;n<=e;n++)i.push(this.renderSegmentElement(n));return i}renderSegmentElement(e){const{_trackHeight:i,_trackWidth:n,draggableSegmentsEnabled:s,id:a,state:o,values:u}=this,r=this._isHorizontalLayout(),l=r?n:i,c=this.viewModel.getBounds(),p=this._positionFromValue(c.max),h=this._positionFromValue(c.min),v=e===u.length?null:e,_=e===0?null:e-1,y=f(v),x=f(_);let F,E;const g=[...u].sort((ie,H)=>ie-H);this._isReversedLayout()?(F=x?this._positionFromValue(g[_]):h,E=y?this._positionFromValue(g[v]):p):(F=y?this._positionFromValue(g[v]):p,E=x?this._positionFromValue(g[_]):h);const T=this._applyPrecisionToPosition(100*E/l),k=(F-E)/l,j=r?`transform: translate(${T}%, 0px) scale(${k}, 1);`:`transform: translate(0px, ${T}%) scale(1, ${k});`,Q=this.classes(C.segmentElement,C.segmentElementIndexPrefix+e,s&&y&&x&&o!=="disabled"?C.segmentElementInteractive:null);return b("div",{afterCreate:this._afterSegmentCreate,afterRemoved:this._afterSegmentRemoved,bind:this,class:Q,"data-max-thumb-index":v,"data-min-thumb-index":_,"data-segment-index":e,key:`${a}-segment-${e}`,style:j,"touch-action":"none"})}renderEffectiveSegmentElement(e,i,n){const{_trackHeight:s,_trackWidth:a,layout:o}=this,u=this._positionFromValue(e),r=this._positionFromValue(i),l=this._isHorizontalLayout(),c=l?a:s,p=this._applyPrecisionToPosition(100*u/c);let h=null;if(o==="horizontal"){const y=n?c-r:r,x=u===c?0:p;h=`clip-path: inset(0% ${r===c?0:this._applyPrecisionToPosition(y/c*100)}% 0% ${x}%);`}else{const y=(r-u)/c;h=l?`transform: translate(${p}%, 0px) scale(${y}, 1);`:`transform: translate(0px, ${p}%) scale(1, ${y});`}const v=n?C.effectiveMinSegmentElement:C.effectiveMaxSegmentElement,_=this.classes(C.segmentElement,C.effectiveSegmentElement,v);return b("div",{afterCreate:this._afterEffectiveSegmentCreate,afterRemoved:this._afterEffectiveSegmentRemoved,bind:this,class:_,style:h,"touch-action":"none"})}renderAnchorElements(){const{trackElement:e,values:i}=this;if(i&&i.length)return this._zIndices=i.map((n,s)=>{const a=this._positionFromValue(n),o=this._positionToPercent(a),u=(this._isHorizontalLayout()?o>50:o<50)?-1:1;return this._zIndexOffset+(i.length+u*s)}),e&&i&&i.length?i.map((n,s)=>this.renderAnchorElement(n,s)):null}renderAnchorElement(e,i){const n=this._positionFromValue(e),s=this._valueFromPosition(n);if(V(s)||isNaN(s))return;const{_dragStartInfo:a,_lastMovedHandleIndex:o,id:u,layout:r,values:l,visibleElements:{labels:c}}=this,p=a&&a.index===i,h=o===i,v=this.classes(C.anchorElement,C.anchorElementIndexPrefix+i,p?C.movingAnchorElement:null,h?C.lastMovedAnchorElement:null),_=this.labels.values[i],y=this._getStyleForAnchor(e,i,p||h),{min:x,max:F}=this.viewModel.getBoundsForValueAtIndex(i),{disabled:E,messages:g}=this,T=l.length===2?Dt(i===0?g.rangeMinimum:g.rangeMaximum,{value:e}):_,k=l.length===1?null:i===0?`${u}-handle-${i+1}`:i===l.length-1?`${u}-handle-${i-1}`:`${u}-handle-${i-1} ${u}-handle-${i+1}`;return b("div",{afterCreate:this._afterAnchorCreate,afterUpdate:this._afterAnchorUpdate,afterRemoved:this._afterAnchorRemoved,"aria-controls":k,"aria-label":g.sliderValue,"aria-labelledby":c?`${u}-label-${i}`:null,"aria-orientation":r,"aria-valuemax":F.toString(),"aria-valuemin":x.toString(),"aria-valuenow":e.toString(),"aria-valuetext":T,bind:this,class:v,"data-thumb-index":i,"data-value":e,id:`${u}-handle-${i}`,key:`${u}-handle-${i}`,onkeydown:this._onAnchorKeyDown,"touch-action":"none",role:"slider",style:y,tabIndex:E?-1:0},b("span",{afterCreate:this._afterThumbCreate,afterRemoved:this._afterThumbRemoved,bind:this,class:C.thumbElement,"data-thumb-index":i,"touch-action":"none"}),this.renderThumbLabel(i))}renderThumbLabel(e){const{id:i,labels:n,labelInputsEnabled:s,state:a}=this,o=this.visibleElements.labels,u=n.values[e],r=this.classes(C.labelElement,o?null:C.hidden,s&&a!=="disabled"?C.labelElementInteractive:null);return b("span",{afterCreate:this._afterLabelCreate,afterRemoved:this._afterLabelRemoved,"aria-hidden":(!o).toString(),bind:this,class:r,"data-thumb-index":e,key:`${i}-label-${e}`,id:`${i}-label-${e}`,role:s?"button":null,"touch-action":"none"},this._activeLabelInputIndex===e?this.renderValueInput(e):u)}renderValueInput(e){const{disabled:i,values:n}=this,s=n[e];return b("input",{key:`value-input-${e}`,afterCreate:this._afterInputCreate,"aria-label":this.messages.sliderValue,bind:this,class:C.labelInput,"data-input-type":"thumb","data-input-index":e,required:!0,tabIndex:i?-1:0,type:"text",value:this._formatInputValue(s,"value",e),onblur:this._onLabelInputBlur,onkeydown:this._onInputKeyDown})}renderMax(){const{_isMaxInputActive:e,labels:i,rangeLabelInputsEnabled:n,state:s}=this,a=this.visibleElements.rangeLabels,o=this.classes(C.maxElement,{[C.hidden]:!a,[C.maxElementInteractive]:n&&s!=="disabled",[C.rangeElementActive]:e});return b("div",{"aria-hidden":(!a).toString(),afterCreate:this._afterMaxLabelCreate,bind:this,class:o,onclick:this._onMaxLabelClick,onkeydown:this._onMaxLabelKeyDown,role:n?"button":null,tabIndex:!this.disabled&&n?0:-1},e?this.renderMaxInput():i.max)}renderMin(){const{_isMinInputActive:e,labels:i,rangeLabelInputsEnabled:n,state:s}=this,a=this.visibleElements.rangeLabels,o=this.classes(C.minElement,{[C.hidden]:!a,[C.minElementInteractive]:n&&s!=="disabled",[C.rangeElementActive]:e});return b("div",{"aria-hidden":(!a).toString(),afterCreate:this._afterMinLabelCreate,bind:this,class:o,onclick:this._onMinLabelClick,onkeydown:this._onMinLabelKeyDown,role:n?"button":null,tabIndex:!this.disabled&&n?0:-1},e?this.renderMinInput():i.min)}renderMaxInput(){return b("input",{afterCreate:this._afterInputCreate,"aria-label":this.messages.maximumValue,bind:this,class:C.rangeInput,"data-input-type":"max",required:!0,tabIndex:this.disabled?-1:0,type:"text",value:this._formatInputValue(this.max,"max"),onblur:this._onMaxInputBlur,onkeydown:this._onInputKeyDown})}renderMinInput(){return b("input",{afterCreate:this._afterInputCreate,"aria-label":this.messages.minimumValue,bind:this,class:C.rangeInput,"data-input-type":"min",required:!0,tabIndex:this.disabled?-1:0,type:"text",value:this._formatInputValue(this.min,"min"),onblur:this._onMinInputBlur,onkeydown:this._onInputKeyDown})}renderExtraContentElements(){return b("div",{bind:this,class:C.extraContentElement},this.extraNodes)}renderTicksContainer(){if(this.tickConfigs&&this.trackElement&&(this._trackHeight!==0||this._trackWidth!==0))return this.tickConfigs.map((e,i)=>b("div",{key:"ticks-container",class:this.classes(C.ticksContainerElement)},this.renderTicks(e,i)))}renderTicks(e,i){const{mode:n,values:s}=e;if(this.tickElements.getItemAt(i)||this.tickElements.add(new ve,i),n==="position"){const u=Array.isArray(s)?s:[s];return this._calculateTickPositions(u).map((r,l)=>this.renderTickGroup(e,l,i,r))}if(n==="percent"&&Array.isArray(s)){const{max:u,min:r}=this,l=u-r,c=s.map(p=>this._applyPrecisionToPosition(p/100*l+r));return this._calculateTickPositions(c).map((p,h)=>this.renderTickGroup(e,h,i,p))}const a=Array.isArray(s)&&s.length?s[0]:isNaN(s)?null:s,o=this._getTickCounts(a,e);return this._calculateEquidistantTickPositions(o).map((u,r)=>this.renderTickGroup(e,r,i,u))}renderTickGroup(e,i,n,s){const a=e.mode==="position"?Array.isArray(e.values)?e.values[i]:e.values:this._valueFromPosition(s);if(!V(a)&&!isNaN(a))return b("div",{afterCreate:this._afterTickGroupCreate,afterRemoved:this._afterTickGroupRemoved,bind:this,"data-config":e,"data-position":s,"data-tick-config-index":n,"data-tick-group-index":i,"data-value":a,onclick:this._onTickGroupClick,key:`tick-group-${i}`},this.renderTickLine(e,i,n,a),e.labelsVisible?this.renderTickLabel(e,i,n,a):null)}renderTickLine(e,i,n,s){return b("div",{afterCreate:this._afterTickLineCreate,"aria-valuenow":s.toString(),bind:this,class:C.tickElement,"data-config":e,"data-tick-config-index":n,"data-tick-group-index":i,"data-value":s,key:`tick-label-${i}`,style:this._getPositionStyleForElement(s)})}renderTickLabel(e,i,n,s){const a=e.labelFormatFunction?e.labelFormatFunction(s,"tick",i):this.viewModel.getLabelForValue(s,"tick",i);return b("div",{afterCreate:this._afterTickLabelCreate,"aria-label":a,"aria-valuenow":s.toString(),"aria-valuetext":a,bind:this,class:C.tickLabelElement,"data-config":e,"data-tick-config-index":n,"data-tick-group-index":i,"data-value":s,key:`tick-label-${i}`,style:`transform: translate(-50%); ${this._getPositionStyleForElement(s)}`},a)}_afterContainerCreate(e){this.addHandles(Gi(e,()=>this.scheduleRender()))}_afterTrackCreate(e){this._set("trackElement",e),e.addEventListener("pointerdown",this._onTrackPointerDown),this.scheduleRender()}_afterTrackRemoved(e){e.removeEventListener("pointerdown",this._onTrackPointerDown),document.removeEventListener("pointermove",this._onTrackPointerMove),document.removeEventListener("pointerup",this._onTrackPointerUp)}_afterSegmentCreate(e){this.segmentElements.add(e),e.addEventListener("pointerdown",this._onSegmentPointerDown)}_afterSegmentRemoved(e){this.segmentElements.remove(e),e.removeEventListener("pointerdown",this._onSegmentPointerDown)}_afterEffectiveSegmentCreate(e){this.effectiveSegmentElements.add(e)}_afterEffectiveSegmentRemoved(e){this.effectiveSegmentElements.remove(e)}_afterAnchorCreate(e){if(this._anchorElements.push(e),e.addEventListener("pointerdown",this._onAnchorPointerDown),this.thumbCreatedFunction){const i=e["data-thumb-index"],n=e["data-value"],s=this.thumbElements.getItemAt(i)||null,a=this.labelElements.getItemAt(i)||null;this.thumbCreatedFunction(i,n,s,a)}}_afterAnchorUpdate(e){f(this._focusedAnchorIndex)&&e["data-thumb-index"]===this._focusedAnchorIndex&&(e.focus(),this._focusedAnchorIndex=null)}_afterAnchorRemoved(e){const i=this._anchorElements.indexOf(e,0);i>-1&&this._anchorElements.splice(i,1),e.removeEventListener("pointerdown",this._onAnchorPointerDown)}_afterThumbCreate(e){this.thumbElements.add(e)}_afterThumbRemoved(e){this.thumbElements.remove(e)}_afterLabelCreate(e){this.labelElements.add(e),e.addEventListener("pointerdown",this._onLabelPointerDown),e.addEventListener("pointerup",this._onLabelPointerUp)}_afterLabelRemoved(e){this.labelElements.remove(e),e.removeEventListener("pointerdown",this._onLabelPointerDown),e.removeEventListener("pointerup",this._onLabelPointerUp)}_afterInputCreate(e){if(e.focus(),e.select(),this.inputCreatedFunction){const i=e.getAttribute("data-input-type"),n=i==="thumb"?e["data-input-index"]:null;this.inputCreatedFunction(e,i,n)}}_afterTickLineCreate(e){const i=e["data-tick-config-index"],n=e["data-tick-group-index"],s=this.tickElements.getItemAt(i);s.getItemAt(n)?s.getItemAt(n).tickElement=e:s.add({groupElement:null,tickElement:e,labelElement:null},n)}_afterTickLabelCreate(e){const i=e["data-tick-config-index"],n=e["data-tick-group-index"],s=this.tickElements.getItemAt(i);s.getItemAt(n)?s.getItemAt(n).labelElement=e:s.add({groupElement:null,labelElement:e,tickElement:null},n)}_afterTickGroupRemoved(e){const i=e["data-tick-config-index"],n=this.tickElements.items[i],s=n==null?void 0:n.find(a=>a.groupElement===e);s&&n.remove(s)}_afterTickGroupCreate(e){var n,s;const i=e["data-config"];if(i&&i.tickCreatedFunction){const a=e["data-tick-config-index"],o=e["data-tick-group-index"],u=e["data-value"],r=(s=(n=this.tickElements)==null?void 0:n.getItemAt(a))==null?void 0:s.getItemAt(o);if(r){r.groupElement=e;const l=r.tickElement||null,c=r.labelElement||null;i.tickCreatedFunction(u,l,c)}}}_afterMaxLabelCreate(e){this._set("maxLabelElement",e)}_afterMinLabelCreate(e){this._set("minLabelElement",e)}_onAnchorKeyDown(e){if(this._isDisabled()||this.state==="editing")return;const{target:i}=e,n=Xe(e),{_anchorElements:s,values:a}=this,o=i["data-thumb-index"],u=s[o],r=a[o],l=[ee.moveAnchorUp,ee.moveAnchorDown,ee.moveAnchorLeft,ee.moveAnchorRight];if(n===ee.showInput&&this.labelInputsEnabled)this._activeLabelInputIndex=o,this.notifyChange("state");else if(l.includes(n)){e.preventDefault();const{steps:c}=this,p=n===ee.moveAnchorUp||n===ee.moveAnchorRight?1:-1;if(f(c))this._toStep(o,this._isReversedLayout()?-1*p:p);else{const{precision:v}=this,_=this._getPositionOfElement(u),y=this._valueFromPosition(_),x=this._isHorizontalLayout()?p:-1*p;let F;F=v===0?this._positionFromValue(y+x):v===1?this._positionFromValue(y+.1*x):_+x,this._toPosition(o,F)}const h=this.values[o];r!==h&&this._emitThumbChangeEvent({index:o,oldValue:r,value:h})}else if(n===ee.moveAnchorToMax||n===ee.moveAnchorToMin){e.preventDefault();const{min:c,max:p}=this._getAnchorBoundsInPixels(o),h=this._isPositionInverted()?n===ee.moveAnchorToMax?c:p:n===ee.moveAnchorToMin?c:p;this._toPosition(o,h);const v=this.values[o];r!==v&&this._emitThumbChangeEvent({index:o,oldValue:r,value:v})}}_onAnchorPointerDown(e){if(this._isDisabled())return;const{target:i,clientX:n,clientY:s}=e,a=i["data-thumb-index"];a!==void 0&&(e.preventDefault(),this._anchorElements[a]&&this._anchorElements[a].focus(),this._storeTrackDimensions(),this._dragStartInfo={clientX:n,clientY:s,index:a,position:this._getPositionOfElement(this._anchorElements[a])},this.notifyChange("state"),document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove))}_onAnchorPointerMove(e){if(this.state==="editing"||!this._dragStartInfo)return;e.preventDefault();const{values:i,_anchorElements:n,_dragged:s,_dragStartInfo:a,_dragStartInfo:{index:o,position:u}}=this,{clientX:r,clientY:l}=e,c=s?"drag":"start",p=n[o],h=this._getPositionOfElement(p),v=this._applyPrecisionToPosition(this._isHorizontalLayout()?u+r-a.clientX:u+l-a.clientY);if(h===v)return;const _=i[o];this._dragged=!0,this._toPosition(o,v);const y=this.values[o];s?_!==y&&this._emitThumbDragEvent({index:o,state:c,value:y}):this._emitThumbDragEvent({index:o,state:c,value:_})}_onAnchorPointerUp(e){if(document.removeEventListener("pointerup",this._onAnchorPointerUp),document.removeEventListener("pointermove",this._onAnchorPointerMove),!this._dragStartInfo)return;e.preventDefault();const{index:i}=this._dragStartInfo,n=this._dragged,s=this.values[i];this._dragged=!1,this._dragStartInfo=null,this._lastMovedHandleIndex=i,this.notifyChange("state"),n?this._emitThumbDragEvent({index:i,state:"stop",value:s}):(this.scheduleRender(),this.state!=="editing"&&this._emitThumbClickEvent({index:i,value:s}))}_onTrackPointerDown(e){const{_dragStartInfo:i,snapOnClickEnabled:n,state:s,values:a}=this;if(this._isDisabled()||s==="editing"||i||(document.addEventListener("pointermove",this._onTrackPointerMove),document.addEventListener("pointerup",this._onTrackPointerUp),!n||!a.length))return;const{steps:o}=this,{clientX:u,clientY:r}=e,l=this._getCursorPositionFromEvent(e),c=this._valueFromPosition(l),p=this._getIndexOfNearestValue(c),h=a[p],v=a.some((F,E)=>F===h&&E!==p)&&c>h?this.values.lastIndexOf(h):p;if(V(v))return;const _=a[v],y=f(o)?this._calculateNearestStepPosition(l):l;this._toPosition(v,y),this._dragged=!0,this._dragStartInfo={clientX:u,clientY:r,index:v,position:y},this._focusedAnchorIndex=v,this.notifyChange("state"),this._emitThumbDragEvent({index:v,state:"start",value:_});const x=this.values[v];_!==x&&this._emitThumbDragEvent({index:v,state:"drag",value:x}),document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove)}_onTrackPointerMove(e){e.preventDefault(),this._dragged=!0}_onTrackPointerUp(e){if(e.preventDefault(),document.removeEventListener("pointermove",this._onTrackPointerMove),document.removeEventListener("pointerup",this._onTrackPointerUp),this.snapOnClickEnabled||(this._dragged=!1),!this._dragged){const i=this._getCursorPositionFromEvent(e),n=this._valueFromPosition(i);this._emitTrackClickEvent({value:n})}}_onSegmentPointerDown(e){var r,l;e.preventDefault();const i=e.target,n=i["data-segment-index"],s=i["data-min-thumb-index"],a=i["data-max-thumb-index"];if(this._isDisabled()||V(s)||V(a))return;e.stopPropagation(),this._storeTrackDimensions(),document.addEventListener("pointerup",this._onSegmentPointerUp);const o=this._getAnchorDetails(s),u=this._getAnchorDetails(a);this.syncedSegmentsEnabled?(this.segmentElements.forEach(c=>c.classList.add(C.segmentElementActive)),this._anchorElements.forEach(c=>c.classList.add(C.anchorElementActive))):(this.segmentElements.getItemAt(n).classList.add(C.segmentElementActive),(r=this._anchorElements[o.index])==null||r.classList.add(C.anchorElementActive),(l=this._anchorElements[u.index])==null||l.classList.add(C.anchorElementActive)),this._segmentDragStartInfo={cursorPosition:this._getCursorPositionFromEvent(e),index:n,details:this._normalizeSegmentDetails({min:o,max:u})},this.draggableSegmentsEnabled&&(document.addEventListener("pointermove",this._onSegmentPointerMove),this.notifyChange("state"),this._emitSegmentDragEvent({index:n,state:"start",thumbIndices:[s,a]}))}_onSegmentPointerMove(e){if(!this._segmentDragStartInfo)return;e.preventDefault();const{_trackHeight:i,_trackWidth:n,_segmentDragStartInfo:{index:s,cursorPosition:a,details:{min:o,max:u}}}=this,{index:r,position:l,value:c}=o,{index:p,position:h,value:v}=u;this._dragged=!0;const _=this._getCursorPositionFromEvent(e);if(_===a)return;const y=this._positionToPercent(a),x=this._positionToPercent(_)-y,F=this._positionToPercent(l)+x,E=this._positionToPercent(h)+x,{min:g}=this._getAnchorBoundsAsPercents(r),{max:T}=this._getAnchorBoundsAsPercents(p);let k=!1,j=!1;if(F<g?k=!0:E>T&&(j=!0),k){const{min:le,max:he}=this.viewModel.getBoundsForValueAtIndex(r),be=this._isPositionInverted()?he:le,z=be,xe=v+(be-c),Ve=xe-this.values[p];return void(this.syncedSegmentsEnabled?this._updateAnchorValuesByDifference(Ve):this._updateAnchorValues([r,p],[z,xe]))}if(j){const{min:le,max:he}=this.viewModel.getBoundsForValueAtIndex(p),be=this._isPositionInverted()?le:he,z=be,xe=c+(be-v),Ve=xe-this.values[r];return void(this.syncedSegmentsEnabled?this._updateAnchorValuesByDifference(Ve):this._updateAnchorValues([r,p],[xe,z]))}const Q=this._isHorizontalLayout()?n:i,ie=E/100*Q,H=F/100*Q,P=this.values,re=[P[r],P[p]],Z=this._getValueForAnchorAtPosition(r,H),_e=this._getValueForAnchorAtPosition(p,ie);this.syncedSegmentsEnabled?this._updateAnchorValuesByDifference(Z-re[0]):this._updateAnchorValues([r,p],[Z,_e]),[this.values[r],this.values[p]].every((le,he)=>le===re[he])||this._emitSegmentDragEvent({index:s,state:"drag",thumbIndices:[r,p]})}_onSegmentPointerUp(e){if(e.preventDefault(),document.removeEventListener("pointerup",this._onSegmentPointerUp),document.removeEventListener("pointermove",this._onSegmentPointerMove),!this._segmentDragStartInfo)return;const{_dragged:i,max:n,min:s,values:a}=this,{index:o,details:{min:{index:u},max:{index:r}}}=this._segmentDragStartInfo;if(this.segmentElements.forEach(l=>l.classList.remove(C.segmentElementActive)),this._anchorElements.forEach(l=>l.classList.remove(C.anchorElementActive)),this.draggableSegmentsEnabled){const l=n-s,c=a[u],p=a[r];this._lastMovedHandleIndex=c===p?c>l/2?u:r:null,this._dragged=!1,this._segmentDragStartInfo=null,this.notifyChange("state"),this._emitSegmentDragEvent({index:o,state:"stop",thumbIndices:[u,r]})}if(!i){const l=this._getCursorPositionFromEvent(e),c=this._valueFromPosition(l);this._emitSegmentClickEvent({index:o,value:c,thumbIndices:[u,r]})}}_onTickGroupClick(e){const i=e.target;if(i["data-config"]){const n=i["data-tick-config-index"],s=i["data-tick-group-index"],a=i["data-value"];this._emitTickClickEvent({configIndex:n,groupIndex:s,value:a})}}_storeTrackDimensions(){if(this.trackElement){const e=this._getDimensions(this.trackElement);this._trackHeight=e.height,this._trackWidth=e.width}}_onLabelPointerDown(){this._isDisabled()||(this._dragged=!1,document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove))}_onLabelPointerMove(){this._isDisabled()||(this._dragged=!0)}_onLabelPointerUp(e){if(this._isDisabled())return;const i=e.target["data-thumb-index"];this.labelInputsEnabled&&!this._dragged&&f(i)&&(this._activeLabelInputIndex=i),this._dragged=!1,this.notifyChange("state"),document.removeEventListener("pointerup",this._onLabelPointerUp),document.removeEventListener("pointermove",this._onLabelPointerMove)}_onLabelInputBlur(e){const{_activeLabelInputIndex:i,values:n,viewModel:s}=this,a=e.target.value;if(this._activeLabelInputIndex=null,this.notifyChange("state"),!a)return;const o=this._parseInputValue(a,"value",i),u=n[i],{min:r,max:l}=this.viewModel.getBoundsForValueAtIndex(i);if(o<r||o>l)return;s.setValue(i,o);const c=this.values[i];u!==c&&this._emitThumbChangeEvent({index:i,oldValue:u,value:c})}_onInputKeyDown(e){if(this._isDisabled())return;const{target:i}=e,n=Xe(e),{hideInput1:s,hideInput2:a,hideInput3:o}=ee,{_activeLabelInputIndex:u,_anchorElements:r}=this,l=i;if(n===s||n===a||n===o){e.stopPropagation();const c=u;l.blur(),f(c)?r[c].focus():l.parentElement.focus()}}_onMaxLabelClick(){this._isDisabled()||(this._emitRangeLabelClickEvent({type:"max-click",value:this.max}),this.rangeLabelInputsEnabled&&(this._isMaxInputActive=!0,this.notifyChange("state")))}_onMaxLabelKeyDown(e){this._isDisabled()||Xe(e)!==ee.showInput||(this._isMaxInputActive=!0,this.notifyChange("state"))}_onMaxInputBlur(e){const i=e.target.value;if(this._isMaxInputActive=!1,this.notifyChange("state"),!i)return;const n=this.max,s=this._parseInputValue(i,"max");s<=this.min||(this.viewModel.set("max",s),this.max!==n&&this._emitMaxChangeEvent({oldValue:n,value:this.max}))}_onMinLabelClick(){this._isDisabled()||(this._emitRangeLabelClickEvent({type:"min-click",value:this.min}),this.rangeLabelInputsEnabled&&(this._isMinInputActive=!0,this.notifyChange("state")))}_onMinLabelKeyDown(e){this._isDisabled()||Xe(e)!==ee.showInput||(this._isMinInputActive=!0,this.notifyChange("state"))}_onMinInputBlur(e){const i=e.target.value;if(this._isMinInputActive=!1,this.notifyChange("state"),!i)return;const n=this.min,s=this._parseInputValue(i,"min");s>=this.max||(this.viewModel.set("min",s),this.min!==n&&this._emitMinChangeEvent({oldValue:n,value:this.min}))}_isDisabled(){return this.disabled||this.state==="disabled"}_positionFromValue(e){const{max:i,min:n}=this,s=i-n;if(s===0)return 0;const{_trackHeight:a,_trackWidth:o}=this,u=this._isHorizontalLayout();let r=parseFloat(u?(o*(e-n)/s).toFixed(2):(a*(i-e)/s).toFixed(2));return this._isReversedLayout()&&(r=u?o-r:a-r),r}_valueFromPosition(e){const{_trackHeight:i,_trackWidth:n,max:s,min:a,precision:o}=this,u=s-a;let r=this._isHorizontalLayout()?e*u/n+a:u*(1e3-e/i*1e3)/1e3+a;return this._isReversedLayout()&&(r=s+a-r),parseFloat(r.toFixed(o))}_positionToPercent(e){const{_trackHeight:i,_trackWidth:n}=this,s=100*e/(this._isHorizontalLayout()?n:i);return this._applyPrecisionToPosition(s)}_applyPrecisionToPosition(e){return parseFloat(e.toFixed(this._positionPrecision))}_isPositionInverted(){const{layout:e}=this;return e==="horizontal-reversed"||e==="vertical"}_isHorizontalLayout(){return this.layout.includes("horizontal")}_isReversedLayout(){return this.layout.includes("reversed")}_normalizeSegmentDetails(e){if(this._isPositionInverted()){const{min:i,max:n}=e;return{min:n,max:i}}return e}_parseInputValue(e,i,n){return this.inputParseFunction?this.inputParseFunction(e,i,n):this.viewModel.defaultInputParseFunction(e)}_formatInputValue(e,i,n){return this.inputFormatFunction?this.inputFormatFunction(e,i,n):this.viewModel.defaultInputFormatFunction(e)}_getAnchorDetails(e){const i=[...this.values].sort((s,a)=>s-a)[e],n=this.values.indexOf(i);return{index:n,position:this._getPositionOfElement(this._anchorElements[n]),value:i}}_updateAnchorStyle(e,i){const n=this._anchorElements[e];n&&(this._isHorizontalLayout()?n.style.left=`${i}`:n.style.top=`${i}`)}_getStyleForAnchor(e,i,n){const s=this._getPositionStyleForElement(e);if(this.values.length===1)return`${s}`;const a=this._zIndices[i];return`${s}; z-index: ${n?this._zIndexOffset+a:a}`}_getPositionStyleForElement(e){const i=this._positionFromValue(e),n=this._positionToPercent(i);return`${this._isHorizontalLayout()?"left":"top"}: ${n+"%"}`}_getPositionOfElement(e){const i=this._getDimensions(e.offsetParent),n=this._getDimensions(e);return this._isHorizontalLayout()?this._applyPrecisionToPosition(n.left-i.left):this._applyPrecisionToPosition(n.top-i.top)}_updateAnchorValues(e,i){e.forEach((n,s)=>this._toValue(n,i[s]))}_updateAnchorValuesByDifference(e){const{min:i,max:n,values:s}=this;s.forEach((a,o)=>this._toValue(o,Math.max(Math.min(a+e,n),i)))}_toValue(e,i){f(this.steps)&&(i=this._getStepValues()[this._getIndexOfNearestStepValue(i)]),this._updateAnchorStyle(e,this._getPositionStyleForElement(i)),this.viewModel.setValue(e,i)}_toPosition(e,i){const n=f(this.steps)?this._getStepValueForAnchorAtPosition(e,i):this._getValueForAnchorAtPosition(e,i);this._updateAnchorStyle(e,this._getPositionStyleForElement(n)),this.viewModel.setValue(e,n)}_getValueForAnchorAtPosition(e,i){const{min:n,max:s}=this._getAnchorBoundsInPixels(e),{min:a,max:o}=this.viewModel.getBoundsForValueAtIndex(e);let u,r,l=null;return this._isPositionInverted()?(u=a,r=o):(u=o,r=a),l=i>s?u:i<n?r:this._valueFromPosition(i),l>o?l=o:l<a&&(l=a),l}_getStepValueForAnchorAtPosition(e,i){const n=this._getStepValues(),s=this._calculateNearestStepPosition(i),a=this._getValueForAnchorAtPosition(e,s);return n[this._getIndexOfNearestStepValue(a)]}_getAnchorBoundsAsPercents(e){const{min:i,max:n}=this._getAnchorBoundsInPixels(e);return{min:this._positionToPercent(i),max:this._positionToPercent(n)}}_getAnchorBoundsInPixels(e){const{_anchorElements:i,_trackHeight:n,_trackWidth:s,effectiveMax:a,effectiveMin:o,thumbsConstrained:u}=this,r=i[e-1],l=i[e+1],c=this._isHorizontalLayout()?s:n;let p,h;return this._isPositionInverted()?(p=f(o)?this._positionFromValue(o):c,h=f(a)?this._positionFromValue(a):0):(p=f(a)?this._positionFromValue(a):c,h=f(o)?this._positionFromValue(o):0),u?this._isPositionInverted()?{max:r?this._getPositionOfElement(r):p,min:l?this._getPositionOfElement(l):h}:{max:l?this._getPositionOfElement(l):p,min:r?this._getPositionOfElement(r):h}:{max:p,min:h}}_getIndexOfNearestValue(e){return this.values.indexOf(this.values.reduce((i,n)=>Math.abs(n-e)<Math.abs(i-e)?n:i))}_getCursorPositionFromEvent(e){const i=this._getDimensions(this.trackElement);return this._isHorizontalLayout()?e.clientX-i.left:e.clientY-i.top}_getStepValues(){const{steps:e}=this;if(Array.isArray(e))return e;const{max:i,min:n}=this,s=Math.ceil((i-n)/e),a=[];for(let o=0;o<=s;o++){const u=n+e*o;a.push(u>i?i:u)}return a}_toStep(e,i){const{values:n,viewModel:s}=this,a=n[e],o=this._getStepValues(),u=o.indexOf(a);let r=null;if(u>-1){let l=o[u+i];isNaN(l)&&(l=o[u]);const c=this._positionFromValue(l);r=this._getStepValueForAnchorAtPosition(e,c)}else r=o[this._getIndexOfNearestStepValue(a)+i];s.setValue(e,r)}_getIndexOfNearestStepValue(e){const{steps:i}=this;if(V(i))return null;const n=this._getStepValues(),s=n.reduce((a,o)=>Math.abs(o-e)<Math.abs(a-e)?o:a);return n.indexOf(s)}_calculateNearestStepPosition(e){const i=this._valueFromPosition(e),n=this._getIndexOfNearestStepValue(i),s=this._getStepValues();return this._positionFromValue(s[n])}_getTickCounts(e,i){const{mode:n}=i;return n==="count"||n==="position"?e||0:n==="percent"&&100/e||0}_calculateTickPositions(e){return e.map(i=>this._positionFromValue(i))}_calculateEquidistantTickPositions(e){const{_trackWidth:i,_trackHeight:n}=this,s=this._isHorizontalLayout()?i:n,a=s/(e-1),o=[];if(e===1)return[s/2];for(let u=0;u<e;u++){const r=u*a;r<=s&&o.push(r)}return o}_getDimensions(e){try{return e.getBoundingClientRect()}catch(i){if(typeof i=="object"&&i!==null)return new DOMRect(0,0,0,0);throw i}}_emitTrackClickEvent(e){this.emit("track-click",{...e,type:"track-click"})}_emitTickClickEvent(e){this.emit("tick-click",{...e,type:"tick-click"})}_emitMaxChangeEvent(e){this.emit("max-change",{...e,type:"max-change"})}_emitMinChangeEvent(e){this.emit("min-change",{...e,type:"min-change"})}_emitThumbChangeEvent(e){this.emit("thumb-change",{...e,type:"thumb-change"})}_emitThumbClickEvent(e){this.emit("thumb-click",{...e,type:"thumb-click"})}_emitThumbDragEvent(e){this.emit("thumb-drag",{...e,type:"thumb-drag"})}_emitSegmentClickEvent(e){this.emit("segment-click",{...e,type:"segment-click"})}_emitSegmentDragEvent(e){this.emit("segment-drag",{...e,type:"segment-drag"})}_emitRangeLabelClickEvent(e){this.emit(e.type,{...e})}};d([m()],S.prototype,"disabled",void 0),d([m()],S.prototype,"draggableSegmentsEnabled",void 0),d([m()],S.prototype,"effectiveMax",null),d([m()],S.prototype,"effectiveMin",null),d([m({readOnly:!0})],S.prototype,"effectiveSegmentElements",void 0),d([m()],S.prototype,"extraNodes",void 0),d([m()],S.prototype,"inputCreatedFunction",void 0),d([m()],S.prototype,"inputFormatFunction",null),d([m()],S.prototype,"inputParseFunction",null),d([m()],S.prototype,"label",null),d([m({readOnly:!0})],S.prototype,"labelElements",void 0),d([m()],S.prototype,"labelInputsEnabled",void 0),d([m()],S.prototype,"labelFormatFunction",null),d([m({readOnly:!0})],S.prototype,"labels",null),d([m({value:"horizontal"})],S.prototype,"layout",null),d([m()],S.prototype,"max",null),d([m({readOnly:!0})],S.prototype,"maxLabelElement",void 0),d([m(),We("esri/widgets/Slider/t9n/Slider")],S.prototype,"messages",void 0),d([m()],S.prototype,"min",null),d([m({readOnly:!0})],S.prototype,"minLabelElement",void 0),d([m()],S.prototype,"precision",null),d([m()],S.prototype,"rangeLabelInputsEnabled",void 0),d([m({readOnly:!0})],S.prototype,"segmentElements",void 0),d([m()],S.prototype,"snapOnClickEnabled",void 0),d([m({readOnly:!0})],S.prototype,"state",null),d([m()],S.prototype,"steps",void 0),d([m()],S.prototype,"syncedSegmentsEnabled",void 0),d([m()],S.prototype,"thumbsConstrained",null),d([m()],S.prototype,"thumbCreatedFunction",void 0),d([m({readOnly:!0})],S.prototype,"thumbElements",void 0),d([m()],S.prototype,"tickConfigs",null),d([m({readOnly:!0})],S.prototype,"tickElements",void 0),d([m({readOnly:!0})],S.prototype,"trackElement",void 0),d([m()],S.prototype,"values",null),d([m()],S.prototype,"viewModel",void 0),d([m()],S.prototype,"visibleElements",void 0),d([In("visibleElements")],S.prototype,"castVisibleElements",null),S=d([J(gs)],S);const vs=S,D="esri-time-slider",I={widgetIcon:"esri-icon-time-clock",esriWidget:"esri-widget",esriWidgetButton:"esri-widget--button",esriButtonDisabled:"esri-button--disabled",esriDisabled:"esri-disabled",timeSlider:`${D}`,timeSliderOutOfBounds:`${D}--out-of-bounds`,timeSliderMode:`${D}__mode--`,timeSliderLayout:`${D}__layout--`,timeSliderRow:`${D}__row`,animation:`${D}__animation`,animationButton:`${D}__animation-button`,animationPlay:"esri-icon-play",animationPause:"esri-icon-pause",timeExtent:`${D}__time-extent`,timeExtentGroup:`${D}__time-extent-group`,timeExtentDate:`${D}__time-extent-date`,timeExtentTime:`${D}__time-extent-time`,timeExtentSeparator:`${D}__time-extent-separator`,playbackControls:`${D}__playback-controls`,min:`${D}__min`,minDate:`${D}__min-date`,minTime:`${D}__min-time`,slider:`${D}__slider`,sliderMajorTick:"majorTick",sliderMinorTick:"minorTick",max:`${D}__max`,maxDate:`${D}__max-date`,maxTime:`${D}__max-time`,previous:`${D}__previous`,previousButton:`${D}__previous-button`,previousIcon:"esri-icon-reverse",next:`${D}__next`,nextButton:`${D}__next-button`,nextIcon:"esri-icon-forward",warning:`${D}__warning`,warningIcon:"esri-icon-notice-triangle",warningText:`${D}__warning-text`,hasActions:`${D}--has-actions`,actions:`${D}__actions`,actionsButton:`${D}__actions-button`},di=1e4;function Ut(t){return f(t)&&t.count!==void 0}function st(t){return f(t)&&t.interval!==void 0}function ci(t){return f(t)&&t.dates!==void 0}function pi(t){return t.declaredClass==="esri.WebMap"}let q=class extends ut(Bi.EventedAccessor){constructor(e){super(e),this._animationController=null,this._isViewTimeExtentInitialized=!1,this._timerId=null,this.actions=new ve,this.fullTimeExtent=null,this.loop=!1,this.mode="time-window",this.stops={count:10},this.timeExtent=null,this.view=null}initialize(){this.handles.add([ae(()=>this.effectiveStops,()=>{V(this.timeExtent)&&(this.timeExtent=this._getDefaultTimeExtent())},Rt),ae(()=>this.view,(e,i)=>{this._unregisterWidget(i),this._registerWidget(e)},$n),ae(()=>this.timeExtent,e=>{if(V(this.view))return;const i=this.view.timeExtent;(V(e)||e.isAllTime)&&(V(i)||i.isAllTime)||f(e)&&f(i)&&e.equals(i)||(this.view.timeExtent=oe(e))},Rt),ae(()=>Te(this.view,e=>e.timeExtent),e=>{this._isViewTimeExtentInitialized?(V(e)||e.isAllTime)&&(V(this.timeExtent)||this.timeExtent.isAllTime)||f(e)&&f(this.timeExtent)&&e.equals(this.timeExtent)||(this.timeExtent=e):this._isViewTimeExtentInitialized=!0})])}destroy(){f(this._timerId)&&(clearInterval(this._timerId),this._timerId=null),this._unregisterWidget(this.view),this.view=null,f(this._animationController)&&(this._animationController.abort(),this._animationController=null)}get effectiveStops(){const{fullTimeExtent:e,stops:i}=this;if(ci(i)){const{dates:n}=i;if(n==null||n.length===0)return null;const s=n.sort((u,r)=>u.getTime()-r.getTime());if(V(e))return s;const{start:a,end:o}=e;return V(a)||V(o)?s:s.filter(u=>!(u.getTime()<a.getTime()||u.getTime()>o.getTime()))}if(Ut(i)){const n=i.timeExtent??oe(e);return this._divideTimeExtentByCount(n,i.count)}if(st(i)){const n=i.timeExtent??oe(e);return this._divideTimeExtentByInterval(n,i.interval)}return[]}set playRate(e){e<=0||e>36e5||(this.state==="playing"&&this._startAnimation(),this._set("playRate",e))}get state(){return V(this.fullTimeExtent)?"disabled":f(this._animationController)?"playing":"ready"}get timeExtentValues(){const{mode:e,timeExtent:i}=this;if(V(i)||i.isAllTime||i.isEmpty)return null;const{start:n,end:s}=i;switch(e){case"cumulative-from-end":case"instant":return f(n)?[n.getTime()]:null;case"cumulative-from-start":return f(s)?[s.getTime()]:null;case"time-window":return f(n)&&f(s)?[n.getTime(),s.getTime()]:null}}static async getPropertiesFromWebMap(e,i){var p;if(V(e)||!pi(e))return null;await e.load({signal:i});const n=(p=e==null?void 0:e.widgets)==null?void 0:p.timeSlider;if(!n)return null;const{getFullTimeExtentFromWebDocument:s,getModeFromTimeSlider:a,getStopsFromTimeSlider:o,getTimeExtentFromTimeSlider:u}=await ue(()=>import("./utils-6dffaa21.js"),["assets/utils-6dffaa21.js","assets/MapView-d4248bee.js","assets/index-9ba3f23e.js","assets/index-fecf00a2.css"]),r=await s(e,i),l=n.loop,c=a(n);return{fullTimeExtent:r,loop:l,mode:c,playRate:n.stopDelay??2e3,stops:o(n),timeExtent:u(n,c)}}next(){this._step({forward:!0,allowRestart:!1})}play(){this._startAnimation()}previous(){this._step({forward:!1,allowRestart:!1})}stop(){this._stopAnimation()}triggerAction(e){this.emit("trigger-action",{action:e})}updateWebDocument(e){if(pi(e)){const i=new Tn({currentTimeExtent:this.timeExtent,fullTimeExtent:this.fullTimeExtent,loop:this.loop,numStops:Ut(this.stops)?this.stops.count:null,numThumbs:this.mode==="time-window"?2:1,stopDelay:this.playRate,stopInterval:st(this.stops)?this.stops.interval:null,stops:ci(this.stops)?this.stops.dates:null});e.widgets?e.widgets.timeSlider=i:e.widgets=new Vn({timeSlider:i})}}valuesToTimeExtent(e){if(V(e))return null;const i=e.sort((a,o)=>a-o).map(a=>new Date(a)),n=i.length>0?i[0]:null,s=i.length>1?i[1]:null;switch(this.mode){case"time-window":return new se({start:n,end:s});case"instant":return new se({start:n,end:n});case"cumulative-from-start":return new se({start:null,end:n});case"cumulative-from-end":return new se({start:n,end:null});default:return se.allTime}}async _animate(){try{const e=this.view,i=Te(this._animationController,n=>n.signal);await Promise.all([Cn(this.playRate,null,i),f(e)&&Ui(()=>e.updating===!1,i)])}catch(e){return Pt(e)||He.getLogger(this.declaredClass).error(e),void(this._animationController=null)}this._step({forward:!0,allowRestart:!1}),V(this._animationController)||this._animate()}_divideTimeExtentByCount(e,i=10){if(!e||!i)return[];const{start:n,end:s}=e;if(V(n)||V(s))return[];if(i>di)return this._divideTimeExtentByCount(e);const a=[],o=n.getTime(),u=s.getTime()-o;for(let r=0;r<=i;r++)a.push(new Date(o+r/i*u));return a}_divideTimeExtentByInterval(e,i,n=di){if(!e||!i)return[];const{start:s,end:a}=e;if(V(s)||V(a))return[];const o=a.getTime()-s.getTime(),u=i.toMilliseconds();if(u<=0||o/u>n)return this._divideTimeExtentByCount(e);const r=[],{value:l,unit:c}=i;let p=s;for(;p.getTime()<=a.getTime();)r.push(new Date(p.getTime())),p=Hi(p,l,c);return r}_getDefaultTimeExtent(){const{effectiveStops:e,mode:i}=this;if(V(e)||!i)return null;switch(i){case"time-window":return e.length>1?new se({start:e[0],end:e[1]}):null;case"cumulative-from-start":return e.length>0?new se({start:null,end:e[0]}):null;case"cumulative-from-end":return e.length>0?new se({start:e[0],end:null}):null;case"instant":return e.length>0?new se({start:e[0],end:e[0]}):null;default:return null}}_registerWidget(e){f(e)&&(e.persistableViewModels.includes(this)||e.persistableViewModels.add(this))}_startAnimation(){this._stopAnimation(),this._animationController=new AbortController,this._step({forward:!0,allowRestart:!0}),this._animate()}_step(e){const{forward:i,allowRestart:n}=e,{effectiveStops:s}=this;if(V(this.timeExtentValues)||V(s))return;const a=s.map(p=>p.getTime()),o=this.timeExtentValues.map(p=>{const h=a.indexOf(p);if(h!==-1)return h;const v=a.reduce((_,y)=>Math.abs(y-p)<Math.abs(_-p)?y:_);return a.indexOf(v)}),u=o.map(p=>p+(i?1:-1)),r=u.some(p=>p<0||p>a.length-1),{loop:l,state:c}=this;if(r)if(l||n){const p=Math.min(...o),h=Math.max(...o),v=(i?o.map(_=>_-p):o.map(_=>_+(a.length-1-h))).map(_=>a[_]);this.timeExtent=this.valuesToTimeExtent(v)}else c==="playing"&&this.stop();else{const p=u.map(h=>a[h]);this.timeExtent=this.valuesToTimeExtent(p)}}_stopAnimation(){f(this._animationController)&&(this._animationController.abort(),this._animationController=null)}_unregisterWidget(e){f(e)&&e.persistableViewModels.remove(this)}};d([m()],q.prototype,"_animationController",void 0),d([m({type:ve})],q.prototype,"actions",void 0),d([m({readOnly:!0})],q.prototype,"effectiveStops",null),d([m({type:se})],q.prototype,"fullTimeExtent",void 0),d([m({nonNullable:!0})],q.prototype,"loop",void 0),d([m({nonNullable:!0})],q.prototype,"mode",void 0),d([m({nonNullable:!0,value:1e3})],q.prototype,"playRate",null),d([m({readOnly:!0})],q.prototype,"state",null),d([m({cast:t=>V(t)?null:(st(t)&&(t.interval=Xt(w,t.interval)),(st(t)||Ut(t))&&(t.timeExtent=Xt(se,t.timeExtent)),t)})],q.prototype,"stops",void 0),d([m({type:se})],q.prototype,"timeExtent",void 0),d([m({readOnly:!0})],q.prototype,"timeExtentValues",null),d([m()],q.prototype,"view",void 0),d([m()],q.prototype,"next",null),d([m()],q.prototype,"play",null),d([m()],q.prototype,"previous",null),d([m()],q.prototype,"stop",null),d([m()],q.prototype,"updateWebDocument",null),q=d([J("esri.widgets.TimeSlider.TimeSliderViewModel")],q);const Gt=q,ys=3,_s=858,bs=new ve([{minor:new w({value:100,unit:"milliseconds"}),major:new w({value:1,unit:"seconds"}),format:{second:"numeric"}},{minor:new w({value:500,unit:"milliseconds"}),major:new w({value:5,unit:"seconds"}),format:{second:"numeric"}},{minor:new w({value:1,unit:"seconds"}),major:new w({value:20,unit:"seconds"}),format:{minute:"numeric",second:"numeric"}},{minor:new w({value:2,unit:"seconds"}),major:new w({value:30,unit:"seconds"}),format:{minute:"numeric",second:"numeric"}},{minor:new w({value:10,unit:"seconds"}),major:new w({value:1,unit:"minutes"}),format:{minute:"numeric"}},{minor:new w({value:15,unit:"seconds"}),major:new w({value:5,unit:"minutes"}),format:{hour:"numeric",minute:"numeric"}},{minor:new w({value:1,unit:"minutes"}),major:new w({value:20,unit:"minutes"}),format:{hour:"numeric",minute:"numeric"}},{minor:new w({value:5,unit:"minutes"}),major:new w({value:2,unit:"hours"}),format:{hour:"numeric",minute:"numeric"}},{minor:new w({value:15,unit:"minutes"}),major:new w({value:6,unit:"hours"}),format:{hour:"numeric",minute:"numeric"}},{minor:new w({value:1,unit:"hours"}),major:new w({value:1,unit:"days"}),format:{day:"numeric",month:"short"}},{minor:new w({value:6,unit:"hours"}),major:new w({value:1,unit:"weeks"}),format:{day:"numeric",month:"short"}},{minor:new w({value:1,unit:"days"}),major:new w({value:1,unit:"months"}),format:{month:"long"}},{minor:new w({value:2,unit:"days"}),major:new w({value:1,unit:"months"}),format:{month:"short"}},{minor:new w({value:3,unit:"days"}),major:new w({value:1,unit:"months"}),format:{month:"short"}},{minor:new w({value:4,unit:"days"}),major:new w({value:3,unit:"months"}),format:{month:"short",year:"numeric"}},{minor:new w({value:1,unit:"weeks"}),major:new w({value:1,unit:"years"}),format:{year:"numeric"}},{minor:new w({value:1,unit:"months"}),major:new w({value:1,unit:"years"}),format:{year:"numeric"}},{minor:new w({value:2,unit:"months"}),major:new w({value:2,unit:"years"}),format:{year:"numeric"}},{minor:new w({value:1,unit:"years"}),major:new w({value:1,unit:"decades"}),format:{year:"numeric"}},{minor:new w({value:2,unit:"years"}),major:new w({value:5,unit:"decades"}),format:{year:"numeric"}},{minor:new w({value:5,unit:"decades"}),major:new w({value:10,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new w({value:1,unit:"centuries"}),major:new w({value:10,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new w({value:2,unit:"centuries"}),major:new w({value:20,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new w({value:5,unit:"centuries"}),major:new w({value:50,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new w({value:10,unit:"centuries"}),major:new w({value:100,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new w({value:20,unit:"centuries"}),major:new w({value:200,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new w({value:50,unit:"centuries"}),major:new w({value:500,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new w({value:100,unit:"centuries"}),major:new w({value:1e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new w({value:200,unit:"centuries"}),major:new w({value:1e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new w({value:500,unit:"centuries"}),major:new w({value:5e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new w({value:1e3,unit:"centuries"}),major:new w({value:1e4,unit:"centuries"}),format:{era:"short",year:"numeric"}}]);let U=class extends Wt{constructor(e,i){super(e,i),this._ignoreNextSliderUpdate=!1,this._slider=new vs({precision:0,visibleElements:{rangeLabels:!1},rangeLabelInputsEnabled:!1,thumbsConstrained:!1}),this._tickFormat=null,this.disabled=!1,this.iconClass=I.widgetIcon,this.labelFormatFunction=null,this.messages=null,this.messagesCommon=null,this.tickConfigs=null,this.timeVisible=!1,this.viewModel=new Gt}initialize(){this.addHandles([ae(()=>this._slider.values,e=>{if(this._ignoreNextSliderUpdate)return void(this._ignoreNextSliderUpdate=!1);const i=this.viewModel.valuesToTimeExtent(e);f(this.timeExtent)?f(i)?this.timeExtent.equals(i)||(this.timeExtent=i):this.timeExtent=null:f(i)&&(this.timeExtent=i)}),ae(()=>this.effectiveStops,()=>this._updateSliderSteps(),Rt)])}loadDependencies(){return Promise.all([ue(()=>import("./calcite-action-1daf85f1.js"),["assets/calcite-action-1daf85f1.js","assets/action-5a45fce9.js","assets/MapView-d4248bee.js","assets/index-9ba3f23e.js","assets/index-fecf00a2.css","assets/guid-9426053f.js","assets/interactive-573cbe88.js","assets/loadable-25ad9e4e.js","assets/t9n-887c4f0a.js","assets/key-4e6b67a3.js","assets/observers-4f67f1fb.js","assets/icon-04547cc0.js","assets/loader-76c5fd82.js"]),ue(()=>import("./calcite-action-menu-52e6b975.js"),["assets/calcite-action-menu-52e6b975.js","assets/action-menu-2f7d1023.js","assets/MapView-d4248bee.js","assets/index-9ba3f23e.js","assets/index-fecf00a2.css","assets/guid-9426053f.js","assets/key-4e6b67a3.js","assets/loadable-25ad9e4e.js","assets/action-5a45fce9.js","assets/interactive-573cbe88.js","assets/t9n-887c4f0a.js","assets/observers-4f67f1fb.js","assets/icon-04547cc0.js","assets/loader-76c5fd82.js","assets/popover-e27ddf8d.js","assets/openCloseComponent-01e91706.js","assets/debounce-31e0cfcc.js","assets/Heading-ad98627e.js"])])}destroy(){this._slider.destroy(),this._tickFormat=null}get actions(){return this.viewModel.actions}set actions(e){this.viewModel.actions=e}get effectiveStops(){return this.viewModel.effectiveStops}get fullTimeExtent(){return this.viewModel.fullTimeExtent}set fullTimeExtent(e){this.viewModel.fullTimeExtent=e}get interactive(){var e;return!this.disabled&&((e=this.viewModel)==null?void 0:e.state)!=="disabled"}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){["auto","compact","wide"].includes(e)||(e="auto"),this._set("layout",e)}get loop(){return this.viewModel.loop}set loop(e){this.viewModel.loop=e}get mode(){return this.viewModel.mode}set mode(e){this.viewModel.mode=e}get playRate(){return this.viewModel.playRate}set playRate(e){this.viewModel.playRate=e}get stops(){return this.viewModel.stops}set stops(e){this.viewModel.stops=e}get timeExtent(){return this.viewModel.timeExtent}set timeExtent(e){this.viewModel.timeExtent=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}static async getPropertiesFromWebMap(e,i){return Gt.getPropertiesFromWebMap(e,i)}next(){return this.viewModel.next()}play(){return this.viewModel.play()}previous(){return this.viewModel.previous()}stop(){return this.viewModel.stop()}render(){var be;const{_slider:e,actions:i,domNode:n,effectiveStops:s,fullTimeExtent:a,interactive:o,messages:u,messagesCommon:r,mode:l,tickConfigs:c,timeExtent:p,timeVisible:h,viewModel:{state:v,timeExtentValues:_}}=this;if(f(a)){const{start:z,end:xe}=a;if(f(z)&&f(xe)){const Ve=z.getTime(),dt=xe.getTime(),Kt=e.min!==Ve||e.max!==dt;if(Kt&&(e.min=Ve,e.max=dt),f(c))e.tickConfigs!==c&&(e.tickConfigs=c);else{const sn=(dt-Ve)/(((be=e.trackElement)==null?void 0:be.offsetWidth)||400),Se=bs.find(ct=>ct.minor.toMilliseconds()>ys*sn),Jt=this._tickFormat!==Se&&Se!=null;if(Jt&&(this._tickFormat=Se),Kt||Jt){const ct={mode:"position",values:this._getTickPositions(Se.minor),labelsVisible:!1,tickCreatedFunction:(pt,mt)=>{mt.classList.add(I.sliderMinorTick)}},an={mode:"position",values:this._getTickPositions(Se.major),labelsVisible:!0,tickCreatedFunction:(pt,mt)=>{mt.classList.add(I.sliderMajorTick)},labelFormatFunction:pt=>xt(pt,Se.format)};e.tickConfigs=[ct,an]}}}}const y=V(this.fullTimeExtent)||V(this.timeExtent)||this.timeExtent.isAllTime||this.timeExtent.isEmpty||f(this.timeExtent.start)&&(this.timeExtent.start<this.fullTimeExtent.start||this.timeExtent.start>this.fullTimeExtent.end)||f(this.timeExtent.end)&&(this.timeExtent.end>this.fullTimeExtent.end||this.timeExtent.end<this.fullTimeExtent.start);if(y)switch(this._ignoreNextSliderUpdate=!0,l){case"time-window":e.values=[e.min,e.max];break;case"instant":case"cumulative-from-end":e.values=[e.min];break;case"cumulative-from-start":e.values=[e.max]}else f(_)?kn(e.values,_)||(e.values=_):e.values=null;e.disabled=!o;const x=v==="ready",F=v==="playing",E=y||!o||V(s)||s.length===0,g=this.layout==="auto"?n.clientWidth<_s?"compact":"wide":this.layout,T=b("div",{class:I.animation},b("button",{"aria-disabled":E?"true":"false","aria-label":F?r.control.stop:r.control.play,bind:this,class:this.classes(I.esriWidgetButton,I.animationButton,E&&I.esriButtonDisabled),disabled:E,title:F?r.control.stop:r.control.play,onclick:this._playOrStopClick,type:"button"},b("div",{class:this.classes((x||E)&&I.animationPlay,F&&I.animationPause)}))),k=f(this.labelFormatFunction)?b("div",{key:"extent",bind:this,class:I.timeExtentDate,"data-type":"extent","data-layout":g,"data-date":Te(p,z=>[z.start,z.end]),afterCreate:this._createLabel,afterUpdate:this._createLabel}):V(p)||f(p)&&p.isAllTime?[b("div",{class:this.classes(I.warning,I.warningIcon)}),b("div",{key:"warning-text",class:I.warningText},u.noTimeExtent)]:p.isEmpty?[b("div",{class:this.classes(I.warning,I.warningIcon)}),b("div",{key:"warning-text",class:I.warningText},u.emptyTimeExtent)]:[f(p.start)&&b("div",{key:"start-date-group",class:I.timeExtentGroup},b("div",{key:"start-date",class:I.timeExtentDate},this._formatDate(p.start)),h&&b("div",{key:"start-time",class:I.timeExtentTime},this._formatTime(p.start))),f(p.start)&&f(p.end)&&p.start.getTime()!==p.end.getTime()&&b("div",{key:"separator",class:I.timeExtentSeparator},"–"),f(p.end)&&(V(p.start)||p.start.getTime()!==p.end.getTime())&&b("div",{key:"end-date-group",class:I.timeExtentGroup},b("div",{key:"end-date",class:I.timeExtentDate},this._formatDate(p.end)),h&&b("div",{key:"end-time",class:I.timeExtentTime},this._formatTime(p.end)))],j=b("div",{class:this.classes(I.timeExtent,!o&&I.esriButtonDisabled)},[k]),Q=f(this.labelFormatFunction)?b("div",{key:"min-date",bind:this,class:I.minDate,"data-date":Te(a,z=>z.start),"data-type":"min","data-layout":g,afterCreate:this._createLabel,afterUpdate:this._createLabel}):f(a)&&f(a.start)&&[b("div",{key:"min-date",class:I.minDate},this._formatDate(a.start)),h&&b("div",{key:"min-time",class:I.minTime},this._formatTime(a.start))],ie=b("div",{class:this.classes(I.min,!o&&I.esriButtonDisabled)},[Q]),H=b("div",{class:I.slider},e.render()),P=f(this.labelFormatFunction)?b("div",{key:"max-date",bind:this,class:I.maxDate,"data-date":Te(a,z=>z.end),"data-type":"max","data-layout":g,afterCreate:this._createLabel,afterUpdate:this._createLabel}):f(a)&&f(a.end)&&[b("div",{key:"max-date",class:I.maxDate},this._formatDate(a.end)),h&&b("div",{key:"max-time",class:I.maxTime},this._formatTime(a.end))],re=b("div",{class:this.classes(I.max,!o&&I.esriButtonDisabled)},[P]),Z=b("div",{class:I.previous},b("button",{"aria-disabled":E?"true":"false","aria-label":r.pagination.previous,bind:this,class:this.classes(I.esriWidgetButton,I.previousButton,(F||E)&&I.esriButtonDisabled),disabled:E,title:r.pagination.previous,onclick:this._previousClick,type:"button"},b("div",{class:I.previousIcon}))),_e=b("div",{class:I.next},b("button",{"aria-disabled":E?"true":"false","aria-label":r.pagination.next,bind:this,class:this.classes(I.esriWidgetButton,I.nextButton,(F||E)&&I.esriButtonDisabled),disabled:E,title:r.pagination.next,onclick:this._nextClick,type:"button"},b("div",{class:I.nextIcon}))),le=(i==null?void 0:i.length)>0,he=le&&b("div",{class:I.actions,title:r.options},b("calcite-action-menu",{label:r.options,class:I.actionsButton},i.toArray().map(z=>b("calcite-action",{bind:this,icon:z.icon,id:z.id,onclick:()=>this.viewModel.triggerAction(z),text:z.title,textEnabled:!0}))));return b("div",{class:this.classes(I.timeSlider,I.esriWidget,`${I.timeSliderMode}${l}`,`${I.timeSliderLayout}${g}`,!o&&I.esriDisabled,y&&I.timeSliderOutOfBounds,le&&I.hasActions,Sn()),afterCreate:z=>{this.addHandles(Gi(z,()=>this.scheduleRender()))},"aria-label":u.widgetLabel},g==="wide"&&b("div",{class:I.timeSliderRow},b("div",{class:I.playbackControls},[T,j,ie,H,re,Z,_e]),he),g==="compact"&&[b("div",{key:"time-slider-row-1",class:I.timeSliderRow},[j,he]),b("div",{key:"time-slider-row-2",class:I.timeSliderRow},[H]),b("div",{key:"time-slider-row-3",class:I.timeSliderRow},[ie,Z,T,_e,re])])}updateWebDocument(e){var i;(i=this.viewModel)==null||i.updateWebDocument(e)}_createLabel(e){if(V(this.labelFormatFunction))return;const i=e.getAttribute("data-type"),n=e.getAttribute("data-layout"),s=e["data-date"];this.labelFormatFunction(s,i,e,n)}_getTickPositions(e){const{fullTimeExtent:i}=this;if(V(i)||V(i.start)||V(i.end))return[];const{start:n,end:s}=i,a=[],{value:o,unit:u}=e;let r=An(n,u);for(;r.getTime()<=s.getTime();)r.getTime()>=n.getTime()&&a.push(r.getTime()),r=Hi(r,o,u);return a}_formatDate(e){return e?xt(e,Zt("short-date")):null}_formatTime(e){return e?xt(e,Zt("long-time")):null}_updateSliderSteps(){this._slider.steps=f(this.effectiveStops)&&this.effectiveStops.length>0?this.effectiveStops.map(e=>e.getTime()):null}_playOrStopClick(){switch(this.viewModel.state){case"ready":this.viewModel.play();break;case"playing":this.viewModel.stop();break;case"disabled":break;default:qi(this.viewModel.state)}}_previousClick(){this.viewModel.previous()}_nextClick(){this.viewModel.next()}};d([m()],U.prototype,"actions",null),d([m()],U.prototype,"disabled",void 0),d([m()],U.prototype,"effectiveStops",null),d([m()],U.prototype,"fullTimeExtent",null),d([m()],U.prototype,"iconClass",void 0),d([m({readOnly:!0})],U.prototype,"interactive",null),d([m()],U.prototype,"label",null),d([m()],U.prototype,"labelFormatFunction",void 0),d([m({value:"auto"})],U.prototype,"layout",null),d([m()],U.prototype,"loop",null),d([m(),We("esri/widgets/TimeSlider/t9n/TimeSlider")],U.prototype,"messages",void 0),d([m(),We("esri/t9n/common")],U.prototype,"messagesCommon",void 0),d([m()],U.prototype,"mode",null),d([m()],U.prototype,"playRate",null),d([m()],U.prototype,"stops",null),d([m()],U.prototype,"tickConfigs",void 0),d([m()],U.prototype,"timeExtent",null),d([m({nonNullable:!0})],U.prototype,"timeVisible",void 0),d([m()],U.prototype,"view",null),d([m({type:Gt}),zi("trigger-action")],U.prototype,"viewModel",void 0),d([bt()],U.prototype,"_playOrStopClick",null),d([bt()],U.prototype,"_previousClick",null),d([bt()],U.prototype,"_nextClick",null),U=d([J("esri.widgets.TimeSlider")],U);const xs=U;function Es(t,e,i,n,s){const a=new xs({container:n,view:s,fullTimeExtent:{start:t,end:e},timeExtent:{start:i,end:i},timeVisible:!0,loop:!0,stops:{interval:{unit:"days",value:1}},mode:"instant",layout:"compact"});return a.visible=!1,a}const Zi=Ke("timerslider",()=>{const t=ce().getView();let e=B(null);function i(n){const s=Je(),a=s.year,o=s.month,u=s.day,r=new Date(a.value,o.value-1,u.value-4),l=new Date(a.value,o.value-1,u.value),c=new Date(a.value,o.value-1,u.value);n&&(e.value=Es(r,l,c,n.value,t))}return{createTimeslider:i,timeSlider:e}}),it=Je();function ws(){let t=[],e=new Date(it.year.value,it.month.value-1,it.day.value).getTime(),i=24*60*60*1e3;for(let n=0;n<5;n++){let s=new Date(e+(n-3)*i),a=s.getMonth()+1,o=s.getDate(),u=a+"-"+o;t.push(u)}return t}const Fs={color:["#ed3f35","#00f2f1","#f7b851"],title:{text:it.nowTime.value,textStyle:{color:"#fff"}},tooltip:{trigger:"axis",axisPointer:{lineStyle:{color:"#ccc",width:1,type:"solid"}},backgroundColor:"#115687",borderColor:"#ccc",borderWidth:1,padding:[5,10],textStyle:{color:"#fff",fontSize:12},extraCssText:"box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);max-width: 200px; max-height: 90px;",formatter:function(t){let e='<div style="font-size: 16px; font-weight: bold;height: 30px; ">'+t[0].name+"</div>";return t.forEach(function(i){let n="";i.seriesIndex===0||i.seriesIndex===1?n="°C":n="%",e+='<span style="display: inline-block; width: 10px; height: 10px; margin-right: 5px;font-size: 14px; border-radius: 50%; background-color: '+i.color+';"></span>'+i.seriesName+"："+i.value+n+"<br>"}),e}},legend:{textStyle:{color:"#4c9bfd"},right:"3%"},grid:{top:"20%",left:"3%",right:"4%",bottom:"3%",show:!0,borderColor:"#012f4a",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:ws(),axisTick:{show:!1},axisLabel:{color:"#4c9bfd"},axisLine:{show:!1}},yAxis:{type:"value",axisLabel:{color:"#4c9bfd"},splitLine:{lineStyle:{color:"#012f4a"}}},series:[{name:"最高温度",type:"line",smooth:!0,data:[]},{name:"最低温度",type:"line",smooth:!0,data:[]},{name:"湿度",type:"line",smooth:!0,data:[]}]},Vt=Je();function Is(){let t=[],e=new Date(Vt.year.value,Vt.month.value-1,Vt.day.value).getTime(),i=24*60*60*1e3;for(let n=0;n<5;n++){let s=new Date(e+(n-4)*i),a=s.getMonth()+1,o=s.getDate(),u=a+"-"+o;t.push(u)}return t}const Ts={grid:{top:"12%",left:"15%",bottom:"10%"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},backgroundColor:"#115687",borderColor:"#ccc",borderWidth:1,padding:[5,10],textStyle:{color:"#fff",fontSize:12},extraCssText:"box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);max-width: 200px; max-height: 110px;",formatter:function(t){let e='<div style="font-size: 16px; font-weight: bold;height: 30px; ">'+t[0].name+"</div>";return t.forEach(function(i){e+='<span style="display: inline-block; width: 10px; height: 10px; margin-right: 5px;font-size: 14px; border-radius: 50%; background-color: '+i.color+';"></span>'+i.seriesName+"："+i.value+"<br>"}),e}},xAxis:{type:"category",data:Is(),axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:"#4c9bfd"}},legend:{data:["pH值","溶解氧","高锰酸盐指数","总氮"],textStyle:{color:"#4c9bfd"}},yAxis:{type:"value",axisLabel:{color:"#4c9bfd"}},toolbox:{show:!0,orient:"vertical",left:"right",top:"center",showTitle:!1,feature:{magicType:{show:!0,type:["line","bar"]}},iconStyle:{color:"#4c9bfd",borderColor:"#4c9bfd"}},series:[{name:"pH值",type:"bar",data:[],itemStyle:{borderRadius:20}},{name:"溶解氧",type:"bar",data:[],itemStyle:{borderRadius:20}},{name:"高锰酸盐指数",type:"bar",data:[],itemStyle:{borderRadius:20}},{name:"总氮",type:"bar",data:[],itemStyle:{borderRadius:20}}]},Ct=Je();function Vs(){let t=[],e=new Date(Ct.year.value,Ct.month.value-1,Ct.day.value).getTime(),i=24*60*60*1e3;for(let n=0;n<5;n++){let s=new Date(e+(n-4)*i),a=s.getMonth()+1,o=s.getDate(),u=a+"-"+o;t.push(u)}return t}const Qe={baseOption:{toolbox:{show:!0,orient:"vertical",left:"10",top:"-10",feature:{},itemSize:25},animation:!0,timeline:{data:[],axisType:"category",orient:"vertical",left:"15%",top:"center",width:"15%",height:"200px",autoPlay:!0,playInterval:1500,label:{fontSize:12,color:"#4c9bfd"},tooltip:{show:!1}},tooltip:{trigger:"axis"},radar:{indicator:[{name:"PM10",max:100,color:"#4c9bfd"},{name:"PM2.5",max:50,color:"#4c9bfd"},{name:"CO",max:1,color:"#4c9bfd"},{name:"SO₂",max:50,color:"#4c9bfd"},{name:"NO₂",max:50,color:"#4c9bfd"}],center:["70%","50%"]},series:{name:"污染指数",type:"radar",data:[]}},options:[]},Oe=Vs(),mi={[Oe[0]]:[],[Oe[1]]:[],[Oe[2]]:[],[Oe[3]]:[],[Oe[4]]:[]};var Li;const hi=(Li=Qe.baseOption)==null?void 0:Li.radar;var Di,Pi,Ri,Oi;for(let t in mi){let e=mi[t];console.log(t);let i={series:{data:[{value:e,name:t,itemStyle:{color:"#17e3f5"}}]},tooltip:{trigger:"item",backgroundColor:"#115687",borderColor:"#ccc",borderWidth:1,padding:[5,10],textStyle:{color:"#fff",fontSize:12},extraCssText:"box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);max-width: 200px; max-height: 130px;",formatter:function(n){let s='<div style="font-size: 18px; font-weight: bold;height: 30px; ">'+n.name+"</div>";if(hi.indicator)for(let a=0;a<n.value.length;a++)s+='<span style="display: inline-block; width: 10px; height: 10px; margin-right: 5px;font-size: 18px; border-radius: 50%; background-color: '+n.color+';"></span>'+hi.indicator[a].name+"："+n.value[a]+"<br>";return s}}};(Di=Qe.options)==null||Di.push(i),(Oi=(Ri=(Pi=Qe.baseOption)==null?void 0:Pi.timeline)==null?void 0:Ri.data)==null||Oi.push(t)}const Re=t=>(rn("data-v-ec6715d7"),t=t(),ln(),t),Cs={class:"envirment-panel line"},$s=Re(()=>N("div",{class:"envirment-panel-title"},[N("span",null,"湿度温度监测")],-1)),ks=Re(()=>N("div",{class:"envirment-panel-footer"},null,-1)),Ss={class:"envirment-panel bar"},As=Re(()=>N("div",{class:"envirment-panel-title"},[N("span",null,"空气污染指数")],-1)),Ms=Re(()=>N("div",{class:"envirment-panel-footer"},null,-1)),Ls={class:"envirment-panel pie"},Ds=Re(()=>N("div",{class:"envirment-panel-title"},[N("span",null,"景点水质监测")],-1)),Ps=Re(()=>N("div",{class:"envirment-panel-footer"},null,-1)),Rs=rt({__name:"environment",setup(t){const e=Xi(),i=Zi(),n=us(),s=B(null),a=B(null),o=B(null),u=B(null);e.addTimeHeatmap();const r=on(i.timeSlider);return n.createOnlayer(),lt(()=>{var h;let l=null,c=null,p=null;a.value&&(l=Et(a.value),It(l,Fs),n.setChartLine(l)),o.value&&(c=Et(o.value),((h=Qe.baseOption)==null?void 0:h.toolbox).feature={myTool1:{show:!0,title:"AQI热力图",icon:"image://https://img.icons8.com/color/48/000000/fire-element.png",onclick:function(){e.isHeatmapLoaded()?(e.toggleHeatmap(),r.visible=!r.visible,r.playRate=3e3):alert("请先创建热力图")}}},It(c,Qe),n.setChartRadar(c)),u.value&&(p=Et(u.value),It(p,Ts),n.setChartBar(p))}),zt(()=>{n.destroyOnlayer(),r.visible=!1,e.cancelTimeHeatmap()}),(l,c)=>(de(),Be("div",{class:"envirment",ref_key:"envirmentRef",ref:s},[N("div",Cs,[$s,N("div",{class:"envirment-panel-chart",ref_key:"chartLineRef",ref:a},null,512),ks]),N("div",Ss,[As,N("div",{class:"envirment-panel-chart",ref_key:"chartRadarRef",ref:o},null,512),Ms]),N("div",Ls,[Ds,N("div",{class:"envirment-panel-chart",ref_key:"chartBarRef",ref:u},null,512),Ps])],512))}});const Os=un(Rs,[["__scopeId","data-v-ec6715d7"]]),Ns=`@charset "UTF-8";.classification-card{display:flex;flex-direction:column;position:fixed;right:0%;top:10%;width:30%;height:auto;border-radius:6px;background-image:linear-gradient(-90deg,#182940 0%,#115687 100%);pointer-events:auto;border:0px solid var(--el-card-border-color)}.classification-card__header{display:flex;justify-content:space-between;align-items:center;color:#fff;font-size:1.6rem;font-weight:700;font-style:italic}.classification-params{height:40%}.classification-slider-demo{display:flex;align-items:center}.classification-slider-tooltip,.classification-tooltip-popper,.classification-legend{height:auto}.el-table{--el-table-border-color: var(--el-border-color-lighter);--el-table-border: 1px solid var(--el-table-border-color);--el-table-text-color: #fff;--el-table-header-text-color: #fff;--el-table-row-hover-bg-color: #115687;--el-table-current-row-bg-color: var(--el-color-primary-light-9);--el-table-header-bg-color: #115687;--el-table-fixed-box-shadow: var(--el-box-shadow-light);--el-table-bg-color: #fff;--el-table-tr-bg-color: #ffffff00;--el-table-expanded-cell-bg-color: var(--el-fill-color-blank);--el-table-fixed-left-column: inset 10px 0 10px -10px rgba(0, 0, 0, .15);--el-table-fixed-right-column: inset -10px 0 10px -10px rgba(0, 0, 0, .15)}.el-table__body-wrapper tr td.el-table-fixed-column--right,.el-table__body-wrapper tr td.el-table-fixed-column--left{background-color:#115687}.el-input__wrapper{background-color:#fff0}.el-input__inner{color:#fff}.el-button.is-link{color:#28c3e2}.el-progress__text{height:auto;color:#fff}
`,js=Ke("Autoupdata",()=>{const t=ce().getView(),e={AQI:"aqi",ph值:"ph",溶解氧:"dissolvedoxygen",高锰酸盐指数:"permanganateindex",总氮:"totalnitrogen",湿度:"humidity"};let i={aqi:[20,40],ph:[7,9],dissolvedoxygen:[6,8],permanganateindex:[2,5],totalnitrogen:[0,1],mintemp:18,humidity:[45,55],maxtemp:23};const n=[i],s=["环境优美","环境良好","环境一般","环境较差","环境脏乱"];function a(l){const c=[[0,255,0,.5],[0,180,0,.8],[0,80,210,.8],[255,255,0,.8],[255,0,0,.8]],p=["#17f5a7","#1F7A44","#1A6EA5","#A59825","#7F1A1C"],h=[];for(let y=0;y<5;y++){const x=new ei({style:"path",path:"M18.3,8.7c0,0-1.7-2.2-8.3-4.4S1.7,8.7,1.7,8.7S6,14.3,10,18c4-3.7,8.3-9.3,8.3-9.3",color:c[y],outline:{color:p[y],width:2},size:7});h.push(x)}const v=new Ln({field:"class",uniqueValueInfos:[{value:"环境优美",symbol:h[0]},{value:"环境良好",symbol:h[1]},{value:"环境一般",symbol:h[2]},{value:"环境较差",symbol:h[3]},{value:"环境恶劣",symbol:h[4]}]});l.renderer=v;const _=new Ot({title:"{名称}",content:[{type:"fields",fieldInfos:[{fieldName:"aqi",label:"AQI"},{fieldName:"ph",label:"ph值"},{fieldName:"dissolvedoxygen",label:"溶解氧"},{fieldName:"permanganate",label:"高锰酸盐指数"},{fieldName:"totalnitrogen",label:"总氮"},{fieldName:"humidity",label:"湿度"},{fieldName:"maxtemp",label:"最高气温"},{fieldName:"class",label:"景点评价"}]}]});l.popupTemplate=_}async function o(l,c,p){const h=t.map.findLayerById("points"),v=h.createQuery();v.where="1=1",await h.queryFeatures(v).then(({features:_})=>{c.value=!0,l.value=0;let y=0;_.forEach(async x=>{const E=x.geometry,g={location:`${E.longitude},${E.latitude}`},T=x.attributes.city,k=ds[T];let j="",Q="";for(let H in k)j=k[H].行政区划,Q=H;const ie={areaCode:j,name:Q,date:""};await jt.post("http://81.70.22.42:9000/quality/water",ie).then(H=>{for(let P in H.data)if(P==="ph"||P==="dissolvedoxygen"||P==="permanganateindex"||P==="totalnitrogen"){const re=`名称='${x.attributes.名称}'`;let Z={[P.toLocaleLowerCase()]:H.data[P]};P==="permanganateindex"&&(Z={permanganate:H.data[P]}),ze(h,{where:re,attributeUpdates:Z}),y++,l.value=Math.floor(y/(_.length*8)*100),y===_.length*8&&setTimeout(()=>{c.value=!1},600)}}),await jt.post("http://81.70.22.42:9000/quality/now",g).then(H=>{for(let P in H.data)if(P==="date"||P==="tempMax"||P==="aqi"||P==="humidity"){const re=`名称='${x.attributes.名称}'`;let Z={[P.toLocaleLowerCase()]:H.data[P]};P==="tempMax"&&(Z={maxtemp:H.data[P]}),P==="date"&&(Z={pointstime:new Date(H.data[P]).getTime()}),ze(h,{where:re,attributeUpdates:Z}),y++,l.value=Math.floor(y/(_.length*8)*100),y===_.length*8&&setTimeout(()=>{c.value=!1},600)}})})}),new Yi({container:p,view:t,layerInfos:[{layer:h,title:"景点图例"}]})}async function u(l,c){if(i=n[n.length-1],l.name)if(l.name==="气温")i.mintemp=l.Value[0],i.maxtemp=l.Value[1];else{const _=e[l.name];i[_]=l.Value}n.push(i);const p=e[c],h=t.map.findLayerById("points"),v=h.createQuery();v.where="1=1",await h.queryFeatures(v).then(({features:_})=>{_.forEach(y=>{let x=0;for(const T in y.attributes)T==="maxtemp"?(y.attributes[T]>i[T]||y.attributes[T]<i.mintemp)&&x++:T==="aqi"||T==="humidity"?(y.attributes[T]<i[T][0]||y.attributes[T]>i[T][1])&&x++:T===p&&(y.attributes[T]<i[T][0]||y.attributes[T]>i[T][1])&&x++;console.log(y.attributes.名称,x);const F=`名称='${y.attributes.名称}'`,E={class:s[x]};ze(h,{where:F,attributeUpdates:E})}),a(h)})}function r(){const l=t.map.findLayerById("points"),c=new Ot({title:"{名称}",content:[{type:"fields",fieldInfos:[{fieldName:"名称",label:"名称"},{fieldName:"类型名称",label:"类型名称"},{fieldName:"longitude",label:"经度"},{fieldName:"latitude",label:"纬度"},{fieldName:"高程",label:"高程"}]}]});l.popupTemplate=c;const p=new ei({style:"path",path:"M18.3,8.7c0,0-1.7-2.2-8.3-4.4S1.7,8.7,1.7,8.7S6,14.3,10,18c4-3.7,8.3-9.3,8.3-9.3",color:"#17e3f5",outline:{color:"#115687",width:2},size:7}),h=new Mn({label:"景点",symbol:p});l.renderer=h}return{Uplayerdata:o,classifyAnalysis:u,cancelrender:r}}),Us={class:"box-card__header"},Gs=N("span",null,"模糊分类参数设置",-1),Bs={class:"classification-params"},Hs={key:0},zs={key:1},qs=N("div",{style:{height:"20px"}},null,-1),Ws=rt({__name:"classification",setup(t){const{Uplayerdata:e,classifyAnalysis:i,cancelrender:n}=js(),s=dn("watchV2"),a=B(null),o=B(0),u=B(!1),r=[{color:"#f56c6c",percentage:20},{color:"#e6a23c",percentage:40},{color:"#5cb87a",percentage:60},{color:"#1989fa",percentage:80},{color:"#115687 ",percentage:100}],l=[{name:"气温",sliderValue:[18,23],sliderSettings:{min:18,max:25},isSelect:!1,selectValue:""},{name:"湿度",sliderValue:[45,55],sliderSettings:{min:40,max:60},isSelect:!1,selectValue:""},{name:"AQI",sliderValue:[20,40],sliderSettings:{min:0,max:50},isSelect:!1,selectValue:""},{name:"ph值",sliderValue:[7,9],sliderSettings:{min:6,max:9},isSelect:!0,selectValue:"1"}],c=(g,T)=>{switch(T){case"气温":return g.toFixed(2)+" °C";case"湿度":return g.toFixed(2)+"%";case"AQI":return g.toFixed(2);case"ph值":return g.toFixed(2);case"溶解氧":return g.toFixed(2)+"mg/L";case"高锰酸盐指数":return g.toFixed(2)+"mg/L";case"总氮":return g.toFixed(2)+"mg/L";default:return""}};function p(g){switch(g){case"1":return{min:6,max:9,sliderValue:[7,9],name:"ph值"};case"2":return{min:5,max:9,sliderValue:[6,8],name:"溶解氧"};case"3":return{min:0,max:5,sliderValue:[2,5],name:"高锰酸盐指数"};default:return{min:0,max:1,sliderValue:[0,1],name:"总氮"}}}let h="ph值";const v=g=>{if(console.log(g),g.isSelect){const{min:T,max:k,sliderValue:j,name:Q}=p(g.selectValue);g.name=Q,g.sliderSettings.min=T,g.sliderSettings.max=k,g.sliderValue=j,h=g.name}i(y,h),s.value=!1};function _(g){switch(g.name){case"气温":return`当前${g.name}的取值为${g.sliderValue[0]}~${g.sliderValue[1]}°C、
        取值范围为${g.sliderSettings.min}~${g.sliderSettings.max}°C`;case"湿度":return`当前${g.name}的取值为${g.sliderValue[0]}~${g.sliderValue[1]}%、
        取值范围为${g.sliderSettings.min}~${g.sliderSettings.max}%`;case"AQI":return`当前${g.name}的取值为${g.sliderValue[0]}~${g.sliderValue[1]}、
        取值范围为${g.sliderSettings.min}~${g.sliderSettings.max}`;case"水质":return`当前${g.name}的默认值为ph值，当前${g.name}的取值为${g.sliderValue[0]}~${g.sliderValue[1]}、
        取值范围为${g.sliderSettings.min}~${g.sliderSettings.max}`;case"ph值":return`当前${g.name}的取值为${g.sliderValue[0]}~${g.sliderValue[1]}、
        取值范围为${g.sliderSettings.min}~${g.sliderSettings.max}`;case"溶解氧":return`当前${g.name}的取值为${g.sliderValue[0]}~${g.sliderValue[1]}mg/L、
        取值范围为${g.sliderSettings.min}~${g.sliderSettings.max}mg/L`;case"高锰酸盐指数":return`当前${g.name}的取值为${g.sliderValue[0]}~${g.sliderValue[1]}mg/L、
        取值范围为${g.sliderSettings.min}~${g.sliderSettings.max}mg/L`;case"总氮":return`当前${g.name}的取值为${g.sliderValue[0]}~${g.sliderValue[1]}mg/L、
        取值范围为${g.sliderSettings.min}~${g.sliderSettings.max}mg/L`;default:return""}}const y={name:"",Value:[0,0]};function x(g,T){y.name=g.name,y.Value=T,console.log(y),i(y,h),s.value=!1}lt(()=>{e(o,u,a.value)}),zt(()=>{n(),s.value=!0});function F(){i(y,h),s.value=!1}const E=document.createElement("style");return E.setAttribute("lang","scss"),E.innerHTML=Ns,document.head.appendChild(E),(g,T)=>(de(),Be(gn,null,[u.value?(de(),De(M(Ni),{key:0,type:"dashboard","stroke-width":20,percentage:o.value,color:r,style:{position:"absolute",left:"30%",top:"20%","pointer-events":"auto",height:"auto"}},null,8,["percentage"])):je("",!0),O(M(qt),{class:"classification-card",ref:"classificationRef"},{header:G(()=>[N("div",Us,[Gs,O(M(Lt),{class:"button",text:"",style:{color:"#28c3e2","font-size":"18px","font-weight":"bold","font-style":"italic"},onClick:F},{default:G(()=>[Pe("执行分析 ")]),_:1})])]),default:G(()=>[N("div",Bs,[O(M(cn),{data:l,border:!0,style:{width:"100%","background-image":"linear-gradient(-90deg, #182940 0%, #115687 100%)"}},{default:G(()=>[O(M(ht),{prop:"name",label:"参数",width:"120"},{default:G(({row:k})=>[k.isSelect?(de(),Be("div",Hs,[O(M(pn),{modelValue:k.selectValue,"onUpdate:modelValue":j=>k.selectValue=j,placeholder:"请选择",onChange:j=>v(k)},{default:G(()=>[O(M(Ye),{label:"ph值",value:"1"}),O(M(Ye),{label:"溶解氧",value:"2"}),O(M(Ye),{label:"高锰酸盐指数",value:"3"}),O(M(Ye),{label:"总氮",value:"4"})]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])):(de(),Be("span",zs,mn(k.name),1))]),_:1}),O(M(ht),{prop:"sliderSettings",label:"设置范围",width:"330"},{default:G(({row:k})=>[O(M(hn),{modelValue:k.sliderValue,"onUpdate:modelValue":j=>k.sliderValue=j,range:"",min:k.sliderSettings.min,max:k.sliderSettings.max,"tooltip-class":"classification-slider-tooltip","format-tooltip":j=>c(j,k.name),onChange:j=>x(k,j)},null,8,["modelValue","onUpdate:modelValue","min","max","format-tooltip","onChange"])]),_:1}),O(M(ht),{fixed:"right",label:"提示",width:"100"},{default:G(({row:k})=>[O(M(fn),{class:"item",effect:"dark",content:_(k),"popper-class":"classification-tooltip-popper"},{default:G(()=>[O(M(Lt),{link:"",type:"primary",size:"small"},{default:G(()=>[Pe("Detail")]),_:1})]),_:2},1032,["content"])]),_:1})]),_:1})]),qs,N("div",{class:"classification-legend",ref_key:"IlengendRef",ref:a},null,512)]),_:1},512)],64))}}),ye="esri-feature-form",tt=`${ye}__date`,pe=`${ye}__group`,ne=`${ye}__input`,A={base:ye,form:`${ye}__form`,formHeader:`${ye}__form-header`,label:`${ye}__label`,inputFieldWrapper:`${ne}-wrapper`,inputFieldLoader:`${ne}-loader`,inputField:`${ne}`,inputDate:`${ne}--date`,inputTime:`${ne}--time`,inputRadioGroup:`${ne}--radio-group`,inputRadio:`${ne}--radio`,inputRadioLabel:`${ne}--radio-label`,inputDisabled:`${ne}--disabled`,inputSwitch:`${ne}--switch`,inputInvalid:`${ne}--invalid`,inputIconInvalid:`${ne}-icon--invalid`,errorMessage:`${ye}__field-error-message`,description:`${ye}__description-text`,dateInputPart:`${tt}-input-part`,loneDateInputPart:`${tt}-input-part--lone`,dateInputContainer:`${tt}-input-container`,dateFormatHint:`${tt}-format-hint`,group:pe,groupLabel:`${pe}-label`,groupHeader:`${pe}-header`,groupHeading:`${pe}-header`,groupTitle:`${pe}-title`,groupDescription:`${pe}-description`,groupToggleIcon:`${pe}-toggle-icon`,groupCollapsed:`${pe}--collapsed`,groupSequential:`${pe}--sequential`,groupActive:`${pe}--active`,collapseIcon:"esri-icon-up",errorIcon:"esri-icon-notice-triangle",expandIcon:"esri-icon-down",widget:"esri-widget",panel:"esri-widget--panel",input:"esri-input",select:"esri-select"},Ie=t=>!!t.inputFields,fe=(t,e)=>{var i;return f(t)&&((i=t.input)==null?void 0:i.type)===e},fi={typeFieldName:null,types:[]};function gi(t,e,i){const n=Object.keys(e).filter(o=>Nt(t,o)),s=n.map(o=>e[o]),a=n.map(o=>i.get(o)).filter(f);return Ks(t,Qs(s,a))}function Qs(t,e){const i=e.map((n,s)=>{let a=t[s];if(n.domain&&n.domain.type==="coded-value"){const o=n.domain.codedValues.find(u=>u.code===a);o!=null&&o.name&&(a=o.name)}return[n.name,a]});return Object.fromEntries(i)}function Ks(t,e){return ti(ti(t,i=>`{${i.toLowerCase()}}`),Object.fromEntries(Object.entries(e).map(([i,n])=>[i.toLowerCase(),n])))}const Bt=t=>{var e,i;return t?t.type==="subtype-sublayer"?{typeFieldName:(e=t.parent)==null?void 0:e.subtypeField,types:(i=t.parent)==null?void 0:i.subtypes}:"types"in t&&t.types?{typeFieldName:t.typeIdField,types:t.types.map(({id:n,name:s,domains:a})=>({code:n,name:s,domains:a}))}:fi:fi};let Ce=class extends me{constructor(e){super(e),this.maxValue=null,this.minValue=null,this.codedValue=null}};d([m()],Ce.prototype,"objectType",void 0),d([m()],Ce.prototype,"maxValue",void 0),d([m()],Ce.prototype,"minValue",void 0),d([m()],Ce.prototype,"codedValue",void 0),Ce=d([J("esri.layers.support.ContingentValue")],Ce);const W=Ce;let $e=class extends me{constructor(e){super(e),this.isRetired=!1}};d([m()],$e.prototype,"id",void 0),d([m()],$e.prototype,"isRetired",void 0),d([m()],$e.prototype,"subtype",void 0),d([m()],$e.prototype,"values",void 0),$e=d([J("esri.layers.support.Contingency")],$e);const vi=$e;let Ue=class extends me{constructor(e){super(e)}};d([m()],Ue.prototype,"fieldGroup",void 0),d([m()],Ue.prototype,"type",void 0),Ue=d([J("esri.layers.support.ContingencyConstraintViolation")],Ue);const yi=Ue;let Ge=class extends me{constructor(t){super(t)}};d([m()],Ge.prototype,"contingentValuesAllGroups",void 0),d([m()],Ge.prototype,"contingentValuesByFieldGroup",void 0),Ge=d([J("esri.layers.support.ContingentValuesResult")],Ge);const Js=Ge;let ke=class extends me{constructor(t){super(t),this.fields=null,this.isEditingRestrictive=!1}};d([m()],ke.prototype,"name",void 0),d([m()],ke.prototype,"fields",void 0),d([m()],ke.prototype,"isEditingRestrictive",void 0),d([m()],ke.prototype,"contingencies",void 0),ke=d([J("esri.layers.support.FieldGroup")],ke);const Ht=ke;var Ee;let we=Ee=class extends Dn(Pn){constructor(t){super(t),this.request=Ae,this.fieldGroups=null,this.fieldGroupDefinitions=null}initialize(){}get subtypeFieldName(){const{layer:t}=this;return t.type==="subtype-group"?t.subtypeField:t.typeIdField}static async createLoadedLayerContingentValuesCache(t){await t.load();const e=t.sourceJSON;if(t.layerId===void 0)return null;const i=e.hasContingentValuesDefinition;if(i)return new Ee({layer:t}).load();if(i===void 0){const n=wt(t.url);if(V(n))return null;const s=n.url.path;if((await Ee._staticFetchEnterpriseFeatureRoot(s)).supportsQueryDataElements){const a=t.layerId.toString(),o=await Ee._staticFetchEnterpriseFieldGroup(s,a);if(o){const u=o.map(r=>({name:r.name,isEditingRestrictive:r.isEditingRestrictive,fields:r.fieldNames.names}));return new Ee({layer:t,fieldGroupDefinitions:u}).load()}}}return null}async load(t){const e=this.layer.load(t).then(()=>this._initializeContingentValues(this.fieldGroupDefinitions,t));return this.addResolvingPromise(e),this}validateContingencyConstraints(t,e){const i=Object.keys(t),n=[],s=[];for(const a of this.fieldGroups){const o=a.isEditingRestrictive?"error":"warning";if(e&&!a.fields.some(c=>e.includes(c)))continue;if(!a.fields.every(c=>i.includes(c))){s.push(new yi({fieldGroup:a,type:o}));continue}let u=!1;const r=t[this.subtypeFieldName],l=a.contingencies.filter(c=>!(!c.isRetired&&c.subtype)||c.subtype.code===r);for(const c of l){let p=!0;for(const h in c.values){const v=c.values[h];if(v.objectType!=="any"){if(v.objectType==="null"){if(t[h]!=null){p=!1;break}}else if(v.objectType==="code"){if(t[h]!==v.codedValue.code){p=!1;break}}else if(v.objectType==="range"){const _=t[h];if(_<v.minValue||_>v.maxValue){p=!1;break}}}}if(p){u=!0;break}}u||n.push(new yi({fieldGroup:a,type:o}))}return{invalid:n,incomplete:s}}getContingentValues(t,e,i=!1){const n=t[this.subtypeFieldName],s=n!=null,a={};let o=[];const u=this.fieldGroups.filter(r=>r.fields.includes(e));o.push(new W({objectType:"any"}));for(const r of u){let l=[];const c=r.contingencies.filter(v=>!(v.isRetired||v.subtype&&s&&v.subtype.code!==n));let p=!1;const h={};for(const v of c){let _,y=!0;for(const x in v.values){const F=v.values[x];if(e!==x){if(t[x]!==void 0&&F.objectType!=="any"){if(F.objectType==="null")t[x]!==null&&(y=!1);else if(F.objectType==="code")t[x]!==F.codedValue.code&&(y=!1);else if(F.objectType==="range"){const E=t[x];(E<F.minValue||E>F.maxValue)&&(y=!1)}}}else _=F,p=p||F.objectType==="range"}if(_&&y){if(_.objectType==="any"){l.length=0,l.push(_);break}const x=this._generateKey(_);h[x]||l.push(_),h[x]=!0}}p&&(l=this._joinRange(l)),a[r.name]=l,o=i?this._filterIntersection(o,l):[]}return u.length===1&&i&&(o=[]),new Js({contingentValuesAllGroups:o,contingentValuesByFieldGroup:a})}_generateKey(t){switch(t.objectType){case"any":return"@any@";case"null":return"@null@";case"code":return t.codedValue.name+t.codedValue.code.toString();case"range":return t.minValue.toString()+"-"+t.maxValue.toString()}}_joinRange(t){let e,i;t.sort((s,a)=>s.objectType==="null"?-1:a.objectType==="null"?1:s.minValue-a.minValue);const n=[];for(const s of t)s.objectType!=="null"?e!=null&&i!=null?i<s.minValue?(n.push(new W({objectType:"range",minValue:e,maxValue:i})),e=s.minValue,i=s.maxValue):i<s.maxValue&&(i=s.maxValue):(e=s.minValue,i=s.maxValue):n.push(s);return n.push(new W({objectType:"range",minValue:e,maxValue:i})),n}_filterIntersection(t,e){var s,a;if(t.length===0||e.length===0)return[];if(t[0].objectType==="any")return e;if(e[0].objectType==="any")return t;const i=t[0].objectType==="range"||((s=t[1])==null?void 0:s.objectType)==="range",n=e[0].objectType==="range"||((a=e[1])==null?void 0:a.objectType)==="range";return i||n?this._intersectRanges(t,e):this._intersectValues(t,e)}_intersectRanges(t,e){const i=[];let n,s=0;for(const a of t)for(;s<e.length;s++){const o=e[s];if(a.objectType==="null"&&o.objectType==="null")i.push(new W({objectType:"null"}));else{if(a.objectType==="null")break;if(o.objectType==="null")continue}if(a.maxValue<o.minValue)break;if(a.maxValue===o.minValue){i.push(new W({objectType:"range",minValue:a.maxValue,maxValue:o.minValue}));break}if(!(a.minValue>o.maxValue))if(a.minValue!==o.maxValue){if(n=a.minValue>o.minValue?a.minValue:o.minValue,a.maxValue<o.maxValue){i.push(new W({objectType:"range",minValue:n,maxValue:a.maxValue}));break}i.push(new W({objectType:"range",minValue:n,maxValue:o.maxValue}))}else i.push(new W({objectType:"range",minValue:a.minValue,maxValue:o.maxValue}))}return i}_intersectValues(t,e){const i=[];for(const n of t)e.some(s=>{if(n.objectType===s.objectType)switch(n.objectType){case"any":case"null":return!0;case"code":return n.codedValue.code===s.codedValue.code&&n.codedValue.name===s.codedValue.name}return!1})&&i.push(n);return i}static async _staticFetchEnterpriseFeatureRoot(t,e){return Ae(t,{responseType:"json",query:{f:"json"},...e}).then(i=>i.data)}static async _staticFetchEnterpriseFieldGroup(t,e,i){return Ae(`${t}/queryDataElements`,{responseType:"json",query:{layers:JSON.stringify([e]),f:"json"},...i}).then(n=>{var s;return(s=n.data.layerDataElements)==null?void 0:s[0].dataElement.fieldGroups})}async _initializeContingentValues(t,e){const i=t||await this._fetchFieldGroupDefs(e);if(i.length===0)return void(this.fieldGroups=[]);const n=await this._fetchContingentValues(i,e);this.fieldGroups=n}async _fetchFieldGroupDefs(t){if(this.layer.layerId===void 0)return[];const e=this.layer.sourceJSON,i=this.layer.layerId.toString(),n=oe(wt(this.layer.url)).url.path;return e.hasContingentValuesDefinition?(await this._fetchAGOLFieldGroup(n,i,t)).map(s=>({name:s.name,isEditingRestrictive:s.restrictive,fields:s.fields.map(a=>this.layer.fieldsIndex.normalizeFieldName(a))})):e.hasContingentValuesDefinition!==void 0?[]:this._fetchEnterpriseFeatureRoot(n,t).then(async s=>s.supportsQueryDataElements?(await this._fetchEnterpriseFieldGroup(n,i,t)).map(a=>({name:a.name,isEditingRestrictive:a.isEditingRestrictive,fields:a.fieldNames.names.map(o=>this.layer.fieldsIndex.normalizeFieldName(o))})):[])}async _fetchAGOLFieldGroup(t,e,i){return Ae(`${t}/${e}/fieldgroups`,{responseType:"json",query:{f:"json"},...i}).then(n=>n.data.fieldGroups)}async _fetchEnterpriseFieldGroup(t,e,i){return Ee._staticFetchEnterpriseFieldGroup(t,e,i)}async _fetchEnterpriseFeatureRoot(t,e){return Ee._staticFetchEnterpriseFeatureRoot(t,e)}async _fetchContingentValues(t,e){if(this.layer.layerId===void 0)return[];const i=this.layer.sourceJSON,n=this.layer.layerId.toString(),s=oe(wt(this.layer.url)).url.path;if(i.hasContingentValuesDefinition){const o=await this._fetchAGOLContingentValues(s,n,e);return this._constructFieldGroupsAGOL(t,o)}const a=await this._fetchEnterpriseContingentValues(s,n,e);return this._constructFieldGroupsEnterprise(t,a)}_constructFieldGroupsAGOL(t,e){return t.map(i=>{const n=e.contingentValuesDefinition.fieldGroups.find(s=>s.name===i.name);if(n){let s=[];return s=e.contingentValuesDefinition.hasSubType?this._parseAGOLFieldGroupSubtype(i,e,n.subTypes):this._parseAGOLFieldGroup(i,e,n.contingentValues),new Ht({name:i.name,isEditingRestrictive:i.isEditingRestrictive,fields:i.fields,contingencies:s})}return null}).filter(f)}_parseAGOLFieldGroupSubtype(t,e,i){let n=[];return i==null||i.forEach(s=>{const a=this._getSubtypeAGOL(s.name);n=n.concat(this._parseAGOLFieldGroup(t,e,s.contingentValues,a))}),n}_parseAGOLFieldGroup(t,e,i,n=null){const s=[];for(const a of i??[]){const o=this._parseAGOLContingency(a,t,e,n);s.push(o)}return s}_parseAGOLContingency(t,e,i,n){var u;const s=t.id,a=!!t.retired&&t.retired===1,o={};for(let r=0,l=0;r<e.fields.length;r++){const c=e.fields[r],p=i.typeCodes[t.types[r]];if(p==="Code"){let h=t.values[l];l++;const v=this._getDomain(n,c);if(((u=this.layer.getField(c))==null?void 0:u.type)==="string"){const x=i.stringDicts.find(F=>F.domain===v.name);x&&(h=x.entries[h])}const _=v.codedValues.find(x=>x.code===h),y=new W({codedValue:_,objectType:"code"});o[c]=y}else if(p==="Range"){const h=t.values[l];l++;const v=h.range[0],_=h.range[1],y=new W({minValue:v,maxValue:_,objectType:"range"});o[c]=y}else if(p==="Any"){const h=new W({objectType:"any"});o[c]=h}else{const h=new W({objectType:"null"});o[c]=h}}return new vi({id:s,isRetired:a,subtype:n,values:o})}_constructFieldGroupsEnterprise(t,e){const i=e.fieldGroups;return t.map(n=>{const s=i.find(a=>a.name===n.name);if(s){const a=s.contingencies.map(o=>{const u=o.id,r=o.isRetired||!1,l=this._getSubtypeEnterprise(o.subtypeCode),c={};for(let p=0;p<n.fields.length;p++){const h=n.fields[p];let v=o.values[p];if(typeof v=="number"||typeof v=="string"){const _=this._getDomain(l,h),y=this.layer.getField(h);(y==null?void 0:y.type)==="string"?v=e.stringDictionary[v]:(y==null?void 0:y.type)==="date"&&(v=new Date(`${v}+00:00`).getTime());const x=_.codedValues.find(E=>E.code===v),F=new W({codedValue:x,objectType:"code"});c[h]=F}else if(typeof v=="object"){const _=v.minValue,y=v.maxValue,x=new W({minValue:_,maxValue:y,objectType:"range"});c[h]=x}else if(v){const _=new W({objectType:"any"});c[h]=_}else{const _=new W({objectType:"null"});c[h]=_}}return new vi({id:u,isRetired:r,subtype:l,values:c})});return new Ht({name:n.name,isEditingRestrictive:n.isEditingRestrictive,fields:n.fields,contingencies:a})}return null}).filter(f)}async _fetchEnterpriseContingentValues(t,e,i){return Ae(`${t}/queryContingentValues`,{responseType:"json",query:{layers:JSON.stringify([e]),f:"json"},...i}).then(n=>{var s;return(s=n.data.contingentValueSets)==null?void 0:s[0]})}async _fetchAGOLContingentValues(t,e,i){return Ae(`${t}/${e}/contingentValues`,{responseType:"json",query:{f:"json"},...i}).then(n=>n.data)}_getSubtypeEnterprise(t){const e=this.layer.sourceJSON;let i;if(e.subtypes){const n=e.subtypes.find(s=>s.code===t);i=ri.fromJSON(n)}return i||null}_getSubtypeAGOL(t){const e=this.layer.sourceJSON;let i;if(e.subtypes){const n=e.subtypes.find(s=>s.name===t);i=ri.fromJSON(n)}return i||null}_getDomain(t,e){var n;const i=t?(n=t.domains)==null?void 0:n[e]:this.layer.getFieldDomain(e);return(i==null?void 0:i.type)==="inherited"?this.layer.getFieldDomain(e):i}};d([m({constructOnly:!0})],we.prototype,"layer",void 0),d([m({constructOnly:!0})],we.prototype,"request",void 0),d([m({type:[Ht]})],we.prototype,"fieldGroups",void 0),d([m({constructOnly:!0})],we.prototype,"fieldGroupDefinitions",void 0),d([m()],we.prototype,"subtypeFieldName",null),we=Ee=d([J("esri.layers.support.LayerContingentValuesCache")],we);const Ys=we;let qe=null;function Xs(t,e,i,n={}){const s=e.elementType,a="value",o=s.type==="array"?[{name:a,type:s.type,elementType:s.elementType}]:s.type==="dictionary"?[{name:a,type:s.type,properties:s.properties}]:[{name:a,type:s.type}];return new ps(t.map(u=>{const r={};return Qt(r,o,{[a]:u},i,n),r[a]}))}function Zs(t,e,i={}){const n=t instanceof jn?new ji({source:t.features,geometryType:t.geometryType,fields:t.fields,spatialReference:t.spatialReference}):t;return e.constructFeatureSet(n,i.spatialReference,null,!0,i.lruCache,i.interceptor)}function ea(t,e,i={}){const{spatialReference:n,interceptor:s,lruCache:a}=i;return typeof t=="string"?e.createFeatureSetCollectionFromService(t,n,a,s):e.createFeatureSetCollectionFromMap(t,n,a,s)}function ta(t,e,i,n={}){const s={};return Qt(s,e.properties,t,i,n),new qe.Dictionary(s)}function Qt(t,e,i,n,s={}){var o,u;const a={};for(const r of Object.keys(i))a[r.toLowerCase()]=i[r];for(const r of e){const l=r.name.toLowerCase();if(s.variablesPreProcessed)t[l]=a[l];else switch(r.type){case"array":{const c=a[l];t[l]=Xs(c,r,n,s);break}case"feature":{const c=a[l];t[l]=c==null?null:qe.Feature.createFromGraphic(c,s==null?void 0:s.timeReference);break}case"featureSet":{const c=a[l];t[l]=n?Zs(c,n,s):null;break}case"featureSetCollection":{const c=a[l];t[l]=n?ea(c,n,s):null;break}case"dictionary":{const c=a[l];t[l]=ta(c,r,n,s);break}case"date":{const c=a[l];t[l]=c?c instanceof Tt?c:(o=s==null?void 0:s.timeReference)!=null&&o.timeZone?Tt.dateJSAndZoneToArcadeDate(c,(u=s==null?void 0:s.timeReference)==null?void 0:u.timeZone):Tt.dateJSToArcadeDate(c):null;break}case"geometry":case"boolean":case"text":case"number":t[l]=a[l]}}}function en(t,e){for(const i of t)e.push(i),i.type==="dictionary"&&en(i.properties,e);return e}function _i(t,e,i,n,s){const{spatialReference:a,interceptor:o,lruCache:u,console:r,abortSignal:l,timeReference:c,services:p={portal:Nn.getDefault()}}=i,h={vars:{},spatialReference:a,interceptor:o,timeReference:c,lrucache:u,useAsync:s,services:p,console:r,abortSignal:l};return e&&Qt(h.vars,t.variables,e,n,i),h}function at(t,e){switch(e.getArcadeType(t)){case"number":case"text":case"boolean":case"point":case"polygon":case"polyline":case"multipoint":case"extent":return t;case"date":return t.toJSDate();case"feature":{const i=(t.type,t),n="geometry"in i?i.geometry():null,s="readAttributes"in i?i.readAttributes():i.attributes;return new Wi({geometry:n,attributes:s})}case"dictionary":{const i=t,n=i.attributes,s={};for(const a of Object.keys(n))s[a]=at(i.field(a),e);return s}case"array":return("toArray"in t?t.toArray():t).map(i=>at(i,e))}return t}const bi={variables:[{name:"$feature",type:"feature"},{name:"$layer",type:"featureSet"},{name:"$datastore",type:"featureSetCollection"},{name:"$map",type:"featureSetCollection"}]},xi={variables:[{name:"$feature",type:"feature"},{name:"$aggregatedFeatures",type:"featureSet"}]},Ei=new Map([["form-constraint",{variables:[{name:"$feature",type:"feature"}]}],["feature-z",{variables:[{name:"$feature",type:"feature"}]}],["field-calculation",{variables:[{name:"$feature",type:"feature"},{name:"$datastore",type:"featureSetCollection"}]}],["form-calculation",{variables:[{name:"$feature",type:"feature"},{name:"$originalFeature",type:"feature"},{name:"$layer",type:"featureSet"},{name:"$featureSet",type:"featureSet"},{name:"$datastore",type:"featureSetCollection"},{name:"$map",type:"featureSetCollection"},{name:"$editContext",type:"dictionary",properties:[{name:"editType",type:"text"}]}]}],["labeling",{variables:[{name:"$feature",type:"feature"}]}],["popup",bi],["popup-element",bi],["feature-reduction-popup",xi],["feature-reduction-popup-element",xi],["visualization",{variables:[{name:"$feature",type:"feature"},{name:"$view",type:"dictionary",properties:[{name:"scale",type:"number"}]}]}]]);function ia(t){const e=Ei.get(t);if(!e){const i=Array.from(Ei.keys()).map(n=>`'${n}'`).join(", ");throw new nt("createArcadeProfile:invalid-profile-name",`Invalid profile name '${t}'. You must specify one of the following values: ${i}`)}return Rn(e)}async function na(t,e,i={}){qe||(qe=await On());const{arcade:n,arcadeUtils:s}=qe,{loadScriptDependencies:a,referencesMember:o,scriptIsAsync:u}=n,r=en(e.variables,[]),l=r.filter(g=>g.type==="featureSet"||g.type==="featureSetCollection").map(g=>g.name.toLowerCase()),c=n.parseScript(t,l);if(!c)throw new nt("arcade:invalid-script","Unable to create SyntaxTree");const p=s.extractFieldNames(c),h=n.scriptTouchesGeometry(c),v=r.map(g=>g.name.toLowerCase()).filter(g=>o(c,g)),_=u(c,l);await a(c,_,l);const y={vars:{},spatialReference:null,useAsync:_};for(const g of v)y.vars[g]="any";const{lruCache:x}=i,F=n.compileScript(c,y),E=n.featureSetUtils();return{execute:(g,T={})=>{if(_)throw new nt("arcade:invalid-execution-mode","Cannot execute the script in synchronous mode");const k=F(_i(e,g,{lruCache:x,...T},E,_));return T.rawOutput?k:at(k,s)},executeAsync:async(g,T={})=>{const k=await F(_i(e,g,{lruCache:x,...T},E,_));return T.rawOutput?k:at(k,s)},isAsync:_,variablesUsed:v,fieldsUsed:p,geometryUsed:h,syntaxTree:c}}var tn;const sa=Symbol("FormExpressionArcadeExecutor");let X=class extends me{constructor(e){super(e),this[tn]=!0,this._lastEvaluatedValue=null,this._abortController=new AbortController,this._stale=!1,this._updatingTracking=new Gn,this._executeAsyncDebounced=Bn(async(i,n,s)=>{const a=await this.executor.executeAsync(i,{...n,abortSignal:s});return s.aborted?this._lastEvaluatedValue:(this._lastEvaluatedValue=a,this._stale=!1,a)})}get isAsync(){return this.executor.isAsync}get fieldsUsed(){return this.executor.fieldsUsed}get syntaxTree(){return this.executor.syntaxTree}get updating(){return this._updatingTracking.updating}get stale(){return this._stale}get geometryUsed(){return this.executor.geometryUsed}get variablesUsed(){return this.executor.variablesUsed}get lastEvaluatedValue(){return this._lastEvaluatedValue}abort(){this._abortController.abort()}execute(e,i){this._abortController=new AbortController;const n=this.executor.execute(e,{...i,abortSignal:this._abortController.signal});return this._lastEvaluatedValue=n,n}async executeAsync(e,i){return this._abortController=new AbortController,this._updatingTracking.addPromise(this._executeAsyncDebounced(e,i??{},this._abortController.signal))}markStale(){this._stale=!0}reset(){this.abort(),this._lastEvaluatedValue=null,this._stale=!1}};tn=sa,d([m()],X.prototype,"_lastEvaluatedValue",void 0),d([m()],X.prototype,"_stale",void 0),d([m()],X.prototype,"_updatingTracking",void 0),d([m({constructOnly:!0})],X.prototype,"executor",void 0),d([m()],X.prototype,"isAsync",null),d([m()],X.prototype,"fieldsUsed",null),d([m()],X.prototype,"syntaxTree",null),d([m()],X.prototype,"updating",null),d([m()],X.prototype,"stale",null),d([m()],X.prototype,"geometryUsed",null),d([m()],X.prototype,"variablesUsed",null),d([m()],X.prototype,"lastEvaluatedValue",null),X=d([J("esri.widgets.FeatureForm.FormExpressionArcadeExecutor")],X);const aa=async(t,e)=>{const i=ia("form-calculation"),n=await na(t,i,{});return e!=null&&e.fieldsIndex&&(n.fieldsUsed=Un(e.fieldsIndex,n.fieldsUsed)),new X({executor:n})},$t="#JSAPI_FORM_EXPRESSIONS_MANAGER_GEOMETRY",oa="esri.widgets.FeatureForm.FormExpressionsManager";let Fe=class extends me{constructor(t){super(t),this._fieldReferencesLookup=new Map,this._fieldsAffectedLookup=new Map,this._latestFieldValues={...t.feature.attributes}}initialize(){this._dependencyGraph=this._buildDependencyGraph()}get _baseContext(){const{editType:t,layer:e,map:i,originalFeature:n,spatialReference:s}=this.arcadeContextInfo,a=(e==null?void 0:e.type)==="feature"?e:(e==null?void 0:e.type)==="scene"&&f(e.associatedLayer)?e.associatedLayer:void 0;return[{$originalfeature:n,$editcontext:{editType:t},$layer:a,$featureset:a,$datastore:e==null?void 0:e.url,$map:i},{spatialReference:s}]}set feature(t){this._latestFieldValues={...t==null?void 0:t.attributes},this._set("feature",t)}evaluateAll(){return this._evaluate(this.executors)}evaluateExpressions(t){return this._evaluate(t)}evaluateInvalidated(t){const{_fieldReferencesLookup:e,_latestFieldValues:i,feature:n}=this,s=new Set;for(const a of t)if(i[a]=n.getAttribute(a),e.has(a))for(const o of e.get(a))s.add(o);return this._evaluate([...s])}async evaluateInvalidatedByGeometry(){if(this._fieldReferencesLookup.has($t))return this._evaluate([...this._fieldReferencesLookup.get($t)])}resetExecutors(){for(const t of this.executors)t.reset()}_buildDependencyGraph(){const{_fieldReferencesLookup:t,_fieldsAffectedLookup:e,executors:i}=this,n=new Map(this.inputFields.map(a=>[a.name,a])),s=new Map(i.map(a=>[a,new Array]));for(const a of i){for(const o of a.fieldsUsed){Ze(t,o,()=>new Set).add(a);const u=n.get(o),{valueExpressionExecutor:r,editableExpressionExecutor:l}=u;f(r)&&r!==a&&(s.get(r).push(a),Ze(e,r,()=>new Set).add(u)),f(l)&&l!==a&&(s.get(l).push(a),Ze(e,l,()=>new Set).add(u))}a.geometryUsed&&Ze(t,$t,()=>new Set).add(a)}return s}async _evaluate(t){const e=new Map,{_dependencyGraph:i,_fieldsAffectedLookup:n,_latestFieldValues:s}=this;for(const o of t)nn(o,e,i);for(const[o,{resolver:u,dependencyPromises:r}]of e)Promise.all(r).then(async()=>{const[l,c]=this._makeContext(s);return o.executeAsync(l,c)}).then(()=>{if(n.has(o))for(const l of n.get(o))this._latestFieldValues[l.name]=l.value;u.resolve()},l=>{!l||Pt(l)||wi(l)||o.markStale(),u.reject(l)});const a=(await Promise.allSettled(Array.from(e.values(),({resolver:o})=>o.promise))).filter(o=>o.status==="rejected"&&!(Pt(o.reason)||wi(o.reason)));if(a.length>0)throw new AggregateError(a,"One or more expression executions failed")}_makeContext(t){const[e,i]=this._baseContext,n=this.feature.clone();return n.attributes=t,[{...e,$feature:n},i]}};d([m()],Fe.prototype,"_baseContext",null),d([m()],Fe.prototype,"feature",null),d([m()],Fe.prototype,"executors",void 0),d([m()],Fe.prototype,"inputFields",void 0),d([m()],Fe.prototype,"arcadeContextInfo",void 0),Fe=d([J(oa)],Fe);const nn=(t,e,i)=>{if(e.has(t))return;const n=Hn();e.set(t,{resolver:n,dependencyPromises:[]}),t.abort();const s=i.get(t);for(const a of s)nn(a,e,i),e.get(a).dependencyPromises.push(n.promise)},wi=t=>t&&typeof t=="object"&&"message"in t&&t.message==="Cancelled";var ge,ot;(function(t){t.Text="text",t.Number="number",t.Date="date",t.Unsupported="unsupported"})(ge||(ge={})),function(t){t.TOO_SHORT="length-validation-error::too-short"}(ot||(ot={}));const Fi={type:"number"},Ii={type:"number",intlOptions:{notation:"scientific"}},Ti={type:"date",intlOptions:{day:"2-digit",month:"2-digit",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}},ra="__internal-type-based-coded-value-domain__";function Vi(t){return t>=1e7||t<=-1e7}let $=class extends ut(me){constructor(t){super(t),this._storedValue=null,this.arcadeEditType="NA",this.editableExpressionExecutor=null,this.id=zn().toString(),this.requiredExpressionExecutor=null,this.valueExpressionExecutor=null,this.visibilityExpressionExecutor=null,this.feature=null,this.field=null,this.fieldElement=null,this.layer=null,this.error=null,this.group=null,this.messages=null}get _configAllowsEdits(){var n,s,a;const{fieldElement:t,layer:e,name:i}=this;return f(t)?t.editableExpression?this.evaluatedEditableExpression:t.editable!==!1:e.userHasUpdateItemPrivileges?!0:((a="popupTemplate"in e?(s=(n=e==null?void 0:e.popupTemplate)==null?void 0:n.fieldInfos)==null?void 0:s.find(({fieldName:o})=>o===i):null)==null?void 0:a.isEditable)??!0}get _layerFieldAllowsEdits(){const{field:t,layer:e}=this;if(!e||!t)return!1;const i=qn(e),n=i==null?void 0:i.operations.supportsEditing,s=t.editable,a=la(i,this.arcadeEditType);return!!(n&&s&&a)}get isUsingValueExpression(){return this._shouldUseValueExpression()}get evaluatedEditableExpression(){const{editableExpressionExecutor:t}=this;return f(t)?!!t.lastEvaluatedValue:null}get evaluatedRequiredExpression(){const{requiredExpressionExecutor:t}=this;return f(t)?!!t.lastEvaluatedValue:null}get evaluatedVisibilityExpression(){const{visibilityExpressionExecutor:t}=this;return f(t)?!!t.lastEvaluatedValue:null}get evaluatedValueExpression(){const{valueExpressionExecutor:t}=this;return f(t)?t.lastEvaluatedValue:null}set initialFeature(t){this._set("initialFeature",t),this.notifyChange("valid")}get description(){var t;return(t=oe(this.fieldElement))==null?void 0:t.description}get domain(){const{layer:t}=this,{typeFieldName:e,types:i}=Bt(t);if(e===this.name&&V(this.field.domain))return new Wn({name:ra,codedValues:i.map(({code:o,name:u})=>new Qn({code:o,name:u}))});const{feature:n}=this,s=t.getFieldDomain(this.name,{feature:n}),a=Kn(this.fieldElement,"domain");return f(a)&&this._isDomainCompatible(a)?a:s}get editable(){return!!this._layerFieldAllowsEdits&&(this.evaluatedEditableExpression??this._configAllowsEdits)}get inputType(){var t,e;return(e=(t=oe(this.fieldElement))==null?void 0:t.input)==null?void 0:e.type}get errorMessage(){return this._toErrorMessage()}get hint(){var t;return(t=oe(this.fieldElement))==null?void 0:t.hint}get includeTime(){var i;const{fieldElement:t}=this,e=f(t)&&((i=t.input)==null?void 0:i.type)==="datetime-picker"?t.input.includeTime:void 0;return e===void 0||e}get label(){return f(this.fieldElement)&&this.fieldElement.label||this.field.alias||this.field.name}get maxLength(){if(this.type===ge.Date)return-1;const{field:e,fieldElement:i}=this,n=e==null?void 0:e.length,s=Ci(i)?i.input.maxLength:NaN;return!isNaN(s)&&s>=-1&&(n===-1||s<=n)?s:n}get minLength(){if(this.type===ge.Date)return-1;const{field:e,fieldElement:i}=this,n=e==null?void 0:e.length,s=Ci(i)?i.input.minLength:NaN;return!isNaN(s)&&s>=-1&&(n===-1||s<=n)?s:-1}get name(){var t;return(t=this.field)==null?void 0:t.name}get required(){const{editable:t,evaluatedRequiredExpression:e,field:i,visible:n}=this;return!!t&&((i==null?void 0:i.nullable)===!1||!(!n||!f(e))&&e)}set required(t){this._overrideIfSome("required",t)}get submittable(){const{field:t,required:e,valid:i,value:n}=this;return(!e||!V(n))&&(!!i||this.initialFeature.getAttribute(t.name)===n)}get type(){const{field:t}=this;return Ft(t)?ge.Number:ii(t)?ge.Text:ni(t)?ge.Date:ge.Unsupported}get updating(){const{editableExpressionExecutor:t,valueExpressionExecutor:e}=this;return f(e)&&e.updating||f(t)&&t.updating}get valid(){const t=this.editable?this._validate():null;return this._set("error",t),t===null}get value(){if(this._shouldUseValueExpression()){const t=this.evaluatedValueExpression;if(this.type===ge.Date){if(t instanceof Date)return t.getTime();if(typeof t!="number")return parseInt(t,10)}return f(t)&&typeof t=="object"?t.toString():t}return this.get("_storedValue")}set value(t){this.notifyChange("evaluatedVisibilityExpression"),this.set("_storedValue",t)}get visible(){return!this._isEditorField()&&(f(this.evaluatedVisibilityExpression)?this.evaluatedVisibilityExpression:!!f(this.fieldElement)||this._isVisibleByDefault())}_isDomainCompatible(t){const{field:e}=this;if((t==null?void 0:t.type)==="coded-value"){const i=typeof t.codedValues[0].code;if(i==="string"&&ii(e)||i==="number"&&Ft(e))return!0}return!!((t==null?void 0:t.type)==="range"&&Ft(e)||ni(e))}_validate(){const{domain:t,field:e,initialFeature:i,minLength:n,required:s,type:a,valid:o,value:u}=this,r=s&&u===null,l=o!==void 0;return!r&&i.getAttribute(e.name)===u&&l?null:r?si.INVALID_TYPE:a==="text"&&n>-1&&typeof u=="string"&&u.length<n?ot.TOO_SHORT:t?u!==null||s?Jn(t,u):null:Yn(e,u)}_isVisibleByDefault(){var e,i;const t=(e=this.field)==null?void 0:e.type;return((i=this.field)==null?void 0:i.visible)&&t!=="oid"&&t!=="global-id"&&!this._isGeometryField()}_isEditorField(){return Xn(this.layer).includes(this.name)}_isGeometryField(){return Zn(this.layer).includes(this.name)}_shouldUseValueExpression(){return this._layerFieldAllowsEdits&&!this._configAllowsEdits&&f(this.valueExpressionExecutor)}_toErrorMessage(){const{domain:t,field:e,messages:i,minLength:n,value:s,required:a,type:o}=this,u=this.error;if(a&&s===null)return i.validationErrors.cannotBeNull;if(u===ai.VALUE_OUT_OF_RANGE||u===es.OUT_OF_RANGE){const r=Qi(t)||Ki(e);return Dt(i.validationErrors.outsideRange,r,{format:{max:o==="date"?Ti:Vi(r.max)?Ii:Fi,min:o==="date"?Ti:Vi(r.min)?Ii:Fi}})}return u===ai.INVALID_CODED_VALUE?i.validationErrors.invalidCodedValue:u===si.INVALID_TYPE?i.validationErrors.invalidType:u===ot.TOO_SHORT?Dt(i.validationErrors.tooShort,{min:n}):null}};d([m()],$.prototype,"_storedValue",void 0),d([m()],$.prototype,"_configAllowsEdits",null),d([m()],$.prototype,"_layerFieldAllowsEdits",null),d([m()],$.prototype,"arcadeEditType",void 0),d([m()],$.prototype,"editableExpressionExecutor",void 0),d([m()],$.prototype,"requiredExpressionExecutor",void 0),d([m()],$.prototype,"valueExpressionExecutor",void 0),d([m()],$.prototype,"isUsingValueExpression",null),d([m()],$.prototype,"visibilityExpressionExecutor",void 0),d([m()],$.prototype,"evaluatedEditableExpression",null),d([m()],$.prototype,"evaluatedRequiredExpression",null),d([m()],$.prototype,"evaluatedVisibilityExpression",null),d([m()],$.prototype,"evaluatedValueExpression",null),d([m()],$.prototype,"feature",void 0),d([m()],$.prototype,"field",void 0),d([m({constructOnly:!0})],$.prototype,"fieldElement",void 0),d([m()],$.prototype,"initialFeature",null),d([m()],$.prototype,"layer",void 0),d([m({readOnly:!0})],$.prototype,"description",null),d([m()],$.prototype,"domain",null),d([m()],$.prototype,"editable",null),d([m({readOnly:!0})],$.prototype,"inputType",null),d([m({readOnly:!0})],$.prototype,"error",void 0),d([m({dependsOn:["error","messages","value"]})],$.prototype,"errorMessage",null),d([m()],$.prototype,"group",void 0),d([m({readOnly:!0})],$.prototype,"hint",null),d([m()],$.prototype,"includeTime",null),d([m()],$.prototype,"label",null),d([m()],$.prototype,"maxLength",null),d([m()],$.prototype,"minLength",null),d([m()],$.prototype,"messages",void 0),d([m({readOnly:!0})],$.prototype,"name",null),d([m()],$.prototype,"required",null),d([m()],$.prototype,"submittable",null),d([m()],$.prototype,"type",null),d([m()],$.prototype,"updating",null),d([m()],$.prototype,"valid",null),d([m({value:null})],$.prototype,"value",null),d([m()],$.prototype,"visible",null),$=d([J("esri.widgets.FeatureForm.InputField")],$);const la=(t,e)=>{if(!t)return!0;const{operations:i}=t;switch(e){case"INSERT":return i.supportsAdd;case"UPDATE":case"DELETE":return i.supportsUpdate;default:return!0}},Ci=t=>f(t)&&(fe(t,"text-box")||fe(t,"text-area")),$i=$;let te=class extends ut(me){constructor(t){super(t),this._expressionTrackingHandles=new Map,this.visibilityExpressionExecutor=null,this.feature=null,this.groupElement=null}initialize(){this.addHandles([ae(()=>[this.visible,this.inputFields],([t])=>{const{inputFields:e}=this,i=!!t&&void 0;for(const n of e)n.required=i},{initial:!0,equals:(t,e)=>e[0]===t[0]&&e[1]===t[1]})])}destroy(){for(const t of this._expressionTrackingHandles.values())t.remove()}get visibilityExpression(){var t;return(t=oe(this.groupElement))==null?void 0:t.visibilityExpression}set visibilityExpression(t){Te(this.groupElement,e=>{e.visibilityExpression=t})}get evaluatedVisibilityExpression(){const{visibilityExpressionExecutor:t}=this;return f(t)?!!t.lastEvaluatedValue:null}get description(){var t;return(t=oe(this.groupElement))==null?void 0:t.description}set description(t){Te(this.groupElement,e=>{e.description=t})}get inputFields(){return this._get("inputFields")}set inputFields(t){this.handles.removeAll(),t&&this.handles.add(t.map(e=>ae(()=>e.visible,()=>this._dirtyEvaluatedVisibilityExpression()))),this._set("inputFields",t)}get label(){var t;return(t=oe(this.groupElement))==null?void 0:t.label}set label(t){Te(this.groupElement,e=>{e.label=t})}get state(){return f(this.groupElement)&&this.groupElement.initialState||"expanded"}set state(t){this._overrideIfSome("state",t)}get visible(){return this.evaluatedVisibilityExpression!==!1&&this.inputFields&&this.inputFields.some(t=>t.visible)}_dirtyEvaluatedVisibilityExpression(){const{groupElement:t}=this;f(t)&&t.visibilityExpression&&this.notifyChange("evaluatedVisibilityExpression")}};d([m()],te.prototype,"visibilityExpression",null),d([m()],te.prototype,"visibilityExpressionExecutor",void 0),d([m()],te.prototype,"evaluatedVisibilityExpression",null),d([m()],te.prototype,"description",null),d([m()],te.prototype,"feature",void 0),d([m()],te.prototype,"groupElement",void 0),d([m()],te.prototype,"initialFeature",void 0),d([m()],te.prototype,"inputFields",null),d([m()],te.prototype,"label",null),d([m()],te.prototype,"state",null),d([m()],te.prototype,"visible",null),te=d([J("esri.widgets.FeatureForm.InputFieldGroup")],te);const ua=te,kt=new Wi({attributes:{}}),da=["editableExpression","requiredExpression","valueExpression","visibilityExpression"],ca=["visibilityExpression"],pa="#JSAPI_CONTINGENT_VALUE_EMPTY_HASH",Le="#JSAPI_CONTINGENT_VALUE_ANY_HASH",ma="#JSAPI_CONTINGENT_VALUE_NULL_HASH";let R=class extends ut(ts(Bi.EventedAccessor)){constructor(t){super(t),this._expressionExecutorLookup=new Map,this._expressionLookup=new Map,this._expressionsManager=null,this._contingentValuesCache=null,this._featureClone=kt.clone(),this._initialFeature=kt.clone(),this.arcadeEditType="NA",this.contingencyConstraintViolations=new Map,this.inputFields=[],this.messages=null,this.strict=!1,this._isSupportedElement=this._isSupportedElement.bind(this)}initialize(){const t=async()=>{const s=await as("esri/widgets/FeatureForm/t9n/FeatureForm");this.messages=s;for(const a of this.allInputFields)a.messages=s};t();const e=ae(()=>{var s;return[this.layer,(s=this.layer)==null?void 0:s.loaded,this.formTemplate]},([s,a])=>{f(s)&&(a?this._updateInputFields():s.load().catch(()=>He.getLogger(this.declaredClass).error("Failed to load layer",s.loadError)))},{equals:([s,a,o],[u,r,l])=>s===u&&a===r&&o===l,initial:!0}),i=ae(()=>this._arcadeContextInfo,s=>{f(this._expressionsManager)&&(this._expressionsManager.arcadeContextInfo=s)}),n=ae(()=>this.layer,s=>{const a=(s==null?void 0:s.type)==="subtype-sublayer"?s.parent:(s==null?void 0:s.type)==="feature"?s:null;a&&this.addResolvingPromise(Ys.createLoadedLayerContingentValuesCache(a).then(o=>{this._contingentValuesCache=o,this.notifyChange("fieldsWithContingentValues")}))},{initial:!0});this.handles.add([is(t),e,i,n])}destroy(){this.feature=null,this.layer=null,this._contingentValuesCache=ns(this._contingentValuesCache)}get _arcadeContextInfo(){const{_initialFeature:t,arcadeEditType:e,layer:i,spatialReference:n,view:s}=this;return{layer:ss(i)?i:null,originalFeature:t,editType:e,spatialReference:n,map:s==null?void 0:s.map}}get updating(){return this.updatingHandles.updating}get allInputFields(){return ki(this.inputFields)}get _layerFieldsByName(){return new Map(this.layer.fields.map(t=>[t.name,t]))}get feature(){return this._get("feature")}set feature(t){this._featureClone=t?t.clone():kt.clone(),this._initialFeature=this._featureClone.clone(),this._resetInputFieldValues(this._featureClone),this.contingencyConstraintViolations.clear(),f(this._expressionsManager)&&(this._expressionsManager.resetExecutors(),this._expressionsManager.feature=this._featureClone,this.updatingHandles.addPromise(this._expressionsManager.evaluateAll().finally(()=>this._afterExpressionsEvaluated()))),this._set("feature",t)}get fieldsWithContingentValues(){if(V(this._contingentValuesCache))return new Set;const t=this._contingentValuesCache.fieldGroups.flatMap(e=>e.fields);return new Set(t)}get formTemplate(){return this.layer&&"formTemplate"in this.layer?this.layer.formTemplate:null}set formTemplate(t){t===void 0?this._clearOverride("formTemplate"):this._override("formTemplate",t)}get formDescription(){const{formTemplate:t,layer:e}=this;return!V(t)&&t.description&&e?gi(t.description,this.getValues(),e.fieldsIndex):null}get formTitle(){const{formTemplate:t,layer:e}=this;return!V(t)&&t.title&&e?gi(t.title,this.getValues(),e.fieldsIndex):null}get joinedContingentValues(){return this._joinContingentValues()}get layer(){var t;return(t=this.feature)!=null&&t.sourceLayer&&"applyEdits"in this.feature.sourceLayer?this.feature.sourceLayer:null}set layer(t){this._override("layer",t)}get spatialReference(){var t;return((t=this.layer)==null?void 0:t.spatialReference)??null}set spatialReference(t){this._override("spatialReference",t)}get state(){return this.messages&&this.get("layer.loaded")?"ready":"disabled"}get submittable(){return!!this.valid||this.allInputFields.filter(t=>!t.valid).every(({submittable:t})=>t)}get valid(){const t=this.allInputFields;return t.length>0&&t.every(({valid:e})=>e)}findField(t){return this.allInputFields.find(e=>e.name===t)}getValue(t){const{_featureClone:e,layer:i}=this,n=!!(i!=null&&i.getField(t));return e.getAttribute(t)??(n?null:void 0)}setValue(t,e){const{_featureClone:i,strict:n}=this,s=this.findField(t);e=e===""?null:e,s&&i.getAttribute(t)!==e&&(s.value=e,n&&!s.valid||(this._afterValueChange(s),f(this._expressionsManager)&&this.updatingHandles.addPromise(this._expressionsManager.evaluateInvalidated([s.name]).finally(()=>this._afterExpressionsEvaluated()))))}getValues(){return{...this._featureClone.attributes}}submit(){const t=this.allInputFields,e=new Set(t.filter(s=>s.valid).map(({name:s})=>s)),i=t.filter(s=>!s.valid).map(({name:s})=>s),n=this.getValues();if(this.validateContingencyConstraints(n,{includeIncompleteViolations:!0}).length>0)for(const[s,a]of this.contingencyConstraintViolations.entries())a.type==="error"&&(e.delete(s),i.push(s));this.emit("submit",{valid:[...e],invalid:i,values:n})}validateContingencyConstraints(t,e){const{_contingentValuesCache:i}=this,n=new Map;if(this.contingencyConstraintViolations=n,V(i))return[];const{invalid:s,incomplete:a}=i.validateContingencyConstraints(t),o=[...s,...e!=null&&e.includeIncompleteViolations?a:[]];for(const u of o)for(const r of u.fieldGroup.fields)n.set(r,u);return o}notifyFeatureGeometryChanged(){const{_expressionsManager:t,feature:e,_featureClone:i}=this;i.geometry=e.geometry,f(t)&&this.updatingHandles.addPromise(t.evaluateInvalidatedByGeometry().finally(()=>this._afterExpressionsEvaluated()))}_emitChangeEvent({name:t,valid:e,value:i}){this.emit("value-change",{layer:this.layer,feature:this.feature,fieldName:t,value:i,valid:e})}_updateInputFields(){const{_featureClone:t,_initialFeature:e,arcadeEditType:i,formTemplate:n,inputFields:s,messages:a,layer:o}=this,u={arcadeEditType:i,feature:t,initialFeature:e,layer:o,messages:a},r=s.slice(),l=f(n)&&n.elements.length>0?this._updateInputFieldsFromElements(r,n.elements,u):this._updateInputFieldsFromLayerFields(r,o==null?void 0:o.fields,u);this.inputFields=l}_updateInputFieldsFromElements(t,e,i){const n=new Map;for(const o of t)if(Ie(o)){At(n,o.groupElement,o);for(const u of o.inputFields)At(n,u.fieldElement,u)}else At(n,o.fieldElement,o);const s=new Map,a=this._updateInputFieldsRecursive({existingInputFieldsByElement:n,updatedElements:e.filter(this._isSupportedElement),sharedInitializationProperties:i,group:null,newExpressionExecutorPromises:s});this.updatingHandles.addPromise(Promise.all(Array.from(s.values())).then(()=>{const o=Array.from(this._expressionExecutorLookup.values()),u=ki(a);return this._createExpressionsManager(o,u),oe(this._expressionsManager).evaluateAll().finally(()=>this._afterExpressionsEvaluated())}));for(const[o,u]of n.entries())n.delete(o),u.destroy();return a}_updateInputFieldsRecursive(t){const{existingInputFieldsByElement:e,updatedElements:i,sharedInitializationProperties:n,group:s,newExpressionExecutorPromises:a}=t,o=[];for(const u of i){const r=e.has(u),l=r?e.get(u):St(u)?this._makeInputFieldGroupFromGroupElement(u,n):this._makeInputFieldFromFieldElement(u,n,s);if(o.push(l),r)if(e.delete(u),Ie(l)){const{feature:c}=n;l.set({feature:c})}else l.set(n);else this._assignExpressionExecutors(l,u,a);if(St(u)){const c=u.elements.filter(p=>this._isSupportedElement(p));l.inputFields=this._updateInputFieldsRecursive({existingInputFieldsByElement:e,updatedElements:c,sharedInitializationProperties:n,group:l,newExpressionExecutorPromises:a})}}return o}_updateInputFieldsFromLayerFields(t,e,i){if(!Array.isArray(e))return He.getLogger(this.declaredClass).warn(this.declaredClass,"No attribute fields found."),[];const n=new Map;for(const c of t)if(Ie(c)){for(const p of c.inputFields)p.destroy();c.inputFields.length=0,c.destroy()}else f(c.fieldElement)?c.destroy():n.set(c.field,c);const s=[],{arcadeEditType:a,feature:o,initialFeature:u,layer:r,messages:l}=i;for(const c of e){const p=n.get(c)??new $i({arcadeEditType:a,field:c,feature:o,initialFeature:u,layer:r,messages:l,value:o.getAttribute(c.name)??null});s.push(p),n.delete(c)}for(const[c,p]of n.entries())n.delete(c),p.destroy();return s}_resetInputFieldValues(t){for(const e of this.allInputFields)e.value=t.getAttribute(e.name)}_makeInputFieldFromFieldElement(t,e,i=null){const{arcadeEditType:n,feature:s,initialFeature:a,layer:o,messages:u}=e;return new $i({arcadeEditType:n,fieldElement:t,field:this._layerFieldsByName.get(t.fieldName),value:s.getAttribute(t.fieldName)??null,feature:s,initialFeature:a,layer:o,group:i,messages:u})}_makeInputFieldGroupFromGroupElement(t,e){const{feature:i,initialFeature:n}=e;return new ua({groupElement:t,inputFields:[],feature:i,initialFeature:n})}_assignExpressionExecutors(t,e,i){const n=St(e)?ca:da,s=[];for(const a of n){const o=e[a],{_expressionExecutorLookup:u}=this;if(f(o)&&o!==""){const r=`${a}Executor`,l=this._expressionLookup.get(o)??this._addToExpressionLookup(o);if(u.has(l))t[r]=u.get(l);else if(i.has(l)){const c=i.get(l).then(p=>(t[r]=p,p));i.set(l,c)}else{const c=aa(l,this.layer).then(p=>(t[r]=p,u.set(l,p),p));i.set(l,c)}}}return s}_createExpressionsManager(t,e){const{_arcadeContextInfo:i,_featureClone:n}=this;this._expressionsManager=new Fe({executors:t,feature:n,arcadeContextInfo:i,inputFields:e})}_afterValueChange(t){var l;const{name:e,value:i}=t,{_featureClone:n,formTemplate:s,layer:a}=this;if(!a)return;const o=n.getAttribute(e);n.setAttribute(e,i);const{typeFieldName:u,types:r}=Bt(a);if(e===u&&i!==o){if(a.type==="subtype-sublayer"){const p=(l=a.parent)==null?void 0:l.findSublayerForFeature(n);n.sourceLayer=this.feature.sourceLayer=p}const c=new Set;for(const p of r)if(p.domains&&typeof p.domains=="object")for(const h of Object.keys(p.domains))c.add(h);for(const p of c){const h=this.findField(p);h&&h.notifyChange("domain")}}if(f(s)){const{description:c,title:p}=s;p&&Nt(p,e)&&this.notifyChange("formTitle"),c&&Nt(c,e)&&this.notifyChange("formDescription")}this._emitChangeEvent(t)}_afterExpressionsEvaluated(){const{_featureClone:t}=this;for(const e of this.allInputFields)e.value!==t.getAttribute(e.name)&&this._afterValueChange(e)}_addToExpressionLookup(t){var s;const{_expressionLookup:e,formTemplate:i}=this,n=((s=f(i)&&f(i.expressionInfos)?Object.values(i.expressionInfos).find(a=>a.name===t):null)==null?void 0:s.expression)??t;return e.set(t,n),t!==n&&e.set(n,n),n}_isSupportedElement(t){return t.type==="field"||t.type==="group"||(He.getLogger(this.declaredClass).warn("form-info::unsupported-element-type","Only element types 'field' and 'group' are supported",`Element ${t.label} has unsupported type '${t.type}'`),!1)}_joinContingentValues(){const t=this._contingentValuesCache;if(V(t))return[];const{typeFieldName:e}=Bt(this.layer),i=e?this.getValue(e):null,n=[];for(const o of t.fieldGroups){const{contingencies:u,fields:r,name:l}=o,c=[];for(const p of u)p.isRetired||f(p.subtype)&&p.subtype.code!==i||c.push({values:p.values});c.length>0&&n.push({name:l,fields:r,contingencies:c})}const[s,a]=this._generateJoinPlan(n);return[...s.flatMap(o=>this._joinFieldGroupContingencies(o)),...a.flatMap(o=>o.contingencies)]}_generateJoinPlan(t){const e=new Map,i=[],n=new Set;for(const r of t)for(const l of r.fields)if(e.has(l)){const c=e.get(l),p=r,h=[c.name,p.name].sort().join("|");if(n.has(h))continue;i.push([c,p]),n.add(h),e.set(l,p)}else e.set(l,r);const s=new Set(i.flat()),a=new Set(t);for(const r of s)a.delete(r);const o=new Map,u=new Map;for(const r of new Set(i.flat())){const l=Symbol(r.name);o.set(l,new Set([r])),u.set(r,l)}for(const[r,l]of i){const c=u.get(r),p=u.get(l);if(c===p)continue;const h=o.get(c),v=o.get(p);for(const _ of v)h.add(_),u.set(_,c);o.delete(p)}return[[...o.values()].map(r=>[...r]),[...a]]}_joinFieldGroupContingencies(t){const e=t.slice(),i=e.shift();let n=e.shift(),s=this._generateJoinKey(i.fields,n.fields),a=new Set([...i.fields,...n.fields]),o=new Map;for(const r of i.contingencies){const[l]=this._hashContingency(r,s.codedValueFields,!0);o.has(l)?o.get(l).push(r):o.set(l,[r])}for(;e.length>0;){const r=new Map,l=e.shift(),c=this._generateJoinKey(a,l.fields);for(const p of n.contingencies){const[h,v]=this._hashContingency(p,s.codedValueFields),_=v?this._findMatchingContingenciesWithAnyHashMask(o,h):o.get(h);if(o.has(Le)&&_.push(...this._findMatchingContingenciesContainingAny(p,o.get(Le),s.codedValueFields)),!V(_))for(const y of _){const x=s.rangeFields.length>0?this._joinContingenciesWithRangeDomains(y,p,s.rangeFields):this._joinContingencies(y,p);if(V(x))break;const[F]=this._hashContingency(x,c.codedValueFields,!0);r.has(F)?r.get(F).push(x):r.set(F,[x])}}o=r,n=l,s=c,a=new Set([...a,...n.fields])}const u=[];for(const r of n.contingencies){const[l,c]=this._hashContingency(r,s.codedValueFields),p=c?this._findMatchingContingenciesWithAnyHashMask(o,l):o.get(l);if(o.has(Le)&&p.push(...this._findMatchingContingenciesContainingAny(r,o.get(Le),s.codedValueFields)),!V(p))for(const h of p){const v=s.rangeFields.length>0?this._joinContingenciesWithRangeDomains(h,r,s.rangeFields):this._joinContingencies(h,r);f(v)&&u.push(v)}}return u}_joinContingencies(t,e){const i={values:{...t.values,...e.values}};for(const[n,s]of Object.entries(i.values))s.objectType==="any"&&f(t.values[n])&&(i.values[n]=t.values[n]);return i}_joinContingenciesWithRangeDomains(t,e,i){const n=this._joinContingencies(t,e);for(const s of i){const a=t.values[s],o=e.values[s],{leftIsNull:u,rightIsNull:r,bothAreNull:l,leftIsAny:c,rightIsAny:p,bothAreAny:h,leftIsRange:v,rightIsRange:_}=this._compareObjectTypes(a.objectType,o.objectType);if(l||h)continue;if(u&&p||r&&c){n.values[s]=new W({objectType:"null"});continue}if(u&&_||r&&v)return null;c?(a.minValue=-1/0,a.maxValue=1/0):p&&(o.minValue=-1/0,o.maxValue=1/0);const y=Math.max(a.minValue,o.minValue),x=Math.min(a.maxValue,o.maxValue);if(y>x)return null;n.values[s]=new W({objectType:"range",minValue:y,maxValue:x})}return n}_findMatchingContingenciesContainingAny(t,e,i){return e.filter(n=>i.every(s=>{var u,r;const a=n.values[s],o=t.values[s];return a.objectType==="any"||o.objectType==="any"||((u=a.codedValue)==null?void 0:u.code)===((r=o.codedValue)==null?void 0:r.code)}))}_findMatchingContingenciesWithAnyHashMask(t,e){const i=RegExp(`${e}$`),n=[];for(const[s,a]of t){if(s===Le)break;i.test(s)&&n.push(...a)}return n}_generateJoinKey(t,e){const i=Array.isArray(t)?new Set(t):t,n=Array.isArray(e)?new Set(e):e,s=i.size<n.size?i:n,a=s===i?n:i,o=new Set,u=new Set;for(const r of s)if(a.has(r)){const l=this.layer.getFieldDomain(r,{feature:this.feature});if(V(l))continue;switch(l.type){case"coded-value":o.add(r);break;case"range":u.add(r)}}return{codedValueFields:[...o],rangeFields:[...u]}}_hashContingency(t,e,i=!1){var a;if(e.length<1)return[pa,!1];const n=[];let s=!1;for(const o of e){const u=t.values[o];if(u.objectType==="any"){if(i)return[Le,!0];s=!0,n.push(`${o}:.*`)}else u.objectType==="null"?n.push(`${o}:${ma}`):n.push(`${o}:${(a=u.codedValue)==null?void 0:a.code}`)}return[n.sort().join("&"),s]}_compareObjectTypes(t,e){return{leftIsNull:t==="null",rightIsNull:e==="null",bothAreNull:t==="null"&&e==="null",leftIsAny:t==="any",rightIsAny:e==="any",bothAreAny:t==="any"&&e==="any",leftIsRange:t==="range",rightIsRange:e==="range"}}};d([m()],R.prototype,"_featureClone",void 0),d([m()],R.prototype,"_arcadeContextInfo",null),d([m()],R.prototype,"updating",null),d([m({readOnly:!0})],R.prototype,"allInputFields",null),d([m()],R.prototype,"_layerFieldsByName",null),d([m()],R.prototype,"arcadeEditType",void 0),d([m()],R.prototype,"contingencyConstraintViolations",void 0),d([m()],R.prototype,"feature",null),d([m()],R.prototype,"fieldsWithContingentValues",null),d([m({type:Ji})],R.prototype,"formTemplate",null),d([m()],R.prototype,"formDescription",null),d([m()],R.prototype,"formTitle",null),d([m()],R.prototype,"inputFields",void 0),d([m()],R.prototype,"joinedContingentValues",null),d([m()],R.prototype,"layer",null),d([m()],R.prototype,"messages",void 0),d([m()],R.prototype,"spatialReference",null),d([m()],R.prototype,"state",null),d([m()],R.prototype,"strict",void 0),d([m()],R.prototype,"submittable",null),d([m()],R.prototype,"valid",null),d([m()],R.prototype,"view",void 0),d([m()],R.prototype,"getValues",null),d([m()],R.prototype,"submit",null),R=d([J("esri.widgets.FeatureForm.FeatureFormViewModel")],R);const St=t=>t.type==="group",ki=t=>t.reduce((e,i)=>Ie(i)?[...e,...i.inputFields]:[...e,i],[]),At=(t,e,i)=>{f(e)&&t.set(e,i)},ha=R,Si="TT",Ne="data-field-name",Ai="latn",Mt=t=>"valueAsDate"in t;let K=class extends Wt{constructor(t,e){super(t,e),this._dateInputFieldMap=new Map,this._activeInputName="",this._activeNumberFieldEdit=null,this._fieldFocusNeeded=!1,this._fieldToInitialIncompatibleDomainValue=new Map,this._switchFieldsWithInitialIncompatibleValue=new Set,this._userUpdatedInputFieldNames=new Set,this.disabled=!1,this.groupDisplay="all",this.headingLevel=2,this.messages=null,this.messagesTemplates=null,this.viewModel=new ha,this._handleInputInput=i=>{this._commitInputValue(i.currentTarget)},this._handleFormKeyDown=this._handleFormKeyDown.bind(this),this._handleInputBlur=this._handleInputBlur.bind(this),this._handleInputFocus=this._handleInputFocus.bind(this),this._handleNumberInputMouseDown=this._handleNumberInputMouseDown.bind(this),this._handleInputKeyDown=this._handleInputKeyDown.bind(this),this._handleOptionChange=this._handleOptionChange.bind(this),this._handleGroupClick=this._handleGroupClick.bind(this),this._handleSubmit=this._handleSubmit.bind(this),this._afterInputCreateOrUpdate=this._afterInputCreateOrUpdate.bind(this),this._afterDateInputCreateOrUpdate=this._afterDateInputCreateOrUpdate.bind(this)}initialize(){this.addHandles([ae(()=>this.feature,()=>{const t=this._getFocusableInput("forward");this._activeInputName=(t==null?void 0:t.name)||"",this._userUpdatedInputFieldNames.clear(),this._fieldToInitialIncompatibleDomainValue.clear(),this._switchFieldsWithInitialIncompatibleValue.clear(),this._dateInputFieldMap.clear(),this._fieldFocusNeeded=!0}),this.on("submit",t=>{if(t.invalid.length>0){const[e]=t.invalid;t.invalid.forEach(i=>this._userUpdatedInputFieldNames.add(i)),this._activeInputName=e,this._fieldFocusNeeded=!0,this.scheduleRender()}})])}loadDependencies(){return Promise.all([ue(()=>import("./calcite-combobox-b420917a.js"),["assets/calcite-combobox-b420917a.js","assets/MapView-d4248bee.js","assets/index-9ba3f23e.js","assets/index-fecf00a2.css","assets/filter2-f9cbea7a.js","assets/debounce-31e0cfcc.js","assets/openCloseComponent-01e91706.js","assets/label2-d8fd57da.js","assets/guid-9426053f.js","assets/interactive-573cbe88.js","assets/loadable-25ad9e4e.js","assets/t9n-887c4f0a.js","assets/key-4e6b67a3.js","assets/observers-4f67f1fb.js","assets/utils2-15d3317d.js","assets/conditionalSlot-681a6110.js","assets/icon-04547cc0.js"]),ue(()=>import("./calcite-combobox-item-3ab0a33a.js"),["assets/calcite-combobox-item-3ab0a33a.js","assets/MapView-d4248bee.js","assets/index-9ba3f23e.js","assets/index-fecf00a2.css","assets/conditionalSlot-681a6110.js","assets/observers-4f67f1fb.js","assets/guid-9426053f.js","assets/interactive-573cbe88.js","assets/utils2-15d3317d.js","assets/icon-04547cc0.js"]),ue(()=>import("./calcite-combobox-item-group-5e2f193e.js"),["assets/calcite-combobox-item-group-5e2f193e.js","assets/MapView-d4248bee.js","assets/index-9ba3f23e.js","assets/index-fecf00a2.css","assets/guid-9426053f.js","assets/utils2-15d3317d.js"]),ue(()=>import("./calcite-input-message-a75fc281.js"),["assets/calcite-input-message-a75fc281.js","assets/MapView-d4248bee.js","assets/index-9ba3f23e.js","assets/index-fecf00a2.css","assets/icon-04547cc0.js","assets/observers-4f67f1fb.js"]),ue(()=>import("./calcite-progress-2d8cd22d.js"),["assets/calcite-progress-2d8cd22d.js","assets/progress-e872170e.js","assets/MapView-d4248bee.js","assets/index-9ba3f23e.js","assets/index-fecf00a2.css"]),ue(()=>import("./calcite-switch-da828524.js"),["assets/calcite-switch-da828524.js","assets/MapView-d4248bee.js","assets/index-9ba3f23e.js","assets/index-fecf00a2.css","assets/label2-d8fd57da.js","assets/interactive-573cbe88.js","assets/key-4e6b67a3.js","assets/loadable-25ad9e4e.js"]),ue(()=>import("./calcite-input-date-picker-7fa77311.js"),["assets/calcite-input-date-picker-7fa77311.js","assets/MapView-d4248bee.js","assets/index-9ba3f23e.js","assets/index-fecf00a2.css","assets/t9n-887c4f0a.js","assets/key-4e6b67a3.js","assets/observers-4f67f1fb.js","assets/openCloseComponent-01e91706.js","assets/debounce-31e0cfcc.js","assets/label2-d8fd57da.js","assets/interactive-573cbe88.js","assets/loadable-25ad9e4e.js","assets/Heading-ad98627e.js","assets/icon-04547cc0.js","assets/input-47dee16e.js","assets/progress-e872170e.js"]),ue(()=>import("./calcite-input-time-picker-edfc242a.js"),["assets/calcite-input-time-picker-edfc242a.js","assets/MapView-d4248bee.js","assets/index-9ba3f23e.js","assets/index-fecf00a2.css","assets/label2-d8fd57da.js","assets/guid-9426053f.js","assets/interactive-573cbe88.js","assets/key-4e6b67a3.js","assets/loadable-25ad9e4e.js","assets/t9n-887c4f0a.js","assets/observers-4f67f1fb.js","assets/icon-04547cc0.js","assets/action-5a45fce9.js","assets/loader-76c5fd82.js","assets/input-47dee16e.js","assets/progress-e872170e.js","assets/popover-e27ddf8d.js","assets/openCloseComponent-01e91706.js","assets/debounce-31e0cfcc.js","assets/Heading-ad98627e.js"])])}get feature(){return this.viewModel.feature}set feature(t){this.viewModel.feature=t}get formTemplate(){return this.viewModel.formTemplate}set formTemplate(t){this.viewModel.formTemplate=t}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get layer(){return this.viewModel.layer}set layer(t){this.viewModel.layer=t}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(t){this.viewModel.spatialReference=t}get strict(){return this.viewModel.strict}set strict(t){this.viewModel.strict=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}getValues(){return this.viewModel.getValues()}submit(){return this.viewModel.submit()}render(){const{state:t}=this.viewModel;return b("div",{class:this.classes(A.base,A.widget,A.panel)},t==="ready"?this.renderForm():null)}renderForm(){const t=this.viewModel,e=f(t.formTitle)&&b(oi,{key:"title",level:this.headingLevel},t.formTitle),i=f(t.formDescription)&&b("p",{class:A.description,key:"description"},t.formDescription),n=e||i?b("div",{class:A.formHeader},e,i):null;return b("form",{class:A.form,novalidate:!0,onsubmit:this._handleSubmit,onkeydown:this._handleFormKeyDown},n,this.renderFields())}renderFields(){const{viewModel:{inputFields:t}}=this;return t.filter(e=>e.visible).map((e,i)=>Ie(e)?this.renderGroup(e,i):this.renderLabeledField(e))}renderGroup(t,e){const{formTemplate:i,disabled:n}=this,{description:s,inputFields:a,label:o,state:u}=t,r=a.filter(E=>E.visible),l=this.viewModel.findField(this._activeInputName),c=!(!l||l.group!==t),p=`${this.id}_group_${e}`,h=`${this.id}_group-label_${e}`,v=`${this.id}_group-description_${e}`,_=s?b("p",{class:this.classes(A.groupDescription,A.description),id:v},s):null,y=this.groupDisplay==="sequential",x=y?c:u==="expanded",F=x?A.collapseIcon:A.expandIcon;return b("fieldset",{"aria-expanded":x.toString(),"aria-labelledby":h,"aria-describedby":s?v:"",class:this.classes(A.group,y?A.groupSequential:null,x?null:A.groupCollapsed,c?A.groupActive:null,n?A.inputDisabled:null),disabled:n,"data-group":t,id:p,key:e,onclick:this._handleGroupClick},b("button",{role:y?"presentation":void 0,class:A.groupHeader,type:"button",tabIndex:y?-1:0},b("div",{class:A.groupTitle},b(oi,{class:A.groupLabel,id:h,level:f(i)&&i.title?os(this.headingLevel):this.headingLevel},o),_),y?null:b("span",{class:this.classes(F,A.groupToggleIcon)})),r.map(E=>this.renderLabeledField(E)))}_getFocusableInput(t,e){const i=this.viewModel.allInputFields,n=t==="forward"?i:i.slice().reverse();let s;if(e)if(Ie(e))s=n.indexOf(e.inputFields[0]);else{let a;if(this._isInputFieldInGroup(e)&&e.group.state==="collapsed"){const{inputFields:o}=e.group;a=t==="forward"?o[o.length-1]:o[0]}else a=e;s=n.indexOf(a)+1}else s=0;for(let a=s;a<n.length;a++){const o=n[a];if(o.visible)return o}return null}renderLabeledField(t){const{feature:e,label:i,layer:n,type:s}=t;return b("label",{key:`${n.id}-${e.uid}-${t.name}`,class:A.label},[i,s!=="unsupported"?this.renderInputField(t):this.renderUnsupportedField(t),this.renderAuxiliaryText(t)])}renderInputField(t){const{domain:e,name:i,type:n,updating:s,value:a}=t,o=this.getCommonInputProps(t);if((e==null?void 0:e.type)==="coded-value"){if(fe(t.fieldElement,"switch")){const{fieldElement:r}=t;if(!(this._switchFieldsWithInitialIncompatibleValue.has(i)||a==null||r.input.onValue!==a&&r.input.offValue!==a))return this.renderSwitchInputField(t,o);this._switchFieldsWithInitialIncompatibleValue.add(i)}return t.inputType==="radio-buttons"?this.renderRadioButtonsInputField(t,e.codedValues.map(({code:r,name:l})=>({value:r,name:l})),o):this.renderSelectInputField(t,this._getFieldValueOptions(i,e),o)}if(t.inputType==="datetime-picker"||n==="date")return this.renderDateInputField(t,o);const u=n==="number"?b("input",{type:"number",...o,value:f(this._activeNumberFieldEdit)&&this._activeNumberFieldEdit.fieldName===t.name?this._activeNumberFieldEdit.value:`${o.value}`}):t.inputType==="text-area"?b("textarea",{...o}):b("input",{type:"text",...o});return s?b("div",{class:A.inputFieldWrapper},u,b("div",{class:A.inputFieldLoader},b("calcite-progress",{type:"indeterminate"}))):u}renderDateInputField(t,e){const{includeTime:i,label:n,name:s,valid:a,value:o}=t,{readOnly:u,required:r}=e,{date:l,time:c}=this._formatValueForDateInputs(o),p=f(e.max)?this._formatValueForDateInputs(e.max):void 0,h=f(e.min)?this._formatValueForDateInputs(e.min):void 0,v=(p==null?void 0:p.date)??void 0,_=(h==null?void 0:h.date)??void 0,y={afterCreate:this._afterDateInputCreate,afterUpdate:this._afterDateInputCreateOrUpdate,"aria-invalid":!a,label:n,numberingSystem:Ai,overlayPositioning:"fixed",readOnly:u,required:r,tabIndex:0,[Ne]:s};return b("div",{key:`${e.key}-date-time-container`,class:A.dateInputContainer},b("calcite-input-date-picker",{bind:this,...y,class:this.classes(e.class,A.inputDate),"data-date-part":"date",key:`${e.key}-date-input`,valueAsDate:l??void 0,maxAsDate:v,minAsDate:_,onCalciteInputDatePickerChange:x=>this._commitDateChanges(x.target),onblur:x=>this._commitDateChanges(x.target,!0)}),i?b("calcite-input-time-picker",{bind:this,...y,class:this.classes(e.class,A.inputTime),"data-date-part":"time",key:`${e.key}-time-input`,value:c??void 0,step:1,onCalciteInputTimePickerChange:x=>this._commitDateChanges(x.target),onfocus:x=>{x.target.calciteTimePickerEl&&(x.target.calciteTimePickerEl.showSecond=!0)},onblur:x=>this._commitDateChanges(x.target,!0)}):null)}renderUnsupportedField(t){const e=this.getCommonInputProps(t);return b("input",{afterCreate:e.afterCreate,afterUpdate:e.afterUpdate,class:this.classes(A.input,A.inputField,A.inputDisabled),onfocus:e.onfocus,readOnly:!0,tabIndex:e.tabIndex,type:"text",value:e.value,[Ne]:e[Ne]})}renderSelectInputField(t,e,i){const{value:n}=t,{messages:s,messagesTemplates:a}=this,o=e.map(p=>p.map(h=>b("calcite-combobox-item",{value:`${h.value}`,textLabel:h.name,key:`#${h.value}`,selected:n===h.value}))),[u,r]=o;this._registerIncompatibleValue(n,e.flat(),t,p=>{r.unshift(b("calcite-combobox-item",{value:`${p}`,textLabel:`${p}`,key:"incompatible-option",readOnly:!0}))});const l=r.length>0?[b("calcite-combobox-item-group",{key:"recommended",label:s.recommended},u),b("calcite-combobox-item-group",{key:"other",label:a.other},r)]:u,c=V(t.fieldElement)||fe(t.fieldElement,"combo-box")&&t.fieldElement.input.showNoValueOption;if(!t.required&&c){const p="",h=fe(t.fieldElement,"combo-box")&&t.fieldElement.input.noValueOptionLabel||this.messages.empty;l.unshift(b("calcite-combobox-item",{value:p,textLabel:this.messages.empty,key:"empty-option"},h))}return b("calcite-combobox",{...i,selectionMode:"single",disabled:i.readOnly,allowCustomValues:!1,onCalciteComboboxChange:p=>this._handleOptionChange(p.target)},l)}_registerIncompatibleValue(t,e,i,n){const s=this._fieldToInitialIncompatibleDomainValue,a=s.has(i.name);(a||t!=null&&t!==""&&!e.some(o=>o.value===t))&&(a||s.set(i.name,t),n==null||n(t))}renderRadioButtonsInputField(t,e,i){const{value:n}=t,s=e.map(o=>this.renderRadioButton({key:o.name,label:o.name,name:t.name,value:o.value,selected:o.value===n,props:i}));this._registerIncompatibleValue(n,e,t);const a=V(t.fieldElement)||fe(t.fieldElement,"radio-buttons")&&t.fieldElement.input.showNoValueOption;if(!t.required&&a){const o="",u=fe(t.fieldElement,"radio-buttons")&&t.fieldElement.input.noValueOptionLabel||this.messages.empty,r=n===o||n===null;s.unshift(this.renderRadioButton({key:"empty-option",label:u,name:t.name,value:o,selected:r,props:i}))}return b("div",{key:`${i.key}-radio`,class:A.inputRadioGroup},s)}renderSwitchInputField(t,e){const{value:i}=t,n=!!fe(t.fieldElement,"switch")&&i===t.fieldElement.input.onValue;return b("calcite-switch",{...e,class:A.inputSwitch,onCalciteSwitchChange:s=>this._commitInputValue(s.target),checked:n,disabled:e.readOnly})}renderRadioButton({key:t,name:e,value:i,selected:n,label:s,props:a}){return b("label",{key:t,class:A.inputRadioLabel},b("input",{...a,class:A.inputRadio,name:e,type:"radio",value:i,checked:n,disabled:a.readOnly,onchange:o=>this._commitInputValue(o.target)}),s)}renderAuxiliaryText(t){const e=this._userUpdatedInputFieldNames.has(t.name)&&!t.valid?t.errorMessage:f(this.viewModel.contingencyConstraintViolations.get(t.name))?this.messages.validationErrors.valuesIncompatible:f(t.valueExpressionExecutor)&&t.valueExpressionExecutor.stale?this.messages.valueExpressionError:null;return f(e)?b("calcite-input-message",{status:"invalid",icon:!0},e):t.description?b("div",{key:"description",class:A.description},t.description):null}getCommonInputProps(t){const{disabled:e,groupDisplay:i}=this,{editable:n,group:s,hint:a,label:o,maxLength:u,minLength:r,name:l,required:c,type:p,valid:h,value:v}=t,_=this._userUpdatedInputFieldNames.has(l),y=!n||e,x=i==="all"&&f(s)&&s.state==="collapsed";return{afterCreate:this._afterInputCreateOrUpdate,afterUpdate:this._afterInputCreateOrUpdate,"aria-invalid":h?"false":"true",class:this.classes(A.input,A.inputField,y?A.inputDisabled:null,_&&!h?A.inputInvalid:null),key:l,label:o,minlength:r>-1?`${r}`:"",maxlength:u>-1?`${u}`:"",...this._getNumberFieldConstraints(t),readOnly:y,value:v==null?"":`${v}`,[Ne]:l,onfocus:this._handleInputFocus,oninput:this._handleInputInput,onblur:this._handleInputBlur,onkeydown:this._handleInputKeyDown,onmousedown:p==="number"?this._handleNumberInputMouseDown:null,placeholder:p==="number"||p==="text"?a:"",required:c,tabIndex:x?-1:0}}_isInputFieldInGroup(t){return!Ie(t)&&f(t.group)}_handleNumberInputMouseDown({target:t}){t.focus(),this.scheduleRender()}_getFieldValueOptions(t,e){const i=e.codedValues.map(({code:s,name:a})=>({value:s,name:a})),n=this.viewModel.fieldsWithContingentValues.has(t)?this._getContingentValueOptions(t):[];if(n.length>0){const s=new Set(n.map(a=>a.value));return[n,i.filter(a=>!s.has(a.value))]}return[i,[]]}_getContingentValueOptions(t){const e={};for(const s of this.viewModel.allInputFields){const{name:a,value:o}=s;!V(o)&&a!==t&&this.viewModel.fieldsWithContingentValues.has(a)&&(e[a]=o)}const i=this.viewModel.joinedContingentValues.slice(),n=new Map;for(const s of i){const a=s.values[t];if(V(a)||a.objectType!=="code"&&a.objectType!=="null")continue;const{code:o,name:u}=a.codedValue&&a.objectType!=="null"?a.codedValue:{code:"",name:this.messages.empty};n.has(o)||Object.entries(e).every(([r,l])=>!s.values.hasOwnProperty(r)||this._valueIsValidContingentValue(l,s.values[r]))&&n.set(o,{name:u,value:o})}return[...n.values()]}_getInputFieldFromInput(t){return this.viewModel.findField(t.getAttribute(Ne))}_getNumberFieldConstraints(t){const e=Qi(t.domain)||Ki(t.field);return e&&e.max!==Number.MAX_VALUE&&e.min!==Number.MIN_VALUE?e:{min:null,max:null}}async _afterDateInputCreate(t){!Mt(t)&&f(t.value)&&"setValue"in t&&t.setValue({value:t.value,origin:"external"}),this._afterDateInputCreateOrUpdate(t)}_afterDateInputCreateOrUpdate(t){const{name:e}=this._getInputFieldFromInput(t),i=this._dateInputFieldMap.get(e),n=Mt(t);f(i)?n?i.date=t:i.time=t:this._dateInputFieldMap.set(e,{[n?"date":"time"]:t}),this._afterInputCreateOrUpdate(t)}_afterInputCreateOrUpdate(t){const{viewModel:e}=this,i=this._getInputFieldFromInput(t),n=e.findField(this._activeInputName),s=this._fieldToInitialIncompatibleDomainValue.get(i.name)===i.value;this._fieldFocusNeeded&&n===i&&(i.inputType!=="radio-buttons"||s||t.checked)&&(this._fieldFocusNeeded=!1,this._isInputFieldInGroup(i)&&(i.group.state="expanded"),t.focus())}_handleInputFocus(t){const e=t.target,i=this._getInputFieldFromInput(e);this._activeInputName=i.name,this._isNumberInputField(i)&&(this._activeNumberFieldEdit={fieldName:i.name,input:e,value:e.value})}_isNumberInputField({domain:t,inputType:e="text-box",type:i}){return i==="number"&&e==="text-box"&&(!t||t.type!=="coded-value")}_handleInputBlur(t){const e=t.target,i=this._getInputFieldFromInput(e);i.type==="number"&&f(this._activeNumberFieldEdit)&&(this._activeNumberFieldEdit.input.value=`${i.value}`,this._activeNumberFieldEdit=null),this._commitInputValue(e),this.scheduleRender()}_commitDateChanges(t,e=!1){const{name:i}=this._getInputFieldFromInput(t);if(!this._dateInputFieldMap.has(i))return;const n=this._dateInputFieldMap.get(i);if(!n||!n.date)return;const s=this._getFieldValueFromDateInput(t),a=this._getFieldValueFromDateInputs(n.date,n.time);this.viewModel.getValue(i)!==a&&(s!==null&&a!==null?this._updateFieldValue(i,a):e&&this._updateFieldValue(i,null))}_commitInputValue(t){const e=this._getInputFieldFromInput(t);f(this._activeNumberFieldEdit)&&this._isNumberInputField(e)&&(this._activeNumberFieldEdit.value=t.value),this._updateFieldValue(e.name,this._parseValue(t))}_handleInputKeyDown(t){const{key:e,altKey:i,ctrlKey:n,metaKey:s}=t,a=this._getInputFieldFromInput(t.target);if(e==="Enter")this._isInputFieldInGroup(a)&&a.group.state==="collapsed"&&(a.group.state="expanded");else{const{type:o}=a.field,u=o==="single"||o==="double";if((o==="integer"||o==="small-integer"||u)&&!i&&!n&&!s&&e.length===1){const r=Number(e),l=["-","+"],c=["e","."],p=u?[...l,...c]:l;isNaN(r)&&!p.includes(e)&&t.preventDefault()}}}_updateFieldValue(t,e){if(this.viewModel.setValue(t,e),this._userUpdatedInputFieldNames.add(t),this.viewModel.fieldsWithContingentValues.has(t)){const i=Object.fromEntries(Object.entries(this.getValues()).filter(([n,s])=>f(s)));this.viewModel.validateContingencyConstraints(i)}}_parseValue(t){const e=this._getInputFieldFromInput(t),i=t.value;if(fe(e.fieldElement,"switch")&&t.tagName!=="CALCITE-COMBOBOX")return t.checked?e.fieldElement.input.onValue:e.fieldElement.input.offValue;if(e.inputType==="radio-buttons"&&t.type==="radio"&&!t.checked)return e.value;const{type:n}=e;return n==="number"?i?parseFloat(i):null:i}_handleOptionChange(t){this._commitInputValue(t),this.scheduleRender()}_handleGroupClick(t){var a;const e=t.currentTarget["data-group"],i=e.state==="expanded",n=this.groupDisplay==="sequential",s=`.${A.groupHeader}`;if(!(i&&!t.target.closest(s))){if(this._activeInputName=((a=this._getFocusableInput("forward",e))==null?void 0:a.name)||"",n){const o=t.target.closest(s);if(i&&!o)return;this.viewModel.inputFields.forEach(u=>{Ie(u)&&u!==e&&(u.state="collapsed")})}e.state=i?"collapsed":"expanded",this._fieldFocusNeeded=n,this.scheduleRender()}}_handleSubmit(t){t.preventDefault()}_handleFormKeyDown(t){t.key==="Enter"&&this.viewModel.submit()}_getDefaultLocaleOptions(){return{locale:rs(),numberingSystem:Ai}}_getFieldValueFromDateInputs(t,e){const i=this._getDateTimeFromInput(t),n=this._getDateTimeFromInput(e);if(!i&&!n)return null;const s=this._getInputFieldFromInput(t),a=this._getNumberFieldConstraints(s),o=Date.now(),u=f(a.max)&&a.max<o?a.max:o,r=et.fromMillis(u,this._getDefaultLocaleOptions()),l=i||r,{year:c,month:p,day:h}=l,{hour:v,minute:_,second:y}=n||r,x=l.set({year:c,month:p,day:h,hour:v,minute:_,second:y});return x.isValid?x.toMillis():null}_getDateTimeFromInput(t){if(!t)return null;let e=null;if(Mt(t)){const i=t.valueAsDate;if(!i||Array.isArray(i))return null;e=et.fromJSDate(i)}else{if(!t.value)return null;e=et.fromFormat(t.value,Si,this._getDefaultLocaleOptions())}return e??null}_getFieldValueFromDateInput(t){return this._dateTimeToFieldValue(this._getDateTimeFromInput(t))}_dateTimeToFieldValue(t){return t!=null&&t.isValid?t.toMillis():null}_dateTimeFromFieldValue(t){return t===null?null:et.fromMillis(t,this._getDefaultLocaleOptions())}_formatValueForDateInputs(t){if(t==null||isNaN(t))return{date:null,time:null};const e=this._dateTimeFromFieldValue(t);return e?{date:e.toJSDate(),time:e.toFormat(Si,this._getDefaultLocaleOptions())}:{date:null,time:null}}_valueIsValidContingentValue(t,e){var i;switch(e.objectType){case"any":return!0;case"null":return t==null;case"code":return t===((i=e.codedValue)==null?void 0:i.code);case"range":return f(t)&&f(e.minValue)&&f(e.maxValue)&&t>=e.minValue&&t<=e.maxValue;default:return qi(e.objectType),!1}}};d([m()],K.prototype,"disabled",void 0),d([m()],K.prototype,"feature",null),d([m()],K.prototype,"formTemplate",null),d([m()],K.prototype,"groupDisplay",void 0),d([m()],K.prototype,"headingLevel",void 0),d([m()],K.prototype,"label",null),d([m()],K.prototype,"layer",null),d([m(),We("esri/widgets/FeatureForm/t9n/FeatureForm")],K.prototype,"messages",void 0),d([m(),We("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],K.prototype,"messagesTemplates",void 0),d([m()],K.prototype,"spatialReference",null),d([m()],K.prototype,"strict",null),d([m()],K.prototype,"view",null),d([m(),zi(["value-change","submit"])],K.prototype,"viewModel",void 0),K=d([J("esri.widgets.FeatureForm")],K);const fa=K,ga=Ke("correctFeature",()=>{let t;const e=ce().getView(),i=new Ji({elements:[{type:"group",label:"基本信息",description:"展示景点基本信息",elements:[{type:"field",fieldName:"名称",label:"名称",editableExpression:"return false"},{type:"field",fieldName:"pointstime",label:"日期",editableExpression:"return false"},{type:"field",fieldName:"类型名称",label:"类型名称",editableExpression:"return false"}]},{type:"group",label:"修正分类",description:"执行修正景点分类的操作",elements:[{type:"field",fieldName:"class",label:"景点分类",editableExpression:"return true",input:{type:"combo-box",showNoValueOption:!1},domain:{type:"coded-value",name:"class",codedValues:[{name:"环境优美",code:"环境优美"},{name:"环境良好",code:"环境良好"},{name:"环境一般",code:"环境一般"},{name:"环境较差",code:"环境较差"},{name:"环境恶劣",code:"环境恶劣"}]}}]}]});let n;async function s(r,l,c){await l.queryFeatures({objectIds:[r],outFields:["*"],returnGeometry:!0}).then(p=>{p.features.length>0&&(t=p.features[0],c.feature=t)})}function a(r,l){l.applyEdits(r).catch(c=>{console.log("==============================================="),console.error("[ applyEdits ] FAILURE: ",c.code,c.name,c.message),console.log("error = ",c)})}function o(r){const l=e.map.layers.find(c=>c.id==="points");l.formTemplate=i,n=new fa({view:e,container:r.value,groupDisplay:"sequential",layer:l}),e.on("click",c=>{e.hitTest(c).then(p=>{if(p.results.length===0)return;const h=p.results[0];h.graphic&&h.graphic.layer===l&&s(h.graphic.attributes.FID,l,n)})}),n.on("submit",()=>{if(t){const c=n.getValues();Object.keys(c).forEach(h=>{t.attributes[h]=c[h]}),a({updateFeatures:[t]},l)}})}function u(){n.submit()}return{createFeaturefrom:o,submitForm:u}}),va=`@charset "UTF-8";.correction-card{display:flex;flex-direction:column;position:fixed;left:0%;bottom:10%;width:30%;height:auto;border-radius:6px;background-image:linear-gradient(-90deg,#182940 0%,#115687 100%);pointer-events:auto;border:0px solid var(--el-card-border-color)}.correction-card__header{display:flex;justify-content:space-between;align-items:center;color:#fff;font-size:1.6rem;font-weight:700;font-style:italic}.esri-feature-form{color:#92c3e4;background-image:linear-gradient(-90deg,#182940 0%,#115687 100%)}.esri-feature-form__description-text{color:#49c5f2a6}
`,ya={class:"box-card__header"},_a=N("span",null,"景点修正",-1),ba=rt({__name:"correction",setup(t){const{createFeaturefrom:e,submitForm:i}=ga(),n=B(null);function s(){i()}lt(()=>{e(n)});const a=document.createElement("style");return a.setAttribute("lang","scss"),a.innerHTML=va,document.head.appendChild(a),(o,u)=>(de(),De(M(qt),{class:"correction-card"},{header:G(()=>[N("div",ya,[_a,O(M(Lt),{class:"button",text:"",style:{color:"#28c3e2","font-size":"18px","font-weight":"bold","font-style":"italic"},onClick:s},{default:G(()=>[Pe("提交表单 ")]),_:1})])]),default:G(()=>[N("div",{class:"correction-featureFrom",ref_key:"correctionRef",ref:n},null,512)]),_:1}))}}),Mi=Ke("pointslayer",()=>{let t=null;function e(){let s=ce().getView();t=cs(),s.map.add(t);const a=new Ot({title:"{名称}",content:[{type:"fields",fieldInfos:[{fieldName:"名称",label:"名称"},{fieldName:"类型名称",label:"类型名称"},{fieldName:"longitude",label:"经度"},{fieldName:"latitude",label:"纬度"},{fieldName:"高程",label:"高程"}]}]});t.popupTemplate=a,s.popup.dockEnabled=!1,s.popup.collapsed=!0,s.popup.dockOptions={buttonEnabled:!1,breakpoint:!1,position:"bottom-right"}}function i(s){ce().getView().watch("updating",o=>{o||(s.value=!1)})}function n(){ce().getView().map.removeAll()}return{addpointslayer:e,removepointslayer:n,ispointslayerLoaded:i}}),xa=N("div",{class:"box-card__header"},[N("span",null,"景点管理")],-1),Wa=rt({__name:"index",setup(t){const e=B(!0),i=`
        <path class="path" d="
          M 30 15
          L 28 17
          M 25.61 25.61
          A 15 15, 0, 0, 1, 15 30
          A 15 15, 0, 1, 1, 27.99 7.5
          L 15 15
        " style="stroke-width: 4px; fill: rgba(0, 0, 0, 0)"/>
      `,n=B(null),s=B(null),a=B(null),o=B(!0),u=B(!1),r=B(!1),l=B(!1),c=B(!1),p=B(!0);ls(s);const h=B(0),v=B(!1);let _=[u,r,l];function y(F){if(F===0)for(let E=1;E<_.length;E++)_[E].value=!1;else _[0].value=!1}const x=()=>{c.value=!0};return lt(()=>{setTimeout(()=>{const F=Mi(),E=Xi(),g=Zi();x(),F.addpointslayer(),F.ispointslayerLoaded(o),g.createTimeslider(n),E.createTimeHeatmap(a.value,h,v)},100),Yt(r,F=>{F||(l.value=!1)}),Yt(h,F=>{F===100&&(e.value=!1)})}),zt(()=>{Mi().removepointslayer()}),En("watchV2",p),(F,E)=>{const g=vn("loading");return de(),Be("div",{ref_key:"screenRef",ref:s,class:"screen"},[v.value?(de(),De(M(Ni),{key:0,type:"circle","stroke-width":15,percentage:h.value,style:{position:"absolute",left:"18%",top:"17%","pointer-events":"auto",height:"auto"}},null,8,["percentage"])):je("",!0),O(bn,{name:"right-slide-in"},{default:G(()=>[O(M(qt),{class:"box-card",style:yn({left:c.value?"0%":"-380px"}),"body-style":{height:"80%"}},{header:G(()=>[xa]),default:G(()=>[O(M(xn),{justify:"space-between"},{default:G(()=>[O(M(ft),{style:{height:"33.33%"}},{default:G(()=>[O(M(gt),null,{default:G(()=>[Pe("景点环境监测")]),_:1}),_n(O(M(vt),{modelValue:u.value,"onUpdate:modelValue":E[0]||(E[0]=T=>u.value=T),class:"box-card__switch",size:"large",style:{"margin-left":"8%"},"inline-prompt":"","active-icon":M(yt),"inactive-icon":M(_t),disabled:o.value,onChange:E[1]||(E[1]=T=>y(0)),"element-loading-text":"Loading...","element-loading-spinner":i,"element-loading-svg-view-box":"-10, -10, 50, 50","element-loading-background":"rgba(122, 122, 122, 0.8)"},null,8,["modelValue","active-icon","inactive-icon","disabled"]),[[g,e.value]])]),_:1}),O(M(ft),{style:{height:"33.33%"}},{default:G(()=>[O(M(gt),null,{default:G(()=>[Pe("景点模糊分类")]),_:1}),O(M(vt),{modelValue:r.value,"onUpdate:modelValue":E[2]||(E[2]=T=>r.value=T),class:"box-card__switch",size:"large",style:{"margin-left":"8%"},"inline-prompt":"","active-icon":M(yt),"inactive-icon":M(_t),disabled:o.value,onChange:E[3]||(E[3]=T=>y(1))},null,8,["modelValue","active-icon","inactive-icon","disabled"])]),_:1}),O(M(ft),{style:{height:"33.33%"}},{default:G(()=>[O(M(gt),null,{default:G(()=>[Pe("修正旅游景点")]),_:1}),O(M(vt),{modelValue:l.value,"onUpdate:modelValue":E[4]||(E[4]=T=>l.value=T),class:"box-card__switch",size:"large",style:{"margin-left":"8%"},"inline-prompt":"","active-icon":M(yt),"inactive-icon":M(_t),disabled:p.value,onChange:E[5]||(E[5]=T=>y(2))},null,8,["modelValue","active-icon","inactive-icon","disabled"])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1}),N("div",{class:"timeSlider",ref_key:"timeSliderRef",ref:n},null,512),N("div",{class:"lengend",ref_key:"lengendRef",ref:a},null,512),u.value?(de(),De(Os,{key:1})):je("",!0),r.value?(de(),De(Ws,{key:2})):je("",!0),l.value?(de(),De(ba,{key:3})):je("",!0)],512)}}});export{Wa as default};
