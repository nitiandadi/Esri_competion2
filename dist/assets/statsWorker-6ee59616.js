import{a2 as C,es as O,et as _,eu as j,bS as A,o as R,ev as q,r as g,bM as B,ew as k,ex as G}from"./MapView-d4248bee.js";import{c as M,D as Y,m as U,f as W,d as Z,T as H,y as J,x as K,z as L,S as Q,M as X}from"./utils-5fb83578.js";let x=null;function aa(e,a,n){return e.x<0?e.x+=a:e.x>n&&(e.x-=a),e}function ea(e,a,n,t){const i=_(n)?j(n):null,o=i?Math.round((i.valid[1]-i.valid[0])/a.scale[0]):null;return e.map(r=>{const l=new A(R(r.geometry));return q(a,l,l,l.hasZ,l.hasM),r.geometry=i?aa(l,o,t[0]):l,r})}function ia(e,a=18,n,t,i,o){const r=new Float64Array(i*o);a=Math.round(B(a));let l=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,u=0,f=0,d=0,c=0;const z=k(t,n);for(const{geometry:T,attributes:v}of e){const{x:p,y:m}=T,I=Math.max(0,p-a),F=Math.max(0,m-a),D=Math.min(o,m+a),E=Math.min(i,p+a),P=+z(v);for(let $=F;$<D;$++)for(let w=I;w<E;w++){const b=$*i+w,N=G(w-p,$-m,a),S=r[b];u=r[b]+=N*P;const V=u-S;f+=V,d+=V*V,u<l&&(l=u),u>s&&(s=u),c++}}if(!c)return{mean:0,stddev:0,min:0,max:0,mid:0,count:0};const y=(s-l)/2;return{mean:f/c,stdDev:Math.sqrt((d-f*f/c)/c),min:l,max:s,mid:y,count:c}}async function h(e,a){if(!a)return[];const{field:n,field2:t,field3:i,fieldDelimiter:o}=e,r=e.valueExpression,l=e.normalizationType,s=e.normalizationField,u=e.normalizationTotal,f=[],d=e.viewInfoParams;let c=null,z=null;if(r){if(!x){const{arcadeUtils:v}=await C();x=v}c=x.createFunction(r),z=d&&x.getViewInfo({viewingMode:d.viewingMode,scale:d.scale,spatialReference:new O(d.spatialReference)})}const y=e.fieldInfos,T=!(a[0]&&"declaredClass"in a[0]&&a[0].declaredClass==="esri.Graphic")&&y?{fields:y}:null;return a.forEach(v=>{const p=v.attributes;let m;if(r){const I=T?{...v,layer:T}:v,F=x.createExecContext(I,z);m=x.executeFunction(c,F)}else p&&(m=p[n],t&&(m=`${M(m)}${o}${M(p[t])}`,i&&(m=`${m}${o}${M(p[i])}`)));if(l&&typeof m=="number"&&isFinite(m)){const I=p&&parseFloat(p[s]);m=Y(m,l,I,u)}f.push(m)}),f}function fa(e){const a=e.field,n=e.normalizationType,t=e.normalizationField;let i;return n==="field"?i="(NOT "+t+" = 0)":n!=="log"&&n!=="natural-log"&&n!=="square-root"||(i=`(${a} > 0)`),i}function da(e,a,n){const t=a!=null?e+" >= "+a:"",i=n!=null?e+" <= "+n:"";let o="";return o=t&&i?na(t,i):t||i,o?"("+o+")":""}function na(e,a){let n=g(e)?e:"";return g(a)&&a&&(n=n?"("+n+") AND ("+a+")":a),n}async function ta(e){const{attribute:a,features:n}=e,{normalizationType:t,normalizationField:i,minValue:o,maxValue:r,fieldType:l}=a,s=await h({field:a.field,valueExpression:a.valueExpression,normalizationType:t,normalizationField:i,normalizationTotal:a.normalizationTotal,viewInfoParams:a.viewInfoParams,fieldInfos:a.fieldInfos},n),u=U({normalizationType:t,normalizationField:i,minValue:o,maxValue:r}),f={value:.5,fieldType:l},d=l==="esriFieldTypeString"?W({values:s,supportsNullCount:u,percentileParams:f}):Z({values:s,minValue:o,maxValue:r,useSampleStdDev:!t,supportsNullCount:u,percentileParams:f});return H(d,l==="esriFieldTypeDate")}async function la(e){const{attribute:a,features:n}=e,t=await h({field:a.field,field2:a.field2,field3:a.field3,fieldDelimiter:a.fieldDelimiter,valueExpression:a.valueExpression,viewInfoParams:a.viewInfoParams,fieldInfos:a.fieldInfos},n),i=J(t);return K(i,a.domains,a.returnAllCodedValues,a.fieldDelimiter)}async function oa(e){const{attribute:a,features:n}=e,{field:t,normalizationType:i,normalizationField:o,normalizationTotal:r,classificationMethod:l}=a,s=await h({field:t,valueExpression:a.valueExpression,normalizationType:i,normalizationField:o,normalizationTotal:r,viewInfoParams:a.viewInfoParams,fieldInfos:a.fieldInfos},n),u=L(s,{field:t,normalizationType:i,normalizationField:o,normalizationTotal:r,classificationMethod:l,standardDeviationInterval:a.standardDeviationInterval,numClasses:a.numClasses,minValue:a.minValue,maxValue:a.maxValue});return Q(u,l)}async function ra(e){const{attribute:a,features:n}=e,{field:t,normalizationType:i,normalizationField:o,normalizationTotal:r,classificationMethod:l}=a,s=await h({field:t,valueExpression:a.valueExpression,normalizationType:i,normalizationField:o,normalizationTotal:r,viewInfoParams:a.viewInfoParams,fieldInfos:a.fieldInfos},n);return X(s,{field:t,normalizationType:i,normalizationField:o,normalizationTotal:r,classificationMethod:l,standardDeviationInterval:a.standardDeviationInterval,numBins:a.numBins,minValue:a.minValue,maxValue:a.maxValue})}async function sa(e){const{attribute:a,features:n}=e,{field:t,radius:i,fieldOffset:o,transform:r,spatialReference:l,size:s}=a,u=ea(n,r,l,s),{count:f,min:d,max:c,mean:z,stdDev:y}=ia(u,i,o,t,s[0],s[1]);return{count:f,min:d,max:c,avg:z,stddev:y}}const ca=Object.freeze(Object.defineProperty({__proto__:null,classBreaks:oa,heatmapStatistics:sa,histogram:ra,summaryStatistics:ta,uniqueValues:la},Symbol.toStringTag,{value:"Module"}));export{na as N,da as b,ra as c,ta as d,h as j,la as p,ca as s,oa as v,fa as x,sa as z};
